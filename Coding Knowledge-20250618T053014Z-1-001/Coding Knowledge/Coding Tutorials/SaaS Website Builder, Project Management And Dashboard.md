---

Title: SaaS Website Builder, Project Management And Dashboard: Nextjs14, Bun, Stripe Connect, Prisma, MySQL

---

what if I told you that you too could have superpowers superpowers to build anything you ever imagined what you're about to witness is far beyond any web application you have ever known this project has been 2 months in the making all just to bring it right into your hands plura is a wh labeled mult tenant SAS application that empowers agency owners a market that has not been tapped into yet we will be using bun stripe connect NEX js14 shaty Nui Tailwind CSS Prisma and clerk authentication even if you are a beginner you can follow through with my guidance I will be breaking down the architecture of this entire project you will not only understand the front end of things but also the behind the scenes now what I'm about to explain is extremely important to ensure that you have a smooth development process and at the same time understand what you are building so please pay attention first we will build a fully functional landing page where agency owners can sign up with our platform after logging in the agency owner is prompted to create an agency and fill in all the required information to start on boarding upon submitting the form the user is redirected to the agency dashboard where they can navigate to the Launchpad to start their onboarding process the sidebar on the left is dynamically pulled from the database you can also search and filter for specific sidebar options and here is something that I have never found on YouTube before I have Incorporated stripe connect which means not only can we use stripe to charge month-to-month subscriptions for our platform but we can also connect the users stripe account into our application we we have also gone above and beyond with stripe and have included the ability to charge platform fees from all transactions that happen within all sub accounts even better if the sub account sells a subscription service we get a piece of the cake every single month when the subscription is successful when the agency owner starts their stripe onboarding process they are prompted with two options either to create a stripe account or to connect an existing stripe account into our application once they connect their account they are redirected back to their Launchpad to ensure that their onboarding process was successful indicated with the blue check icon now the agency owner can access their dashboard and see performance metrics agency owners can upgrade to paid plans to get access to premium features by clicking on the building section in the sidebar the billing page also has a ton of add-on products they can subscribe to these to get access to additional features and of course add-on products are completely customizable and I'm going to show you how you can create your own add-on products as well once the user clicks on the upgrade button we will show a custom stripe form and this gives a much more professional White Glove onboarding experience to your customers I'm sure you've seen the traditional stripe hosted page on every single YouTube video so I decided to just go one step further and show you how you can use a custom stripe form to do the same once the user puts your credit card information and hit submit their payment is successful and if the user Scrolls to the bottom they can see their subscription charges in the transaction table the user can also upgrade to a higher plan with just one click of a button and they will be build only once the existing subscription has ended agency owners can create sub accounts for their clients by clicking on the dropdown or by clicking on the sub accounts tab which shows a list of all the sub accounts they own they can also search and and filter through these as well now let me explain what is the purpose of these sub accounts as an agency owner you might have multiple clients and managing all of them on one single application can be a little difficult so what we did is we gave the agency owner the ability to create sub accounts for their clients and each sub account gets access to a bunch of amazing features if we try to create a sub account a modal pops up prompting the agency owner for the information but the coolest part is this is not done using a library like zo stand we will be building a Global provider completely from scratch to show you what actually happens under the hood the agency owner can update both the Agency information and their own personal information inside the settings tab they can also set goals for their agency by increasing the number of clients in the step component another cool feature is that agency owners can also invite staff members to assist them with running their business operations they can do this by sending an email requesting the staff member to log into plura to access the agency account and they can also fine-tune the level of access each staff member can have by toggling their access for each sub account now this part is really cool the agency owner can also invite sub users into the application to give them access to their own sub account so just as an example I have invited a sub user here and when they log into the application they will see a custom unauthorized page until the agency owner gives them permission to view their sub accounts now let's move on to the sub accounts view sub accounts are also required to connect your stripe account to see metrics and to sync their stripe products directly into the app the onboarding process is very similar to the agency onboarding process and once they have successfully completed it the check icon shows in the Launchpad as you can see in the sidebar sub accounts have access to a bunch of really really cool features the first one is the media bucket sub account users can upload images and store them safely in their media bucket the contact Section helps the sub account user keep track of all the leads that come in through their website and I know we haven't spoken about websites yet but when we do you are definitely going to be impressed they can also see if a contact is an active or inactive lead with their estimated ticket value showing on the right side of the table the next section is pipelines subac account users can create conon likee boards which we call pipelines and these pipelines can have lanes and tickets to keep track of their business processes when a ticket is created we fill in the information for service request and we can also assign the ticket to a contact if it exist and not only that we can also assign the ticket to team members that have access to the sub account and here's another cool feature we can also label and place tags on each ticket to provide us with more information on the type of services that need to be performed these pipelines can be used for anything that has a life cycle such as lead generation or booking appointments and even cooler you can drag and drop and reorder the lanes and the tickets as well now just to show you since we created a ticket that has a customer assigned to it we can see in the contact Section that specific contact has an estimated value in the right side of the table subac account users can create funnels and websites and host them on custom domains within the application after creating a funnel by filling in the details the user can also View and edit these settings in the settings tab of the funnel we can create multiple funnel steps directly in this section you can also update the path for each section in the settings tab the order of the funnel steps can also be rearranged in whatever manner you like and what's really cool about the funnel steps is that when a user submits their information through a website they automatically get redirected to the next part in the funnel if you head into the settings tab you'll also notice that you can search for all the products that the user has in their stripe account and these products automatically sync in directly from their stripe you can choose to set which products you want live so that the sub user can accept payments directly from this specific funnel to edit the funnel page in the Builder all the user has to do is click on the placeholder image and the funnel Builder shows up on the page with a beautiful animation with all the powerful features in one place and just for your information every feature you see in this website builder is built completely from scratch including the drag and drop functionality for the components which again I'm going to show you in great detail so that you can add to this and build your own custom components the user can change the funnel page Name by double clicking on the title and changing it to whatever they like and when the user clicks outside the title the changes are saved in the database the navigation bar on the top also has other relevant information like the updated timestamp and the path of the page and here's a really cool feature the user can also switch between different responsive views to see what their website would look look like on different devices the preview icon up top allows the user to view the website as if it was in production to help to make a better decision for uiux you can also switch back to the editor mode by clicking the close preview icon on the left hand side and here's something that's definitely going to impress you we also built a fully functional undo and redo feature that keeps track of every action the user performs including clicking different elements on the scen screen this is what a website would look like fully built out in editor mode changing the values of the text inside the elements is as simple as double clicking and changing them when the user clicks on the elements on the page a badge shows on the top left providing more information on the element being selected you can also delete the element from The View and bring it back if needed by hitting the undo button on the right hand side you will see a beautiful minimalistic editor that allows you to change almost every every single CSS property you want and I have made this architecture in such a way that creating new properties and expanding on these are as easy as copy paste when the user clicks on an element the properties automatically populate so that you can see what properties are being set on that element we also have a custom section up top where I will show you how to create custom property values for any element you create as if this wasn't enough we also went above and beyond and created more tabs under the section the first one is the components tab which has a bunch of layouts and elements that the user can simply drag and drop on their page and as you can see this drag and drop feature is built completely natively with the way I have set up this project you can create almost any component in just one simple step-by-step process which I have not only broken down in the video but I have also provided the diagram the illustration to everybody in the private community that is in in the description below to create a stripe checkout page all the user has to do is drag and drop the stripe component and stripe will automatically sync all the products that are live on this funnel the contact component allows the user to capture lead information and once the user submits the form the details are saved inside the contact Section the video component also helps build beautiful vssl Pages or funnels to keep the user engaged on the website we have used the power of client components and directly embedded the media bucket in here so that users can copy links to their images and use them as assets for their website all they have to do is copy and paste the link in the background image property and the image will show on the website even cooler a preview of the image shows in the color swatch and the same applies to background color as well finally the layers tab shows a full breakdown of every element on the page in a tree structure so that you can easily access elements from here to make it super userfriendly to build more pages with the same theme we have Incorporated a feature where the user can simply duplicate the funnel page and change only what is needed to create a new page now since the website is hosted under a subdomain you can click the live production link which will take you to the live website and as you can see the URL shows the subdomain that the user created if website visitors try to access a page or a subdomain that does not exist a 404 page is shown indicating that the page is not available we have also built notifications in the Navar up top when an agency owner is viewing a sub account they can filter all the notifications that only belong to that sub account we also have a mod toggle button in the navbar which allows the user to switch between light and dark mode hey guys this Pon here I hope you enjoyed that amazing demo I had to do a lot of research to actually put something like this for you and the best part is it's completely free and I'm not charging you even a single dollar here is all I ask in return first you actually take action go get your laptop and build this entire project with me and I'm going to guide you through the entire process the second thing is I want to give you more free resources because I want to help you reach your goal if you look in the description you will find a private community that Community is completely free if you join now while this community Community is open every single course that I upload in that Community will be free for you and then hopefully in the future I win your trust and then you give me the opportunity to Mentor you and get you to your goals now with that being said only join this community if you are ready to take action and you want to start freelancing because we are going to be releasing a free completely free freelance course so that you can get your first client and finally the most important thing all I asking is you click that subscribe button because we are going to be the biggest and the best web development community on YouTube and I really believe in that and I hope you guys do too all right prodigies I hope you have fun building out this entire project and I will see you in the community I am super hyped for this video if you haven't already go ahead and grab your laptop because we are going to be building this entire app together okay see this is action- driven content so if you want to take action this is the best way okay so the first thing we want to do is we're going to create a folder in here so just anywhere wherever you want create a folder and we're going to change this to web prodigies uh SL plura okay don't forget this name it like this and then you want to drag this project into your Visual Studio code okay and that's just going to open it up for you so for this entire project we are going to be using bun and if you don't know what bun is just quickly look it up what is bun like this and it's going to show you go ahead and install bun into your computer okay so I'm going to assume that you've already installed it and I'm going to proceed so what we need first is create next app so we're going to say bun X create-- next- apppp at latest space and period okay and go ahead and hit enter and it's going to give you this so hit yes for typescript yes for ES lint yes for this yes for this as well app router yeah of course we need app router also guys please use SSE directory okay it's needed for this project I mean at least I like it and I prefer you use the same settings okay we're going to hit no for this option and let's just give that a second to spin up wow see that was so quick I couldn't even say let's wait for that awesome so guys please please open the dis uh not Discord sorry please open your GitHub and keep it on the right side okay you're going to need this uh because we're going to copy paste a bunch of things go ahead and create a EnV file and copy these just copy it for now okay we just need these EnV variables we're going to populate in just a second first thing is we're going to just spin up our upload thing open up upload thing create an account if you haven't already and it's going to create an app or something like that okay it's going to look something like this I've already built I've already created the app so once you create the app it's going to take you to click on API keys and uh copy this here come in here and just replace these two things with that API key we're going to use upload thing to basically upload images files and things like that so we need this okay so go ahead and do that awesome the next thing is we are going to use Shad CN UI for theming designing or components and things like that and and by the way Shad CN has become one of the most used it's not a library right it's like a copypaste component they just had a new update and it's just gotten so much better so uh go ahead and scroll up top and you're going to see installation click on that by the way don't immediately install give me a second I'm going to show you what to do click on the bun command open your uh terminal paste that right after in it you want to hit add okay go ahead and hit enter and that's going to give you a bunch of things so so let's hit yes for this for typescript yes for default cuz we want default you can use whatever you want and now our CSS file is actually inside the app directory so we're going to say SRC SL make sure there's no spaces y SRC /a/ global. CSS and hit enter and now we want to use variable to hit yes just leave this blank um tail when this is good and then hit components hit yes hit enter for react server components hit yes and hit enter for this as well as well awesome so that's going to go ahead and install everything we need okay so small problem here it looked like it didn't install the components so let's go ahead and do that one more time so we're going to copy this and what we're going to do is just remove in it and just say add and let's hit enter okay now it works and you want to hit a so once it prompts you with these you know radio buttons hit a and then hit enter and that's going to install all the components for you this is just so much more quicker so that we don't have to go back and forth and use all the components it's too too much of a hassle okay awesome now that we have upload thing uh there's a couple more things that I want to address hey this is paren here from the future in the next section of this video we are going to be setting up our database so in development we will use a local database and when we deploy we will switch to a production database okay but for whatever reason if you have a problem setting up the local database on your local machine look at the timestamps scroll to the deployment section and watch the first part of that okay in that section I will show you how you can directly use the production URL link we are going to be using a local database for local development and then we're going to quickly swap to our production database by simply changing one string how cool is that it's very important in production environment specifically we're going to be using MySQL workbench so if you don't know what this is don't worry I'm going to try my best to explain okay quickly look up what is my SQL workbench and it's going to give you this go ahead and install this okay once you install it it's going to look like this and by the way when you install it's going to ask you for a root password do not forget that password okay I forgot and it took me a very hard very long time to get back into it so make sure you remember that password so once that is done you want to hit this plus icon okay and it's going to show you something like this go ahead and put plura up top and type it exactly the same way that I am okay type in plura and just take a look at this port so just remember this okay this is root this is good good as well and you know you already remember your password awesome so just go ahead and hit okay I already created it and it's going to take you into this okay the root account has all access so that's good awesome and we need to create the URL so I'm going to uh just copy paste this give me one second okay so go ahead and type this all right type it the way I'm typing it which is MySQL this do/ root which is the user account right so we're just going to use root and this dot here we're going to write test this is the password okay not this this part only and then at local host and remember that's uh Local Host um Port we saw right so go ahead and put that port and for this one we're just going to put plur I think this is what we created let me make sure so just go ahead and type that in there as well and we're going to populate the other stuff later okay so for now since we're using local database I'll copy that and paste it inside the database URL for now um in here okay awesome okay awesome so it looked like first it failed for some reason so I just did it one more time and it worked so great if that happened that's the solution all right just do it one more time now the next thing is we want to go into our next config file and we're just going to paste in a couple things in here okay so you can again go back into the GitHub right in there so I'm just going to click on that config file I'm just going to get the images for now okay we'll we'll leave everything else for now okay we'll just get this we're just going to remove the strict mode as well and the reason why we're removing it right here is because um when we're using some of libraries it causes some problems okay so that's why we're just going to remove it for now and uh let's go ahead and run Bun Run Dev to make sure everything is running as expected I'm just going to say Local Host and let that run and let's so it looks like I need to upgrade my nodejs all right so it looked like um it I mean it basically told me I need to upgrade my node version right here it said I need to be greater than 18.7 so what I usually use is NVM but for some reason it's not not on my computer I don't know why go ahead and look up NVM okay node version manager I'll actually put the link in the description okay open up this package U scroll here click on installation copy this command if you're on a Mac and paste it in here okay and hit enter I already did that so I'm not going to do that and that's going to go ahead and run a script okay and once that is done make sure you close the terminal so close this and open up another terminal again and then you just have to hit NVM okay and it's going to show you you know it's going to do something basically basically that's how you install node version manager and we actually use this for production builds so it's very easy to switch between node versions and in fact production applications do not use the latest version of node so you would always have to revert so having this tool is definitely going to come in hand okay the other easy version is I think you can just go to node.js and like download it from there but we use this all the time so just wanted to give you a heads up awesome okay so once that is done go ahead and type NV M want to say use node okay this is going to use the latest version of nodejs so just go ahead and hit enter let's do this I think this should install it and let's just give that one second okay awesome and I think it's already using the latest version of node so we don't have to worry about anything but that's okay I just wanted to show you guys how to do it in case you came across this bug and if you have any problems just reach out to me in the Discord the Discord is literally blowing up everyone is helping each other out so if you need any help I'll be there to help okay awesome so I'm just going to close this again and let's run this command and hope everything works okay awesome now when you type NVM uh also you might have to restart your Visual Studio code so you can probably just reload it like this by hitting command shift p and just reload that or you can shut down and open a you want and let's go ahead and say Bun Run Dev okay that spun that up and all of you guys had this problem last time which is you were like why is this stopping here why is my file not coming I mean not showing up on the browser well that's because no no nextjs does not work that way for nextjs you have to make a request to the server to get a file okay and that's why you need to refresh this okay so go in here enter so make a request to Local Host and then you're going to see the code awesome let's move on okay the next thing we need is clerk because we're going to be using clerk for authentication okay so go ahead and look up clerk.com and hit enter and go ahead and do the same thing okay log in create an account all that kind of stuff so I'm going to go ahead and do that just give me a second all right so I went ahead and created an account hopefully you hopefully you did it as well so you want to get to this page and you want to click on ADD application turn off the email address put plura in here I'm just going to put all small letters and go ahead and hit create application okay that's going to take you to another page okay scroll in here copy this and you want to go in here and you want to replace the first two environment variables with what you just copied okay we're going to need this and then we're going to populate these two things when we I mean these four things things when we need it as well but right now this is all you have to do okay and the next thing we need is clerk themes and clerk themes actually helps us change this to a dark mode or light mode whatever you like so go ahead and copy this command they're using npm so we're not going to use npm so I'm just going to Quick Quit the server here so we're going to say bunad at clerk SL teams go ahead and hit enter and let that install so once that is done we need to install a couple more things okay so let's go ahead and also populate these values I'm just going to paste it in here and it's just HTTP localhost 3000 uh with the trailing slash okay don't forget to add that and same thing here Local Host 3000 and this scheme is just going to be HTTP for now okay awesome so we got to do a couple things now to set this up so let me uh see in here okay so uh we have to do some quick changes here so let me go into the Tailwind config file so we have to wrap this whole uh export with with the upload thing that we just created so let's shrink this I'm going to copy all of this stuff and I'm going to go ahead get with UT so which comes from upload thing all right and now we're just going to change this as well so uh we're just going to change this to the following so just go ahead and put this for the public URL for the and don't forget the trailing slash okay and put this for the scheme and now we're going to go back to upload thing because we need to also install it we only created the project right so go ahead and open up the terminal and you can uh go to your project so you'll be in here right you'll be into you'll be in here click on documentation and that's going to take you to the documentation file right here okay so we're going to use bun so click on bun copy this and paste it in your terminal go ahead and hit enter I think we already populated all these variables so this is fine so now go into your Tailwind doc config.js file okay so just change just change this to typescript guys I don't know why it came out as uh JS okay so it looks like when we were creating the Shad CN themes it actually made a JS file and everything is typescript clearly right you can see here so what you're going to do is you're going to copy everything inside this config.js and you're going to uh delete this file here so just delete that file and go to this one here and just paste that inside the typescript file okay this is what's going to hold all the correct configuration awesome if we have to make any changes anywhere else we'll we'll figure that out okay but for now just do this anyway now the next thing we need to do is we need to wrap this module export so copy this and get with you with uh we have to get some package here so let me import this package up top first so we're going to say import with UT from upload thing so from upload thing SL um tailwind and now we just have to wrap everything inside that so with UT invoke it and then pass in that object that we just got okay this is how um upload thing actually gets all the stock styling and all that kind of stuff great now quickly go back into your uhg ignore file and we're going to actually put do EnV in here so that's just going to hide uh our EnV file so it doesn't get pushed okay and now you want to go back into clerk okay go into Clerk and I want to show you what you need to do here so in clerk you're going to have this sorry not that you're going to have this right click on continue to docs uh from home continue to docs it's going to take you to this page scroll down and you're going to find this uh thing right here okay so copy this um and we're going to use bun so actually just type bun um add clerk sljs okay go ahead and hit enter and that should install clerk for us so we can start using it um in our application all right awesome I know we went back forth a little bit but if you're following through you are going to get everything correct okay um and if anything happens guys you can reach out to me in the Discord and we will all help you out okay so the next amazing website or thing that I found tool is this and someone actually shared this in the Discord and this is what we're going to use for theming our application so if you don't like the theme we're using you can use any theme you want like look at this this tool has access to every single theme for shads and UI and it it is completely compatible you just have to copy the code and you can just paste it inside your Global CSS file okay but what I would suggest is you just go into our our um our um git repository and just copy the CSS file so that there's no uh problems okay we want to make sure that we're working on the same exact thing so go into your app directory click on global. CSS and just copy everything in here okay so copy this go into your uh Global file as well which is in here and just replace everything in here okay this way everything looks the same and what we did additionally here so right here is this is just called CSS reset or css normalizer okay so go ahead and put that in here and put this up um this in here as well okay awesome and then the next thing is we also need some additional classes I'm sorry some Tailwind configuration that I did so just go to that file as well which is all the way in the root um I know we already did the config but I wanted to show you that config thing right and that's why I did that there so go in here go to your tail Tailwind config do typescript and you want to copy everything in here actually in might need some plugins uh let me see okay I don't think we need plugins yet so just copy all of this copy it just like that just replace this stuff okay inside your Tailwind config uh file so I'm copy and paste and then just save that okay that's it and we need this because we need to wire up something in the future uh which is Tremor which we'll be using but that's fine just copy this for now okay next thing you need to do is replace these URLs so this is what we're going to use okay we're going to use agency sign in and agency sign up okay we haven't done this yet of course but this is what you need to do so just put these values in here now the next thing is we need to wrap our entire application in this clerk provider go into your directory right here go into layout. TSX and you see this right here right go ahead and import this component and we're just going to go ahead and use this component in here now drag everything into this component and that's it you're set for that now the next thing is we we need to use the theme right so scroll up top and we're going to import dark from clerk themes and in here there is an appearance prop we're going to set that to the base theme and that's going to have the dark property on it so of course it's not going to render anything now you're going to ask why is this actually not working well clerk needs some sort of setup it needs a path to render out its components and if you read the documentation you will see all that in detail okay like you see here for example uh they're showing you how to create all this stuff right so that's what we need to do so go into your directory again inside this app folder now we're going to actually build our structure so first we're going to create a a route group called main so go ahead and say Main and this is where our entire application will uh will remain okay we're going to have the agency and the sub accounts and all that kind of stuff say Main in here and also let's just quickly go ahead and say provider we're going to need this maybe right so we're going to put that in here and inside this main we're going to have the agency folder and we're also going to have a sub folder and inside the agency create another one this is another route group called o and inside this we're going to say sign Das in sign- sign up and in here we're going to create another path and this one is going to be a dynamic path sign Dash in like this and inside that a page. TSX has return the sign in component right so I'm just going to say R fce I'm using react Snippets by the way okay and in here I'm just going to return the sign in I don't think it's going to come okay came in right there awesome and in here same thing we're going to create a dynamic URL sign Dash up and inside this ap. TSX and return rafc which Returns the sign up component I mean let's just see what happens actually so if you reload this so nothing really happens and that's because our um our default path I think is set to a public okay so if you go into your middleware do typescript let me see if I actually have that okay we haven't set that up yet okay so let's go ahead and set up our middleware file inside the source directory create middleware do typescript okay you can see the documentation so if you scroll up here you see it gives you something right so copy that and paste it in this middleware file inside here guys we actually are going to set some public paths okay we need this to be public and this is public routes and this is going to be site uh with a slash like this and the next one is this is actually for upload thing we're going to set this but we're just going to do it right now API SL upload thing this has to be in an array so let's put that in an array so now clerk knows that these are public routes so if you try to render now you're going to see that for the local for Local Host 3000 it's going to render this component and there you go it's showing the dark component now I don't like this I want to center it so let's go back into this folder go into Main and we're going to create a layout page for our authentication so inside the off create a page call it layout. TSX and inside this layout. TSX we're going to render like a wrapper that's going to give it some uh new styling okay just return ra fce again and I'm going to change this to Au layout let me shrink this so you guys can see more and let's give this some class name so now it's returning this right so we need to return the children component because how layout works is it wraps the components and any children components passed into that it's going to pass it in here and that's how we get access to that stuff so I'm just going to get the children from here and react. react node okay and um this has to be returned here of course so we're just going to send this and now you you're going to see that sign in page but I don't like this I'm going to say height full I'm going to say Flex item Center and we're also need justify Center okay so there you go now it looks so much better right awesome so now inside this directory we have to also build other other structures right so let's go into this app folder right in here and we are going to create um another uh route actually not a route group we're just going to create another folder this is a route called site and we need this because our root page which is our website is going to be inside here so simply move this page inside here okay and hit move that's it it's going to give you some proms so just go ahead and uh do that as well and inside this page guys this is where we're going to have our website everything is going to be in here so I'm just going to remove all this stuff remove everything inside this just keep the main just the main okay and we're just going to say page okay and now if you try to access the site it will actually be a public URL so you can access this and now we're going to ask paren why are we doing this why do we need to create this well the way our application works is our website is in a different path and we're going to rewrite this path okay so when the user tries to access the site it's going to look like Local Host okay and the like I said the magic is in the middleware file so please just focus when I get to the middleware file because everything about this app works from the middleware file okay so I already have our beautiful website deployed right so we're going to build this entire thing and I'm going to show you so I just want to first show you what it looks like and then we're going to go ahead and build it okay cuz I know I didn't share screenshots of the uh landing page so look how amazing this looks guys and we're going to learn how to create this grid inside our page. TSX we are going to remove this now to remove all the styling in here as well we don't need this okay we're going to keep the main tag though cuz we need um some good uh semantic meaning okay so we're going to create a section tag and this section tag is going to have a class name of height full width full padding top of 36 relative Flex item Center justify Center Flex Das column inside this we're going to create a div and this is going to have a class name of absolute bottom Das Z I think we're basically building that uh that grid right so we're going to say left- 0 right- 0 and then also on top so top- 0 and on dark hey guys just a quick announcement for our free freelance course so if you want access to that just listen up one of the most important skills as a web developer apart from the web development stuff is knowing how to freelance and how to make money on your own and there's a lot more benefits that you can gain as a freelancer than doing a 9 to-5 job because the problem with only having a job is that you're exchanging your time for small dollars now why do I say small dollars well it's pretty obvious you only have so much time whereas when you free you're basically exchanging your expertise and the value you have to offer for a fixed price and one of the best rewards that you get out of freelancing apart from the monetary part is that you can work from anywhere like it really is possible you could sit halfway across the world and deliver the same if not better results for your clients and just through freelancing alone you learn so many things like how to get leads how to run an entire sales call how to show somebody your expertise and have them build trust trust in you to invest in your services and the best part is you get to work with other people build a team and you're building a brand for yourself so here's what I want to do for you we have opened up limited spots in our private community and I want to give you access to this community for free because I want you to start learning and the fastest way to do it is be a part of a supporting Community that's already making money doing freelancing be around people who are where you want to be so I want you to get access to this knowledge because it's not available anywhere else so I am creating a completely free freelance course to get you guys started and that course will be available for anybody who is a part of that private community and here's the best part if you join before we actually lock this community every course we release in that Community will be completely free for you now here's the criteria if you join the community you have to have a display picture because people want to know you and I'm sure you want to know other people this is not a Discord channel so if you want to just hang around and this is not the place for that this is the place only for for success-minded individuals this is only if you want to meet successful people and see some real progress in your career please be understanding because we are only opening up limited spots in that community so if you try to log in and your request gets denied it's probably because we're either at cap or we're no longer offering this opportunity if you want to start freelancing and also get personally mentored by me and be a part of a community that is absolutely crushing it in the field of freelancing scroll down to the description and you are going to find the link there click on that and join and I will see you there all right guys so I took a look at it I actually couldn't tell what was going on wrong so uh this is the website that I found this resource from okay it's called Uh Snippets I think uh BG this one all right right here and they have some really really cool stuff okay you can copy this and it's just copy paste okay so I copied this one pasted it in here I just changed the color values okay I changed this one and the other thing I changed was the size size I changed it from what it is to 4 RM I'm not sure what broke or what happened also I changed this one right here I changed it to uh 6 60% okay and now you see it on the screen so let's move on so right after this so I'm going to actually close this tag because we don't need to keep that open uh we're going to create a paragraph and we're going to say run your agency in one place and this is going to have a class name set to text- Center so it's right in the center all right sorry about that pretty stupid thing so first of all we are we don't really need to push this back I think and what has happening is I forc the color here so the you know the color scheme is not actually working okay so that's what's going on there that's because we're on light mode but it will work okay awesome and after this paragraph go ahead and create a uh a div and this div needs to have a class name and this is going to have BG gradient so why we're create why are we creating this this is for um the text you see here right we need to create a background gradient and we're going to clip that text okay so we're going to see BG Das gradient-2 right from Das primary and then we're going to say 2 secondary Das foreground and then we're going to say text- transparent and we're going to do BG dclip uh border no clip clip text sorry and then we need relative from here so um yeah once we create this inside this we're going to create an H1 tag and we're going to set the class name to text- 9xl and then font should be bold and then we want the text to be center with uh medium so from medium devices from MD this is going to have text- 300 pixels and um inside this we're going to say uh we we just need to put a title so I'm just going to say plura for now and there you go so now when you extend it it looks great and when you shrink it it looks like that and you can change this if You' like okay you can change the brightness I think it looks different here oh I just removed it on dark mode okay on light mode sorry but yeah you could you could do that if you want to okay I think that's what I did uh somewhere here right I think I set something here to dark I'm not sure what I set to dark let's see okay there you go done all right it's gone uh so yeah you can do that if you want I'm just going to keep it because it looks great okay awesome and after this H1 tag after this did we're going to create another div here and we're going to give this a class name and set this to flex justify center items is going to be Center as well and then this is going to be relative with from medium de uh devices sorry it's going to have a margin top of -70 pixels we're going to push it up a little bit so that way it goes up and U let's see what that looks like there you go okay and let me make sure this looks good okay cannot shrink anymore okay cool and inside this we're going to put an image so this is why I said you need to have the GitHub because we need to download a bunch of images so go into the public folder and you're going to see a bunch of stuff in here okay I want you to go ahead and download each of these images Okay click on it and then click here download okay download all these images and open your uh folder to and inside your public folder just drag and drop it in the exact same format so let's say right now inside the public folder inside that directly we have these four Images so drag them and drop them inside this folder okay and then inside the assets so create a folder in here and call this assets like this and inside that you want to drag and drop these pictures so go ahead pause the video do that and come back all right hopefully you did that I just finished doing that as well so let's continue so after uh sorry inside this div okay inside this you're going to create an image tag and this comes from next image so let's import that from uh next image where is that they already imported I think I already imported some stuff up here so I'm just going to remove that sorry uh import this okay and we're going to say SRC and we're going to set this to the SL assets SL preview.png okay this is the preview image for our application and this needs an ALT so I'm just going to say Banner image and then uh the uh height and width also have to be specified so we're going to say height of uh 1,200 and width of 1200 as well and then let's give this a class name we're going to say rounded uh Dash uh top left- 2 XL and then rounded Das top right of uh 2XL I think there's just one property for that but that's okay and Border two and Border Das muted like this okay so it kind of has that effect nice and the reason why we're doing this is because we're going to give it a fade uh in effect at the bottom okay I think this is good all right and after this image so right here okay since this has relative we're going to place something at the bottom of this image so we're going to say div with a class name of bottom Das Z top- 50% so 50% like that and we're going to say BG Das gradient-2 top we did this last time too I think right yeah um sorry 2T and then we're going to say dark from Dash background left- 0 right- 0 absolute and Z of 10 okay okay so it's from dark mode that's why we don't see it okay but you will see it um on dark mode okay cool and um if you want to see that we would have to actually create our navbar and maybe we could actually maybe we could do that let's go ahead and do that guys so inside our folder in here inside our layout this is where we're going to um render out that uh navigation or navbar component okay so in here write uh before the children create navigation which we're going to come to in just a second it's going to throw an error and now you want to go into your components okay create a folder and we're going to call this site okay because everything for that is going to go in here okay you can call it site components if you like but it's already under components and inside this I'm going to create navigation and then inside this just say index. TSX okay and then we're going to say typescript you can use this one to if you'd like navigation component and inside this navigation component uh we're going to do a bunch of stuff so in here first this needs a user okay create user from here and this is going to be either null or type user and now this is where we come into um you know getting types and stuff like that I mean for getting Prisma and all that kind of stuff but we're not going to deal with that for now and now we can just destructure this user here and inside this navigation we're going to return a div not a fragment actually we'll return a div like this with a class name of padding for Flex items Center justify between and relative and inside this we're going to give it a side because we're going to have two sides left and the right okay and on the left side uh first let's give this a uh Flex items Center and gap of two and inside this go ahead and create an image and import this image from next image like that too and you want to say SRC is equal to uh SL assets SL pla- logo.svg okay like that and then you want to say width is going to be 40 and height is going to be 40 as well and just give it an alt and let's also give it an alt all tag is going to throw an error okay we're just going to say plura logo okay and now let's go back in here and let's import this component so just import the navigation and refresh and there you just you see something in there okay so let's refresh that okay I see something very weird that is not the um element what's going on let me take a look I think I might know what's going on so this navigation came from Lucid react let's remove that and let's import navig from our components that happens all the time all right so make sure you look at your um your Imports if something's happening and you don't know what the hell is going on so all right so let's go back to this component here and after this we want to create a span and we're going to say class name text- XL and uh also let's make it font Das bold like that and we want to say plura and put a dot okay and we're also using a specific font here guys we haven't loaded this font in yet uh but we will soon okay so let's just finish this nav bar okay so after this a nav tag and this is going to have a class name of hidden on mobile devices but for medium device it's going to have block we want absolute left of 50% we want top of 50% and then we want to say translate X transform translate X of -50% perc okay and then Translate Y and then here we're just going to change this to 50% okay and this is basically for the navigation stuff in here so inside here create a UL tag and this is going to have a class name of flex items Center justify Center and gap of eight and then let's go ahead and create our link tag so I'm just going to create a link from next link okay and uh just give it an HF I'm just going to put this because we're not really you know building all that crazy navigation we did that last time by the way so if you guys want to learn how how to build a really insane navigation bar you can watch the previous video okay we did a lot of cool things in that video so let's uh expand this again and let's just say about U documentation t a Tio n sorry and then this one's going to be features so we see something here or maybe not not sure oh that's because of medium devices right okay this is set to mg this should be MD okay now you will see that okay and something's wrong here is it because of this okay it's because I don't think we have Flex set properly let me see what's going on okay this is spelled absolute okay that fixed it guys sorry about that I make a lot of spelling errors that happens and here we also need trans I think it's transform transform I think transform right there yeah that should be good now it'll be perfectly centered and after this nav down here we're going to create a side and in here we're going to give it a class name of flex Gap D2 items Center and this is where we're going to have our toggle mode so we have to create that component too okay but uh let's just say link and give it an hrf of slash slash agency because we can log in here and we're going to say login inside this and we're going to give this some styling so class name is going to have BG G primary text- white p-2 PX D4 rounded DMD hover BG primary sl80 not DOT sl80 um and then let's hit enter here okay already looks great and then we can just do Transition all I guess if you want okay that's fine we don't need that so and after this now we need the user button and this comes from clerk authentication so let's quickly see what that looks like of course there's nothing there because the user is not logged in okay and um and if you also hit this it's going to take them to the agency page where they can log in okay cool and in here now you want to create the mode toggle which we haven't built yet so we're going to build that in just a second okay so say mode toggle like this and now go to Shad CN UI and and just open this up real quick and you're going to see um just give that one second why is it taking time okay so themes let's go to docs okay dark mode nextjs and it's going to give it to you literally so go to this okay oh they have the drop down version yeah this is probably what we want so we need to create this theme provider so copy this code okay let's move this aside and let's go to our providers that's why we created those providers so go in here create them- provider. TSX and just paste that code in here and now go into your uh let me think yeah you want to go into it says right here right go into your layout so the root layout right in here and inside this so right above the body tag you want to place this theme provider so I'm going to import this from our file okay like this hit enter and I'm going to just bring all the stuff inside that and now inside this we're going to also pass in these properties in here and they're also telling us to pass in suppress hydration warning so let's pass that into the HTML tag as well okay I think that's all there is to that and now inside your mode toggle we're going to copy this code here and let's go into our components and let's create a global file okay so you can say global and inside this we're going to say mode Das toggle. TSX paste the code go back into the okay something is wrong here radx UI why does it need that I don't want that so Moon icon where is that Moon icon here I'm just going to remove this sun icon from Lucid react Moon icon from I think that might be an error anyway and um or maybe that just automatically installed I don't know but yeah let's go back in here and now we can bring in this component mode toggle from our file and now if you refresh there you go now you can just change it right from there and now you see it show okay so looks like there is some sort hydration okay looks like there's a hydration fail I'm going to fix that just give me one second so I think this is yeah this is not right this this body tag should be outside this the children tag can be in here that's probably what's breaking it let's see um yeah there you go that was it all right awesome great job so let's go back to where we were which was inside the navbar right I mean I think we're pretty much done here with this okay cool yeah let's move on now you want to go back into your site and click on the page. TSX and after this section you're going to create another section and this you're going to give a class name of flex justify Center flex-all and GAP D4 and and margin top of 20 okay and also let me change this items Center like that just create a H2 with a class name of text- 4XL text- Center and in here we're just going to say choose what fits you right so let's put that from maybe from medium devices okay cool and we can hide that later and now after this H2 we're going to create a paragraph tag and we're going to set the class name to text- muted D foreground and text- center and we're going to just paste some text in here okay okay cool so I just went ahead and pasted something so create a div here and say Flex Flex items Center Gap -4 flex-wrap and then we need margin top of six now what you're going to do is you're going to open the GitHub repository click on this and go into the constants file which will be inside source Libs constants do typescript and go ahead and copy the prices price cards okay so open this go into your Libs and go ahead and create this all right pause the video go ahead and build it and then come right back all right hopefully you did that you just have to go into Libs create a constants file and then just paste that in there okay you want to come in here and now you want to import that uh variable that you just created inside the constants which is called pricing cards so I'm going to come in here shrink this so you can see and I'm going to say pricing cards I'm going to import that and I'm going to do map and for each of that I'm just going to return something for now okay I'm just going to return like a div and inside this we get access to the card so I'm just going to say card in here and give this a key and inside this actually yeah let's just change this to a card and this card is from components UI and in here I just want to put card. tile just to see what's going on okay cool there you go we see some stuff and if you shrink it okay we need to F fix that part justify Center how does that look okay that looks slightly better yeah and that will accordingly fix itself great and inside this we're going to just remove this card description we don't need this card description anymore and in here we're going to first give this a class name and we're going to use clsx here they actually have a CN function but clsx just makes sense for me I'm just going to use this right now width D300 pixels Flex flex-all justify Center actually justify between and in here after this you want to put a an an an object sorry and you want to say border -2 border D primary and this is if the card. nickname or we don't have nickname okay we can just say title for now equal to let's see what titles we have and this has to say unlimited SAS like this okay and in here we want to create a card header in here we want to also use a card title and this title is going to say card. tile and let's give this a class name clsx this is going to be empty we'll just say text- muted Das foreground and this is going to be true if card . tile is not equal to unlimited SAS after this car title we're going to put the description card. description for now after header we want to use the card contents component and this is going to have a span with a class name of text- 4XL and font D bold and in here we're going to say card dot uh price maybe and after this span we're going to create another span so I'm just going to to duplicate this right below so we're going to say card dot okay we don't have that so I'm just going to say per month per month like this okay that looks good enough and after this after the content we're going to create a card footer and this footer is going to have a class name of flex flex-all items Dart and GAP D4 and in here create a div and we need to basically render out each of the features so card. features. map that's how we render for each of them and we're going to get the feature here and here we're going to return a div with a key set to the feature itself that's fine and uh we're going to give it a class name of flex Gap -2 and items D Center and in here we're going to first render the check icon like this and we're going to also have a P tag this is going to have the feature inside here there we go looks great put a class name of text- muted D foreground that looks so much better right below this we want to create a link so say link and import from next link okay and we're going to say href is going to be slash agency put a question mark so we're creating a pram here and we're going to say plan equal to dollar sign card. ID this string has to be the other quotes Okay so card dot um let's see what we can put in here maybe price ID I think that should be good because basically we're sending a price ID which later inside the app we will extract from because it comes from stripe and then we'll create a payment intent with and inside this create a class name and this also is going to use clsx say with- full text- Center BG - primary and p-2 rounded D medium this one is going to also depend on what we are on so we're going to say not BG Das muted I'm not not sorry this means important uh foreground and this is true if the c. tile is equal to unlimited SAS then inside this you just have to put get started let's remove this justify Center I think that is wrong maybe it's the item Center yeah it's the item Center so just go ahead and remove that okay hm okay change this to not equal to that looks so much better we want to emphasize on the Pro Plan more than the free plan damn I mean I think we're pretty much done yeah we just have one more thing and I think that's about it okay so what we would do when we are wiring up stripe is we would replace this card with an additional card because in stripe you cannot create a free product well you technically can by using free trials and things like that but we just we're not using that okay if the user hits get started we're going to create an account for them and then we're just going to set them up so for that we will wire something up in here so what I'm going to do is I'm going to create a uh a work in progress tag okay and I I know you guys saw this in the last video we did this very often okay so we're going to do this here and we're going to say wire up free product from stripe awesome guys great job so far you already finished building the uh the website let's go ahead and move on to the next parts now all right so I'm just going to reduce this a littleit bit cuz on mobile devices it looks really bad so what I'm going to do is I'm going to say margin top so first set this to important and set this to maybe something like 40 pixels I think that should be just enough uh oh negative my bad don't do positive that should go up okay that looks better if you shrink it okay it goes right back yeah let's increase that a little bit more let's just set something like -60 so it's right around here that looks so much nicer let's go ahead and set up the for our website so go into your layout page in your root file right in here scroll to the top change this to plura okay and change this one to allinone agency solution now we're going to import a different style in here and I'm going to change this to font and this one is going to be DM sand I love DM sand you can use this if you'd like to it's up to you and let's replace that okay great job guys go ahead and stop whatever you're doing and just give me your attention for a few minutes I'm going to explain our architecture for the navigation okay so go ahead and stop what you're doing and just pay attention like I said everything happens in the middleware file the middleware file does all the magic okay but what we're essentially doing guys is we are rewriting the user to a specific path okay based on what they are trying to access so for example if that still doesn't make any sense look here you see we say web prodigies do application right so this is a subdomain so if they were trying to access a subdomain we're going to send them to a different path that we created so let's say if we had a path in here called subdomains path or or it can just be anything it can be domain path we are going to send them to that path and we're going to rewrite the URL so that it looks like this but technically under the hood it looks something like it's like this basically okay I hope that makes sense so that's basically what we're doing so first when when they try to access any page we want to check if a subdomain exists and if a subdomain exists then we're going to send that user over to that page which is the domain and if there was any path we're going to send them to that path along with a search primes if there's no subdomain we're going to check if they were trying to access the signin or signup page if yes we'll send them to agency signin because that handles all the logic for sub accounts uh to send the user to a sub directory or keep them in the agency directory then if that does not exist so if they're not trying to access sign in then we will want to see if they're trying to access the website so in this p in this application if you try to put slash site it's going to take you to the landing page but if you try to also put the local only this uh the root path it's also going to take you to the side page so that's a really cool thing okay and we're doing that because um we just want to create that great experience okay so we're rewriting the user to slash site if they try to access either Local Host I'm sorry if they try to access the root path or the path site now if that's not the case then that means they're probably trying to access their sub dashboards or their agency dashboards so what we're going to do then is we're simply going to rewrite them to the path they want along with any search prams I hope this makes sense okay I think it's I did a great job explaining but hey if you have any questions the Discord is going to help you like give you all the support you need awesome so let's move on so here's a challenge for you go ahead and create a dynamic route called domain and a dynamic route called path within that domain and that has to be inside the root app directory okay take it up as a challenge go ahead pause this video give it a shot and then come right back if you don't know how to do it I'm going to show you exactly how to do it awesome so go in here you want to create a folder and you want to call it domain like this and inside this domain create a a page. TSX and just return something for now so I'm just going to return uh page and inside this domain create another page uh a a dynamic path we're going to call this path okay and inside that a page. TSX that's all you had to do so if you got this correct great job and uh I want you to actually give a good attempt at these challenges okay awesome to understand this uh very important concept right of how this provider actually works with Clerk so when you wrap your app inside this clerk provider everything right now so we are in the root layout. TSX file every component is wrapped with the clerk provider and inside the middleware file we have only these two uh paths set as public URLs however we also want the domains and the paths to be public now this is going to cause a problem because we have to do something like star and all that kind offf stuff and that would also mean that everything after that would become a public URL so how do we solve this problem it's very simple you canot have the clerk provider uh in the root layout file so let's quickly remove this clerk Provider from here I'm just going to copy that and we'll just remove it from here as well and you're going to see this error on the screen that's fine okay and you want to go into your main file your main folder create a layout. TSX in here and just return a layout get access to the children from the props so we're going to to say children is react. react node and in here we're simply going to return the children component and now go ahead and remove this div we don't want to return anything else and we have this clerk provider here so just push the the children into this clerk provider and go ahead and import this I'm going to import clerk provider and import Dark theme from clerk provider as well okay okay so I'm going to copy this dark theme and I'm going to import it here so I can actually use that okay awesome and another thing you're going to notice is the website will also need that clerk provider okay so go into its layout. TSX and in here you're going to return that uh that clerk provider so I'm going to copy this clerk Provider from here go into site paste that hit enter and move this into this component and quickly just import all of this stuff there we go awesome and now if you okay there you go so if you try to access the uh Dynamic path your your you're not going to see it and the reason is because we are not uh rewriting the user you're still going to see the sign in okay that's because we still have to build the middleware file but I just wanted to get you guys set up with this so that we can move forward with that okay so go into your middleware file right in here I'm going to shrink this so you guys can see more and inside this o middleware there are two uh functions okay it's called before o like this and this gives us access to the Au and the request and this is an async we're just going to make this an async function okay and there is one more in here called after o okay we are not going to use the before o but I just wanted to show you okay and inside the after o first we're going to do um rewrites for domains okay so basically we're following the structure that we just have here that's literally it so the first thing we need to do is we're going to say const URL equal request. next URL okay next we want to say const search params equal to url. search ps. twoing and then we're going to get the host name so we're going to say host name equal to request. headers like this and then after this say const path with search params equal to we're going to use back tick dollar sign and the bracket we're going to say url. paath name not password sorry path name and after this put another dollar sign and a curly bracket like this we're going to say search pam. length greater than zero and if this is true then we're going to return another back tick and we're going to say question mark dollar sign search uh params okay like this uh copy this and I'm just going to paste it in here or we're going to return something else right U so okay I see some error here uh let's see what is the error okay the back tick has to close here and this can be like this I think so okay yeah so close that back tick sorry I just made a small error there and if not we're just going to return an empty string now after this go ahead and we're going to run this logic which is we're going to check if subdomain exist if the subdomain exists we're going I'm just going to put a note here for you all who want to see this so um if sub doain exists okay and what we're going to do is we're going to say const custom subdomain equal to host name. getet host and then we're going to if this has something we're going to split like this uh put back tis again and we're going to say dollar sign process. env. next public um domain and make sure you also have that in here okay there you go we already have that in here and let me go back to the middleware file okay cool and uh we're going to split at that and then we're going to filter for Boolean so only the ones that are string and we're going to get the first one okay in here we're going to basically check if the domain exists so if custom domain custom subdomain exists then we're going to return next response. rewrite and we're going to rewrite with a new URL invoke that like this and inside here we're going to pass the back back text with a slash and we're going to say custom subdomain and we're going to put the path with the search pram so another dollar sign like this and path with search pram so I I hope you understand what we did here we're basically rewriting the user to that domain and the path ID so whatever we created in here you see this uh where is that right here we're rewriting them to this path okay that's it and um after this so after this if statement if the subdomain does not exist then we're going to the next stage which is if the url. paath name equal to signin so slash sign-in okay let me scroll down and hopefully you guys can see more and U I'm sorry R we're going to say url. paath name equal to SL sign-up so they're trying to access the signin Pages then we're going to return next response. rewrite sorry redirect we're not rewriting them we're redirecting them now to a new URL with a uh with backticks and we're going to say agency SL sorry SL agency SL sign-in and then after this pass in the request. URL uh like this awesome and after this so after this we're moving on to the next stage which is if the url. paath name equal to back slash so they try to access the website right or the url. paath name is equal to/ site and the url. host name host sorry not host name the host is equal to process. env. uh um let me go and copy this from here actually or here I can just copy it from here okay let's shrink that okay process. env. nexu domain so if this is equal to this then we're going to do something what are we going to do well we're going to redirect them to the website to site URL okay so next response. rewrite the user to a new URL with slite and request.url just like this so we're taking them to the site awesome and after this so if this is still not true then right after this we're going to make another check we're going to check if the url. paath name do starts uh do starts with the SL agency or the url. pathname do uh starts with sub account so if they're trying to access their dashboards then we need to take them to those pages right so if this is true then we're going to return the next response. rewrite uh re yeah rewrite okay new URL invoke this and you want to pass in back ticks sorry actually no back ticks my bad you want to say um uh actually yeah we will need this because we need to put the path with the search params yeah so dollar sign path with search pams like this and after this put a comma and say request.url so now it's going to redirect them to that page awesome now let's just see what happens okay so if I try to access the site it's taking me here if I try to access the root page it took me to the website as well and if I try to access access agency it's going to uh ask prompt me to sign up or sign in oh this is sorry I didn't spell that correct so agency like that okay so something's wrong here it looks like it took me to some other page because this should throw in error but it's not so something is wrong here let me just take a look at that guys okay so nothing was actually wrong here we also need to put the next URL at line 28 so after you return the custom subdomain make sure you put request. URL as the second parameter okay I think everything else was fine but we do we do not have a page for our agency so let's go ahead and create a page. TSX and return rafc we're just going to say page like this and here we're going to return agency dashboard for example okay I'm just I'm just going to say agency right here so now you see it's showing the agency whereas if I try to access some other page here so some other path name it's going to take me to that domain path and now you may ask well hey that page does not exist so why are we showing this well we're going to do some logic where we're going to Loop uh I'm sorry we're going to search the database and check if the domain exists and if it doesn't exist we're going to throw a not found that's why if you try to access Something That Is Random like this right it's actually going to throw a not found error and it's not going to show them anything so that's why we're seeing that problem but everything else looks good so uh great job let's move on head and install Prisma so if you don't know how to find all this stuff right you can just search for bun with Prisma or something like this and it's going to show you right here and you can just copy these commands all right so copy this one paste it in here and that's going to go ahead and install Prisma and Prisma client for us and then the next next one we need is this command which is to init U MySQL so we're going to remove this and put MySQL and hit enter and that's going to um spin up our application with mySQL so it also gives you the next step so set the database URL in the EnV file and point it to the existing database and then uh it's literally telling you everything so let's go in here and let's just see what it did to ourv okay so okay so it looks like there's something all right it didn't do anything in here but if you go to Prisma you're going to see a schema. Prisma file and this is going to have your database URL key in here and it's going to say MySQL so this is exactly what we want one more thing I want to add here is a after this after the URL go ahead and hit enter and you want to say relation mode equal to Prisma like that okay you want to add that in here I don't know wa awesome and uh generate client Prisma client JS this is okay all right awesome so now now go to your uh Libs folder in here create a db. typescript file not TSX sorry typescript file and in here we're going to initialize our client okay and if you don't know what that is I'm going to show you in just a second so first let's go ahead and import Prisma client so import Prisma client from at Prisma client like this and then we're going to declare Global VAR Prisma Prisma client or undefined okay and then we're going to say export const DB equal uh sorry Global This Global this. Prisma so if this um exist basically or we're going to create a new Prisma client so this way we don't create multiple clients on every single reload and if you guys were here from the last project you know that we had this issue with the drizzle orm client being rein initiated every single time the app reloads so this is the solution for it okay and we also addressed it in the Discord and all that stuff but if you are not there for some reason this is the answer okay so we're going to say process. env. node environment is not equal to production then we want to say Global this. Prisma do uh sorry equal to DB okay so now we can use this Prisma client um DB in here and we can make uh calls and you know we can basically create tables and all that kind of stuff now go ahead and open your terminal and type bun X Prisma generate and that's going to say something let's see what happened you don't have any modules defined in your schema file of course we don't it's Mo models okay so let's go in here and we can basically create the structure so for now what I'm going to do is I'm just going to create an enum we're going to call this Ro inside this ro we're going to say agency owner just to basically create something right and let's say Prisma oh we have to create a model too sorry so I'm just going to create that the first model we're going to build is the user model this is going to have an ID of string which is going to have this at ID and the default is going to be uu ID and then we're going to have a name which is also a string we're going to have the Avatar URL which is a string we're going to use db. texture this gives us some more characters and then we're going to have an email which is a string this is going to be unique in here we're going to have a created at which is going to be a date time at default now so it's going to every time you create a user it's going to default to the current uh date okay then we're going to have an updated at which is also a date time and this is going to have the default as updated at okay and then we're going to have a rule and this rule is this rule from here okay this Rule and we're going to have the default value set to new sub account user that is better okay sub account user right there okay because we didn't close that bracket nice and then we're going to have an agency ID now if this is confusing I'll tell you what it means so what is this agency ID each user can be assigned to one agency only okay okay so that's why we're going to have the agency uh ID linked to this user in here okay and now we're going to say agency here this is going to be of type agency which we haven't created which we'll create in just a second um this is going to have a relation with the fields set to agency ID and um the it references the ID field in the agency table and on delete we're going to set it to Cascade so when the agency's deleted we want to delete that user as well because they only have one agency right so we're going to say Cascade here you're going to see this eror and we'll solve that in just a second so we have to say index here and we have to set this agency ID the reason why you don't see this is because that that model is not created yet so we also have to create the agency model so uh we'll do that in a second but I just want to first show you how to create these models so that you can build them on your own the next one we're going to have is permissions and what is this permissions so this permissions is not um the roles okay permission is basically can a user see a sub account that's what the permissions table is so by default the agency owner has permissions to all accounts but sub accounts right the sub account users only have access to those sub accounts that the agency owner has given access to okay I hope that makes sense so that's why we need these permissions table so each user who is a like a profile in our application they are not a contact okay they can also have tickets assigned to them okay and this comes through for the conon board that we're going to create soon so that's why we're going to put a ticket model which we haven't created which we'll create in a bit and then we have to have the notification and this notification is uh here because it can be assigned to a user okay like let's say for example I made a change I want to assign that notification to me right um awesome and then that's about it we need to basically create models for each of these references here and we just have to assign them uh at the bottom that's literally it okay so uh let's move on to creating the agency table now so the agency table is going to have the following so it's going to have the ID a connected account ID and this is needed for stripe because remember I mentioned that we're going to be using connected stripe accounts that means every user can connect their own stripe account inside the application okay that's something that I've never seen anyone do so I thought it would be great and then we're going to have a customer ID this is for the subscriptions so when they are subscribed to our application through our subscription service we need that customer ID okay we're going to have name agency logo uh company email company phone the white label and this is needed when um let's say if the agency owner wants to show each sub account their own logo in the dashboard instead of their white labeled logo right in that case if they turn this off it's going to actually show their logo and then we're going to have address City all this address related stuff and then the users so each there are multiple users that can go into an agency so by default even sub owners are part of the agency okay we're just giving them access to either the agency or the sub account that's literally what we're doing and then uh we have the sub account which is a bunch of sub accounts which don't exist again so we'll have to create that we have the sidebar options which is going to be agency sidebar options and the reason why I did this is because in the future if you want to control what sidebars can look like or if you want to control stuff like show the sidebar hide the sidebar you want to give the user the ability to do that you can do that with this system okay and then invitations so people can invited to the agency so we have to keep track of that as well and then we have notification we have subscription and this subscription is you know something for stripe and then add-ons so these are different products that are in addition to the subscription fee that we sell now let's go ahead and also create these other tables so here's what you can do guys just save yourself a bunch of time okay go in here I already showed you how to create a model and I showed you what how we're building that right and what it looks like and all you have to do is just go into the GitHub repository copy this cuz there's a lot of code in here okay we if we type this it's going to take us 2 hours so copy all these the Prisma uh schemas go into your code in here and replace it with that new file so I'm just going to do that so go ahead pause the video do that and come right back okay awesome hopefully you copied and pasted it as well so let's just quickly look at what we added okay so now you see the permissions here it has the permission for the user so who can access it and the sub account so which account they have access to and of course if they do or don't okay so by default we will create these for them but we have a Boolean value that allows us to show it or not show it basically awesome and then the agency is same thing we just went across that the sub account now the sub account is a little different so the sub account is going to have everything is the same thing okay everything that we had in the agency we have a connected account but we're not going to have the customer ID because they they are not paying a subscription fee to us okay they're just owned by the agency owner we're going to have the agency that it belongs to the side bar options and this one is a sub account sidebar option and to look at what that looks like let's quickly take a look at that it's it's literally the same thing as the agency okay we have the ID the name a link an icon for it the created ad uh updated ad the sub account it belongs to sub account ID and it's index that's literally it let's look at the other stuff so we have permissions again okay and then we have funnel now this is basically the websites so each sub account will have multiple websites so that's why we have this as an array and if you go to a funnel you will see in the funnel sub account right here so each funnel belongs to one sub account and after that we have media so this is where all the media files will be stored now we have contact this is where all the contacts for the sub account will be stored and contacts are basically the leads for that sub account and then this is additional guys this is actually a bonus I don't know if I will be releasing this but it is a bonus thing that I do not have time to actually make in this video and if I do maybe I would if not um you know I will see how I can put that out for you okay and then uh we have tags what are these tags these tags are basically for the tickets okay so you can assign tags to tickets and the notifications for the sub account exactly the same thing it's just inter interal looped okay it's the same thing like everything pipeline belongs to the uh sub account right you have a bunch of pipelines in here and stuff it's just the same thing we're just linking everything so all you have to understand is how to create one relation and then you can do it for everything so I'm just going to give you a good example of how you can do that okay so I'm just going to show you one example here so let's say we had a model called we'll just call it owners I'm just going to give an example okay owner and this owner is going to have an ID um let's copy this right an ID they're going to have a name which is a sorry a string like this and then um it the owners basically belong to the agency Okay so I'm just going to copy this below the agency I'm just showing you an example how to create these relationship things cuz yall had a question last time so I want to give you a good idea so an owner basically a multiple owners can belong to an agency right so this is how you think about it an agency can have multiple owners so all you have to do here is say owner and set it to owner with an array okay and now an owner can have only one agency so in here you have to say agency but since it's one agency you just want to say agency like this okay and now you have to give a reference to this so how are you going to identify this owner with the ageny well through an ID so you're going to say agency ID and then uh in here if you see this is how we give the relations right so for this you want to say at relations because this is related to something let's give this a string in here Fields this is actually incorrect I don't know why I did it this way let me just redo that real quick so you want to say agency okay and that would say relation the field so which field is it related to the agency and which field does it reference from the agency table we want the ID you can reference anything you want okay and on delete Cascade what does this mean this means that when the agency is deleted we want to delete the owner as well and now finally because we're creating this relationship we have to create an index in here and say agency ID this is how you build relationships between tables okay and let's say if this had multiple so let's say an owner um had a multiple agencies then you would have to create something like this and then you would have to change so I think we have a good example somewhere here too let me see yeah so there's a good example in there so you guys get the idea right that's how we build relationships awesome so yeah um unfortunately if I type every single thing that's a lot of code it's going to take us a lot of time so let's move on to the most critical part of the application all right we're just going to quickly look at what we copy pasted so we have the users table we have permissions which is for the sub accounts to show the sub account for that specific user then we have the agency which is the entire agency which has a bunch of fields of course and an agency has multiple sub accounts okay and a sub has a bunch of fields as well so an sub account has sidebar options permissions so basically which permission can be show to which user funnels media contacts this is actually a bonus guys I'm not putting it in this tutorial but um I will see maybe we could do it some other time it's basically how to create automations it's an autom aut Builder where you can drag and drop components and that will create automations like emailing email marketing and all that kind of stuff okay uh and then we have notifications we have tags so what are tags tags are basically um for each ticket you can assign tags for them okay I'm sure you saw in the demo so that's what the tags are for what is a pipeline a pipeline is basically think about it as the entire conon board okay that is the pipeline and each pipeline can have Lanes okay and each lane can have tickets all right and then finally again these trigger thing this is sorry this is actually like a bonus ad so I'm not going to be putting it in this video so let's skip to the action yeah after the actions then we have contacts which is multiple leads that come into each sub account through the website and then we have media which is the media bucket so each media file can have the this you know these fields and then we have a funnel what is a funnel a funnel is just a website so right here you see we build something this is a funnel okay and I made it in such a way that you could literally build anything you want it's a funnel a website like see these are working links okay you can literally click on them and get started you know you can take payments take get contact information literally it's super powerful okay and after funnels you have class names now this is actually a challenge for you so that's why I put this in here when we get to it you will see the challenge and then we have the funnel page so each funnel has a funnel page okay it's just that just that simple the agency sidebar option so this is just the sidebar option so each option in here actually has these properties and the reason why it did this is because in the future if you wanted to give the user who is the agency owner the ability to hide options for their sub accounts you can use this okay so I just wanted to give you some additional uh knowledge on that so you can actually do that and then same thing for Sub sub accounts as well and then we have invitations what are invitations for an agency you can send invitations to other users right so we need an invitations table to keep track of that right here and then we have notifications that belong to either the agency or for the sub account right and then we have the plan so these are the pricing plans which we'll have to create which we'll have to change of course but um just to give you an idea it's just the plan and the two prices that we sell so right now these are the two prices that we sell okay and then the subscription right here this subscription is for strip purposes okay okay so we need the price ID the customer the current start period and all this kind of stuff we're going to use this to actually uh show whether the user is on a paid plan or on a free plan and then finally the add-ons this is also another challenge for you and we'll get to that when we get to it okay awesome so let's move on now all right guys awesome great job so go ahead and open up your terminal okay I'm going to close this studio terminal for now and we're going to say bun X Prisma generate okay and hit enter and that's going to generate the Prisma schema file and then we're going to say bun X Prisma DB push and that's going to update our database and now if you open another terminal so I'm just going to open another one here and I'm going to say bun X Prisma Studio like this and let that open up now you should see all your tables in your database awesome and also if you go into um your um what is that the MySQL workbench right in here you should see those tables in here too right that's the whole point of this so you can cross check that and make sure you see the table let me see if I can pull that up um okay right in here we see plura we see tables and there we go we see all the tables in here so if you don't see this um there are a like thousands of videos on the internet talking about MySQL workbench okay it's one of the oldest database technology so go ahead take a look at that and again the Discord is open join ask me I'll help you okay awesome so let's continue all right so I noticed something here I'm unable to create login and that's I'm unable to click on the Navar itself so that just looks like something wrong here so I'm just going to go into uh provide sorry I'm going to go into components go to site navigation and this one is actually uh relative here okay so what I'm going to do let me see if I put uh fixed on this I don't think that should break anything hopefully not yeah we'll remove this relative okay Flex sorry uh fixed top d-0 right- 0 left d0 and let's give it a height okay it already has a height because of the padding and we need to give this a z index I'm just going to say Z of 10 okay let's just see what happens now you can click on it okay so it just looks like it was hiding behind that so this should work perfectly all right awesome cool and now you can actually click on login it's going to take you to the agency uh agency page okay and it should actually send you a login hm something's wrong here it should make you log in but it's not letting me do that so I'm going to take a look at this all right okay so the reason why nothing was happening when you clicked on login and it was just showing agencies because we didn't do anything in here okay we need to redirect them so what we're going to say is we're going to say const o user equal to um await current user and change this component to an acing component up here and we're going to check if there's no o user then we're going to return redirect from next navigation okay from next navigation to slash sign-in like this and now if we refresh and if we click boom there we go now it prompts the user to sign in because they don't have an account okay awesome so this is how we uh route the user through our login system all right so now the next step is we need to uh get the users details we need to check what access they have and depending on that we're going to send them to the sub accounts or we're going to keep them in this agency account and if they have an account we have to send them to that specific account as well so what we're going to do in here is we're going to first scroll to our Libs folder and we're going to create a queries. typ script file and in here we're going to put use server up top okay guys so many people made this mistake last time please don't do this mistake again put use server up top okay that's how this becomes a server actions um file and uh what we're going to do here is we're going to close this and we're going to create an action so the action is uh user equal to await get o user details okay details like this and this does not exist so we're going to copy that we're going to go to our queries file we're going to export const this which is equal to this function and this is an async function right here and um this function what okay and this function right here is going to basically say const user equal to equal to await current user okay we're going to get the current user from uh clerk next okay and if there is no user then we're going to Simply return okay but if it does exist we're going to say const user data equal to await DB imported from our from our file right that we created here db. typescript so db. user. find unique okay like this where and in here we're going to say where email is equal to user. email addresses at z. email address okay we're going to take the first email and then we're going to include a bunch of stuff cuz we need this data so we're going to say agency include the sidebar options so sidebar options uh we're going to set this to true and then we also need the sub account and we're going to set include the sidebar options for that and set that to true as well so let's hit enter here so we have two lines awesome and then finally after the agency right here we're going to say permissions and set that to true as well so we're going to get a bunch of data and let's make sure to return this data okay go ahead and return the user data just like this and now you copy this go in here and you can import these get um you know the Au details so if there is no data guys we have to prompt them to create the the agency account that's what we're going to do here okay so before that we'll also have to make make some quick what is this uh we'll have to make some quick checks right we have to check if they are a sub account guest agency guest and all that kind of stuff all that logic so let's quickly do that in here uh okay there's one more thing so what if the user was sent an invitation we don't want to end up creating an account for them so we have to do some logic before that right so we're going to say const agency ID we need to get their agency ID you know don't have an account right I mean if they do have an account so we're going to say uh verify and accept invitation like this and we're going to copy this go into our queries file which is in here queries and we're going to export const export this function set that to an async function like that and this is going to do the following so in here we're going to say const user await current user like this equal to this and you can basically redirect the user if you'd like in here but we're just going to say if no user okay we'll just redirect the user in here itself so redirect them to sign- in like this and then we're going to say const invitation exists equal to await db. invitations. find unique where uh we need to find where their email address is uh the same right so email address is user. email addresses at0 like this. email address okay and we need to also say status is pending like this okay because we created that that stuff if you go and read just read through the schema file all right guys it's very simple it's not too complex okay if their status is pending that means they have an invitation if you're curious as to how we're doing this when we send an invitation we will just create an entry here and set the status depending that's it so if the invitation exists that means they are um invited we're going to say const user details equal to a away create team user so this is um another function that we're going to do in just a second okay and we're going to pass an invitation exist. agency ID and then we're going to pass in all the all the data that's in here okay so that function that create team user function we're just going to build it maybe somewhere up here so we're going to say export const create team user equal to async function async Arrow function like this and this is going to take the the agency ID which is which has a type of string and we also need the user which is of type user and this user comes from Prisma client okay and in here we're going to say if the user. roll is equal to agency owner then we're going to return null okay that means they already have access but if not then we're going to say const res uh const response equal to agency sorry await db. user do create create like this and we're going to pass an object here and say data and this data is going to have everything in user like that okay and then finally let's also return this response from here so now we can create that so now we have to pass in um that data into this into this object right here so going back to this in here we're going to say email is going to be invitation exists. email and then we need to pass in the agency ID is going to be the invitation exist. agency ID and then we need their Avatar URL which we can capture from the user do um user do okay image URL and then we need the ID which is user. ID and we need a couple more things we need the name which is going to be dollar sign user. first name and put a space here and we're going to say dollar sign curly bracket user. last name and after this we need the role so the role is going to be invitation from here invitation exist. roll okay and we're also going to pass in the created at uh which is going to be new date not data transfer new date like this and the updated ads also is needed in here new date like this and you want to invoke that and then after this we're going to go down here and we're going to create activity logs okay so these activity logs are basically when user accounts or when any action is performed we need to save that data right how do we do that well we're going to create that in just a second let's scroll maybe up top here so we're going to export uh const save activity logs notific or yeah this is fine you can call it like this notification equal to async this is an arrow function so I'm just going to create an arrow function in here and this is going to take in uh the following so it needs an agency ID okay agency ID which is going to be uh just like this okay agency ID uh description okay and it needs a sub account ID like this and we can basically take that from here too so we can see agency ID which is actually going to be optional and it's a string okay and then we need description so I'm going to copy this description which is going to be a string and then finally we need sub accounts ID which is also going to be a string and this is also optional in here okay um okay like this and what this is going to do and we're going to need this here guys it's super important that's why we're creating it right here okay and uh what we need is first to say const o user is equal to await current user like this and then we're going to say let user data and if there is no o user then we want to say const user or const response equal await db. user. find unique find first actually sorry and I'll tell you why we're doing this okay so find First and the reason why we need to do this is basically let's say we are creating an activity log when a contact came in okay that time there's not going to be an off user so that time we need to just find some user that belongs to that sub account or that account and we need to just assign it to them I hope that makes sense that's why we need to do this process right here so we're going to say find first where okay the agency and then where the sub account where sum ID is sub account ID and let me hit enter here so everything gets indented all right like that so we're going to find that and after this AU user so after this right down here if response exist then we're going to say user data equal to response okay and uh right below this so after this statement we're going to say else create a bracket here and say user data is equal to await db. user find unique okay where I'm actually going to hit enter here okay or let's just first put this in here first so we want to say email is is off user email addresses something's wrong here why is this why is this throwing this error ah okay move this up here sorry about that so else you want to say Au user email addresses at 0. email address like this something is wrong here too email addresses I spelled that incorrect sorry about that so you want to get that email address we're going to find unique we're just going to find that user and then after this L statement we're going to say if there's still no user data we're going to just console.log okay could not find a user okay then we're just going to return here okay because we could not find anyone so we will return here and then after this we're going to say let found agency ID equal to agency ID that we just uh found from above and if there is no found agency ID then we're going to see if there is no sub ID as well then we're going to throw a new error okay we don't actually have to throw a new error but I'm just going to do this here so that we can track what's happening you need to provide at least an agency ID or sub account ID so we need something right to assign it to assign the notification after this if statement so after this one right here the sub account we're going to say const response equal to await db. sub account. find unique ID is sub account ID Not subscription sub account ID like this and after this so right after this yeah we're going to say if there is no I'm sorry if there is response then found agency idid equal to response. agency ID and if you're wondering why are we doing this why are we checking if there is no agency ID and stuff like this sometimes notifications are assigned to sub accounts and inside the sub account directory right in here we will not have access to the agency IDs so for that reason we need to find the agency ID that belongs to that sub account and then we're going to set that okay hope that makes sense and now after this so I know this is a little long but this is just one of them that's long there's a lot of stuff okay so after this we're going to say if sub account ID exists then await DB um db. notification. create okay data like this and we're going to say notification is going to be dollar sign hey okay user data dotame and then we're going to put a like a pip Ty here we're going to say dot description okay and then we also need a couple other things right so we're going to say user we're going to connect a user in here connect hey not continue connect with ID user dat. okay that's so weird it wasn't showing me the intelligence anyway and after this we want also want to connect to the agency so connect with the ID and set that to found agency ID and after this agency ID we're going to say sub accounts and we're going to set connect to ID sub account ID okay like this awesome ID sorry guys this has to be an object okay nice now if that's not the case we have to do one more final step which is else if that's not the case we need to say await db. notification. create where um sorry data and we're going to set the notification sets to dollar sign user dat. first U user data do name and we're going to put a pipe here we're going to say description in here and after this we also need to connect to some user so user connect ID equal to user data. ID like that and after the user go ahead and say agency is going to have connect set to ID with found agency ID awesome that's it so now we are going to use this every single time so we need this function so it's good that we created it here okay what you can also do is you can create a wrapper for everything okay you can create a wrapper uh for every single action and every time you invoke that action you can pass in some additional properties but at the end of the day you're going to end up doing it for every single thing so you might as well just do it this way okay yeah let's go back to where we had to put that I think that that is right here okay after this just say await save activity no log notification pass it an object with the agency ID set to invitation exist. agency ID and then we need the description and we're going to set this to joined like this and then we're going to set sub ID to undefined okay awesome and then after this if user details so okay we you have to move this whole thing inside this fun inside this if if block okay so if user details then await clerk client so say clerk uh client like this give me one second let me try to import this yeah clerk client you can import this from here dot users do update user metadata okay update user metadata going to invoke that and say user. ID so for that ID we're going to set the private metadata so private metadata is going to have a rle set to user details. roll or we're just going to say uh sub account user okay so sub okay we don't have that here so what I'm going to do is just give me one second sub accountor user like this okay so basically if the details do not exist if the details do exist we're going to create a a role and by default we're always going to give them a sub account user role okay awesome all right guys now what is next so after this we also have to delete that invitation right so after the statement right here say await db. invit invitation. delete delete where ID or H sorry where email is fine too where email is user details. email okay so it's going to delete that invitation so we no longer end up you know creating accounts for them every time and let's also return user details. agency ID because we need this agency ID to reroute the user and now after this let's just say else return null okay and after this block you can also say another else and we're going to say uh check if um at least they have an agency ID okay so in here we're going to say const agency equal A8 db. user. find unique okay where email is user. email addresses do uh at zero so the first email address do email address like this awesome and then after this go ahead and return if agency exist then we're going to return agency. aent gency ID or we're just going to return null okay awesome great stuff and now if we go back in here we can import this and if you try to invoke this okay let's just say console.log agency ID and since we're on the server we're going to see the console in here if we hit login it's going to take us to the login page because this statement here failed right this right up here um or what we can do guys is we can simply just remove this part in here because the verification is also redirecting right so let's remove this we don't need it in here anymore so let's refresh that okay awesome it's going to do what it has to do and now it's asking us to log in so I'm going to go ahead and log in and I'm just going to use one of the testing accounts okay it's going to take me back to the local page the I mean sorry Local Host 3000 because that's what I set as the redirect to URL right here after sign in to the default path and then we're going to hit login so now you see the user's account is here this is so cool with clerk the user button actually just comes straight out of the box okay and now if you hit login it's going to take you to that page it's saying null there's no user account so now we I'm sorry there's no agency account so what are we supposed to do now now we need to create an account for them okay so before that we will search to see if we have the agency ID and if it does exist we'll send them to that page if it does not EX exist we'll send them to the creation page uh the form where they can actually fill in their details awesome hey everyone so the best way for me to actually know that you enjoyed this video or you want more similar content like this is just by hitting the like button and also go ahead and do yourself a favor and click that subscribe button because the next video is going to absolutely blow your mind away for we send them over to that agency we also need to check if they are a sub user okay okay and we also have one more role guys it's called sub guest we are not using it for this project in terms of the logic under the hood and stuff like that that is going to be a challenge for you to incorporate to create additional functionality for guest accounts so basically your sub accounts can actually you know give access to their platform to other you know maybe their clients or something and they can also log in and do a bunch of stuff so that I'm going to leave that up to you but but I already put it in here in case you need it okay so let's go ahead and first do that so we're to say if the agency ID so agency ID exist then we're going to do a bunch of stuff so in here we're going to check if the user. ru okay there going to we have to put a question mark here because it's undefined it might be undefined we want to check if it is equal to sub guest or it's. roll is equal to sub user then we need to do the following we need to basically return redirect them to the sub page okay and if this is not the case then else if user. roll equal to agenc or the agency admin so or we're going to say user r equal to agency admin okay and if that is true then we're going to check if there are any search prams so these search PMS actually come from the param from the props okay that's how Pages work so let's go ahead and extract that so we're going to say search params search pams and this search P types I'm just going to copy this paste it here and the search param is going to have plan which is of type plan that comes from Prisma client or it's going to have I'm sorry and it's going to have a state and this state I'll explain what this means okay for now just put it this is for stripe stuff but we're just going to put it in here and then we're going to also have a code this is also for stripe but don't worry about it for now just put it in here okay so this roll put a question mark here too and uh we want to say if the search params exist then actually we need search pam. plan okay so if this exists we need to basically send them to that to that dashboard to the billing page and we need to pass in that parameter so that way we can show the payments payment plan on the screen immediately okay so if this exists we're going to return redirect the user to a Dynam DC here so we're just going to use string here yeah just put this back TI and then we're going to say slash agency SL doll sign we have to put the agency ID so agency ID and we also need slash billing billing and we need to we need to pass in that Pam this is search pam. plan like this okay awesome after this part right here after this you want to say if search pam. State and what is the state so basically when we are using connect to connect any users's stripe account in our application there is a redirect URL and unfortunately there are I mean I don't know if there is or not but I did a lot of research and there's no way to have um like a dynamic PM as a return URL you have to have a static URL so we have to send the user back to this agency page and then we need to reroute them to that specific agency ID that we're trying to connect right but we're not going to know that because it's we don't know what we're trying to do in stripe so that's where stripe allows us to pass in a state property when we are redirecting to stripe and then processing the stuff and then getting the response back and that state is going to have that ID basically okay so if State exist so in here if this exist do this and we're going to say constate path equal to search perm. state dosit so we're going to get that uh parameter uh we're going to get that search param and I'm going to put an underscore in there okay so that's why we're taking this and we're going to say at zero and then we're going to say constate agency ID equal to search params do state. spit and again we're going to put this it's a triple I think it's two underscores one two at one okay and then if there is no state agency ID so this unauthorized is actually a component we are going to create so for now I'm just going to just return a div that says not authorized like this and then we'll we'll build that component because we're going to need it a lot okay and after this we're going to also return if not we're going to return direct the user to backx SL agency SL dollar sign state agency ID slash state oops sorry not this we need uh this right here dollar sign in bracket and we're going to say State path and after this you want to put that param that we uh that we just received the code so code is equal to dollar sign search params do code and what do we need this code for once we receive the code we need to actually update we need to confirm that everything is successful and this code is what's going to confirm with stripe okay while connecting the account for now we're not doing that but I'm just setting this up right now because it's needed for the logic okay and um after this we're going to say else return redirect the user to backtick SL agency SL dooll sign agency ID okay after this part here we're going to put another else and we're going to say else return um the the same div for now okay we're going to actually create that unauthorized page because we're going to need it a lot anyway now after this below everything we're going to say const o user equal to await current user like this okay and then we're going to return something in here so what are we returning this is basically if everything failed that means they don't have sub accounts they they don't have agencies they don't have any like is satisfied we need to do here and what we're doing here is basically allowing them to create an agency for their for thems okay so what is wrong here a wait uh so after this guy sorry I put it outside that's why so remove this return here okay and we're going to paste what we just of what is that why did it do that class name of flex justify center items Center like this margin top of four and inside this we're going to create another div this is going to have a class name I'm going to remove this and in here I'm going to say Max with of 850 because this is the form where the form where they're going to put in the details okay so I want it to have some Maximum width border -1 pixel and then we have padding for rounded DXL okay and inside this we're going to have a H1 tag that says um Al why is this not refreshing let me see okay let's come back in here right now we'll get to that in a second in here we're basically going to um return a um return the the title so let's let give this a class name of text- 4XL and then let's say create an agency okay and after this H1 we're going to put that component that component in here okay so you see it says create an agency whatever right so great and um okay yeah so let's go ahead and create that component that component is called agency details okay and we need to also pass in some props so this is going to be a Clos tag and let's go ahead and say data equal to an object with company email set to O user. address at z. email address okay we're passing that email okay and let's go ahead and create this component so let's go to uh forms okay so scroll in here we're going to create that folder go into components create a folder here called forms and inside that create a just C details. TSX and we're going to create uh TS like this okay and we're going to say agency details okay cool and now in here we're going to get access to data and let's see what data we passed in okay so this data is a is basically an email address right so let's go up top here and let's get data inside this component so let's go to definition oh what's going on okay we didn't import it that's the problem so let's see if we can just import this right now okay import it go in here and in here we're going to say data which is optional and it's going to be part of agency okay because we can pass in half of it half of it basically so agency U okay and just import that from Prisma client now let's come down here and in here we're going to destructure data and in here where we're returning this stuff we're going to do all our logic so first thing we need is toast okay so I'm just going to get uh toast equal use toast from why use toast okay and invoke that nice and then we need router so now an error and I'll tell you why we're seeing that error and a lot of you had this confusion this is because this is a client component since we're using hook so go up top and say use client like this this and after this you want to also create another state and this is for deleting so deleting agency okay and we're going to say set deleting agency okay so let's move on to actually building the form first and then we'll come first thing is we're going to need the alert dialogue and this alert dialogue is needed because we are going to have a delete button so when the user hits delete we want to you know basically show the alert and say are you sure something like that so that's why we need this so the first thing is we're going to use a card here import card from UI card and this is going to have a card header and in the card header we're going to have a card title card title and this card title is going to say Agency information and for this card give it a class name of width of full okay nice awesome and uh let's go after this you want to say card description and say um I'm I'm just going to paste some string in here okay I'll just yeah let me just copy that so we have where is this forms agency details let me go ahead and just copy some string where is that okay right here copy that and I'm just going to paste it in here nice cool and description we want after the header we're going to have content so card content here we're going to have a form not the native form actually from from UI form and this form is going to uh basically have a prop in here okay we need to pass something in here so to get this we need to use a use form and this use form comes from react hook forms okay so we're going to say con form equal to use form from react hook forms and in here we're going to pass in Z Dot and Z comes from Zod so let's see if that why is that not here maybe that's not imported let me go up top and see if I can import Star as Z from Zod okay it's already there so good so z. infer and inside this infer we need to pass in um some sort of a a form schema okay so first let's open this bracket here and we're going to say type of form schema okay and that form SCH is going to create it up here so const form schema equal to Z doob invoke that and pass in the property so name is going to be z. string okay invoke that and say minimum of two and then say and this message is agency name must be at least two characters okay and after name we want to pass in the company email so company which is going to be a a string so Z do okay z. string and the next one is going to be the company phone so go ahead pause the video go to your schema file okay which is in here search for the agency and see what information do you need give this a shot just build out don't have to build all this white label stuff just the goal maybe and then you can do the name and the company email and phone okay go ahead pause the video and give that a shot okay awesome and now we're going to infer that type here so it's going to understand that form is going to be of this type great job and now inside this we're going to pass in an object and say mode on change and after that resolver and this resolver is going to come from Zod resolver we need to import resolver so G uptop let's just say right here so I'm going to put all imports from outside files up here and Native Imports at the bottom okay this is good and we're going to go up top and we're going to say import um Zod resolver from react hook form so at hook forms resolver Zod okay all right cool it important it nice and now okay resolver is going to be Zod resolver and we're going to pass in the form schema that we just created okay nice and after this we're going to have default Val copy all of these paste them in here okay and for just remove this stuff so remove this remove this so what I'm going to do is highlight all of these after that I'm just going to delete everything data name for company email I'm going to see going to say data. company email for the company phone same thing okay we're just populating these uh company phone and then for the white label we're going to say data dowh labeled or false and then for address we're going to say data. address City we're going to say data. City same thing for zip code so go ahead and fill this in one more thing we have to in here use effect and the reason why this use effect is needed default um react hook forms will cach if data exist then we're going to say form. reset and pass in the data okay so it's just going to reset those values nice and um after this let's go back down to our form in here and pass in the form with a spread Operator just like this okay and inside this form we're going to let me see if I imported this form okay I think I imported it what is it screaming for children okay so in here we need to pass in the native form like this and we're going to say onsubmit is equal to form. handlesubmit and we're going to create a submit function in here so const handle submit to an async function okay async function in here and uh we're just going to copy this function and pass it in here okay nice and after this we going to give this a class name too so let's say class name of space- y-4 and inside the form go ahead and create a form field okay like this nice and for this form field we're going to have disabled guys keep my GitHub repository open okay we're going to copy paste and if you need to you can copy paste all right so keep that open it's going to be so much easier so the disabled prop is going to be equal to is loading and where does this is loading come from is loading actually comes from the form State itself okay so let's go up top let's just say let's go up top to this let's go up top here to States and say is loading equal to has to be after the form of course down here is loading equal to form do uh do state sorry form. form state do is submitting okay like this and now we can use that is loading in here so if this is is loading true then this field is actually going to be disabled okay and then control is going to be equal to form. control and inside this we are going to pass an a name and this name is going to be agency logo okay and then we're going to render uh we're going to pass in a render prop and this is going to take it okay this gives us access to an arrow to a we're going to get Fe from that and in here we're going to return a form item form item with a form label and this form label is going to say AC logo and after this we're going to have the form control and the form control is going to have whatever component we want in here okay so since we're going to need component for everything we're actually just going to create it right now so let's go ahead and say file upload like this okay and we're going to pass in the API uh file upload uh we have to install this I think so let me go ahead okay so open your folders go to uh Global create a file in here call it file- upload. TSX and then we're going to say TS R fce we're going to call this file upload okay and then let's go ahead and import this right away so we can go in here so this file upload is going to take a couple things so we need the API and send or we're going to have sub logo like this and after this we're going to have an onchange and this is going to have a callback function and this is going to actually return void not an object sorry and here we want to have the string and this is going to have a value set to string as well as well okay and in here let's go ahead and destructure this so go ahead and say API endpoint sub on change and value like this okay and in here now we're going to create a type so cons type equal split at uh the period at the dot. pop so we're going to remove that and um in here we're now going to check so if the value exist we're going to return a div okay value exists we're going to something's wrong if value return that the image itself in here okay so if value exist a div with a class name of flex flex-all justify Center and items Center okay and inside this div we're going to see uh we're going to say if the type is equal to or not equal to PDF then we're going to um return something so true do something else do something else so here if this is true then return a div great I need to close that on my own and say class name class name and set that to relative width -40 and height -40 okay and in here we're going to return an image component from next image with the source equal to the value and the alt is just going to be um uploaded image okay like this and we're going to give this a of object D contain and fill say div here and let's close this div I don't know why it's not closing for me that's so weird and let's pass in a class name of relative Flex items Center p-2 margin top of two rounded DMD and then BG dasb background not black sorry background like this and uh let's just put divid by 10 like that okay and then we're going to say file icon and this comes from uh Lucid react icons okay and inside after this sorry we're going to use uh an anchor tag and we're going to say hre equal to Value Target equal to blank so underscore blank like this and after this target we're going to say relationship equal to no n o opener okay no opener uncore no referer okay just like this and after this we're going to pass in a class name and this class name is going to have margin left of two and it's going to have text DSM text- Indigo of 500 and then we're going to say dark text- Indigo um 400 and hover is going to have underline okay nice and inside this we're going to say view PDF so this is if it was a PDF document you can have that in here okay if not you can just skip this that's fine but now after this we're going to say button okay this comes from UI button and we're going to have um the the variant and the variant is going to be ghost and we want to pass in the type equal to button like this okay and also we need an on click on this but before that I'm just going to say remove logo and in here we're also going to use the X icon so import X and this comes from again the same Lucid icons and in here we're going to pass in class name of height of four and width of four okay so um let's see okay so remove yeah we don't have an icon right now so that's why we don't see this and let's have an onclick on click and we're going to have a function here and this is basically just going to take the onchange that comes in from the uh props and it's going to set it to an empty string so that basically tells react forms there's no value in here okay simple and after this div so here where we're returning something we're going to return something else so let's remove this file upload and say class name with Das full BG D muted / 30 and in here we're going to create we're going to import upload Drop Zone okay and if this does not show up just give me one second let me go ahead and I think we have to create this upload drop zone so let's go in here go into Libs create upload thing. uh. typescript okay and in here first we're going to import let me see if I can generate okay I need to import it so import generate components from at upload thing that/ react and then we also need another one which is import generate react helpers from at upload thing SL react SL hooks okay great and now we're going to also import another type let me shrink this so you guys can see clear we're going to get um we we are going to import our file router and we got to create this in a second so I'm just going to import it for now import file router from slapp SL API which we need to create slash upload thing SL core okay and then also let's just say export const um upload button comma upload Drop Zone comma uploader equals equal to generate components invoke it this should be const um you want to invoke it and you also want to pass an A type and this is going to be our file router but we don't have it so we're going to go and create that in just a second so our file router like this and um let's go down here and we need to do the same thing I'm just going to duplicate it here and we're going to go go in here and say use upload thing and upload files okay and this one uses generate react helpers so invoke that and we're going to pass in this so let's go ahead and build this out um and this is inside the API folder okay so let's go into API up here so close this close everything so it's easier to see you want to go into your app directory and you want to create another folder here call it API okay and inside this API folder you're going to create another folder and call it upload thing like this and another uh file in here called core. typescript okay nice and inside uh inside this one more which is called route. typescript and inside the core. typescript we're going to do the following so I'm just going to go in here this is just setup so we don't really yeah doesn't really matter let's go in here go into app go into your API and you see upload thing click on that go into core and and basically we're just using upload thing okay if you read documentation you'll know what this means but basically we're just creating a router with different API endpoints okay like the sub logo the Avatar agency logo and things like that okay so go ahead and copy this like this and paste it in here nice and the next thing we need is a route so what is this route this is how we can upload so we're going to just import I'm going to copy the import statement actually so let's go into route the import statement okay we're going to get this create route next route Handler and we also need um this our file router okay and then we're going to export const get and sorry get and post equal to create next route Handler invoke that and pass in an object with router and set it to our file router like this okay now now if we go into our components let's see if we can uh also upload this import this upload thing component and now we need to pass in a bunch of stuff into this as well so in here the first thing we need to pass is the API endpoint so the API endpoint in here is agency logo and then the next one is the onchange which is going to be field. unchange the same function and then we also are going to pass in the value which which is optional so we're going to pass that in here and we're going to say field. value okay so that way we can tell uh what's going on with the value awesome and uh let me also just close this component and let's see what's going on here okay let me just quickly render this before form message component there's something missing I think I need to go ahead and take a look at this form uh form element give me one second guys all okay we actually didn't build it out sorry about that so let's go in here and now let's import the upload Drop Zone okay and this actually comes from um our Libs SL upload thing okay like this and this is going to take an um a bunch of props so it's pass in the endpoint and the endpoint is going to be the API endpoint we get from our props so API endpoint nice and then we need the on client upload complete so once it's completed we're going to we're going to pass in this call back function and pass in res res in here we get access to Res and we're going to say on change and pass in res at 0. URL okay and after there you go you see it's already showing up here right looks awesome and then on upload error we're going to invoke that and uh we're going to get access to the error which is of type error like this okay and in here we're going to say console.log error great so let's refresh this um it still says loading okay there you go fixed nice now we're going to use this component literally everywhere okay so we're going to need it um and that's why I wanted to build it right away so let's go back up and now go ahead take this up as a challenge go use Shad cnii so go to Shad C nuui go to form so scroll down you're going to see form forms in here okay where is it I'm going to show you how to do it so click on form and see here they're giving you form item form label form control they're literally showing you what to do so try just give it a shot there's also a good example at the bottom okay so build out those input components if you don't want to no problem I'm just going to show you right away all right so after this form item we're going to create the others so we're going to say div class name of flex MD Flex - row Gap -4 this is just some styling okay we're going to put items left and right so that's why we need this um this kind of a wrapper here okay and then we're going to use a form field and this is going to have the disabled set to is loading like this and we also need the control which is sorry the control which is form. control sorry not this and we need to pass in the name which is is name and then render which is uh a function like this and this render has uh gives us access to the field so let's get that field and let's return a form item okay and this form item in here is going to have the form label so form label and the label is going to say agency name like this and after form label let me shrink this real quick after form label we need the form control and inside the form control we're going to use input and import it from here okay not from anything else from UI input and uh passing a placeholder like this placeholder oops sorry sorry about that it's going to have a placeholder set to your agency name and we also need to use the spread operator and put all the items in here okay so the field goes right in here that's how you create a field okay okay so let's see um there you go we just have to refresh and that shows up so this is how we do this and if you create another form field just literally copy it paste it that's all you have to do and now you have another field just do the same thing okay and create multiple Fields um and I think we made would we okay I think this is okay not sure what's wrong here yeah it's fine it's just the same thing all right go ahead and just copy copy paste copy paste and just change this name according to the field and then come back okay so uh basically I wanted to just point something out the reason why it wasn't stretching across the entire form was because I didn't put flex one on this form item okay so just put that as well all right so I went ahead and just built out a couple form Fields it's the exact same thing nothing is different just change the name for each field that you need up here okay so I did company email company phone and I just created the same row and I removed the row for some of them so this one has a row so you will see company phone and the other one in the same thing the only different thing is this wh labeled agency right here so I'm just going to show you what I did so let's scroll down it's the same thing guys just literally copy paste copy paste and change the name okay so where is this switch component it is right here so for this we're going to use form field have a disabled prop set to is loading the control set to form. control the name is going to be white label and we're going to pass in a render prop which is going to give us access to field we're going to return a form item with a class name Flex Flex row item Center justify between rounded LG border Gap 4 and padding four and then we're going to have a div here and we're going to say form label white labeled agency and we're and we're going to pass in a description we're just going to say turning this will you know whatever whatever we're just going to give some information okay and then we need to pass in a form control and for the switch we're going to import the switch from U our UI folder and then we're going to pass in the checked as the field. value and the oncheck change as field.on change okay that's it and um that's it and literally that's about it guys is nothing crazy there's a couple other things but I just wanted to show you this uh because these are the the the values that um you know are going to be there by default okay so let's go down to Country right here and after country we're going to show something here so let's say right after this right here go ahead and create this and say data. ID exist then we're going to return a div with a class name of flex Flex D flex-all and GAP D2 now this is basically a way for them to create um uh gos for the agency okay but this component comes from a different library that we're going to need for um you know creating charts so let's go ahead and install that so open up Tremor okay it's a library uh let's find this Tremor UI all right right here and I'm going to click on installation and you see it's going to show you I wish it gave us the bun command I don't know why they don't do that anymore but anyway so we're going to just copy this command from here copy it open this close this paste don't hit enter actually okay it's causing problems paste that and we're going to change this to bunad okay so bun add like this Tremor SL react okay go go ahead and hit enter and then we're going to copy this from here okay awesome so since you already copied the Tailwind config file from the GitHub if you haven't go to the GitHub and copy that file okay and paste it if you haven't already but we've already done that but um yeah if you haven't go ahead and do that and now we're going to use that component uh in here so inside this div for now I'm just going to remove this so we can see what this component looks like let's go back here awesome and inside this go ahead and say form label create create a goal so they can create a goal basically and we're going to say form description and this form description I'm just going to copy it from the GitHub so let's go to app uh we need to go into the components so where is that app um sorry this is wrong go into Source components go into forms agency details let's scroll and I'm just going to copy this text from here okay and just just paste this you can do the same thing too no hard feel no you know nothing stopping you from doing that okay go ahead and do that just don't copy paste blindly because you're not going to know what's going on and then we're going to import the number input okay looks like it's not showing up so I'm going to go up top and let's get that number input component from Tremor react let's go to the bottom and let's import number input component like this okay and now we need to use this component so in here we're going to pass in the default value not default checked default value and the default value is going to be data. goal data. goal like this okay and inside um actually we need one more so on change on change we need to update this so we're going to just say um create a function here and we're going to make this async and in here we're going to say if no data. ID return okay if not okay let's put this question mark here and then if not we're going to await update agency goal and we're going to set that to data. ID and set value in here okay so um we don't actually have to use this we can actually use here let me go into the libs queries and I'm going to create const uh update update um agency details equal to an async function whoa whoa whoa sorry equal to an async function and we're going to pass an async in here what's going on okay whoa equal to async and this is going to get the um agency ID which is going to be a string and we need the agency d details which is actually going to be partial so partial we did this last time guys if you don't remember and you want to get a good idea of how we built an amazing application last time go ahead and check out the previous video the link is going to be in the description it is an amazing application and there's nothing like that on the internet because we taught you how to use realtime cursors and so many cool things so go ahead and check that out if you haven't if not no problem this is still an amazing project so I'm going to say partial agency from Prisma client and then we're going to say cons response equal to await db. agency. update um let's see data okay and this is going to be like this data and we can say um everything basically everything that is inside agency details not agency logo agency details why is it it's saying agency logo it's not even here agency details okay and we also need to pass in where so where um ID is equal to agency ID like this and then we're going to update this okay you don't even have to do this you can just that's fine just do it like this and then return uh response because we're going to use this more than we use that update one so return response so close this go in here let's go ahead and import this if it if I even imported it let's see okay export const update agency details and let's go ahead and import that right here so this needs the ID first I'm going to pass in data. ID and the the data that I need to pass in is going to be an object with Goal sets to um the value okay nice and now um after this we need to what's what's going on here saying value I didn't get Val from here that's why okay so this V is going to be string goal is not assignable to type number sorry about that so this is going to be number and huh something seems to be wrong here guys just give me one second okay so this one has to be on value change not on change all right there we go okay I wish it was just on change but anyway and um so now that we're updating this we can also use that activity log so we can say const I'm sorry await save activity notification we're going to pass in uh an object and say agency ID is going to be data. ID and then we need the description which is going to be uh something like updated the agency goal to put this and say dollar sign um Val and then after this we're just going to say sub accounts like this and then finally we need to say sub account ID of undefined and finally after this we're going to scroll to the top right here okay we imported use router so let's go to the bottom here and after this we're going to say router. refresh and just invoke that like that and for this by the way we need to also pass some additional props so let's go in here and let's close this component actually and let's pass Min equal 1 class name equal BG Das background no border I'm sorry import and Border import and Border Das input and then we're going to say placeholder is equal to sub account goal okay and let's refresh this page we have to say Bun Run Dev and let's refresh this and let's see what that looks like awesome there you go take a look at that looks very very different but um it's fine we're just using an external component right and we're not going to show this if the ID does not exist so now we can go ahead and hide this and we're going to say uh data. ID then we're going to return this component so now you're not going to see this by default awesome now we need to also create the submit button so let's go quick um after this um after this div right here we're going to say button which comes from UI button and class name um actually we don't need any class name we can just say type equal submit and then we need to say disabled equal to disabled is equal to is loading okay um loading what is what what's going on is loading and the text inside is going to um say you know something like loading basic so let's just say save Agency information because we're going to use the same form for creating and for up updating so we're just going to say save Agency information and uh that should be it I think shadan also released a new update let me take a look at this okay so they have a new reload icon that's awesome so what I'm going to do is I'm going to import this component so let's go in here and let's say um reload icon like this hello okay Imports are not working anymore let's go ahead and import that oh I got to import this component literally okay give me a second guys okay so I'm not going to install this I think there's more to install if you try to get some components I might be wrong but um I'm just going to move on okay I'm actually going to use my own loader so let's go in here and go to the go to GitHub I actually created my own custom loader so that's why I was a little excited thinking I could use that right off the bat but U this is loading component um this loading compon component comes from um a different place so let's go ahead and import that where is this component let's see so globals SL loading okay let's go to that okay so let's go in here we want to go into Source components globals loading. TSX let's go ahead and copy this and let's go ahead and create that so go into your globals file folder right in here and say loading. TSX paste that in there and let's go back and let's install that uh let's import this component in here so I'm going to say um let's remove this and say is loading if this is true then return the loading component from Global loading or say this save Agency information okay and we actually might use this again so I'm going to go in here there is a loading page that we need so let's go ahead and copy this it's it's nothing it's just a loading component and something with with height full width full and it's just spans the entire page we're going to use this to basically show the loading state of the page so let's go in here and say loading page. TSX and paste that in here too we might use this again okay cool and uh now we also need one more button I think uh let me see okay this is good after this we need the delete button so U go down here after this form component okay after this and we're going to say if data. ID exist that means something exist then we're going to return a div with a class name of flex Flex D row why is this like this okay never mind and then we're going to say items Center we're going to say justify between rounded LG border border destructive and then we're going to say Gap -4 padding -4 and margin top of four padding top of four oh sorry padding of four I made a mistake there okay and inside this create another div create another div here and we're going to call um we're going to call this one danger zone okay danger zone like this let's remove this and see what this looks like actually let's go in here refresh that danger zone oops reading use cont okay never mind yeah danger danger zone and then we want to create another div in here and we're just going to pass in a class name and I'm going to copy this text so let's go back here go into forms agency details scroll to the bottom let's close this it's taking too much space and let's copy this delete danger notification whatever and let's say text muted foreground okay copy this I put it outside the okay what is this close this and paste that inside okay nice now let's go back and see what that looks like great so it just says Hey danger zone watch out okay cool and after this part after this div now we're going to use use that alert dialogue trigger okay dialogue uh trigger dialogue trigger like this and this comes from UI alert dialogue okay please be careful with that and this is going to have a disabled set to is loading or deleting agency okay and let's give this a class name of text- r- 600 p-2 text- Center margin top of two rounded uh round DMD like this hover BG Das red uh -600 and then hover oops never mind that's just a message and then hover um text- white Whit space no wrap okay see I don't I can't even see that because it shows but I know the next one's going to be no rap and in this dialogue we're going to say deleting agency if this is true just say uh Delete T dot dot dot or we're going to say say delete agency just like this great job and now we're not going to see this of course so let's go up here and let's hide this now so you see it's just going to look like this and you can click on this okay so let's just wrap this where is that um wrap to the alert dialogue and we're going to say data. ID if that exists then return this component okay you cannot return return to jsx elements so we need to actually put this uh alert dialogue inside this div like this okay sorry about that and now we need to do get the alert content so what are we going to show inside that content and we can just get this from here so uh just copy this content from here and paste the content after this okay and go ahead and import each of this so oops make sure you import import it from UI okay import this from UI alert title from UI alert dialog title description as well from there so like that and the footer from there as well the cancel button from there action um and that should be it and now we need to pass in this function so let's go up top and I'll basically create this function okay so uh copy this go up top here and say const this is equal to a function and it's going to be async because we're going to create some sort of API request right and in here we're going to say if sorry inside this we're going to say if agent uh if no if there's no data. ID okay and then let's put this in here we're going to uh return so we don't have any of this just return and if it does then we're going to say set deleting agency to true and after this um what are we going to do here actually we're going to just delete it right okay so there's one thing you have to do in here this is something we're going to keep for later if we have time sure if not it's fine okay you have to basically discontinue the agen the subscription for the user okay okay I'm just going to put a work in progress flag there so we don't forget so create a TR catch and inside the say cons response equal await delete agency and pass in data. ID copy this go into your queries file scroll to the bottom and just say export const this equal to an async function whoa whoa whoa sorry I don't know what just happened let's save that and we need the agency ID which is going to be a string and in here we're going to just say cons response equal to a wait db. uh agency. Delete okay where ID is agency ID okay and then return response like this good okay and let's copy this go in here and let's go ahead and import this from here so import that great awesome and if this is successful we'll return a toast okay also I know shaty and UI updated their library and created using Sonar now but I'm not going to use that okay I'm just going to use this title and we're going to say deleted agency and we're going to say description is going to be uh deleted your agency and all sub accounts okay CU that's a that's a bad thing you don't want to delete everything so you need to tell them and after this we're going to say router sorry what was that router refresh awesome and if there was an error same thing copy this go in here paste it um and we'll just say oops could not delete your agency okay just like this and pass in the variant which is going to be destructive okay nice and after this we'll also just console.log the error in here so we can see what happened and after everything which is after all of this set deleting agency to false so that we can stop loading that awesome and now let's go ahead and also create the saving uh on submit in here so we're going to create a try catch in here and say let new user data and let customer ID so this might be work in progress let's see how far we can go without breaking uh you know the flow so if data. ID does not exist oh sorry yeah if data. ID does not exist then we're going to actually say yeah we're going to say body data equal to an object email do um email sorry is going to be values. company email and this value comes in from here okay so say values is going to be z. infer type of uh form schema like this so now this has all of these values so values. company email like this and just go ahead and populate everything okay go ahead and populate all the data okay and I just saw how how far we could get without actually jumping into the stripe stuff but basically this is the stripe uh thing right we need to create this so we can uh create the customer okay so that's why we're just going to skip this process right here and after this right after this we're going to say const um or we're going to say new user data equal to await uh init user so init user like this and uh this is going to be a uh new action that we need to create and we're going to pass in the role sorry the role of agency owner so I'm just going to copy this okay and replace this and let's go ahead andate create that action okay so where do we go let's go in here go to queries and let's say export const init user equal to async function like this and inside this we need new user which is going to be partial of user okay and in here we're going to say const user equal to await db. user. upsert and in here we're going to say where the email is user. email addresses uh user not user agent sorry it's new okay sorry guys I skipped a part here we need to actually get the user so const user equal to current user like this okay and if there if there is no user then return okay um yeah and in here we're going to say user data instead so yeah so return this or we can throw a new error whatever you like to do I'm just going to return here and after this I'm going to say where email addresses email addresses so user. email oh we have to await here my bad. email addresses at z. mail address like this okay and after this we're going to say update the new user or we're going to create the ID is going to be user. ID the Avatar URL is going to be user. imageurl the email is going to be user. email addresses at0 doil address the name is going to be dollar sign user. first name space dollar sign user. last name okay this is small letter and then finally the r is going to be new user. roll or sub user okay sub user like this and after this part after upserting um after this we're okay this is not user metadata this is user data and after this we're going to say await Clerk client. users do uh uh do update user metadata to user. ID so for this user we're going to update their private metadata and we're going to set that to roll and that Ro is going to be new user. roll or sub account like this I'm just going to copy the sub account user and paste the sub account user in here okay so we're just going to basically create that role for them uh on the private metadata as well and then return user data awesome cool pH that was a lot of code so let's go in here and now import this init user from our Li from our Libs folder and let's go ahead and build this out in here okay so we're going to get we're going to create the user and if no data do customer ID and no cust ID so this cust ID actually comes from here so since we're not doing that I'm just going to remove this uh for now okay and I'm just going to put a work in progress flag cust ID okay we'll come back to that and if there is no data in here then we are going to say cons response equal to await upsert um upsert agency I don't think I exported let me see where is a qu queries file queries okay we need to create that one so export const upsert agency make sure I didn't uh actually create that anywhere okay yeah we didn't create that nice so let's go down here and we're going to say upsert ageny and this is going to be a function that's going to take in the agency which is of type agency and the price which is of type plan so this plan comes in from um Prisma client plan like this so if there's no agency. company email then return null okay and why is this I think that's just yeah it's going to take some time so try catch let's import I mean let's create that template and say con agency details equal to await db. agency. upsert like this where ID is agency. id. ID okay that exists nice and we're going to say update agency or create a new agency so we're going to say for users connect where email is agency. email. company email like this and after this let me hit enter here so we can see more and after this um users we're going to say dot dot dot agency like this and then we're going to say Side bar options we're going to create some default options okay so we're going to create an array okay and we're going to say um the following so we're going to say name is going to be dashboard go here just actually just go in here and let's go into not in it user where is that where is that upsert agency let's click on that and let's go into to this right here okay oh it's not okay upsert sub account upsert agency copy this entire create statement okay copy that replace this it's basically a default um like sidebar options that we need okay and now you're going to notice we have this icon here what is this icon so we have already gone ahead and got the best icon set we have updated it we have upgraded it change the colors everything and we put it in here so make sure you go into this Source uh components folder and you're going to see icons go ahead and just download this entire folder this one right here and just bring it into yours and create the same directory structure okay so go ahead pause the video do this and come right back hey it's me again just quickly reminding you if you haven't already just please click that like button if you found this video helpful it's the only way for me to know if you actually found this valuable and I'm going to put much more similar highquality content out just for you hopefully you went ahead and copied the entire icons folder into your components folder it's same thing download drag it from your download folder into your components okay now how does this work there is a mapping structure okay that we're going to use inside the sidebar to determine which icon to show go into Source okay see this is why I said you need to have your my my GitHub open okay go to the description click on the link and open it keep it on the right side so go into Libs constants and you see this mapping structure right just copy this whole thing right here and go into your Libs you have a constants file in here so just go paste it in there and then you're going to see all the import statements for all the components just copy this go up top and just import all those components and now that all the errors are going to go away basically we're going to use this one to determine which icon to show in the sidebar now you want to go back into your agency details under the forms basically we're just going to finish up this okay so let's look at that inside the GitHub repository so click here you want to go into Source components forms and then click on agency details Okay the reason why I'm copying this is just unnecessary redundant stuff okay right here you see it's just await upsert agency that new uh function that we just created right the new server action we're just going to invoke that and pass in some data I'm going to I'm going to show you exactly what it is um right in here so you want to import this upsert agency like this and let's also we also need V4 and V4 comes from uh uu ID let's quit the server and say bun add uu ID okay that's going to go ahead and install that and then we can import this from that I think we might also have to import the types for this yeah okay so you see it's going to give you it's going to say uh get this types copy this types and just say say bun add and paste those types okay so the customer ID right here is actually undefined we're not we're not doing that part yet right so we're just going to remove this and we're just going to pass in this customer ID like this so let's see what happened here string or undefined is not not assignable to string uh to string okay so the customer ID has to be present when we create an account okay so let me see how we can make this work since this customer ID requir a bunch of stripe setup um and we haven't even gotten our UI kind of up and going right so what we're going to do is we're going to go into our schema file okay go into your Prisma schema and you're going to find customer ID under the agency okay so we're just going to remove this for now all right remove that and I think everything else is okay and just go ahead and open your terminal and say bun X Prisma generate and then bun X Prisma DB push okay that's going to go ahead and push that change and I want to go back into your file and we're just going to remove this from here because it's no longer needed and let's just make sure data dot yeah so if data. customer ID does not exist then we're going to create this so for now we're just going to uh let me see right here init user and we're creating an account right so we can just say if data. ID or yeah we're could just put this this is fine uh and what is this issue property ID does not exist on type of never h interesting all right give me one second guys okay so you just have to put this here and that way it will remove that typescript error okay awesome and after this now we need to quickly show a toast if everything is successful so in here just copy the toast that we have above which is uh right here did we even use that toast I think we used a toast somewhere yeah right here copy that toast paste it here and you want to say created agency okay and this is okay we can just remove this and uh we need one more toast for an error so I'm going to copy this one and if some error took place I'm going to console.log the error and I'm also going to show a toast and say could not create your agency okay and um yep so this is how we basically uh create it now the other thing we need to do is once the user creates this we have to Route them to that page how do we do that so right after this so right after the toast after showing we created it we want to say If U data. ID okay we're going to return router. refresh okay we're just refreshing the um we're refreshing the the browser okay and then after that we're going to say if response exists so response exist nice and then we can do return return um this one okay right here so just do this in here nice so we're just refreshing it and once this refreshes what happens the page basically gets purged all the data gets kind of uncashed right it refreshes that and then inside our page. TSX in here under agency it's going to basically refetch and check okay it's going to refetch this and we're going to end up finding the Au user details and it's going to have the the person's going to have a user because we ini initialize the user and then it's going to redirect them to the agency if an account was created for them and whatever okay awesome so let's go ahead and see how this works so let's first hit this and see if error validation works okay awesome and even the agency detail gets pre-populated so I'm just going to refresh this um okay we have to run the server so go ahead open your terminal and say bun runev and refresh this okay and let's just give that a second okay so what I'm going to do real quick is I'm going to go into this agency folder and I'm going to create a dynamic um path like this Dynamic route and I'm going to call this agency ID okay we're going to need this because we're going to Route the user right inside inside that just create a page. TSX and say this and just say page like this okay and in here we're going to get access to uh some sort of uh some prams right so this is basically the ID that will get passed in so to extract that we're just going to say uh params like this which is going to be um an object with pams which has our ID so agency ID which is going to be a string okay and now we're just going to render out ps. agency ID so that way we can see when the user gets routed okay so let's go ahead give this a test so if you hit this air valid validation Works let's go ahead and try to upload something I already have an image pack um that I'm going to use so in here under my assets folder I have a bunch of amazing template logos I'll see if I can put it in the description okay this is not mine guys I this is not my logo I just found this from the figma community okay so I'm going to go ahead just select uh a really nice looking logo and I think uh let's take this one okay I think it's called focal point and I'm just going to put it in here so focal point I already have some you know preconfigured data I'm just going to put some uh random text in here okay just put some number like this and we're going to change this to USA so United States like that awesome and this white label can be off for now so let's go ahead and upload this image and oh did I click on something let's see okay I'm going to use this one okay so let's go ahead and upload that image if everything works as expected that image should show up here so let's give that a second awesome looks great well it it's not um covered all throughout and maybe we can go fix that cuz we're going to use this component we don't want it to look bad right so let's go into our globals into the file upload component and let's see where do we have that I think that should be somewhere in here items what is this item Center I'm just going to fix that and object contain contain this should fix it okay let's give that one more shot of course it's going to upload that image but it's fine okay we're going to change this to bolt shift I know this is Bolt shift logo and let's go ahead and upload that and let's hopefully hopefully everything looks good okay amazing and now you want to scroll down and hit save agency details okay let's hope everything works okay something looks wrong that might be because we made a refresh so I'm just going to change this stuff in here here one more time okay just like this yeah that's probably because we made that refresh and now let's go ahead and save okay it did something what did it do I'm not sure I'm going to open this and see what's going on in here okay okay so here's what I did guys I just removed all the if statements because we are actually not returning any data from the upsurt agency we could but that's fine that I think that's why it's failing because there's no data in there right or what you can do is go in here and just return the agency details so let's go to the bottom here and we can just say return agency details like this okay and this will work okay awesome and let's just console.log some error if an error takes place in here let's quit this and now it's of course going to work okay so let's refresh this one more time let's give that a second okay and the meantime I'm just going to fill this up with some uh some mock data so I'm just going to use focal point guys so I'm having some issue here I don't think you will face this problem but I think it's because I'm out of space in my com uh memory in my computer but if that's not the case I don't think you're going to face the same problem okay um but yeah I'm just going to quit and refresh just give me one second okay so now if you go ahead and try to upload some image put some random phone number put some random information um change this to United States we'll keep this like this let's go ahead and upload this image and now if you go ahead and Save The Agency information it should reroute us to that page awesome great job so far this is the logic so now you pretty much know how to build any form literally any form okay and if you have any questions discord's open or learn how to read the documentation under forms in here there's so much that teaches about Zod and how Zod works we literally worked through an entire example you have to use Zod to basically validate and components just do it for you because that's the power of shadow Nui so from now I'm not going to build each form element one by one because you know what it is okay you already know so just read this and try to understand how does a form work a form works with simply a form field with a bunch of props that you have to pass in because that's how the component Library works and then you need the form item label a control for the input whatever the input type is so here we had a custom input so you also know how to create a fully customized input okay and um you also know how to create the form error messages every single thing so from now I'm just going to copy paste form so I can help you speed up your process all right awesome let's move on to the next part which is working with the sidebar all right so go ahead and open your directory I'm just going to shrink everything and so it's easier to see go into components and create a sidebar folder and inside the sidebar folder we're going to create the um index. types uh TSX file okay so let me change this real quick TSX and then I'm just going to use this uh snippet here and I'm just going to say sidebar like this okay and now this sidebar is going to take two props which is the ID which is going to be a string and it's going to have the type and this is going to either have agency or it's going to have the sub account now why why do we need this the reason why we need this is we're going to use the same sidebar for everything for agency and sub accounts okay we're just going to make some quick tweaks and also we're going to use the same sidebar for mobile devices as well okay so that's why we need all this stuff and in here first I'm just going to change this to an acing component and I'm going to remove this and I'm going to say ID I'm not removing it sorry by the way I am destructuring okay id id and type and uh here now we're going to do some stuff so we're going to we're going to first say con user equal await get user get off user details okay and then we want to say if there's no user we're going to return null okay because there's no user and if there is no so if no user. agency then we're going to return as well okay and now first we need the details so let's go ahead and get all the details that we need for uh the agency or sub account so if type equal to agency question mark and then we're going to say user do agency um like this user. agency or we're going to get user do agency. subac account. find where the subac account. ID is equal to the ID we just passed in okay so we're just basically filtering uh let's see what seems to be the problem here sub account. ID is equal to ID okay and this is wrong there's no space great and now after this we want to basically say const is white labeled agency okay say is wh labeled agency equal to user. agency dowh labeled okay like this and then we're going to say if there's no details if there's no details we're just going to return okay and after that we need the sidebar logo so which logo are we going to show so let's write this here sidebar logo and this is equal to user. agency user. agency. agency logo okay and um or we're just going to pass in from our asset so we already have a plur logo so worse comes to worse if something fails we at least show our logo okay so assets plura Das logo like this okay and Let me refresh this I think I'm having that error okay yeah I'm having that error again and this is not something related to the code I know that because I made other people run the code and everything looked good so if you guys are facing this problem please let me know and we will solve this bug okay and now that we have see now it's running so clearly there's no other problem but anyway so now we have this uh plural logo.svg like this and after this we're going to say if it is not a white labeled agency then we're going to say if type equal to to sub account then we're going to say sidebar logo is going to be equal to user. agency. subac account. find where the sub account has a subac ID equal to the ID that we just passed in okay and if this exists uh then we're going to after this okay right here what is this did I say const sidebar logo so here we're just going to say sidebar account sub logo or user. agency. agency logo okay awesome and after this all the way at the bottom we're going to create the sidebar options okay so const sidebar options is equal to if type equal to agency then we're going to say user. agency do sidebar options so let me get that sidebar option like this or we're just going to put an empty array okay and if this is uh true this one if this is not true then we're going to say user. agency. subaccount dot um find where the sub has a sub. ID equal to the ID we just passed in so now we have all these sidebar options okay and also we can pass in the Mt array here if uh this fails so uh actually let's first get the sidebar options we missed that here and then we can pass an or an Mt array and in here we want to say con sub accounts equal to uh user. agency. subaccount do filter like this and we're want to filter for the sub account okay where uh where the user. permissions doind so we're basically saying only the sub accounts that they have access to okay uh so permission okay where the permission this is the wrong spelling permission. sub account like this sub ID is equal to sub ID that we uh are accessing here so we're going to say sub account. ID and permission. access is true true okay so this will have these sidebar options sub account uh sidebar options basically okay sub accounts and with their um options awesome and then finally now we're going to return the components so here we're going to return a custom component so first let's have a uh react fragment and in here we're going to say menu options okay like this and because it's a custom component we're going to create in just a second and I'm just going to close this and I'm just going to do this one more time down here and I'm just going to pass in uh some props actually here let me just go and build this out so we're going to call this menu options. TSX okay oh I can't type okay menu options. TSX and in here we're just going to use this snippet and menu options okay cool and let's go ahead and import this component from here awesome and now if we go into this component we can actually show the props here and then we can bring those in so we're going to say default open is going to be a optional property set to a Boolean okay and then we need sub accounts is going to be of type sub account when from Prisma client which is an array and then we need sidebar option which is going to be agency sidebar option uh with an array or it's going to be sub account sidebar option with an array okay and then the Side Bar logo is going to be a string and then the details oops what is this the details is going to be any and user is also going to be any here and the ID is going to be string okay like this and now this SC we destructured so we can get access to these so I'm just going to get this value okay yeah just import just bring all these values in okay user and finally default open cool so now we have all these values in here and um so let's go ahead and pass in all these values from here so you want to say default open is equal to True okay and then we have details which is equal to details that we just got and then we have the ID which is equal ID we have the sidebar logo which is equal to the sidebar logo we have sidebar options which is equal to sidebar options and then we have sub accounts which is equal to sub accounts and then finally we have user which is equal to user like this and now we're going to copy all of this paste it in here but we're going to remove this uh default open a true because this one is going to be the mobile Navar okay awesome and now let's go into this component and we're going to make some changes in here so the first thing we want to do is go all the way up top and we're going to say use clients like this okay and uh give me one second I'm just going to refresh everything okay so now what we're going to do is before we put changes in here we want to actually render out this component right so let's shrink everything go into app go into main into agency um and then we're going to go into this this agency ID and we're just going to create a layout. TSX and we're going to just quickly import this and inside this component we're going to get access to some props so this one is the children which is going to be react. react node and then we're also going to get pams and these pams are basically an object with agency ID which is a string and let's go ahead and destructure this from here so we have children and params okay and we're going to first um remove this div actually before this we need to do something so I I am aware that um layout. TSX does not refresh on every render okay however I think when pams are present that means the component should be rendering right I read a lot of documentation and I think this is correct it worked if it doesn't work well the solution would be to wrap each page element or each component in a check but we're basically doing a check here okay we're going to say const agency ID equal await verify and accept invitation okay and change this to async and after this we're going to say const user equal await current user from next from Clerk nextjs and then we're going to say if there is no user return redirect which comes from next navigation to nothing to the main page and then if there is no agency ID then we're going to return redirect the user again to the agency page okay because that will do the logic of prompting them to create or send them to their account and then if user. privat metadata okay. roll we created this if you guys remember is not equal to agency owner so agencycore owner and user do private metadata is not equal to do sorry rule is not equal to agency admin like this okay so agency owner and agency admin then we're going to return an unauthorized link so let's just quickly go ahead and render that so right now we're not going to see that uh let me see what's going on okay so right now we're not going to see that because we are not rendering this page so uh give me one second I'm just going to quickly uh get that layout that unauthorized page guys this is the page that we're going to be building it's a very simple unauthorized access page so how do we how do we build this it's very simple so what we're going to do is we're going to create a folder inside this agency okay so open the agency create an unauthorized folder okay and inside that create a page. TSX and the reason is we might need this route I'm not going to use it but if you ever need to you can reroute the user to this page so you can show something and you can also do the same thing in the sub account but anyway so yeah you're going to have that unauthorized and then you want to go to your components folder right in here and create an unauthorized folder in here as well and inside that create an index. TSX okay I hope you're with me go ahead and do this with me right now okay pause the video and get it done if you haven't but that's what you need to do to just get this set up awesome now click on this index. TSX and just return a component okay just type in rafc and uh or TS R A fce same thing and inside this we're just going to say div with a class name of padding for text Center Height screen width screen Flex justify Center item Center and flex call and now you may ask where do you get this from don't worry about that this is not going to be there for now we're going to get this in a second and then create an H1 tag and say text 3 XL from medium devices text 6 XL that's why it increases is like this okay and then we're going to say unauthorized access and then for the P tag just say please contact support or your agency owner to get access and then we're going to have a link tag in here okay very simple component nothing crazy and now we're going to go into that page okay the unauthorized page and just return this component in here so that if we ever access this page we can show that component okay awesome now go into agency ID and inside the layout. TSX in here now instead of returning this div here we're going to return the the unauthorized page that we just created just like this okay awesome now hit enter after this you want to say let all notifications okay any equal to an array so we're going to get all the notifications as well so we can show them and right now we're not going to need this but we will in the future because when you click this we have to show some notifications right so for that we're going to build this all right so let's go back in here and U the reason why you don't see anything is because we're not returning the children okay if you're ever curious that's what's happening so say const notifications equal await uh get notifications access so this is going to be a new action that we're going to create which uh you don't have but I already built it right now so I'm just going to get to that in just a second so let's quickly go into this function it's a server action so go into your lib query Aries file and Export a a function called get notifications and user which is an async function with an agency ID which is a string as a parameter and all this does okay it we have a tri catch const response equal await db. notification. find many where the agency ID is of this okay and then we're going to also include the user and we're going to order by by the created at in descending order and we're just returning that response nothing crazy and if an error occurred we're just console we're printing a console saying error okay so let's go back to that file and that's what we're doing here so I just want to give you a quick overview and then after that we're going to say if notifications exist all notifications is equal to Notifications like that okay and after this we're going to return a new div with a class name of height - screen overflow hidden not Auto hidden and inside this we're going to return the sidebar that we created so import that sidebar and you want to say ID equal to pams do agency ID and we're going to pass in the type which is going to be agency okay and after this we're going to have a div and this div is going to have a class name of from medium devices padding left of 300 pixel this is not going to make sense right now I understand but I'm going to show you and we see an error here and I'll tell you what error we caused so if you go into this sidebar component and you scroll down you're going to see we're importing use instead of the user so let's go up top and remove this it accidentally got imported and let's go down here and just change this to user like this okay that's it so just change that to user and now that error should go away awesome so now we're going to say two men options because we haven't constructed the uh menu option component yet so let's go ahead and do that so right up top in here we're going to say const open State equal use memo okay use memo and we're going to pass in a a function with an with a dependency array with the default open inside here and in here we're going to say uh we can remove this and say default open if it is true then return an object with open set to true or just return an m object okay and we're going to use this somewhere now I did notice something and I think this might have changed uh after the new update from chatsi and UI but sheet components are causing some sort of a hydration error and I tried it I also copy pasted the exact same code that we have in production into the build and we're still seeing that hydration error so it could be coming from somewhere else I'm not sure if you guys find out awesome just let me know what's going on okay but um so to prevent that hydration error from happening we have to create a state here so we're going to say is mounted and set is mounted and this is going to be equal to use state so just wh okay use State like this and set it to false okay and if um is mounted is not true so if is mounted is not true we're just going to return and in here we're going to create a use effect use effect and all this use effect does is it's going to have an empty dependency array all we're going to do is set is mounted to True okay so this way only when the component is mounted will we show the show the sidebar I know this is this might cause some problems this might uh look a little weird when it loads because we are waiting for the component to load on the client side but I don't think this is going to cause any problems okay let's let's see how it goes anyway so in here now we want to return the sheet so let's go ahead and import uh sheet component from from the UI components in UI library and then we want to say modal equal false and then we're going to use the spread operator for the open state in here okay and inside the sheet component go ahead and say sheet trigger okay and the sheet trigger is going to say as child and it's going to have a class name of absolute absolute it's going to have left das4 and then we're going to have top-4 and Z of 100 okay and then we're going to say from medium devices make this hidden and say Flex now I want to quickly also show you what this is going to look like all right so if we go back let me just go back to home real quick and let's go back into our dashboard so if you look at the structure of our page we're have we are going to have a sidebar okay and this sidebar of course has this cool animation when it loads that's why I'm using the sheet component and um the other thing is you notice the sidebar has this really cool effect where it is under the other page it's under our dashboard so if you go into team maybe we can see clear there you go you see that really cool effect it's I don't know it just looked amazing and I thought it'll be great so um this is why uh we need to create all this this stuff okay we're basically hiding it underne all right and um so that means our structure is going to be sidebar we're going to have this info bar up top and we're going to have this component in here which is um the main uh page and it's going to be wrapped in something called a blur page and I'll get to that in a second but I just want to give you guys an idea so you understand what you're building okay awesome and um one more thing if we go back into our layout let's go back in there okay we have this uh inside the agency okay so in here go ahead and return children that's why you're not seeing anything render okay and now if we go back there you go now you see it so let's go back into our sidebar menu options and let's continue so inside this trigger go ahead and create a button okay with a class name actually no class name just say variant equal to outline like this and the size is equal to Icon and this is a New Edition which I think is amazing so in here now we're going to pass in the menu and this menu comes from um the react Lucid react icons okay and after the trigger go ahead and say sheet content and the sheet content is going to have the following so first we need to make some changes to the component itself so come up here go into that uh sheet component so you can hold command actually and click on it it'll take you into the component and in here we're going to create an interface okay interface we're going to say custom sheet uh content props okay like this and uh what we're going to do is we're going to create something called show X which is of a type of Boolean Boolean like this and now we're going to copy this and go in here and just hit enter and paste it okay put a comma after this so uh we're basically creating our own version of this and in here we're going to extract that show X property and let's wrap this in show X and and then we want to show this so for some reason shads and UI does not give you the ability to actually customize the X icon that shows up so we're going to make that uh we're going to put that in for ourselves okay and now we want to go in here and you're going to see something called Focus uh out focus ring and stuff like that just remove all of that and just from just keep this and after disabled okay you're going to see that I'm not going to see it but uh if you do just remove that anyway and even if you don't that's fine you can keep it as is I just wanted it to look a little nicer so let's remove this now and let's go back into our component and we need to pass in the following props so we're going to also one more thing sorry we want this to be optional this does not have to yeah it's not required okay so now in here we're going to say U sheet content show x equal to um the opposite of default open like this okay and in here we want to say side equal left and then we want to give it a class name so the class name is going to be clsx import that we're going to say bg-- background / 80 and then we want to say backdrop of blur LG actually let's use XL and then fixed top top of zero um and then we want to say border right of um one pixel like this okay and after that just say padding six great job and after this in here as the second parameter passing an object and you want to say something here and just passing true for now we'll fix that in just a second so say hidden from medium devices we want it to be inline Das block like this and then we want Z to be zero and width to be 300 pixels 100 pixels just like this and now this value here is going to say default open and let's uh go ahead and hit enter after this and we're going to create one more so I'm just going to say true for this again and we'll fix that so in here pass an inline block okay and then we want to say for medium devices hidden and then Z should be 1 100 and width is going to be full like this and now you can change this to the opposite of default open okay awesome follow through with me guys you're going to get it and this is going to be an amazing project for you to put on your resume okay so uh go ahead and create a div here and inside this div we're going to use the aspect ratio and this is going to have the ratio set to uh ratio set to 16 / 5 also when you're importing please make sure you're importing from the UI Library not from uh radic UI okay by default it's going to show you radic UI so make sure you do that so let's create an image component with the SRC set to the sidebar logo we need the alt tag to be um sidebar logo like this and let's say Phill and then the class name is going to be be rounded DMD rounded DMD and then we're going to say objects Das contain okay inside this so object Dash contain just like this nice and after the aspect ratio we're going to create a popover component and inside the popover component create the popover trigger and the popover trigger is going to be a button and this button is going to have a class name of width of full margin y of four Flex Flex item Center and justify between and we want to say padding y of 8 okay and now we're not going to see this actually so what we're going to do is let's go up here and just set this to True um default sheet content okay yeah let's go up here and just set the open state to True okay let me hide this open open equal to True we'll change this in a second we just want to see what we're building okay nice and now let's go back in here to this and we want to change this to a variant of um ghost so that it's empty nice and inside this button go ahead and create the following so you want to say div class name of flex items Center text left and gap of two and inside the div create the compass which comes from Lucid react icons just import that and then create a div here to show all the names and titles and stuff like that so class name is going to be flex flex-all and then we want to pass in details. name and after the details. name create a span and the span is going to have a class name of Tex text- muted D foreground and inside this you want to say details do um address sorry yeah detail. address okay let's see what that looks like okay looks good so I made a small error here so this is flex like this and that should go to the next line awesome cool great job and after the address so 1 2 after the second div hit enter create another div and say Chevron up down okay this is the icon we need and you want to say size equals 16 like this and then let's also give it a class name of text- muted D foreground so it just has this and I think we did something wrong with The Styling let me take a look at this give me one second okay so on this trigger first let's say as child okay that fixed it right so just say as child on the popover trigger and that will fix that problem all right and now after this trigger right here go ahead and create a popover content and give it a class name of width of 80 height of 80 margin top of four and Z of 200 okay and inside the component go ahead and say this with the command component which comes from the uui components again and then class rounded dlg not large You Want U LG um and then inside the command you want a command input like this and the command input is going to have a placeholder of search accounts dot dot dot and in after the input I'm going to close this tag actually okay we're going to say command list list and this command list is going to say um it's going to have a class name of padding bottom of 16 and inside the command list we're going to have a command empty component and the empty is going to something wrong here okay let me remove this and the empty component is simply going to say no results found like this okay no results found and after this after the empty component go ahead and say the following okay please type it out the way I'm typing so create this bracket and say user. roll equal to agency owner or user. roll equal to agency admin okay so after this bracket type and the user. agency C exist then we want to return some elements here so I'm just going to say div for now and save this to make sure okay nice so change this div now to command group okay and this command group is going to have a heading of accounts or actually I'm going to change this to agency okay and inside this we're going to create a command item and the command item is going to have a a key set to the um user. agency. ID and the command item will also have a class name um actually we don't even need a key here so I'm just going to remove this key y we don't need a key there guys we're not mapping over anything so we don't even need this I'm just going to remove that okay and a command item is going to have a class name of important BG ja- transparent margin y of 2 text- primary not pretty text- primary border D1 pixel so just say one pixel like this and then border Das border border Das border and then we want padding of two rounded DMD hover should be BG D muted and then cursor pointer and transition all okay and inside the command item we're basically going to show uh the links so we're going to say if default open is true okay like this so we're showing different versions for mobile and for the desktop devices so if this is true we're going to return a link which is going to have the href set to backtick slash agen agency slash um dollar sign user user. agency. ID and we're also going to pass in a class name so say class name equal Flex Gap D4 width D full and height Das full okay just like this and inside the link go ahead and say div with a class name of relative and with- 16 okay and in here go ahead and create an image tag and say SRC equal to user. agency. agency logo so agency logo like this and we want also want to pass in the all tag and we're just going to say agency logo and after this we're going to say fill class name class name set to rounded DMD and we need to Al pass an object contain okay great job and after this image so if you don't know what this is is it's basically um we're showing all the accounts okay it just looks like this so this stuff right in here so now you can see we're almost getting there so now after this this image tag right here create a div and give it a class name of flex flex-all Flex D column and flex D1 okay and in here say user. agency. name like this and again create a span with a class name of text- muted D foreground and you want to put the user. agency. address okay so if you click this now um you're supposed to see that let's just give that a second oh this is if default open is true so since default open is false right now we're not going to see that okay so what we're going to do after this is in here let's go ahead and copy this first of all copy this link and in here we're going to return a sheet close Okay and inside the sheet close first pass as child in here and inside the sheet close go ahead and paste what we just copied okay and we need to change a couple things so let me make sure this is the same relative with 16 nice agency logo okay this looks good so I see it here and this looks great I think this y they look the same all right awesome and we can also give it bold I think Boldt comes only if you click on it right yeah not sure anyway okay so after the command group go ahead and hit enter and create another command group and we're going to call this one accounts okay like this accounts and inside this we're going to say if sub accounts like this and we're this is basically converting it into a Boolean all right a strict Boolean question mark if this exists we'll do something if not we'll do something else okay and in here we want to say if sub accounts. map we're going to get access to the sub accounts and in here we're going to return um if default open is true question mark we'll return something if not we'll return something else and here we're going to basically return a command item okay a command item like this and this command item will have a key set to subac account. ID and um what we can do guys is we can actually just copy the sheet close here okay sheet close um or here yeah we can copy this default open open all the way to the sheet close Okay command item yeah I think this should be good so what we will do here is let's go ahead and remove this default open let's return this command either way okay and inside this we'll return this default open link and then we'll show something okay so in here you want at the bottom you want to say no accounts found okay or just no accounts and this here is now going to change to sub accounts and this will this one all the stuff so just select Everything Will Change to sub account okay name and this one specifically will change to a uh sub account ID sub account logo sorry and up here as well this will change to sub logo and let's refresh that and we're not going to see anything right now of course so we should see um this just just like this is just going to say accounts awesome okay great job and now we also need to create the ability to create the um account right we have to have that ability so let me go ahead and build that out okay one more things one more thing guys we have to change this also to sub account sorry I missed that out so sub account account yes and everything else should be good I think yeah you can change this to sub account logo all right and after this you want to go to the bottom of the command list and you want to say the following so you want to say user. roll equal to equal to agency or user. roll equal to agency admin so wrap that in a bracket then you want to say and turn a button with a plus icon let's refresh the page and that should render okay awesome so this will basically show a create button now when we click on this create button we should actually show a modal on the screen so if you see this example when you click on this create button it shows a modal and you can create an account now a lot of people use a library like zustan to M maintain the states we're not going to do that guys we're going to build a library like that from scratch so that we can maintain modal data across our entire application how amazing is that right so what you're going to do is you're going to go into your providers and create a modal provider file okay go ahead and create a modal provider file and this is going to have that new thing that we're going to create okay so create an interface called modal provider props pass in children which is react. react node and make sure you put use client up top and then you want to create a modal data so anytime you want to create a modal and have data prepopulated inside it you have to come in here and you have to create a type so let's to say we were creating a contact so we'd say contact which is optional and import contact from Prisma client if you're creating a ticket then you would put ticket in here and so on so forth that's just how it goes okay for now just need the user I'm just going to only put user in here and uh we'll also create the other stuff like sub let's say Agency for now we might need agency right so we're going to say agency which comes from Prisma client like this and maybe sub account this is okay for now we'll get back to that if we need to okay and then you want to create a type called modal context type which is equal to data which will have modal data the modal data we just created up top here and then we're going to have is open like this and this is going to be a Boolean and then we're going to have set open and this is going to be a function and this function is going to return void so nothing in here but this is going to have the modal which is a react. react node and it's also going to have a fetch data function which is optional okay okay and this is going to be a function that returns a promise of any just like this and after this we're also going to have a set close that we can also close it and we're this is going to just return void awesome and then export const modal context equal to create context from react and this is going to take our modal context type that we just created up here and you're going to invoke and pass in an object and you're going to say data is an empty object this is just default stuff and is open is set defaults and and then you want to pass in the set open is set to an empty function that has the modal which is a react. react node okay we'll just do this here and for this we're going to say fetch data is going to be a function here that is optional and this is going to return promise any like this okay and after this we also need a set close function which is going to be just a function that returns this okay awesome and then sorry guys this is not return this is just an empty Arrow function okay sorry about that and then we're going to create the modal provider so the provider is equal to react. FC okay and we're going to pass in the modal provider props which is equal to this function right here okay and I think we made some errors here this is this and this is going to be equal to this sorry about that and in here let's destructure the children like this and inside this we're going to return null for now and and what we're going to do in here is we're first going to create a const state called you can also use the snippet guy so you can say is open and here Chang this to is open set this default by default and then import use state from react and then say you state snippet again and this one is called data and set data and the data is going to be an empty object set to modal data like this and then we want another one so UST State Snippets this one is showing modal okay so set showing modal and set this to null and this is going to have react. react node and after this finally we need the is mounted because models create a lot of hydration errors so we have to say is mounted like this and set this to false okay and this is the same thing we did in the other component the sheet component if you guys remember so use effect pass in an empty dependency array for now and inside this we're basically going to set is mounted to true just like this and after this go ahead and say const set open equal to an async function which is going to take in a model which is react. react node node like that and it's also going to take in a Fed data function which is optional and this is just going to be function that returns promise of any and in here we're going to say if modal exist we're going to check if F data exist then we're going to set data to be this object with everything inside data but then we're going to invoke this like this and we're going to say everything inside a weit fetch data like this okay invoke that and after this you can pass in or an empty object just like this okay and after this we want to set showing modal to be the modal that was provided and then set is open to be true like this and now after this part down here we're going to say const set close which is another function and all this does is it sets is open to false and it also sets the data to back to an empty object okay and now we need to check if not is mounted we're going to go ahead and return null just like this and if not we're going to return the modal context. provider just like this and we're going to pass in values which is an object with the data with set open set close and is open like this and inside the provider we're going to pass in the children as well as the showing models the model that we want to show that's literally it okay and finally to use this now we need to create a hook you can create another hook folder and you can put it in there I'm just going to put it in here okay so we're going to say export const use model equal to an empty function like this and then const context equal to use context invoke that let me make sure I imported from use context okay uh import it and pass in the modal context and if there is no context we want to throw new error saying use model must be used within the provider okay and after this we're going to return the context awesome and finally export default the modal provider there you go guys now you need to go to your your layout file so go into your root Source app go into layout file in here okay and and uh right inside this wrap everything in the modal provider so put the children component inside like that and that's basically it that will wrap everything okay and we're also going to need toaster so I'm going to import toaster from UI toaster like this because we're going to need this and let's also bring in sonar I don't know if we're going to use this but if I just want to try it out and see it's uh new guys it's it's new in chat Cen okay if we need it we'll come to that okay so yeah now we have this so now we can go back into our component that we were using let me close this right in here and now we can actually open that model okay so let's do a quick test here so if this one has on click then we can actually do that so we need to pass in that onclick and inside here we're going to basically say set open oh we have to import it so go up all the way up top uh right above all of this and say const something equal use modal and invoke that like this let's bring this down okay and in here we're going to get set open and I think that's pretty much about it we'll only need this for now and let's go down to the button and now we need to say set open invoke that and we're going to pass in a custom model okay now this component comes from the Global's folder so go into Global create a file call it custom model. TSX okay and let's just return this and in here also I'm going to let me just change this to custom model like that and we're going to add some props so we need the title which is going to be a string we need subheading so I'm going to say subheading like this which is also going to be a string and then we're going to need a couple more so children which is going to be react. react node we're going to need default open which is going to be Boolean and now we can destructure that stuff from here okay and now in here we need to get access to the use modal hook so we're going to say use clients up top let's come in here now and after this we're going to say const is open equal to use model invoke that and we're also going to need the set close in here and let's change this to the dialogue component from UI dialogue like this and we're going to say open is equal to is open or default open okay and then onop change is going to be equal to set close and in here we're going to pass in the dialogue content which comes from UI dialogue like this and this is going to have a class name so I'm going to quickly put that in here class name of overflow scroll from medium devices Max height is going to be 700 pixels okay and then for medium devices height is going to be fit like this and height is going to be screen on mobile and background is going to be card and inside the content let's use a dialogue header like this and inside the header we're going to have a dialogue title and the title of so first let me give this some styling so for the header we're going to have padding top of 8 text- left and the dialogue title is going to have a class name of text- toxel font D bold I'm just going to change this font DB and inside the title we're going to pass in the title and after title we need dialogue description like this and let's pass in the subhe header subheading sorry not subheader so subheading and after the description component after this we need to also pass in the children and that's it for this custom Modo component so let's go back in here now and we're going to say custom model okay and we're going to pass in the title and this title is going to say create a sub account and it's going to have a subheading and the subheading is going to be you can switch between sub account just put some information here okay your agency account and the sub account from the sidebar okay just like this and we can we also need a couple more things I think in here let's see okay we need to pass in the children component so now we're going to pass in another component called sub Account Details which is basically a copy of the agency details okay so what I'm going to do is the reason why I created a separate component is if we ever needed to make some changes to sub accounts then it's going to cause a big problem so go into forms okay and inside the forms you're going to create another file file called um subac account details. TSX and I'm just going to return this or actually I'm going to copy everything in agency details like this let's get out of this and in the sub account I'm going to paste it and we're going to change a bunch of things okay so let's go up top so we need to change some stuff let me see what we need to change okay so the the sub Account Details is basically almost exactly the same as the agent details there's just a couple things that are changing for example we are not creating a new user okay um we are also changing the API request like we're not deleting the agency right we're going to be able to delete only sub accounts from here and so that's the only thing that's changing so here's what I'm going to tell you to do go to the GitHub okay save yourself like 1 hour okay go to this go to Source go to the components go to forms and you're going to find the sub account uh details right in here copy this and we're going to see I'm going to also explain any differences that are in here okay some uh server actions might be different and we're going to build that as well so let's go in here let's copy this and I'm going to shrink this real quick and let's go ahead remove everything and just paste it okay and let's see what else we need to build so okay we have file upload which comes from Global file upload um what do we have instead I think we have a different component let me see file upload okay so I think we can just say something like this right and upsert sub account this is is a new query so let's go ahead and build this upsurt sub account uh query okay so go into your queries which is in here and let's bring that out and let's say export const this equal to an async function and this one needs a couple uh props okay so this one needs the sub account okay like this so I'm going to say sub account is going to be of type sub account from Prisma client and in here we're going to say if there is no sub account. company email then we're going to return null and const agency owner is equal to await db. user. find first where agency has an ID equal to sub. agency ID and we can hit enter here so we can see clearly all right and also the role is agency owner so we need the agency owner for this agency um and then after this at the bottom we're going to say if there is no agency owner we're going to actually throw an error or you can just uh yeah let's just return console.log error and let's put a nice Emoji here so I like to put the red emoji and just say error with the error message oh actually there's no error message so yeah let's just say this okay and then we need to basically say const permission ID equal to V4 and you can also use cryptography Library whatever but we're just going to use V4 cons response equal to awaits db. subac accounts. upsert invoke this and we're going to pass in where the ID is of type sub account. ID and we're going to update the sub or we're going to create the sub account and you want to say everything inside sub account but you want to set the permissions to something else so we're going to create a new permission with access to True email is going to be set to the agency owner. email okay and the ID is going to be set to permission ID and after that we also need the connect so we're going to create this and we're also going to connect it to the sub ID where the sub ID is like this sub accounts. ID and then we need the ID to be the permissions ID so we're just connecting this permission together okay and after connect pipeline we're going to create a pipeline we're just creating default data for them okay and this is going to be an object with name with name equal to lead cycle something like this and we're also going to create the side our options so go in here let's see if we can get to that function uh which is in here so click on that and you can go into the queries file okay it's going to take you to that and this is default data okay these are the sidebar options that we're going to use for the sub account so copy this array okay I'm just going to copy the whole sidebar options so copy sidebar options and just paste that in here so we're just creating some default sidebar options to show very similar to the agency okay awesome I hope this is not not too confusing right it's the same repetitive stuff guys and let's go back in here so now let's just quickly look at the sub account stuff that we just built and let's see what it is okay and you also have two challenges uh one is the sub account guest so how do you do this and this is fine if you guys don't want to um it's not a requirement for the project okay but here's one challenge basically the layout. TSX right now will only render once okay I explained that before so when the page rerenders it's only going to uh render once okay and that means if you remove permissions for someone it's not going to um show new updated data so how would you do that do some research and see how we can figure that out okay and so what we're going to do in here is it's the same thing okay we have the same form schema there's nothing different here and uh we're just using the sub account logo instead of agency logo okay and then we're going you guys can also copy paste this all right copy paste it and follow along with me if you haven't pause this right now pause it copy and paste it and then continue okay and here we're going to create an onsubmit function which has that that form schema and we're going to create a upsurt sub account query okay we're going to wait for their response we're going to pass in this data okay which is data details. ID uh V4 address is going to be value. address the sub account is going to be this the city is going to be this same thing okay everything is literally the same now here's one thing I want to point out differently and I wish I change this I didn't actually change it somewhere else so the details here comes from partial sub account account so instead of this we can actually let me think real quick why did we actually do it this way because we're going to use this component not as a modal but as a form field okay so if you look in here I'm going to show you what that looks like if you go into settings we're actually going to embed that form right in here like this okay so that's why we're not using that modal provider and and after the onsubmit so we have something here what's wrong here response. agency ID I don't think we returned anything here did we go all the way to the bottom and let's return this okay so now this function would have some return value okay and sub is response sub ID is response. ID all right sorry about that we just need to change some names there and yeah we're just using the toast we're closing uh and now we're closing the modal okay so if a modal was used we're basically closing that modal if you were creating the sub accounts and then we're resetting the form data here we have a loading State there's nothing different it's the same exact thing okay copy past this you guys are going to be happy and we're also returning that loading component that we created nice good stuff guys so now let's go ahead and just see what this looks like so when we create a sub account like this if we click this it shows a model okay but now we need to pass in that components okay so let's close this we're passing the custom model so let's go ahead and pass in the details which is the uh sub details I think right right here sub details form and um we also need to pass in some data into that so just give me one second guys let me uh see what we need to pass in okay so let's go ahead and say agency details is equal to agency details like this or we can just uh pass in h let me think what can we pass in here okay we can just say user. agency yeah I think this should be good as agency like this right what does this need okay as agency and we also need the user ID which is going to be user. ID and we can pass this as string okay and then finally we need one more which is the username which is also going to be user.name all right it's not causing any issues yeah so now when we create let's see what happens happens custom model is throwing an error default open prop is missing okay this default open is optional forgot about that sorry about that yeah and now if we create this okay so it went behind this that's probably something we need to actually fix uh let me go up here first and let's turn off this open so remove this undo this so now we can actually control that state so yeah here it's going to work but on the mobile device it's not working because we have to close this so we need to set is open to something else okay let me think how we can do that I think we would have to wrap this component yeah we would have to wrap this in the sheet close let's see so I'm going to say sheet close put this button into this okay let's give that 400 milliseconds let's click on this and if you hit this all right there we go awesome okay so now it's showing the sub account and you can go ahead and create a sub account how awesome is that check this out right okay let me see if it closes for okay it's not closing for okay great it's not closing for the desktop I didn't want that to happen that would be bad yep all right nice yeah so you see the power of this new custom model Creator right it looks amazing and we can use it for any component you just have to pass in a new form every single time and that's how we can build uh different forms for each item okay awesome all right now after this popover right here go ahead and create a paragraph tag and give it the following class names which is text - muted D foreground text- Xs and margin bottom of two so we're going to say menu links after this paragraph just go ahead and use the separator and you can give that a class name of margin bottom of four and after this you want to use the nav tag okay give it the class name of relative and inside this we're going to use the command component and in uh inside this give it a class name of rounded let's give it large and then overflow hidden or actually overflow visible okay and then you want to give it a background of transparent and inside this command we're going to create a command input and give it a placeholder of search and this is basically for all the navigation components okay after this go ahead and create a command list give it a class name of padding bottom of 16 overflow of visible and inside this we want to create the command empty and and uh the command empty is going to have so we're just going to say no results found and then command group give it a class name of overflow visible inside this command group we're going to have our sidebar option so sidebar options. map okay we're going to get the sidebar option like this just to return null for now okay and before this we're going to say let a value const result equal to icons doind and this icons you have to import it from our from our constants filefind where for that specific icon we want to say where the icon. value is equal to sidebar options.on okay and once we find the result we're going to say if result value is equal to the result. path now in here right after this we're going to return something so we're going to return a command item and the command item is going to have a link component and now let's set the props for these components so for the command item go ahead and say key equal to sidebar options. ID and the class name is for medium devices we want the width to be 320 pixels and then we want width to be full and then for the link we're going to say href is equal to sidebar option uh where why is it not showing up okay it's because we said sidebar options when in reality this is a sidebar option but that's okay sidebar options. link the class name is going to be Flex item Center Gap -2 hover BG D transparent and after that we want to say rounded DMD transition all MD with- full so from medium devices and then width is supposed to be by default 320 pixels and inside the link we're going to put the value and we're going to to create sorry we're going to put value like this and we're going to create a span with the sidebar option so we'll say sidebar options. name okay awesome there you go and I see something wrong with the background color so go into the command item area selected is BG accent we're going to change that to primary and let's refresh this and see what it shows okay so much better and on the large device okay it goes underneath perfect it is text- accent D foreground we're going to change that to text- White okay and we're going to set one more so for area selected we're going to say font bold okay so let's close this and there you go now you can see looks really cool and also the search looks a little weird so let me see if we can fix that as well so what we'll do is let's go into the input and see if we can change this input item as well okay okay so right here guys where we have this div is the wrapper for everything what we're going to do is after this we're going to say dark uh BG Das muted okay so now it should there we go and let's also give it a rounded of MD let's see all right that looks good it looks like it has some extra padding but that's fine you guys can do whatever adjustments you like to make it look exactly like what you want okay let's give this some padding as well so I'm going to go back in there where our list starts we're going to just set the padding y for should be just perfect or two all right this looks good right awesome so now you can actually search for items you can search for Launchpad so let's say in the future if you gave the user the ability to create sidebar options for their sub accounts like let's say they wanted to show some custom Pages or something they can actually do this all right and you can make this insanely powerful for example let's say if youate created a funnel you can take the the hosted page and you can host that page inside an iframe right that would be insanely powerful because now the user can literally create whatever they want for their sidebar items how awesome is that right all right awesome guys so let's go ahead and move on to creating the info bar and our blur page all right so go ahead and open your directory you want to go into our layout page which is inside main agency agency ID and the layout page that we were using and this layout page in here is going to have the info bar which we'll get to in a second and after the info bar it's going to have another div and this is going to have a class name set to relative let's take these children items and we're going to create this blur page component and inside this we're going to pass in the children items okay and now you want to open up the global components so go into Global and we're going to create a blur dpage dtsx and we're going to say typescripts rafc blur page like this and this blur page is going to get access to the children which is react. react node and we're just going to extract the children prop from here and we're going to return that in here okay and let's go back and import the blur page that we just created let's go back into this and now you should see all the children all right awesome so you see even the padding everything is created so now we just have to create that blur page so in here just give it a class just follow through with me okay so let's go into Source into components let's go into Global and we're going to find that blur page so go ahead and copy this entire class name till the end and let's paste that class name for this div right here awesome that's it and if you want to know how that works it's because this component here is absolute okay and we made top right and left zero um and we brought it in front Okay and the wrapper inside the layout pushes this component by 300 something pixels so that's how it doesn't get you know blocked it doesn't get hidden under this okay awesome now that's about it for the blur page let's go back to that component and now we have to also provide the other one which is the info bar so Above This relative we're going to create the info bar like this it's a component and it's going to take the notifications and that should be equal to all notifications that we just created so copy the info bar go into your Global's file and you want to create the infobar ttsx and in here just use a typescript rafc and change this to info bar just like this this is going to take the all notifications the not notification that we created is equal to an array so this is actually either an array aray or notification with user go ahead copy this go into your types file inside Libs and we're going to say export type notification with user so let's go into this go into Libs go into types and let's search for that component right here I'm sorry that type so copy this type and paste that in here import the RO from Prisma clients we have to import this too from Prisma clients go back to the component and let's just import it from our types and now the role here is going to be optional we're just going to pass in a string like this and then we need the class name which is going to be optional which is a string as well and then finally we're going to need uh one more which is the sub account ID which is going to be a string and go ahead and just bring this just import all these in here first thing we're going to do is we're going to say const all notifications and set all notifications equal to use State and pass in the notifications we just got in and let's import this use State and change the component to use client okay nice and after this we're going to say const show all and set show all equal to U State again with false as a default value um or we can say true because we want to show it by default here we're going to return a react fragment okay and we're going to say div with a class name Tailwind merge invoke that and we're going to pass in fixed or this is a really really long class so um let's go to the source components Global and then let's go into um maybe I created somewhere else I probably created it outside this okay yeah don't worry guys this will be in sync with our project okay this is going to be slightly different okay so yeah you see this is a pretty long class so just go in here and copy this Tailwind merge thing here and just replace it okay save yourself some time after this we're going to create another div in here and give it the following class name so Flex item Center Gap D2 and margin left of Auto Gap -2 all right and inside this we want to pass the user button which comes from Clerk and that is going to have an after signout URL which is going to be equal to slash like this and after this we want to have a sheet component from UI sheet which um will have a sheet trigger this is for the notifications by the way if you're curious um and inside this sheet trigger pass in a div and give this a class name rounded Das full width d8 and height -8 BG D primary Flex items D Center justify D Center and then text D white and inside this div we're going to use a Bell icon so the Bell icon comes from Lucid react and they have so many here so the Bell from yeah this one okay pass in the size and set it to 17 all right let's go back and try to import that info bar so go in here and let's import info bar like this and now the info bar might ask for some props but some of the stuff here are actually optional so roll is optional sub account ID is also optional so when you click this it has to show the notifications right so go down here after the she sheet trigger and we need to pass in the sheet content so we're going to say sheet content from UI sheet with a class name of margin top four margin right of four PR of for flex and flex-all okay so let's say sheet header and give this a class name of text- left and let's have the sheet title and say notifications okay notifications and then we want to have the sheet description like this and this description will have um a quick check in here so we're going to say if rule equal to agencycore admin let's let's use a different thing in here so we're going to say roll from from Prisma client so we get some typescript so agency admin so if it's equal to the agency admin or role equal to agency owner then we're going to say and and we're going to return a card component from UI card okay cool and give this a class name of flex items Center justify between and padding of four okay nice and now we want to pass in the some text in here so we're just going to to say current sub account and then we're going to have a switch here which comes from UI switch and we're going to pass in on check change handle click which we can just create up top so const okay this is equal to a function up here and let's quickly go and just build out the logic for this function too so this function is going to say if not show if um the opposite of show all is true true then we want to set all notifications to Notifications else we want to see if notifications. length is not equal to zero and if this is true then we're going to say set all notifications to be notifications. filter where the item has item. sub account ID is equal to the sub accounts ID and then at the end you can do this and just put this array in here here okay nice and after all of this after this we're going to say set show all to something like this an arrow function and the previous value with the opposite of previous value like this okay good so now when we click here it shows something and let's scroll to the bottom here let's refresh this page actually okay so we said this this should actually show us the card component why do I not see it let me see all right so the reason why this this is happening is if there are no notifications right then we are returning that so that's the problem and in here just to make sure we are we are returning the response but we are not getting any notifications right because there's none so we have to show some message in there so that's the reason why I think U so let's go back in here and what we're going to do is yeah we can pass this in here okay so let's go into the component and let's quick show all the notifications in here okay so scroll down right after the sheet header you want to say all notifications map invoke that and we're going to get the notification okay like this and once we get this we are going to say div and this div is going to have the key set to notification. ID and we're going to pass in a class name of flex flex-all and then Gap Dy y-2 margin bottom of two overflow-x overflow dx- scroll text- ellipse like this inside this we're going to have a div with a class name set to flex g-2 and we're going to pass in the Avatar component from UI Avatar with the Avatar uh image set to Source SRC set to the notifications do user do Avatar URL and then we need to also to pass in the alt tag we're just going to say profile picture and after this Avatar image I'm just going to close this tag Avatar fallback like this with a class name set to BG primary okay and then inside this we're going to have notification. user.name do slice so we're only going to get the first two letters 0 to 2.2 uppercase and just invoke that so so we're not going to see anything right here of course after the after this Avatar go ahead create a div with a class name of flex flex-all and inside this AP tag you can pass in a span give it a class name of font Das bold the first one is going to have notification. notification dosit at that pipe that we created so split at the pipe but we're going to take the first section okay and just duplicate this three times and in here this one is going to have text- muted D foreground and this one is going to be the first one and then this one can be text- XS um actually this one can just be font bold it's fine and we're going to take take the second element and after the span after this P tag create a small tag here and say class name text- EXs uh text- muted D foreground we want to say notification. created at and we're we're going to pass this into new date so new date like this okay new date okay and then we're going to say dot to local date string just invoke this it's fine you guys can do any for some cool formatting just use chat GPT and get some cool formatting and you can put it in there okay and then after this we're going to say all notifications. length equal to Z and we're going to return something so we're just going to say div Flex items Center justify Center and margin bottom of four and inside this we're going to go ahead and say you have no notifications now if you click this you're going to see you have no notifications and let's also make this uh text- muted D foreground so let's go back to our components okay let's shrink this not letting me shrink okay so our Navar works you can close that you can also search through here and let's go back into our agency ID layout. TSX and just make sure everything looks good in here yeah I think everything is good all right great job guys so now we're going to move on to creating each and every page uh to show all the all the cool data and things like that all right now here's your next challenge okay so go ahead and open your directory shrink everything so it's easier go into Source into app into main into agency and for each agency so that means inside the agency ID you are going to create new pths so what is the requirement of of this challenge right now as you can see we can access the agency for a specific agency ID but what I also want to access is the settings page for example or I want to access a team page like this so you need to basically create directories which will render out a component in here if it was like this in the Navar go ahead and give this a shot okay this is how you get better by simply guessing and failing and trying okay so pause this video give this a shot if you don't know how to do it don't worry about it I'm going to show you in just 2 seconds go ahead and give this a shot all right awesome so the first page we will be building is the settings page and before that I want to make a quick change to our info bar so go into our info bar which is inside the global components folder and we need to add one more icon here so first I'm going to change this to width and height nine so they're equal to the same height and width okay that looks like L better and now after this Bell icon we need to add something in here okay so after user buttons I'm just going to shrink this sheet after this I'm going to use the mode toggle uh button in here so then that way I can also change the the toggle the the theme okay directly inside and yes of course this is completely compatible for all uh dark mode and light mode devices okay um awesome so yeah now that we made that change let's go back to the settings page which is in here page. TSX and now we're just going to build this out so for this we're going to need two things first is the agency details or the sub account details and then we need to also show the user details so the user can change their user information and the user details is literally the same thing guys okay there's only one thing that is different which is the most crucial thing and I will get to that which is the U the permissions for each user okay and I'll show you how to do all that kind of stuff anyway so what we want to do in here first is we're going to get access to the params which is um going to have going to consist of the agency ID okay which is going to be a string so let's go in here and extract params and um I I think yeah I think that's all we need for now so we're going to say cons o user equal to await current user which comes from Clerk and if there's no o user we're just going to return okay we'll return all it's fine and um this needs to be an a Asing component so let's change that and then we're going to say const user details equal to await db. user this is the power of server side components you can actually make API calls directly in the component okay so user. find unique okay where email is of type Au user. email addresses at0 doil address if there's no user details oops We spelled this wrong that's why if there's no user details we're just going to return uh null again and after this if this exists we're going to see we're going to say agency details equal to await db. agency. find unique unique like that where ID is going to be pam. agency ID and we also want to include all the sub accounts in here so we're going to say sub account true awesome and then we're going to go to the bottom here and we're going to say if there is no agency detail then we're just going to return null and then finally we're going to say const sub accounts equal to agency details we're just extracting it from there okay you can just you can destructure directly here if you'd like but um if this is null it's going to cause a problem so that's why I'm doing it like this after this we need to return that component so go in here and for this div pass in a class name say Flex from large devices we're going to make this important and say Flex D row and we're going to say Flex D column on mobile devices and then we're going to say Gap -4 and now in here we're going to pass in the agency details that we created and we need to pass in the following uh stuff which is data is going to be equal to agency details and then we need to also create a new form called user details okay and we're going to get to this in just a second so let's just pass in um the stuff in here we're just going to say type equal agency and then ID equal ps. agency ID so we're going to this is going to work for both sub accounts and the agency that's why we need this that's why we're passing it in here okay and then we're going to say sub accounts are going to be equal to sub accounts and then user data is going to be equal to user details so let's go ahead and copy this component and let's go into our forms and let's create user- deteta TSX and in here just return a component and let's change this to user user details and let's go back and just quickly import this component now let's go into this component again and in here we're going to pass in the ID which is going to be a type of string or null we need to pass in the type which is going to be of type either agency or it's going to be of type sub account like this and then we need the user data which is going to be optional which is going to be partial of user which comes from Prisma clients okay not Clerk and then the sub accounts which is also optional which is going to be of type sub account from Prisma client and it's going to be an array and here we can go ahead and just destructure all this stuff so first we need the sub account permissions okay and then set sub permissions let's come in here permissions like this equal to use State let's import that and we're going to say this is going to be a special type which we're going to get to in just a second we're just going to pass in null for now and then um this one right here we're going to let's go ahead and actually create that type so it's going to be user with permissions and sub accounts it's a little long but um it's okay so let's go to the same folder structure in the GitHub repository and let's click on this user uh with permission stuff and let's go into that types and let's go ahead and copy this and let's go into our types folder which is inside Libs types like this and let's go ahead and Export actually we already copied that yeah and now this is actually a function it's a server action let's go ahead and get that server action so click on that go to the queries and let's also understand before we copy paste like it's very simple nothing crazy okay go into queries at the bottom of this go ahead and um just paste that okay so what is this we're going to get the user permission with a specific user ID literally nothing but going to the database going into user finding unique where the ID is like this and we're going to get the permissions so we're going to select permissions and we're going to include the sub accounts so all the sub accounts that the user has permissions to access okay and now inside the types go ahead and import it and let's go back into our component as well and you're going to see that error here so we can import that um that permission uh type okay and then we want to set or null so two different types here easy right not too complex now we also need this which is coming from use model so we're going to import this and we're going to get access to data and set close so this is an example of how we can use that that data stuff that we just created from our custom provider right which is really really helpful so const roll state so we're we're just going to create some stuff in here too which is roll State and set roll state is equal to use State invoke this and we're just going to pass it nothing for now and then we need the cons loading so I'm going to use a snippet here and just say loading permissions okay like this and set this to set loading permissions and this is going to be false and then finally at the bottom here we're going to say const toast equal use toast from UI use toast and just invoke that and then we also need router Router equal use router which comes from next navigation all right first thing we're going to do is we're going to get the Au user details in here okay um so we're going to get the information also one more state so let's go ahead and create the state const Au user data and set Au user data equal to use State invoke that and we're going to pass in a new custom typee in here okay and we can copy that in just a second so just say null right now go back to that exact file and we're going to copy this type here it's a really long name I rather prefer a long name than name that has no information okay and can put that in here or say R null and let's go into click on this it's going to show you this go to the types which has that type in there and let's copy this entire thing let's go to the type I'm just going to click this to get a shortcut and I'm going to scroll to the bottom and just paste that in here okay and now this is get off user details which we already created so I'm just going to import that right here so now this will actually get all the types and it will do it automatically so this is really really helpful here so let's go back and quickly import that and now let me close this and let's go back to our component okay now that we have this we can now go ahead and get the Au user details so say use effect invoke it pass it an empty dependency for now actually let's pass in the data that we get in um from from the model and in here we're going to say if data. user we're going to say const fetch details equal to async so it's a function and we're just going to fetch the details down here so I'm just going to call this async function Asing function after this I'm just going to invoke this like this awesome and inside this I'm just going to say cons response equal await get user get Au user user details invoke that and now we're going to say if the resp response exist okay just copy this and paste it in here if response exists we're going to set off user details equal to the response just like this awesome so now we have that data store so when this component renders we will have all the data stored um directly in here and now after this we're going to go ahead and create a form schema so this is red done in stuff we already did this the first time so it's the same thing let's go in here and copy this it's called user data schema and we can paste that um we can paste that here it's okay so go in here and paste it like this and let's import Z from Zod okay nice and now let's scroll down here and let's say con form equal use form invoke that and pass in z. infer put in another angular bracket and say type of user data schema so I'm going to copy this paste it in here and in here we're going to pass in resolver is going to be Zod resolver guys and if you want more information how we did this exactly and you need some help to understand even more the previous video does a a much in-depth um breakdown of every single thing so if you need some help just go to our YouTube page and there's a full breakdown of an amazing application that we built last time go take a look at that everyone loved it I'm sure you're going to love it too so here I'm going to say default values and the default values is just an object and all the default values are is the user data okay if it exists that uh let's put that data in here or we want to uh populate it with anything that's in the model and same thing if we passed in something we're going to use that uh actually this user data comes from yeah it comes from the props okay so if it's passed in we're going to use that if not we're going to use anything that comes in from here same exact thing for every single thing okay after this we're going to have another use effect and this is going to get the permissions so we're going to say use effect like this okay pass an a dependency with data and the form okay so when this form updates and in here we're going to say if there is no data do user return and then we're going to say const permissions equal to an async function and let's quickly get permissions invoke this here and inside this function we're going to say const permission equal A8 get user permissions invoke that and pass pass in data. user. ID is potentially undefined so what we'll do here is we can just say if data. user does not exist return yep like this we can just return this okay and then here we're going to say set sub account permissions to be permissions okay awesome so we're just setting that and we also getting the data here nice awesome and then finally we need to do a reset we already did this last time so let's go in here copy this it's just a reset paste that in here nice and then this part is a little complex so we we will break this down okay and the onsubmit is pretty straightforward as well so I'll just copy the on submit and I'll explain that to you so we can delete this and we can just say console.log error something like this okay so let me import this and this is going to be sub accounts ID so um we have to create this function so basically what is this doing saving the user information if the user data exists or data. user exist then what we're doing is we're just upserting the values so everything that's going to be in the form which is going to be all this all this stuff in here and you can see what it looks like in here right all this the name the profile picture email and the roles right see I cannot change it here because I'm the owner so all this logic so basically we're going to um give the ability to change that okay and that is stored inside values when you submit and we're simply going to go ahead and upsert the value upsert if you don't know what that means upsert is update if it exists or create if it doesn't okay very straightforward and um so what we're doing here is we're saying Au user details. agency. subac accounts. filter okay um where this one okay we're going to filter for the Au user data permissions and we're going to filter for each of the permissions and for each of them we're going to create an activity log okay so uh we're just just creating some things saying updating this person's information just like this all right pretty straightforward and then if the updated user so if we successfully updated the user we're just showing a toast message and closing the modal if it is open okay and then we're just doing router. refresh and same thing here if not we're going to throw an error just show a toast saying could not update and U show an error message at the bottom okay so let's go ahead and create this and this is also a very very straightforward function so let's copy this let's not waste time so click on that click on this uh function from the queries go ahead and copy this okay and we'll look at this in just a second and let's go back into our queries file scroll to the bottom and let's paste it so const update user just requires partial user because it's update okay and then we want to we don't need this anymore because we're not even using it and we're going to say const response equal await db. user. update where this is true okay we're just going to update the user because because why are we updating because the user already created but um but yeah and then um update is it up search or update what do we use here oh this this update sorry guys but anyway I already explained what upsert means and that makes sense because we don't need to create the user anymore and here we're saying await cler client. user. update their uh update the user metadata okay and we're going to say for this ID okay for this response ID which is basically the user we're going to change their private metadata to whatever was changed whatever was changed in here um or whatever was provided or we're going going to set them to the sub user if nothing was provided okay and we're just returning that's it so let's go ahead and import this and that's literally it for this function now let's go back into the browser so we can see what we're building so let's go to the bottom let's remove this and we're going to return a card okay from UI card and this is going to have a class of way with full and inside this we're going to have the card header okay and inside the card header we'll have card title and after this we'll have card description and the card title is going to say user details and the description is going to say add or update your information and after the header we'll have the card content make sure I imported it okay from the correct Place nice and then inside this we're going to have a form component with everything in from the form and inside this let's go ahead and have the form with onsubmit set to form. handlesubmit invoke this and pass in the submit Handler we just created this onsubmit in here okay like that and what is this saying form is not defined let's import that from UI form okay much better and um this is also going to have a class name set to space- y-4 okay and inside this form we're going to have each and every form field you already know how to do this so okay so by the way now if we click on settings let's see what happens okay we see some error errors in here because we didn't make this a use client component let's go ahead and refresh this awesome there we go we see it it looks great already I mean we see a bunch of stuff right so let's scroll down and it's the same thing guys we're just creating forms again so since we already built the first form I'm going to go ahead and copy each form field so click on this form field inside the form and do this with me okay do this carefully with me because we're going to ignore only this one part okay so copy it till the email copy it like that and just replace whatever uh just insert this inside this form okay and now you can scroll on top and just copy the import statements for the form so copy this scroll up top and I'm going to go to the bottom and just paste it in here and the form file upload let's go ahead and import that too and we have an input which we need to upload uh import Port as well and that should solve that problem and now if you look in here you can see we have that stuff the user's Avatar and things like that so what are we trying to build here what we're trying to build is um it's a special type of um component here called the role okay this one right here so this role is actually pretty crucial we don't want the owner to end up changing their role so that's one thing we need to create in there okay and the other one is uh going to be the save and also if it is an agency owner okay if it's an agency owner we're going to use the same form to actually change the team memb settings so let's go into team oh this is actually not the one let's go into team here and there's a bunch of team members here if you edit this you can see you can actually change each user's access to each and every sub account and they will they will see this okay they will see uh they will see their sub accounts in here only the things they have access to so that's what we're trying to build so that's all that also needs some logic right we can't just show to everyone so how do we do that so in here first let's go ahead and create the select component go ahead and say form field and this form field is going to have disabled set to form. form state do is submitting and you can actually create this uh up top here let me do that oh we also did it everywhere okay it's fine and um this is going to have the control set to form. control and then we're going to have name set to roll and then we want to have the render prop set to a arrow function which gives us access to the field so I'm going to get that from there and for this I'm going to return the form item component like this and the form item component is going to have the class name set to flex D1 to just to take maximum width and then inside this form label is going to be us user user roll and the inside this we're going to use the select component and if you don't know how to use this stuff go into Shad CN UI and you can see all the components in here click on select where is that select and you can see the code okay this is what we're trying to build the select component and you can see the code here it's very simple component okay it's a very simple component you can just copy everything and paste if you'd like Okay so let's go back here and let's say select and import it from UI select and we're going to set thec disabled prop equal to form. form state.is submitting is submitting like this awesome and we also need one more which is on value change which is going to give us access to an arrow function which gives us the value so we're going to take that value and we're going to say if value equal to sub user I actually want to copy this cuz I don't want to make an error in that spelling so we can go in here I'm just going to copy this one here and I'm going to say if the value is equal to sub user or sub guest okay we're going to set R state to be um this which is this a string you have to have sub accounts to assign sub access to the team members and then else we're going to say set R set R state to be empty okay and then after this we're going to say field. onchange we're going to put the value in here so it changes and then we can save that data okay and then the next prop we need is actually called default value which is going to be set to field. Value like this okay and inside this we're inside the select we're going to say form control select trigger okay let me make sure I imported this from the correct okay it's the correct place and inside this select value okay let's save that and in here we're going to say placeholder select user roll dot dot dot like this and inside the value we're going to oh we don't have to actually yeah this component will automatically show everything so you can just set it like that okay nice and inside after the form control so hit enter and say select content from UI select content did I import something from the wrong folder ah there we go see I knew it guys so let's go ahead and remove this and let's import this from UI select and then we want to use the select item from UI select item and we're going to set the value equal to agency admin and we're going to say agency admin okay and the same thing we're creating multiple different um options but one option is going to be hidden which is the user uh which is the user um the ad so the agency agency owner okay so of data. user okay if this exists this is undefined here so I'm just going to put this if data. user. Ro equal to agency owner or user data. roll equal to agency owner then we're going to return a select item okay a specific select item and this one is going to have value set to agencycore owner and in here we're going to say agency owner after this item we're going to say select item value is going to be equal to sub account so same thing so I'm going to go in here it's just literally the same thing so sub user and sub guest okay so let's replace this and paste that in here and awesome and then after this entire select component just have a P with the class name of text- muted D foreground and we're going to say roll state so it's just going to give us some information in there okay and now let's see what we have so if you see this we can change this even though I am the agency owner which is bad because now I can actually change my state okay so inside this select we have the disabled prop um okay so this disabled is if it is submitting but this has to be different so since we already have that here we don't need this we're going to say field. value equal to agency owner then we're actually not going to give the user there we go okay so now you can't change this because the user is just going to change their their info we do not want that to happen okay after this we're going to create a button this is just a submit button okay uh but there's a couple more things in here because we need to also have the access so if you see this we have the access control right right here right here at the bottom we have the access control with the predefined values we need to also provide that so um let's go ahead and quickly build that out not too complex so let's say button okay and let's also see what we're building so button like this this button comes from UI button and we're going to say disabled is equal to form. is sorry form. form state.is submitting okay and then we're going to have the type equal to submit inside this we're going to say form. form state do is submitting if this is true we're going to return something or we're going to return something else okay so if this is true we're going to return our custom loading component from here or we're going to return save user detail after this button in here now we're going to return all the other stuff so in here we're going to say off user data. roll if this is equal to agency owner only then we're going to give the ability to change all this stuff okay so we're going to just return a div and we'll we'll uh put a separator in here and the separator is going to have a class name of margin y of four and after this we're going to use a form label form label and we're going to say user permissions and after this a form description like this and I'm just going to copy this so first I'll give this a class name okay class name of margin bottom of four and let's go in here to GitHub copy this description just text okay just put lurm ipsum if you want it's fine but um if you want to put this on your resume I think it's better to have some design right at least some meaningful information so users who's using it can actually see okay cool and after this we're we're going to use a div here with a class name of flex Flex DC column and GAP -4 okay and inside this we're going to render all the sub accounts so sub accounts sorry sub accounts map for each of them for each sub account we're going to return something so let's do this and inside this we're going to say sub accounts sorry const sub account permissions details equal to sub permissions um from here dot so question mark. permissions. find okay where the permission so I'm just going to say p this is easier and we're going to say where P do subaccount ID is equal to sub account. ID and if this once we get this data we're going to return a div like this and let's pass in the key and the key is going to be subac account. ID and in here we're also going to give us a class name and we're going to set it to flex flex-all flex-all let's see what we're building to okay fx- column and um items D Center and then we need justify between and then rounded LG and border of uh yeah just put border and P4 okay and inside this we'll go ahead return a div okay it's not letting me close that automatically let's go ahead and put a P tag and inside this sub account. name and after this create a div uh create a um what do you call that a switch okay so after this one create a switch S swtch switch from UI switch and we're going to set its disabled property equal to loading permissions we're going to set the checked value to be equal to sub account permissions details if this exists do access and then we're going to say on checked change is going to be a function which gives us access access to permission and in here we're going to say onchange permission which we need to create okay so let's go up top scroll up top here actually let me just put onchange permission okay and I'm going to copy this function go up top here and I'm going to paste that right above this so const onchange permission equal to async function and we're going to get access to the following so what we need is the sub ID which is going to be a string we need a string like this we need the value which is going to be a Boolean we need the permission ID so we're going to say permission SS i o NS permissions ID which is going to be a string or undefined now we got to pass that in or it's going to scream where is that okay okay so invoke this and now we need to pass in the sub account. ID and then permission I made a spelling error here so I'm just going to change that the permission and then the sub permission details. ID go back up here and let's uh complete this function so if there's no data. user. email then we're just going to return and we don't need this just shrink one more line okay then we're going to set loading permissions to true and in here we're going to say const response equal await change user permissions and this is a new um action which we're going to create permissions ID if this exists we're going to pass in the permissions ID from here or we're going to pass in V4 let's import that and just invoke it a lot of people actually rename this to uu ID you can do that if you want to and then data. user. mail we don't need this actually data. user. okay something is wrong okay we just need to put a comma there and sub ID and then finally the value so this is going to be value okay so let's go ahead and copy this let's go into our queries file and we're just going to create um this change user function okay so this change user function is going to be right here so I'm just going to close this so you you guys can see so export const is going to be an async function so async function and this is going to take in the following so permission permission ID which is going to be a string or undefined like this okay permission ID user email is going to be a string have the sub account ID which is going to be a string as well we're going to pass in the permission which is going to be Boolean and we need to put this comma here so here we're simply going to say try catch okay and we're going to say cons response equal await db. permissions. upsert okay upsert where ID is equal to permission ID update the following so we're going to update the access set to permission or we're going to create the permission like this and we're going to create access equal permission and then we need email equal user email and sub account ID is going to be sub account ID and then just go ahead and return the response like this and let's Al console.log let's put a red Emoji could not change permission and just paste the error message and let's go ahead and import this um this action in here so import the action and now we have access to that so in here after we change the permission we also want to check if the type equal to agency so that we can save an activity log okay right here let's go ahead and just copy this so do the same thing okay copy and paste and go ahead and import that okay and sub account ID so basically we're saving an activity log for the agency ID like this and then the description is gave user data. name and access to um whichever sub account they got access to okay and we're going to put the sub account ID we're going to link it to that so that even the sub account can see that and after this we're going to say if response then we're going to return a toast just a simple toast message and then here inside this if statement if the sub account permissions exist then sub account permissions. permissions doind oops I forgot to put the closing bracket okay do find where the I'm just going to say perm as in permission and if the perm. sub account sub account ID equal to our sub ID then we're going to return everything inside perm but the access is going to be set to something else so we're going to say access is going to be opposite of perm. access and um something looks wrong here oh we also need to return I think so return perm like this okay something is wrong here guys let me fix this what's what's up what's happening okay nothing just this finally after this response if nothing exist we're going to return the error toast which we also have here saying destructive failed could not update the permission of the user so now you will not see this in here but from the teams when you create the user you will actually see that okay this actually looks so good guys if you put this on your resume you are going to get hired man no way like I actually sent this to one of my clients as well and they were very excited all righty so after this else in here say router. refresh and then you want to set the loading permissions to false so now because we have already changed it awesome then what else what else do we have to do I think we did everything guys I think we already finished it this looks absolutely amazing and we're already there we're getting there we're almost there okay we finished the settings so let's go ahead and uh move on to the next part now hey guys just a quick announcement for our free freelance course so if you want access to that just listen up one of the most important skills as a web developer apart from the web development stuff is knowing how to freelance and how to make money on your own and there's a lot more benefits that you can gain as a freelancer than doing a 9 to-5 job because the problem with only having a job is that you're exchanging your time for small dollars now why do I say small dollars well it's pretty obvious you only have so much time whereas when you freelance you're basically exchanging your expertise and the value you have to offer for a fixed price and one of the best rewards that you get out of freelancing apart from the monetary part is that you can work from anywhere like it really is possible you could sit halfway across the world and deliver the same if not better results for your clients and just through freelancing alone you learn so many things like how to get leads how to run an entire sales call how to show somebody your expertise and have them build trust in you to invest in your services and the best part is you get to work with other people build a team and you're building a brand for yourself so here here's what I want to do for you we have opened up limited spots in our private community and I want to give you access to this community for free because I want you to start learning and the fastest way to do it is be a part of a supporting Community that's already making money doing freelancing be around people who are where you want to be so I want you to get access to this knowledge because it's not available anywhere else so I am creating a completely free freelance course to get you guys started and that course will be available for anybody who is a part of that that private community and here's the best part if you join before we actually lock this community every course we release in that Community will be completely free for you now here's the criteria if you join the community you have to have a display picture because people want to know you and I'm sure you want to know other people this is not a Discord channel so if you want to just hang around and this is not the place for that this is the place only for success-minded individuals this is only if you want to meet successful people and see some real progress in your career please be understanding because we are only opening up limited spots in that community so if you try to log in and your request gets denied it's probably because we're either at cap or we're no longer offering this opportunity if you want to start freelancing and also get personally mentored by me and be a part of a community that is absolutely crushing it in the field of freelancing scroll down to the description and you are going to find the link there click on that and join and I will see you there all right guys the first thing we're going to build is the Launchpad okay but I noticed something here we made a small change we need to make a small change we just change this to Launchpad okay so now when we try to access the Launchpad it does not throw any errors okay so it was throwing an error before so I'm going to change this to dark mode and now it actually renders the Launchpad page awesome so go into the Launchpad page and what we're going to return here is simply a div let's remove this and put a class name of flex Flex D column so Flex - column and we want to say justify center items Center okay and inside the div go ahead and return another div uh with a class name of width of full height of full and then Max width is going to be 800 pixels okay cool and inside this we're going to use a card component from UI card and then we're going to pass in a class name of Border none and inside the card we're going to use the card header oops sorry header component and then the card title component and for after that the card description component like this and inside the card title we're going to say let's get started with an exclamation and for the description we're going to say follow the steps below to get your account set up okay like this so this this way every time you get a client and they log in inside here they're going to see this and they're going to start you know setting up their stripe and all that kind of stuff all right and in the after the description we're going to have the card sorry right below this card uh content let me make sure okay we imported it from the correct place and the card content is going to have a class name of flex flex-all and GAP -4 and it's just going to be like an onboarding guide guys so if you go in here let me extend this if you go in here and if you look at what the Launchpad looks like it's just an onboarding like an onboarding form okay so let me extend this so you guys can see clear all right so you see it's just an onboarding form and this is something that you guys can add additionally if you like and it shows a stripe um if it's connected or not and also fill in your business details so if your business details are not completed we need to get that information okay and it's completely responsive as well of course so let's go into the content and we want to render out the following so the first one is going to be a div with a class name set to flex justify Center justify between item Center wi- full border and padding of four and then rounded LG and GAP -2 okay and inside this we're going to have another div that has a class name of flex MD items D Center Gap -4 Flex f- call from medium devices we want Flex to be row okay awesome and you can already see that kind of form there right awesome and inside this we're going to use an image component which comes from next image and we're going to pass in the source equal to slash App Store I think it's app store.png let's see if that's correct okay we need to pass in alt and we're just going to say app logo like this and then we're going to say height equal to 80 and width equal to 80 okay and finally a class name of rounded dasm medium objects contain nice there you go already looks great and after this image right here use a P tag and say save the website as a shortcut on your mobile device okay this is just like a a just some text in here just to show something but you can go ahead and take it up as a challenge and see if you can actually get this done okay it's possible so you can you can do some research and check okay so we're going to use the button component and we're going to pass in start like this so it just shows right there okay looks awesome and now after this all you're going to do is copy this div here this div from here oh actually yeah this entire div and paste it below three times two times okay so you're going to have two cards there just like this and now we just going to go and change these logos so for the second one we're going to change the logo to strip logo.png so it shows the stripe logo and we also want to change the text and we want to say something like connect your stripe account to to accept payments and see your dashboard okay awesome so now you can see that here and finally for the last one we can change this one to um their agency detail so what we're going to do here is we're going to see um here let me actually think what we're going to render here because we have to render a new Dynamic image right so let's remove this and we're going to change this source to agency details which we're going to get in just a second so let's let's actually go up top and uh fetch all this information okay so go up top and you want to you want to get access to the props which is going to give you the pams which is going to give you agency ID which is going to be a string okay and now what we're going to do is we're also also we're also going to get one more in here which is called search prams okay search params and that's going to give us access to code which is a string if you remember we were kind of getting getting this set up right so that's where we're going to use this in here to actually create the um the connected account once they have successfully come back from Stripe Right so in here now what is this error okay it's just a source never mind so in here we're going to say const agency details equal to await DB so import this and change this to an asnc component db. agency. find unique okay where ID is like prams sorry let me change this actually destructure pams and search p uh the search pams and we want to get pams do agency ID okay so we want to get the agency details for that and we want to say if there are no agency details return okay and if they do exist we're going to say const all details exist equal to agency details so it's just a bunch of and statements so go in here go to um Source go into app go into main agency agency ID Launchpad page. TSX okay and you see this copy it it's just bunch bunch of if statements to make sure that all information exists okay and just replace this right here awesome so now that we have that all this other stuff is extra guys we're not doing Stripe Right now we'll get back to stripe in just a second okay and let's go back in here and now we want to go to the bottom and you want to say agency details dot agency exists um actually that's not the one what we need here we need agency details sorry so we're going to say agency details do agency logo and now when you copy paste this for sub account I'm sure you know what to do you just have to change that logo okay something all right there we go I thought something was wrong there it was not rendering right look looks nice right and every time each of these are checked we're going to show a check icon so right now we're showing this right uh fill in let's replace this and we're going to say fill in all your business any SS business details like this right okay and after this div here we're going to return this button but instead of this button we're going to say all details exist if that's true do something if not do something else and if this is not true then we're going to return the button that we just copied and if this is true we're going to return a check Circle icon which comes from check Circle icon here and if you hover over it okay that's the perfect one and we want to set the size to 50 and we want to set the class name to text- primary like this and we want padding of two and flex-shrink d0 so that's that's what it looks like okay and here we're also going to return a link so actually let's not return a button here let's return return a link so that we can send the user to that page if they need to change it so hrf equal to um slash agency like this agency SL dollar sign pam. agency ID slash settings so we're going to take them to that page where they can start and let's provide a class name and set the class name to BG primary p y-2 p x-4 rounded DMD and text- white okay nice so now you can actually change that information for some reason if something was not saved you can you can show that to the user okay very simple and let's move on to the next page now we are creating is all these sub accounts so go into all sub accounts and in here simply say const user equal to await get off user details um user details like this invoke that and this has to be an async component because of this and this also gives us access to the Pam so let's say params is going to be an object with agency ID set to a string okay and now we can destructure the params from here and after this after we get the user data we're going to say if there's no user return here we're going to return and alert dialogue okay and let's okay see I imported from the wrong side uh wrong folder so I'm just going to say alert from components okay and this is going to have a div with class name set to flex flex-all and inside this we're going to have a create button okay so for now I'm just going to say button okay from components UI and set it to create okay we'll come to this in just a second and in here we're going to say command component command component like this which is going to going to have a class name of rounded dlg rounded dlg like this BG transparent and this command component is going to have a command input which comes from again the same folder I'm just going to make this a closed component here this one is going to have a placeholder set to search accounts okay like this and after this we're going to have the command list like this and in here command Mt command Mt like this and we're going to say no results found and after the command empty we're going to have our Command items right so we're going to say actually hm let me take this command item out of here and I'm going to say if no user. agency. subac account. length then return this component so we're also going to return it then actually I think this would work without this too let me see so let me go to all sub accounts and see what we have okay hm yeah whether we show it or not it's not going to work so if we search something eh interesting stuff okay so let's go ahead and create the other parts okay which is the command group put this in here and the command group is going to have a heading set to sub accounts and inside this we're going to say user. agency. subac accounts. length if this is true then we'll do something else we'll do something else okay and in here we're going to say user. agency. sub accounts. map map and for each of that we're going to get access to a sub account and in here we uh we can put some type I think this would have any type yeah so we have to put a sub type from Prisma client and in here we're going to return a command item okay so return command item just like this and let's pass in the key which is equal to subac account. ID and inside this we're going to pass in um actually we need to pass in some styles for this too this is a lot so what I'm going to do is just go in here go into agen C ID go into the all sub accounts page. TSX and copy this styling okay so right here we have this I'm just going to copy that and paste it right here okay I'm only doing this because we have some more stuff to actually type out so that's why I only need this okay command item and inside the command item we're going to pass in a link so when you click on this it should take you to that page so href is going to be equal to slash like this sub account SL dollar sign sub . ID like that and we want to have class name set to flex g-4 width D4 and height D full okay and inside the link go ahead create a div with a class name of relative and wi-32 and inside this create an image tag which comes from next image and we're going to set the source equal to sub account. subaccount logo okay like that and the alt tag is going to be sub logo something like this and and oh okay never mind and we want to put the fill in here and after this let's put a class name of rounded DMD object D contain BG D muted divided by 50 and then p-4 okay and in after this image so we have this div here hit enter and create another div with a class name of flex flex-all justify between okay and uh inside this create another div here like this and say class name Flex flex-all and this is going to have the sub account. name like this let's go ahead and refresh so we don't have anything in here that's why we're not seeing anything okay but when we create a sub account we will see that in here okay and after this go ahead um sorry inside this so after the sub account hit enter create a span and give this the class name of text- muted D foreground and text- Xs and inside this small say sub account. address okay awesome and now let's create an alert dialogue trigger okay and this is needed when we try to delete the sub account so as child and in here button and let's give it a size equal to SM and we want to say variant equal to destructive okay and then we want to say class name text- r- 600 okay wi-20 hover bg-- 600 and then hover text- white okay and in here we want to say delete so we can delete that account we need to create uh what we call the the alert dialogue body right the content so in here go ahead and say alert dialog content and inside this give it the alert dialog title so alert dialogue title I think we need to use a header yeah aler alert dialogue header from here and hit enter and move this not trigger this is alert dialogue title okay and the title is going to say are you absolutely sure okay and let's also give this a class name of text- left and after the title we need alert description right here and the description oops sorry and the description is going to say class name text- left as well and we're going to put in this action cannot be undone this will permanently or this will just delete the sub account and all data related to the sub accounts okay okay that's it and after this we need to have a footer to cancel and delete right so after the header component say alert dialog footer and in here we're going to say alert dialogue cancel and we're going to have an alert dialog action like that and for the cancel we're going to say cancel Cancel like this and let's go ahead and give this a class name of flex item Center and um actually never mind this class name is for the footer like this and this cancel is going to have a class name of margin bottom so class name margin bottom of two okay and the action here is going to have a class name of BG ddestructor3000 this server side so what we're going to do is inside this all sub accounts create a folder called underscore components because we're not supposed to use this anywhere else okay and create a file called delete button. TSX and typescript rafc and delete button inside here okay and let's go ahead and let's import that component in here so we're going to say delete button from this folder nice and this is going to have one prop which we'll pass in which is sub account ID which is going to be equal to sub account. ID okay so copy this go in here and pass this in here so say this is going to be a string what this is going to do up here is it's going to be a use client component so it's a client component and then const router equal to use router from next navigation and then we're going to create a button here so change this so since this is already a button so the action component is a button we can not return a button we have to return a div so we're going to say onclick async Arrow function and we're going to just pass this in here and then in here we're going to say const response equal to await get sub Account Details we're going to invoke this and we're going to we're going to create this in just a second okay and let's go ahead and just import that and say sub account sub ID so let's first go ahead and just build it so here's what I'm going to do I'm going to go into this component go into the delete button click on that and I'm going to copy this function so click on this function click on that inside the queries it's a very simple simple query okay so copy that go into your query file which is inside Libs queries scroll to the bottom and just paste that in here let's go back and import this from queries awesome and now what we want to do here is we want to also update um the activity log so save activity logs notification and we need to pass in an object in here with the agency ID set to undefined and then we need to pass in the description which is going to be a string like this deleted by deleted a sub account and passing a pipe and this and we're going to say response. name this response I spelled this wrong response. name okay cool and after this we need to pass in the sub accounts ID which is going to be sub account ID that we're we're getting in okay so we can just pass this in like this I think all right nice and then after this we need to also pass in a delete sub account action which is going to take in the sub account ID so let's copy this let's go to the queries file and we're going to say export const delete sub account which is going to be an async function and it's going to take a sub account ID which is going to be a string and in here we're going to say con response equal to await db. subac account. delete where so remove this where ID is sub accounts ID so we're just going to delete this I'm going to hit enter here so we can see clearly and then we're just going to return the response like this I made this error again response okay and let's copy this go in here and let's import this query awesome so once we get this we want to do router. refresh and just invoke it so it kind of refreshes all Purge data and in here we're going to say delete sub account amazing and let's see if we already imported this okay we oh we did okay nice so yeah that's about it for that and at the bottom here where we're returning this we're going to return a div with a class name set to text- muted D foreground text- Center not clip Center and then we're going to say padding -4 and we're just going to say no sub accounts so if you refresh this it says no sub accounts okay because by default it will not fetch that okay nice awesome guys great job so far you are doing amazing if you have come so far okay this is going to be one the best projects that our account our channel will ever create because I think this is amazing okay so let's go ahead and test this out so let's open this here create a sub account and let's go ahead and add some images so I have some uh placeholder images uh I'm just going to upload one give me one second okay I'm just going to upload some image here I'm just going to give it some name um I'm just going to put some accounts here so this is yeah we'll put prodigies testing 2 United States let's go ahead and try to oh we need to upload this okay let's give that a second okay so what I'm going to do is I'm going to upload a new picture here assets like this we prodigies prodigies testing to okay all right awesome so I just went ahead and populated some data and let's go ahead and save this account information and boom there we go the account is created and if you refresh the page you see it right here now if we click on it it's going to take us to the page but we're going to see oh okay it looks like we already created that that's why it's taking us to that um to that sub account yeah we have a let's see what we have in here we have this uh component in here it took us to sub slash an ID um let me see what is going on in here something looks a little off not sure what it is we will is it coming from here actually no this is domain and this is path so I'm just going to say path maybe it's rendering this path out hm interesting so it went to sub account okay because we don't have a page here that's why it's rendering that path so if I had a page. TSX in here and if I just use typescript rafc and said this is the sub account main page like this let's go ahead and try to refresh this see what it does okay it took us to that page what does the wrapper page do in here okay so hm sub account sub account okay we have a page sub main page we have a layout that wraps all of this okay something is wrong here I think maybe we would need to have this up set up with yeah we would need oh okay we have sub account but we need to have the sub account ID okay and that has to have a page. TSX let's see if this solves our problem and we're going to say sub account page ID there we go it should all right there we go much better so because of that it was actually rendering um the wrong component it was thinking it was of that route all right all right guys awesome stuff um let's move on now on we also need to fix up the create button right so there was a button here just replace that with a create sub account button and go into the components folder and just create that component okay and that component is going to do the following so we need a couple props in here and uh what I'm going to do is I'm going to say uh we need user which is of type user from Prisma client and this is going to have agency which is going to be this right here which is going to have U put a pipe here and just say agency from Prisma client um or this is going to be another bracket null and so we're going to extend this and we're going to say sub account which is going to be sub account from Prisma client which is an array and after this we're going to say sidebar option is going to be agency sidebar option and make that an array to and after this part here so since this is in this bracket here after this go ahead and say null like this okay cool and then we want to say ID which is going to be string and class name which is going to be a string as well and now we can extract that from here so go ahead and extract it like that just destructure and here we're going to say const set open equal to use modal and let's make this entire component use client and in here we want to say const agency details equal to user. agency and then here we want to say if there's no agency details we're going to return okay and here we're going to just return a very simple button button from components UI let's have a class name and we're going to set this to Tailwind merge invoke that and say with full flex and GAP -4 okay nice and the second parameter is going to be the the class name that we pass in and then in here we're going to have an onclick which is going to be a function which is going to do the following so again we're going to use the power of that set open function uh model provider that we used and we're going to return a custom uh model like this and this is going to have title prop set to create a sub account and then description oops it's not showing subheading sorry that's not description subheading is equal to you can switch between just put some text in here okay just put whatever you want and then after this we're going to pass in the child component which is going to be sub details and render this and we need to pass in the agency details which is equal to agency details which we got from here right and then we need user ID which is going to be user. ID and then we need the user name which is going to be user.name okay awesome cool and after this we also need need to put a plus icon so inside this button use a plus Circle icon with a size set to 15 and the create sub account text in here so now we can actually go and create that all right um see what happened here okay clearly cuz we did not pass in these props so let's go back to the component and now we need to pass in user that's going to be equal to user we need ID which is going to be equal to prams do agency ID and we need the class name which is going to be set to wd-2 200 pixels self end I'm not sure if this would make a difference um let's see self end yeah I don't think it's going to make a big difference but anyway and self end and then margin of six all the way around okay yeah self end yeah that's fine we want it to be on that side that's why so if you click this again you can go ahead and create sub accounts from here as well okay awesome stuff now we can go ahead and create our other components what else do we have we have billing and team okay so let's move on to just creating the UI for billing page and we'll put it on a pause okay awesome all right guys so I just thought about it I think it makes more sense to put a pause on billing and not go to that yet and let's finish the team page first okay uh cuz this is you know we have all the data that we really need here for the stripe stuff we'd actually done so let's come in here and we're going to get the pams which is going to give us the agency ID which is going to be a string and in here we're going to quickly just extract this and get access to this so we're going to say const Au user equal to await so this has to be async component okay and by the way this is the team page. TSX okay so we're going to say await db. user. find many okay where where agency where the ID is pams do agency ID okay and we're going to include something so after where go ahead and type include and we want to include the agency and set this to include um the sub account okay and set this to true and then finally we want the permissions so permissions and we're going to include the sub account okay actually set this to true sorry this way we can show the users with their U permission so what they have access to okay and after this if there is no o user we're going to return null just like this and here we're going to say const agency details equal to await db. agency. find unique from here invoke that and here this is wrong so it's going to be equal to where ID type ps. agency ID okay and we're going to include something in here too so we're going to say include the sub account set to true and then after this agency details if no agency details we're going to return and after this so we're going to use this component the data table this is a little more complex but I want to show you guys how to use it because the documentation is actually really is not that great so let's try to build out this component so what we're going to do here is if no agents details return so we're going to get access to data table okay in here we are going to open our directory and we're going to create um a page here called data-table ttsx and we're going to create columns. TSX okay and inside the data table we're going to return the following so first make this a use client component let's shrink this and we're just going to return something like this okay so I'm going to set this to data table so we're going to create an interface called data table props like this and in here we're going to get access to columns like this and the columns is going to have a column um okay it's not getting imported so let's go up top and try to import the stuff so go up here after this react and we want to import something okay from at slash components slui SLT okay and what we're going to import here is basically the table we also need table body um like this and then we also going to need this column stuff right so you're going to import from trans stack table okay so import from um at trans okay we might have to install this so here's what I'm going to do I think it maybe didn't yeah it probably didn't get everything when we did add all components so go to the code here go to data table and we're going to copy this uh add table here oh okay it says we have to install this so copy the bun command quit this here paste this command and hit enter and install the trans stack table for us and then we're going to say Bun Run Dev like usual and let's refresh the browser and while that's uh loading up we can go ahead and import so now we're going to say column definition let's uh refresh that properly okay there we go so I'm just going to import something from trans stack react table and what we're going to get here is column def we're going to get Flex render um and then we need a couple more things we need get core row model then we need get filtered row model and then we need c use use react table like this and now here this column is going to have column def with this type with this generic type here and we're going to say t data and this T data actually comes from uh somewhere else uh let actually no this is just what we're sorry guys this is what we're creating here okay so for this data we're going to get some generic values in here so we're going to say t data and T value from here and we're going to use that in here so T data and comma T value we're going to pass that in here and then the data is going to be T data but an array and then we're going to say filter value so filter value is going to be a string and then we're going to have action button text which is optional which is going to be react. react node and then we are going to have the modal children which is optional react. react node just like this okay awesome and now we can take this interface and we're just going to say react. FC and pass this in here and now we can go ahead so we need to get those two types right there I think we can do it let me see so T data and T value okay so here actually I I know how to do this with the regular function component so um we're going to say const default function data table and we're going to uh say t data and T value okay and let's invoke this so function like this something is wrong here let me see what's wrong here guys export default okay so data table like this and this data table is going to have columns so data table props has to be passed in here right hm so we need to pass this in here okay there we go that was the issue I think so this needs these two values right here um let's see if we can pass that in um so columns I think I'm making some some errors here oh we need to pass in what's this error generic type requires these two things okay so T data and T value like this and this should actually fix that error now let's see columns yeah okay and let's get all the values that we need and what is it saying here export default you cannot export again okay so awesome so that sorry guys um I was a little confused with the data types there and now we need to say const equal to use modal invoke this and in here we're going to get is open oh we don't need is open just set open this and after this we're going to say cons table equal to use react table invoke it and we're going to pass in our data our columns our get core row model we're going to set this to get core row model we're going to invoke it and then we need to pass in a couple more things so what is the issue here it says okay something wrong with the data we'll we'll come back and fix that data okay and after this we need to pass in something in here which is get filtered row model and invoke this okay all right let me see what's the problem with this guys give me one second okay so here we made an error it's supposed to be an array okay we put this and that that's not how the columns are going to look it's basically going to be an array so that's how we're going to create this okay so after this now we have to return something so return a react fragment first and then we'll return a div inside that so return a div here with the class name of flex items Center justify between and inside this pass a a div with a class name of flex items Center again padding y of four and gap of two and inside this we're going to pass in the search component from Lucid react and an input component component from components UI and this is going to have a placeholder of search name okay just like this and we also have to pass in a value and the value is going to be set to um table so we'll put this bracket here we'll say table. getet colum invoke this and we're going to pass in filter values and um after this we're going to say question mark. get filter value like this invoke that and we want to say as um string okay and after this we can put question mark and pass this okay awesome and I'm going to close this input component here and after this we also need an onchange and the onchange is going to give us access to a function which gives us the event like this and this event in here is going to be table. getet column okay and put in the filter value question mark. set filter value so set it um to event.target do value like this okay and that's for that I think that's good yeah and now let's go ahead and pass in a class name and the class name is going to have a height of 12 okay and let's go to this component actually we're not going to see anything right now because there's no column data but if we go to Team um yeah we're going to see a bunch of Errors cuz we didn't import anything or do anything okay but um that's fine so let's see if we can import that component so where are we in here let's import data table and this needs action button text is going to be equal to something like this and we're going to pass in the plus icon from Lucid react with the size set to 15 and after this we're going to also pass an add like that okay and in here modal children is going to be the send invitation so we're going to create this in just a second so for now I'm just going to create a react fragment and after for this filter value is going to be equal to name and then columns is going to be equal to columns we need to import columns so we need to create some stuff yep sorry about that and let's go ahead and pass in the data so we'll say data is equal to team members okay and team members is actually going to come from um so inside team we got the O user okay after getting the O user something is wrong here I think I made a mistake I don't think agency details we got that if there's no Au user we're returning null we got the O user so this is actually from user okay guys this is not the O user this here is actually the team members yeah it's the team members and this is the O user o user equal to await current user from clerk next sorry about that okay so now we have this and the team members here let me make sure this is correct agency ID we want to include this okay this is correct okay so we're going to go to down here and we're going to pass in the team members into our data okay sorry about that guys and let's close this go back into our data table okay and we still need to finish this up we we left somewhere where did we leave so we have the on change and we need to pass in a class name and after the class name we have this div let's create a button from components UI button we're going to pass in a class name of flex Gap 2 and this is going to have an onclick and this onclick is going to say if modal children exist then we're going to set open invoke this and pass in the custom modal component with the title of add a team member and the subheading is going to be set to send an invitation like this okay and in here we're going to pass in the modal children we remember we never created this okay we never created that component so we're not going to see anything but we're almost done with this and inside this button we need to pass in the action button text okay and after this div go ahead and create another div here and say class name border BG dbgr rounded dlg like this and in here we want to create the table component and we want to give this a class name actually no need of any class name here and in here table header and inside the table header we want to render something so we're going to say table. get header groups. map and we're going to get access to the header group like this sorry this is group and here we're going to render a table row component from components UI table okay and this row is going to have a key set to header group. ID like that and in here we're going to have the header. is. map and in here now we need to get access to the header and for this we're going to we can just say return and we're going to return the table header from components UI table and we're going to pass in the key set to header. ID and in here we're going to say header. is placeholder if this is true we're going to return null else we're going to return something in here we're going to say Flex render like this and we're going to pass in header. column. colum def. header and pass in a second parameter which is header. get context and invoke this okay yeah I know it's a lot of stuff to build a table honestly I think this component's a little little crazy um let's see all right it's okay uh we're learning here okay so table body and inside this we're going to say table. getet row uh model. rows. length Okay if this is true do something if not do something else and in here we're going to say table Dot get row model so get row model like this and we're going to say rows do map and we're going to get each of this so we're going to call this a row and for each row we're going to return a table row like that okay and in here we're going to set the key equal to row. ID okay oh what just happened here row. ID like that and we also need a data Dash State and this is going to be equal to row. getet is selected we're going to invoke that and if not we're going to return um selected okay like this and inside this table row we're going to have the row get visible cells invoke that map and then inside this we're going to get access to Something in here right so we're going to get the cell and for each cell we're going to return a table cell import reped from the wrong place I know that table cell and the table cell is going to have the key set to cell. ID like that and each cell is going to have Flex render invoke that pass in the cell. column. colum def. cell and the second parameter is going to be cell. getet context okay look that okay we're almost done guys we're almost done we just have to show one more row here so if this is true then we're going to say table row invoke that table cell invoke that too I'm sorry not invoke that just open that and we're going to say call span equal to columns. length and we're going to say class name equal height 24 text- Center and inside the cell we're going to pass in no results okay just like this I think this should be more than enough now we need to create the columns okay so for the columns what we're going to do is we're going to open this I'm going to copy paste and explain okay there's a lot of stuff in here and it's going to take us 1 hour to build that out I want to say save us as much time as possible okay so what we're going to do is go into Source go into app go into main go into agency we want to go into agency ID we want to go into team and now we're going to see columns in here now this is a big component but it's just it's repetitive stuff okay I'll explain what it is in detail so it's so much easier for us let's make sure we import everything okay we have some um types which we'll also create in a second okay but let's first look at this component so we have this columns here and what are these columns so how this works if you go to Shad CN UI you will notice that um The Columns okay right here is just each column what would that look like so we have status email column amount column Etc and whatever data you pass in right you can actually get get each column data from it you can get each column data from that thing that's used okay and basically you can also fire events on each of these rows to get data so right here we're firing in we're we're calling the cell function to get access to the row and then we're getting specific values like the Avatar URL and we are then rendering out some components some specific um components in here now is this Overkill I think it is overkill and the reason is because there is another table component where you can just render but why do you need this component there are some insanely powerful features like uh sorting um selection like you can do a bunch of stuff okay so that's why I use that uh component here just to give you an idea of how it works we might use this I think in one more area and that should be it okay but um it's just going to help you understand how this works and it makes it actually it's very easy to to to you know create a table like this once you create it you can just reuse it everywhere you can copy paste it okay so that's what we're doing for each column we're returning an ID with a header so this is a hidden item I think so that's why we're hiding this so no header for the name we're using a header but we're returning a custom component and the custom component is the Avatar URL okay it's just an avatar with the image and then we have another one which is a hidden item here okay and I realized I made a small um error here when I was reading the documentation you can actually call the actual value from the row itself so there's something called origin and original okay so you don't have to create these hidden values in here and hide a column and then get the data you can call the original row and pull data out of it okay so yeah guys go to the GitHub copy this entire component and follow through with me we're going to just make quick changes here and there okay so the custom model first of all let's import custom modal I'm just going to hit enter and that's going to import it for us where is that let's see okay it imported it right here at the bottom okay cool and then we need two more two more queries so we're going to get that so let's go in here to the GitHub we have delete user click on that it's going to take you to the function click on this one let's wait for it to load close this copy this very simple query okay and we're going to go into the libs SL query go to the bottom and just simply paste this in here Here and Now go in here and you can import this uh like that okay and for get user okay it's right here so copy this get user go back into the libs queries go to the bottom and we're just going to paste that right in here and now that should solve that error now this is a specific type how do we get this type same process go back I hope you guys are doing this with me okay if you have any problems just copy paste okay it's not too hard and click on this type here close this we're going to copy this type okay and we're going to go into lib /type and we're going to paste this and now this is a custom function that we're not going to use so it has underscore so I'm going to click on that go to that uh function I think it's somewhere up top okay copy this okay it's just a function we're not using just to get some types all right import this DB all right there you go awesome so now you can go back and you will not see any errors all right looks great so yeah guys just returning some new rows with custom components now there's something at the bottom called sell actions what is this it's basically an alert dialogue I'm going to show you what it does so if you go into team you're going to see this in here you have an alert dialogue in here so when you click this you have a remove user which shows an alert dialogue so we have that and we also have a drop- down menu so if you click this we have drop- down menus that can you can copy the email okay you can edit their details and this is the most important one right here okay we want to be able to edit so that's why we have um that component uh in here the drop down menu okay so it's very simple it's a drop- down menu with the trigger drop down menu with all the content okay all the way to here okay and what is the content is literally a drop- down menu so we have drop down menu items with copy with a separator with a menu item right here which is a custom model that says you can change permissions only when the account uh has an owned sub accounts something just you know some titles in here and user details so when we click on this and hit edit okay you see this is for the edit details it's going to show this and um you know it's giving a bunch of stuff in here so you can change um the permissions here so if nothing is here then it's going to show something else and let's go ahead and close this and let's look at anything okay we have one more thing in here which is remove user so you can click here and you can delete the user so it's going to remove remove them from the account okay and if you want to know how that works um actually this is not set up um and I'm going to leave that up as a challenge guys because we want to speed this okay there's a lot of stuff to go we have the editor we have so many cool things so um basically all you would have to do is remove them from the accounts okay so remove this uh agency and uh make sure you remove this sub accounts or whatever from from there so they have they no longer have access Okay cool so awesome so now what we're going to do here is we're going to close this and go back guys if you have any questions just ask okay just ask around the Discord we're going to help you so let's go ahead and import these columns now and now let's take a look at what we have what's our output like let's refresh the page and now you have all the Account Details okay so if you click on this you can edit their details but you cannot uh remove for um you know for I well this person obviously since they're the owner will automatically have access to web prodigies I don't like I think so we made some small error here so let me go into H this comes under our user details right so let's go into that so let me shrink this real quick okay let's scroll to the user details component which is inside the forms user details let's shrink this and all the way at the bottom we have flex-all justify between flex-all this should work Flex sub name in here so this has to have flex-all why did this not work did I spell it wrong guys am I am I missing something here what the hell anyway I just removed that and it fixed the problem and I'm happy now okay so I'm going to close that again and yeah so just go ahead and remove that Flex Das call not sure why that broke this stuff but um oh Flex Dash call okay all right Flex Das call column is going to put it onto the next line Flex D row is going to put it side by side I think that's what's going on there all right so now that we removed that we can actually add users so let's go ahead and see um this add button so this add button now is not wired up okay so we need to wire up that ad button so let's go straight into that so to wire up the add button you're going to go into your team folder into page. TSX and in here for the modal children okay we need to pass in that component and that component is actually a form okay that we're going to create so open this up go into components go into form and create a new file in here called send Das invitation like this. TSX this is a very very simple form so I'm not going to type it out and waste your time okay I'm going to explain it I'm going to copy this so go into the GitHub repository test plura Source components forms send invitation go ahead and copy this form and paste it in here okay we just have to change a couple things here we're going to change that in just a second second so this is insanely simple so basically it's a card with a form with two form Fields the email form field and the roll which is the select item which we already built the last time okay and it's a button so if you don't know how to build this select go back scroll back to where we were building it and watch that one more time okay but it's the same thing so I'm just going to paste this in here and we're just going to fill this up real quick so first we need the send invitation uh action okay and again this is also a very very simple action so what we're going to do here just to be more productive is click on the send invitation and click on this one and it's going to take you to the queries file just go ahead and copy this and we're going to look into this in just a second okay I'm going to explain this as well so click on the queries file scroll to the bottom and just paste that in here and now you will not have any problems okay roll has to be imported from Prisma client so go ahead and import that okay so what does this do very simple the send invitation takes the rle the email email and the agency ID for what we want to send an invitation for okay so all it does is it creates an invitation by saying db. invitation. create with the data with the data that we just provided okay now behind the scenes when we store this invitation whenever a user is new into the software right they're new they just signed up and they are trying to access the dashboard we are going to check if they already have an invitation and if they have an invitation we are not going to create an Agency for them because our entire SAS application only allows for one agency per email address okay I hope that makes sense so that's why we need this invitation stuff right here so first what we're going to do is we're going to say constant invitation equal to uh the clerk client. invitations. create invitation and what this does guys clerk actually has an invitation um sort of like a email sequence okay it sends them an actual email all right I'll put the screenshot on the screen in just a second there there you go this is what it looks like it's just an invitation that gets sent out that says hey you know here you go go feel free to click on the link and access it and the redirect URL is going to be process. env. thepublic URL okay so we're basically going to be able to access that link through the email so that's what this does okay there's literally no point of this we don't even have to create this but we want to actually give that premium experience so we're sending an email saying this person asks you to join that's literally it now let's go back in here and we need to complete one more thing okay so this has to change to sub account ID all right that's about it so let's look at this component so first we have the same toast okay we have a form schema all right which has email and a rule and if you guys don't know how to create enums with Zod this is exactly how to do it you say z. enum agency admin agency sub user and sub guest okay because you cannot create an agency owner all right and then same thing here we're going to have another we're going to have the actual form schema here okay I'm sorry we're we're going to have use form in here which has the default values and the mode onchange with the Zod resolver okay and the onsubmit function is literally nothing but creating the invitation that's it very simple we're going to invoke that query that we just created okay and we are going to Simply pass in those values that come in from here values. roll values. email and agency ID that we actually get from the uh props okay and we're also going to create the activity log uh by just passing in this information that whatever information we have okay so since it's an um agency that they're joining into we don't want to show the sub account so that's why we're only populating the agency ID okay and then we're just going to have the toast saying success or error right here and this is the same thing take a look at this nothing form form field form item form label form control with the input same thing for everything guys you just have to say form field form item form label and the input right here the input is Select right here the input is inputs okay similarly if you're using switch the input would be a switch we already did a great example of that and then finally we have a button at the bottom here that has a disabled prop and all that kind of stuff awesome I hope this makes sense if for some reason you don't like this sorts you feel uncomfortable we're going to help you out just reach out to us in the Discord okay so let's go back in here let's go to page. TSX under team and in here we need to import that component so let's go in here and uh what we want to say here is send invitation send invitation import that component and we're just going to pass in the agency ID because it needs that okay which is agency details. ID just like this awesome and that's it now we actually have this set up I think so let's click on that let's refresh the page actually I think I have to run this one more time and let's refresh this just give me a second okay and that's it guys when you go here and click on the add button now it shows you that that add a team member form and all you have to do is put the email and change their role so if you want them to be an agency admin you can put that or a sub user or sub account guest okay so what we're going to do right now is we're going to kind of test this out so we're going to send uh a sub user um access okay yeah let's go ahead and send sub account user and I'm going to send it to one of my testing accounts which is this one right here okay and uh let's go ahead and send the invitation okay something went wrong great now we can test it out and see what happened so let's see it should show up on the service side so let's see what the issue was invit okay I know what the problem is so here is a problem with uh the clerk thing okay so if you have already sent an invitations you cannot send it one more time so it makes sense right they're trying to save resources so that's why but technically we have actually saved all the data in the table so let's take a look and confirm that to go into Prisma studio if you don't know how to open this you want to run bun X Prisma Studio Studio okay and let's go ahead and refresh this um okay if you click on invitations you now see this person is invited to join okay so what we're going to do is we're going to log out of this so let's go back in here we're going to close this let's go ahead and log out so sign out okay and we're going to be taken back to this page we're going to try to log in with that new email address and if everything is correct it's not going to prompt us to create a new account okay so fingers crossed let's give this a shot so we're going to uh log in here I'm going to put this email address because that's what we have saved all right let's see what it does and now it takes you back to this page if you hit login awesome it takes you to the sub account page that is exactly what we wanted because we gave this user a sub account access only okay let's just make a quick fix in the settings page so go into your agency ID settings page. TSX and change this from LD to LG okay you'll notice it doesn't it's not on the same line because of that and now it will actually be on the same line and it will wrap after large devices so what we're going to be working on now is the sub accounts so when you access a sub account so right here if you click on this we have to go ahead and show some stuff in here as well right so that's what we're going to be working on and any billing related stuff we'll get to that in the end okay awesome all right so go ahead and just shrink everything in here open the source folder app main sub account and inside this we're going to do a bunch of stuff okay so the layout page is already completed so let's go into page. TSX and let me first explain what is this page right it's very it's literally the same thing as agency right where we are first doing some logic to check if the user has been verified and accepted right U and we're also checking if they have an agency ID that is attached to them if not they are unauthorized and we'll have to send them to the unauthorized page and we also want to get the users detail so if they landed on this page we want to find the first sub account that they have access to and we're just going to send them to that sub account okay awesome so let's go ahead and do that right here so first thing go ahead and change this to an asyn component and inside the props here we're going to get the search pams which is going to be um an object with the state set to string and code set to string now if you don't know what this is um of course I don't don't expect you to know what this is because it took a long time to figure you know where we can get this from but this comes from stripe and when we wire up stripe when the user comes back into this page after they have connected their their stripe accounts we are going to get access to the state and what is the state the state is basically the um sub ID that we're going to send them to okay that that's what that is and the other thing the code this code is needed to BAS basically just do some lot we did that for the agency as well right I hope you guys remember so that code is what we need in here to just kind of finish up the whole authentication process all right so come in here first and we're going to say const agency ID agency ID equal to await verify and accept invitation so we're going to invoke this and we're going to say if there is no agency ID then we're going to return unauthorized component like this and at the bottom here we're going to say const user equal AWA get Au user details and if there is no user we're just going to return and after this we're going to say get first sub account with access equal to user. permissions. find and we're just going to invoke this and we're going to get access to the permission here so we're going to say permission and we're going to say permission. access equal to True okay so now we have that first sub account where they have access to and then if the search parm so now we're checking for for that stuff okay so let's go ahead and extract it from here so let's get search pams and I'm going to say search pam. state if this exists then we need to do something so I'm just going to remove this stuff here so inside this we're going to say const sorry const State path equal to search pam. State dosit why is it giving me that I don't want this I want this okay do spit and you're going to put um three underscores okay that's how we're going to be splitting so put three underscores here please be careful do not mess this up you're going to be in big trouble okay so if you just copy paste this if you'd like I'm I'm I'm much more happy I'll be happier if you don't get any errors with this stuff cuz it's going to be impossible to debug this so put these three underscores here okay so we're going to split that we're going to say const State sub account ID equal to search perm. state State dosit at again we're going to put um the uh what do you call that the three um underscores here and we're going to get one okay the first one so we're passing different state data in here separated with an underscore we're just trying to extract it from that okay so if there's no State sub accounts ID we're just going to return unauthorized because there's something wrong when the data came back if not we're going to return redirect which comes from next navigation use the back takes here and we're going to say slub account SL dollar sign state state sub account ID and then after this dollar sign State path like this and after this we're going to append that code to the URL Pam so we're going to say code equal to dollar sign search pam. code okay and that's it and after this so um after this part here after the state parth we're going to say if okay just to put this curly bracket here if get first sub account with access exist so they have something we're just going to return redirect to use the back text again sorry sub slash we're going to say get first account with sub account access. sub account ID okay so we're going to return them to that URL and if all of this fails that means something is wrong so we need to return the unauthorized component like this okay awesome and now let's go into this page. TSX here right above this page. TSX and we're going to create a new component okay and this component is called loading. TSX we never did this in the other page as well so I'm just going to do it in here and I'm just going to copy something and paste it right here so just very simple component okay basically it is a div that has height screen width screen FL Flex justify Center and items Center and then finally in here it's going to say loading um uh like this the loading component that we created from Global loading right so we're just going to use that in here and we can also copy this guys and let's go into agency and we can paste that in here as well so we have that loading um in here for this component so anytime it loads it's going to show that spinner okay awesome and uh let's see so it says sub account page ID so what that means is inside the sub account right um let's close this agency Sub sub ID page in here it says this so here is where we need to uh basically do our logic of you know getting this is the dashboard page right so let's go ahead and uh build out the layout page for this so we can render out the navigation bar so go ahead and say layout. TSX okay and just return something in here so I'm just going to return a component in here and inside this layout component I'm going to first change this to what just happened there let me redo that one more time I'm going to say sub layout and in here we're going to render that layout component so let me shrink this so you guys can see more so first get access to Children which is react. react node and then we also need pams which is going to be an object that gives us access to the sub account ID which is going to be a string and in here I'm simply just going to destructure these values okay just like that awesome and in here what we're going to do is first we're going to say const sorry const agency ID is equal to await verify and accept uh invitation so if they try to access this directly we need to do this here as well after this we want to also say if there's no agency ID we want to return unauthorized component like this const user equal to await current user and if there's no user we're just going to return redirect the user back to this page page okay and then we're going to get the notifications here so basically the same thing we did in u the agency guys okay so let notific so actually you know what here's what I'm going to do I'm just going to copy this because it's the same exact thing let's not waste time okay so let's copy this I'm also going to explain it in detail all right so I'm going to copy and I'm going to paste this in here and we're going to go over this in just a second so we might need to import something let me see get off user details import that nice get notification and user what is the say agency ID is not assignable um something is wrong here let me just take a quick look at this oh okay so this is an object it's not supposed to be an object it's just supposed to be a function that takes in this as the parameter like that okay and it's going to wrap to the next line which looks horrible but that's just what it does so I'm just going to leave it at that so I'm just going to go ahead and import the sidebar import our info bar and um roll is what's let's see what the issue here let's remove this return statement here here and let's put it in here let's see if that solves the problem it's just copy paste guys so just copy this stuff okay there's nothing crazy in here there's no magic happening in here all right look it already did it all for us how amazing is that so okay what seems to be the problem with this R I need to take a look at this give me one second guys okay so basically in the info bar we had as string but if you go into info bar it has to be of type roll so all you have to do is just say roll like this as type roll because that that's how it works right we can only have these types nice that's it and now we have our sidebar built for our sub accounts and as you can see in here it shows which sub account we are on and if you go back to the agency it says we're in the agency how amazing is that all right awesome so let's quickly go ahead and build out the rest of our sub accounts now right before we go and start building everything let me just explain this I'm really sorry I told you I would explain it and I totally forgot but here we go this is what's happening okay so inside the sub account layout we're verifying that they have access if not we're creating it right and we are checking if there's a user that exists so in here first we're saying if there's no user to private metadata so if they don't have a rule return unauthorized okay and in here now we're checking if the user has permissions to access the sub account so we're just saying all permissions equal get Au user details which has the permissions in here and then we're checking if they have permissions by simply saying all permission permission. find that permission where the access and the permission ID so the access is true and the permission ID is equal to the permission sub is equal to the sub ID we got that they're trying to access from the URL okay I think I explained it very simple but that's basically what it is and if they don't have permission return unauthorized now we're going to go ahead and get all the notifications so we're going to say so here we just created this in here and set it to an empty array so there's no um errors right so here we're going to say const all notifications get the notification for this agency ID here we're going to say if the user. privat metadata rule is agency admin or it is the agency owner then the notification is going to be equal to all notifications but if not then we're going to do filtered notification so that's why I wanted to explain this cuz it's kind of important okay so um we're basic see since I'm the agency owner I can actually filter out the current sub account or agency notifications as well the filter notification is going to be all the notifications. filter where the item so filter each notification where the sub account ID is equal to the sub account we're on so basically if there were any notifications in here that belong to the sub account only we can actually filter that right from here directly in here as the agency owner so we can track all the activity from our sub accounts this way you have control over what's happening and then this is nothing this is the same thing okay we're returning a div with height screen overflow hidden with the sidebar and then this is literally the agency's layout okay also here we're passing in sub account instead of agency that's the other change in here and then here we're going to say MD padding left of 300 pixels info bar and now we're just going to pass in the notifications the RO and we want to change that as Ro and the sub account ID and then finally a div with relative set to uh the children and inside here the children are going to be wrapped in the blur page component that's why we need that in here so I see something in here this one seems to be okay this is actually not needed so we can go ahead and just simply remove that okay because it's not going to reach that returning this that was just on accident that's it okay awesome so now let's go ahead and test to make sure that our sub account logic is working so if we go into our agency you'll notice that Emanuel Joseph this person right here is a sub user but has no access to any of the accounts so if we try to edit their details you will see oh I have to refresh this page all right right there we go you'll see they don't have access to that sub account so technically speaking if I hit log in here I should no longer see that weird sub ID or whatever at top but I should see unauthorized page so if I hit login there you go guys it shows that this user is unauthorized this is exactly what we want and they can go back home and same thing okay so if they also try to access an agency page like this right let's just say let me take this agency ID here okay and let's see what happens if they try to access this we hit enter it says unauthorized because they are not access they don't have access to these pages okay awesome I also want to point out one more thing so if you are seeing this error I don't think you will but if you are seeing this problem where it just says module not found the I think this is just a local test environment problem it's not going to be in production it's just because of the hot module reloading this is what I assume and I think it's it's something to do with my computer but if you are facing that issue just go up top delete node modules okay delete the folder come back to the terminal do bun I okay so bun I like this do bun I okay and hit enter so if I do that it's just going to install all the packages and then you can go ahead and say Bun Run Dev okay and that should solve the problem I don't think you're going to face this problem but if you do that's the solution to that problem for now okay all right so let's head back into our sub accounts so inside this we have web prodigies let's click on that as you can see that really cool loading animation happened so what we're going to do here now is we just need to build out these pages so the first one we're going to build is the Launchpad okay so let's go ahead and open this a little bit more go into sub account ID and then in here you want to create a folder called launch pad. TSX not launch paath launch pad. TSX this is not a okay this can be a folder no problem and in here we're going to say page do TSX okay and then let's just quickly return this and we're going to say Launchpad okay just like this awesome and in here we're going to get access to the following so pams which is going to be a an object with sub ID set to a string and we're also going to get one more thing which is the search params okay so I'm going to get that as well search pams which is going to get us the state which is going to be a string and the code which is going to be a string as well okay and now we can go ahead and import these sorry destructure these from here now what is this page you guys have already built it you can pretty much copy paste and change some values okay but let's go ahead let's go bit by bit I think that's the best way to actually do this so first we're going to actually get the sub details so we're going to say const sub Account Details equal await so this has to change to async DB let's go ahead and import that from lib db. subac account. find unique where the ID is of this type okay and once once we have these details we're going to say if there's no sub account then go ahead and return and now we also want to show you know that all the details exist right so if you remember we have that page where it shows like you know a check icon for each page each uh settings that has been completed right so we're just going to return that so all details exist subac account detail. address the address is done twice we don't need this twice here okay sub account logo city phone email if all of these exist that means all the details EX exist okay and then there is some stripe stuff that's also you know going on in here we're just going to skip that for now so what I'm going to do is I'm going to say uh work in progress wire up stripe okay like this okay this is causing an issue um there is one more statements here so I'm just going to end that yeah just remove that and okay and now we're just going to say wire up stripe in Here and Now what we're going to do we're going to scroll down to the Launchpad here we're going to return blur page like this and inside this this is no different from the other thing okay the one in agency just a couple things are changed I will show you exactly what it is so I'm going to copy it go to the uh go to the GitHub repository okay I already showed you guys how to do this so go to GitHub copy it from the same file uh same file and just paste that in here we're going to uh walk right through this okay so let me import blur page first okay nice and go ahead and just import each of these things so import card the card header just h take a second pause this video and import this okay and then come right back okay so hopefully you went ahead and copy pasted it and you imported every single thing now you will see one error right here which is connected stripe account okay all you have to do is remove this because we don't have stripe wired up yet okay I hope that didn't alarm you but you guys need to understand anything that has stripe right now just ignore it till the end okay forget about it it does not exist okay so let's go ahead and refresh this I'm just going to refresh uh this page here and uh we'll access the sub account in just a second okay so let's go to sub account let's click on the launch pad okay so it's showing um an error here okay launch let me see what is the issue so it accessed SL Launchpad okay whoops I just made an error in the folder name so I changed this to TSX just remove this okay and if you click out and if you change the import statements as well if you refresh there you go it shows the page we're supposed to see great job guys and you also see the blur page right it does the same exact thing in here as well nice and uh now you pretty much have the setup so let's move to the next folder now all right so the next thing we're going to build is the media component and in the media component basically we are just showing the user all the media files they have uploaded inside their uh accounts this way when we get to the awesome website builder we can actually use this med media component anywhere we need inside this application to give the user the ability to directly copy paste the URLs of these U files okay so it makes it very easy to use background images um and all that kind of stuff so let's go in here inside the sub account create a media folder and inside this create a page. TSX and we're going to just um return something in here okay so I'm just going to say we're going to say media page like that and inside this media page we're going to get access to the pams in here so we're going to say pams which is going to be sub ID which is going to be a string and let's go ahead and extract that from here okay um it made an error so extract that just do that all right awesome and in here all we're going to do is we're going to we're going to get media and this does not exist so we have to import this so let's change this to async component okay and get media does not exist all right so we're going to build that right now so go into your queries file right right in here where is that inside your queries Libs queries like this and inside this we're going to go all the way to the bottom we're going to say export const get media equal to async component um async sorry async function and this is going to get the sub ID which is going to be a string okay uh why is it doing that string like this and inside this we're going to say media files equal to await db. subac account db. subac account do find unique okay so we're going to get these details so find unique where ID is going to be sub ID and we're simply just going to include the media true okay and um then we're also going to return the media files that we just got and also you can just go into the table I don't know why I did it like this but that's fine just do this and go in here and let's quickly import this so import that all right nice no errors there great and then here we're going to return okay a blur page and this is going to have a new component called media component and the reason why we're doing this is we want to reuse this anywhere we need the user to have access to this so let me just pass in a couple props so data is going to be data that we just got and the sub ID is going to be the params do sub account ID okay and go into your components so what we're going to do is we're going to go down here where is that so go into components and just create a media folder in here and just create an index. TSX and just return something from here awesome and we're just going to say media component and let's go ahead and import this component from here nice so no errors now and let's go in here back into the media component and let's get those props so data is going to be get media files and we're not going to have this right now just give me one second we need to create this type in just a second but let's get the sub ID which is going to be a string as well we're going to take this and we're going to just destructure this from here okay nice now to create this type copy this go into your types folder right in here where is that yeah right here go down and we're going to say export type paste that equal to Prisma do promise return type and we're going to say type of get media okay so import that nice and let's go back to that file and let's import that type right in here okay that should fix that error nice and now in here we're going to remove this and all we're going to do in here it's actually a very very simple component we're just going to show all the media files right so let me try to access this this uh page media hello media okay all right it opened the media component so um in here we're going to change this so remove this from here and we're going to say class name is going to be Flex Flex oops I just made an error sorry guys one second okay there's no error okay yeah so we're going to say Flex Flex - column Gap -4 height full and width full okay and then we're going to create another div in here and this div is going to say Flex justify between items Center okay then go ahead and create an H1 and this is text 4L the class name is text 4XL and it's it's going to be uh called media bucket okay and then finally we're going to need the upload button so this upload button is another component we need to create okay and uh let me see where we can get this from okay so this comes from okay so this is not the upload button that we created we're going to create a custom upload button all right just give me one second after this uh we're going to basically Bally have the search functionality and all that stuff in here so go into your media folder and we're going to say upload dasb button. TSX and inside this we're going to return the following so just return this right in here and um let's also change this to upload button uh maybe you want to change the name for this actually so let's say upload button media upload button this makes more sense right okay media upload button and I'm just going to go ahead and quickly import this component like like that and let's go back into the upload button and this is a client helper right so we're going to go up top and we're going to say use clients up here and this is going to get access to the uh sub ID which is going to be a string so let's go ahead and destructure that quickly from here and inside this component we're going to say const is so we're basically getting um is open set open and set close from our modal so I'm going to say modal like this oops just need to put that in there okay use modal and there you go you already see the button rendering right nice and we're just going to return a simple button component nothing crazy okay so just say uh return here button from UI button and this is going to say U what is it going to say upload in here right okay upload like that and in here we're going to have an onclick so onclick we're going to say this is going to take a callback function and in here we're simply going to set open and we're going to um open one of the modals so that we can um upload that that stuff okay so we're going to say set open in here and say custom modal okay set the title to upload media and the subheading is going to be upload a file to your media bucket okay I'm just going to paste some string and inside this we're going to have the a new component called upload media form okay just like this and it's going to take a prop so I'm just going to pass that right away so we save us some time okay so sub ID just like this and now we're going to go ahead and create that upload media form so let's go into our forms which is right in here okay so forms and we're going to say upload D media. TSX and let's just return some component in here we're going to say upload uh media form component like this okay and um I'm going to try to import this as well upload media form and let's go in here and quickly get the sub account ID which is going to be a string and let's go go ahead and extract it oh it says sub account I think we only need sub ID yeah all right so we'll just pass in the sub ID and then we'll do the following um stuff inside this component so this is actually a very very simple component I'm just going to build this form out so you guys get some practice okay I don't want you to always keep copy pasting so let's go ahead and first say const form schema so go ahead and type it with me right now okay Z doob so let's go ahead and import Z from Zod and you want to say object okay object like this we're going to we're going to invoke this and inside this object we're going to pass an object but we're going to pass another object with the link set to z. string. string like this invoke it and say minimum is got to be one and the message is going to say media file is required okay like this okay and then after this we need the name of the media file which is z. string again and this is going to have Min of one and message is name is required okay okay nice and now we can use this form schema in here and now um another thing we need is this has to be a client component so we're going to say use clients up top and inside here we're going to first get access to toast so cons toast equal to use toast which comes from UI use toast let's import that and then we also need router so cons router Router equal use router like this from next navigation go ahead and invoke that and after the router now we're going to say cons form equal use form use form and let me import this from react H forms and we're going to say this is z. infer type of form schema like this and in here we're going to pass in an object with the resolver set to Zod resolver okay and invoke this and pass in the form schema and the mode is going to be on submit for this one okay we can use onchange too but I'm just going to do this and the default values are link is going to be an empty string and name is going to be an empty string okay and now let's go down here and let's return a card component from UI card with class name of with Das full like this and inside this we're going to have the card header card title and card description like this so card header card title and just put some title in there card description put some description inside this as well and then we're going to have the card contents so after this say card contents card contents and this will take a form component so form component from UI form and use a spread operator and put everything from form inside this and inside this use a native form component and set the onsubmit to be form. handlesubmit invoke it and we're going to pass in a function called onsubmit onsubmit and let's go up here and we are going to basically create that function so we're going to say async function onsubmit okay like this oops we don't need this okay onsubmit and this is going to have values set to z. infer type of form schema okay and inside this we're going to have a TR catch so we're going to say try catch oh they made an update I didn't know they made that update nice con response equal await so this has to be an async function okay await create media which does not exists so just say create media and we're going to pass in the sub ID and values like this okay and now to create this quickly go back into your queries file like this and at the bottom we're going to say export const create media equal to an async function async Arrow function and this is going to have the sub ID which is going to be set to a string and inside this we're going to say const media files sorry um we need one more thing in here guys we need the media files as well right so we're going to say media file is going to be create media type which does not exist so let's go ahead and build that type so we're going to copy this we're going to go into our types file and we're simply going to say it's pretty much very similar to this okay um but okay actually there's one thing different it's not exactly the same thing sorry about that so we're going to say export type create media type equal to Prisma Prisma do media um create without sub input this is what we need so if you hover over this you'll see the type this is all we need to create and it also shows the optional stuff so let's go back in here and let's go ahead and import that and let's make sure there's no errors okay cool and in here now we're going to say const response equal await db. media. create invoke that and pass it an object and we're going to say data is going to be link which is Media file. Link the name is going to be media file. name and the sub ID is going to be the sub ID we just received okay put a comma here okay I think there's something wrong here what's okay I know what's wrong H We spelled that wrong in okay there we go and and finally we're just going to return response not redirect response like that okay and let's go ahead and quickly import this so go back into your file upload media a form and let's go ahead and say create media and go ahead and import that okay okay cool nice no errors in here so nice and now we're going to say await save activity notifications and we're going to pass in the agency ID which is going to be undefined okay we're going to pass in the description which is going to be back ticks and I'm just going to pass this in here you can put whatever text you like which is uploaded a media file and put this Pipeline and you want to put this in here okay and then sub ID is going to be sub ID like this okay you can just remove this too reduce a number of lines of code nice and then here we wanted to say router. refresh okay and before this actually let's just say toast invoke this and we're going to say title success and the description is just going to say uploaded a media file like this okay so description is uploaded uh media media that's fine too and if an error exist inside here we'll print the error message and we'll simply just show another toast right in here okay so now if I click this let's see what happens nice I see something looks great okay and let's go ahead and build the rest of this so inside this form this is where we're going to have the form field so if you guys remember we built this 4 million times so I'm going to copy this paste it in here and just import everything so import field sorry import form field import the form item so go ahead pause this and do this okay okay awesome so I went ahead and did that so now when I hit uh upload it shows the form field name okay nice and the final one is the file upload which is also done before so I'm going to copy this here and after this form field here I'm going to enter this let's go ahead and import file upload that's pretty much it so now when you hit upload it shows you this and uh now you can actually submit that and to submit that you need a button so after this component go ahead and place a button component from UI button with the type equal submit classes margin top of four and say upload media so now when you click you can actually upload something nice looks amazing right so let's go ahead and try to upload something um so okay so before we upload we have to actually build out that that layout to show those components right so let's go ahead and do that I'm just going to close this real quick and we're going to go into that upload form media in here okay we actually don't need this so here let me get out of this okay go into the index file and now we can actually show those uh the media files so go ahead and say command okay which comes from UI command and this is going to have a class name of BG transparent okay and inside this we're going to have a command input put component with a placeholder set to search for file name okay just going to import that and then we're going to have a command empty so if this is empty um actually sorry guys we want to have a command list and then inside that we'll have that so go ahead and say command list like this I'm going to import this as well okay and class name of a padding bottom of 40 max height of full and inside the command list we're going to have the command empty okay so I'm going to go ahead and import this from this like that command empty and it just says no files uh no media files okay and now we're going to inside inside this we have to show the list so create a div with a class name set to flex Flex Das WP Gap D4 and padding top of four and inside this div we're going to Loop over the data. media. map okay so for each of that we're going to get a file for example and we're just going to return a command item so we're going to say command item where is that command item here oops command item like this and this is going to have a key set to file. ID and inside this we're going to have a class name so this class name is going to be set to padding of zero margin sorry Max width of 300 pixels width full rounded LG important background transparent font medium important and text white important okay and in here we want to have our media card so now we need to create this media card so quickly go into your um okay inside this is itself create media- card. TSX and just return a component in here change this to Media card and inside this media card we're going to do the following so in here get access to file which is going to be of type media from Prisma client okay let's go ahead and import this uh sorry extract this and we're going to create a state so this has to be a use client component and in here go ahead and say loading set loading equal to use States and import that okay so import this usate and then we're going to again get access to the router so let's go ahead and import router from router so I'm going to say const router equal use router from next navigation nice and now we're just going to have an alert dialogue so this is just a redundant component okay there's nothing crazy happening and I'm going to explain everything in detail but I'm going to copy this and paste it guys so go to the GitHub go to this media card copy and paste it right in here okay and I'm going to explain exactly what we did so copy that component paste it in here and go ahead and import each and everything okay go ahead and import all that stuff you need so I'm just going to go ahead and copy paste that import that as well okay and of of course you're going to see some other stuff here so let me go ahead and import this so pause this video and just import it you will see some errors but if the errors are coming from the components import that but if they're coming from something like this we will fill that up in just a second okay okay awesome hopefully you didn't get alarmed or anything but if you copy it you'll see an error here for toast you'll see an error here for delete media and this toast as well okay these are the only three errors you should see if you see other errors just see if make sure you import the components correctly okay so all this component does is basically it's an alert dialogue okay and um I mean it's yeah it's basically an alert dialogue that allows us to trigger a drop-down menu so whenever a card is shown we can hit on the more icon and we can change some properties like delete update well all that kind of stuff that's what we're doing in here okay this is not needed I'm just going to remove this from line 54 that's just redundant all right so um that's what we have this for in here okay and let's go ahead and break this down so I'm going to try to actually create let me first solve these errors so toast comes from toast uh from you toast and I also realize guys you don't have to do use toast you can just say toast like this okay I actually was creating it here and then importing it yeah well I just learned you don't have to do that so just say toast like this okay and this other one more function you're going to have this one more query error here so let's fix that so go into queries and we're going to say export const delete media equal async Arrow function and this delete media function is simply going to delete the media from that that folder I'm sorry that table okay so let's change this to Media ID okay which is going to be of type string and inside this we're going to say cons response equal to await db. media. delete where the ID is Media ID okay so go ahead and delete it and after this we simply want to return response if we need something and okay I made a spelling error here response and let's return response like that let's go ahead and import this now so go in here delete media and import that nice so now we should not see any errors okay so um now I will explain what this does okay so it's just a um a drop- down so go ahead and type this with me if if you had some errors so you can just build it out and have nothing to worry about okay so we're going to have wrap this in an alert dialogue and we're going to wrap this in a drop- down menu okay these are context providers and in here we're going to create an article saying class name border with full rounded LG background slate 900 and then we're going to have a div here with the image so this is the file link to show the image on the screen okay so that's what we're going to do there and after that we're going to have the title so which is the name of the file so create a P tag put the file name and then we're going to have a div here saying p-4 relative and we're going to have created at so when was this created that's what we're going to put in here instead A P tag and we're going to also put the file name okay and um here we're going to say drop- down menu trigger more horizontal okay inside this div so that way when we click this more horizontal it's going to show this drop down menu right in here so what is this it is a drop down menu content is going to have the label saying menu and we're just going to have a separator which comes from drop- down menu separator and the dropdown menu item is this the first one is a copy icon to copy the image link and all we're doing in here this is important okay Navigator this is a native thing okay Navigator do clipboard. writ text file. link okay and then we're just going to show this copy to clipboard toast when the user copies that that's it and then after that we're going to say alert dialog trigger this is delete file that's why we wrapped it in that uh alert dialog okay so when we click on this also put as child in here don't forget and you want to say drop down menu item so we're creating another item which is a trash icon to delete so when we click on this you have to delete this item okay so this right here um for this delete is simply the same thing that we did at the bottom here where is that let me go ahead and find that okay so just copy this logic inside this onclick go up top we just had deleting that file right and change this on click in here that's it okay so con response equal A8 delete media um this one and we're just we're just copying the same thing here so we're saving some data for the notifications we're creating a toast setting loading to false and we're just refreshing the page okay and what's out what else let's see all right that's done now what does the alert dialogue look like the alert dialogue just says hey are you sure you want to do this and guys if you don't know how to create these components it's literally inside chat scene UI click here go to alert dialogue and you will see click on code here it also shows you preview this is what it looks like continue or cancel and if you click on this code here you just have to copy this you can hit copy here and paste it into your code and you can change everything as you like that's what I did as well okay so change that and um everything else should work as expected and I'm sure you guys can understand you guys are experts now you can understand what this function does okay all right so now we're just going to go ahead and test so let's create a file so hit upload change this to um web prodigies Banner image or something and just upload something so I'm just going to upload my banner image in here and hit upload media okay something oh I need to what seems to be the problem here let me see this might be some spelling error media file is okay media file is required uh let me go into that component guys so let's go into the form I'm curious why we have this here so this is for this so it's showing some error so upload media let's go in here and say name is required media file is required okay that's just all right never mind guys so go ahead and upload that that was basically the um the label that just turns red I got confused for a second it's like wait is it for this one never mind so go ahead and upload that okay awesome my banner is uploaded and hit upload media and success the media is uploaded and if you refresh the page okay something seems to be wrong maybe we are not actually are we rendering the component I'm not sure let me go ahead and take a look at that um media page. TSX we have media component inside that we have a command item all right we're not returning anything in here and as a result we're not seeing anything okay so sorry about that confusion so let's go back to our components so so go back to Media index. TSX and let's continue this so we can see something all right sorry about that guys so inside this item we're now going to import that media card that we just created like this and let's show the file okay and um after this um so there you go it already shows looks great right and there you go looks amazing right and one more thing so after this if there's no media files which is after this command item so you have command item here hit enter after this so if data. media. length Okay if this exists if this does not exist so there's no no items then we want to show this folder search icon which comes from Lucid react just set it to 200 size so we're just showing something like hey empty no files to show you don't have to you can just remove this okay you don't have to show that I just wanted to show that so by default if we deleted this let's see delete okay delete oh okay guys I know what what happened I know why I don't have that so let's go back into the media card inside this delete where is that okay alert dialogue delete onclick where is that let me search just give me one second okay delete file this is actually okay remove this onclick we don't need it okay because the other um alert dialogue is actually doing it for us so we don't need to do that okay so there you go you see that icon if you create this one more time let me go ahead and create that upload that in there I'm just going to say web prodigies Banner image upload and let's just give that a second okay awesome and now if I upload this media it shows uploaded media and it also refresh the page so now when I hit delete it's going to prompt this and not immediately delete it okay that's what we want so that's why I did that and if you want you can just directly delete it and remove all this alert dialogue stuff okay it's up to you but there we go now we can copy this link and it says copy to clipboard so I can paste it anywhere I want okay something happened wrong here a pench parameter one of node H what is this error okay something is wrong with this component I'm going to go back into the index file and let me fix this give me one second guys all right guys so I found the problem and I did not expect this to even be a problem but basically um you have to have a command group for every command uh list you're creating okay I mean for anything if you have a list here Comm a bunch of items they have to be inside a command group so that's why it's not showing that stuff for us okay so I went ahead and just say command group and I put that entire list that div inside that command group and don't forget to give it a heading and we're going to change this to media files like this okay and that's it now it works now we can search for web prodigies or Banner image and it does the logic for you awesome stuff so now we can reuse this component anywhere we want so go ahead knock yourself out create like 10 pictures or whatever you want okay for those of you who are still here I am super proud of you because you have come so far and there's so much more you're going to learn because now we are going to move on to pipelines and if you have seen there's so many videos out there that talk about how to create this pipeline con Bon board we're going to build that entire video in this video how insane is that okay and please keep the GitHub ready okay keep it open we're going to do a bunch of copy paste but at the same time I'm going to explain anything I copy paste okay and I'll make sure that you don't face any errors as well and if you do I got you in the Discord okay so go in here to your folder structure we're going to shrink everything go into Source app main Sub sub ID and in here we're just going to create something called pipelines like this and inside that a page. TSX and we're just going to return something for now we're just going to call this pipeline so so the pipeline ID or the pipeline page for this page right here is going to have the pipeline but then we also need to access each pipeline ID right so we're going to have another pipeline ID in here so create a folder and call this pipeline ID and inside this AP page. TSX and we're just going to return a component in here call this pipeline page okay and in here we just called it pipeline okay fine so um yeah so let's go ahead and build that so first thing we want to do is in here um inside this pipeline folder go to the page. TSX and we're going to do the following okay so first up here let's quickly go ahead and get the params which is sub ID which is a string like this okay and I'm just going to go in here and extract this from here and now I'm going to get the pipelines very simple query okay we're going to change this first to an async component and we're going to say pipeline exist await db. pipeline. findfirst where the sub ID is the params do subac ID and then we're going to go down here and we're going to say if Pipelines exist so some pipeline exists then we're going to return the redirect so um let's go next navigation to sub uh use back tis guys return redirect subac account pam. subcount id/ pipelines and pipeline exist. ID okay and then we're going to do a TR catch in here so let's go in here quickly and let's do that just give me one second so enter here and we're going to do the following so I'm just going to remove this toast I don't know why I have toast in here anyway so I'm just going to console.log if any error happened okay like this nice and what we're going to do in here is if some error happened in here okay so we're going to say um try catch okay const response equal await db. pipeline. create data uh. name first Pipeline and we're going to say subac account here subac account ID is going to be pam. subaccount ID then we're going to return redirect this stuff actually now that I think about this guys I don't think we need to do this cuz see here if we go into our queries um let's go ahead and take a look at that okay so where's our sub account let's see here okay we have Launchpad whatever whatever right pipeline there we go we created a default pipeline called lead cycle so we no longer need to do this process in here all right I think I know why so if there's no pipeline then we need to show no pipelines exist so I think instead of that I just prefer to create to Pipeline and just route them to that pipeline if they have zero pipelines okay that's probably why guys and um I don't know if you like that logic feel free to just remove this entire Tri catch if You' like okay so now let's open this in here and we're going to create a loading. TSX and this is a very simple component it's basically we're just going to have this loading page which comes from Global loading page and we're just going to return a div with negative margin top of8 and height of screen and we're just going to return return the loading page okay and we've already created the loading page in our Global folder okay let's go back there to the other component now let's open this folder structure and we're going to create a layout. TSX so in here pipelines inside the pipeline not inside pipeline ID be careful please we're want to create layout. TSX layout. TSX and inside that we're going to do the following so we're just going to return the blur page along with the stuff so we're going to say pipeline layout out we're just going to get access to Children which is react. react node we're going to return a blur page with the children okay that's it and inside this pipeline ID we're now going to create um everything related to the pipeline in here okay so what we're going to do is let me click on that okay so it's showing the pipeline page nice and we're going to go up top here quickly get the pams which is going to be subcount ID which is going to be a string and in here let's go ahead and extract that and now we're going to say const pipeline details equal to get pipeline details which we need to create okay so because this is a weit this has to be an async component and this uh query we need to create so copy this right here okay we need one more thing from here guys so we're going to get pipeline ID so also add that in here okay pipeline ID is going to be a string like this now this will not show any error okay so let's copy this go into query's file and I'm just going to scroll to the bottom here and let's just say export const this is equal to an async arrow function and this is going to have the pipeline ID which is going to be of type string okay and in here con response equal await db. pipeline. find unique where the ID is like this pipeline ID that we passed in and we're just going to return that so let's go in here and import this uh from that query file and now what we're going to do is we're going to return that pipeline stuff in here okay so before for this we also need to make sure this details exist right so if no pipeline details exist then we're going to return and redirect the user to subaccount slams. subaccount id/ pipeline so we're going to go back to that page and then accordingly the logic might create a new Pipeline and so on so forth okay and then in here we're going to say pipeline equal await db. pipeline. find many where sub ID is pam. subac account ID and the reason why we're doing this is because we're going to also pass all of our pipelines into a drop- down component so that we can see and select all the pipelines and then finally we need the lanes so what are Lanes uh pipeline is the conon board Lane is each uh column think about it that way so to get the lanes we're going to say Lanes equal await get Lanes with tickets and tags cuz we need all this information first import this Lane details here oh actually we need this Lane details the lane details is going to going to be Lane so go into your types file and in here we're going to export a type called Lane details which is going to have the lane from the Prisma client and we're going to extend it with tickets is equal to ticket with tags now where is ticket and tags so how do we get this we're going to create this right here so go up here and say export type uh ticket like this and tag which is an array and all come from Prisma client okay this Prisma client Prisma client um and assigned also comes from Prisma client and contact also comes from Prisma client and uh now we have this setup in here so we can go back and let's try to import these types so import this now we need to also build this um query so I'm quickly going to go into our queries file so I'll click this here which will take me in there we're going to say export const get Lanes with the tags okay equal to an async function and this is going to have the pipeline ID which is set to a string and in here now we're going to say const response equal await db. lane. find many where pipeline ID is the pipeline ID we get from here and we're also going to order by something so order by order of ascending okay this is important guys don't forget to do this okay and uh we're also going to include the following so we're going to include tickets order by order is going to be set to ascend and after this we're going to include the tags and set this to true we're going to say assigned set this to true and we're going to set customer set this to true as well so we're getting all that data and at the bottom just return response like this and let's go back and just import this uh query from the file nice and no errors perfect now we're going to use the TBL list from chatsi and UI if you don't know what that is um it's simply tabs that you can click between so it looks like this okay um we're going to use this component so let me go back in here and I'm going to try to access this so where's that pipelines okay so I see okay loaded and I see pipeline page right in here nice so we're going to go in here and so scroll down here to the bottom we're going to change this to tabs which come from um components UI tabs and inside default value going to be set to view okay and the class name is going to have width of full and inside the tabs now we have to render a tab list okay so the tab list is going to have the following so just say tabl list like this um not from Tremor guys from component UI tabs okay and the tablist is going to have a class name set to BG transparent border of Border bottom of two height of 16 width of full justify between and margin bottom of four and then we're going to have an info bar in inside this okay and this info bar it's a special type of info bar called pipeline info bar okay so let's go ahead and pass that in here and I'm going to show you how to create this component so go in here and inside the pipeline ID uh we're going to create actually outside the pipeline ID so inside pipelines create a folder call it underscore components okay and inside that we're going to create a file called pipeline infobar so in here pipeline D infobar dobar dots X and let's return something from here nice and uh this is going to have some errors so let me do that one more time we'll say pipe line info bar pipeline info bar nice so it's just returning that component and now let's go ahead and import that from here like this nice and we're going to have some errors with the um props so let's go ahead and fill that up as well so inside our pipeline info bar we're going to go up top here inside the props and we're going to say sub ID is going to be a string and then we need pipel lines sorry actually let me do this guys I'm just going to copy this okay save you some time so sub ID is going to be string pipelines is going to be pipeline but an array of pipeline so let's import this from Prisma client and the pipeline ID is going to be a string as well and this is going to be a client component so go up here and say use client and in here we're going to create first we're going to get access to the model so do use model set close set open but we're going to rename this to set open model Okay the reason is because um there's something that clashes with this okay so do set open like that and we also need another one in here which is called open and set open okay and this open is actually for something else and I'll show you in just a second it's going to make it's going to make sense when I show you so in here now we're going to create another one called set value and uh value here and pass in the pipeline ID let's go ahead and extract all these values from here nice so we put the pipeline ID in there in here now we're going to return that component so let's create a div and inside this this div we want to create another div and we want to give it a class name of flex items end Gap -2 and inside this we're going to use the popover API okay so I'm just going to copy this popover it's not popover API sorry it's popover component man I remember making a video about Google's new popover API and that kind of got stuck in my head all right so here we go okay components import this popover component from there oops I need to close this and put the popover trigger inside that so say popover and this comes from our components UI pop over open set to this open and open State uh on open change set to this set open so that's why we need needed to rename this right here okay and um in here we're going to say pop over trigger as child and let's import this as well and the button import that and also I'm going to input the Chevrons up down so what is this this is basically a drop down that allows us to see each and every pipeline we have so right now you see the lead cycle in here that's basically what we're building so so now we need to show the popover content so the popover content I'm going to copy this and I'm going to explain it in just a second so follow up with me just follow through with me okay so after the pop over trigger hit enter and paste this in here you don't have to paste it I'm going to explain it so just give me one second I'll import it in just a second and I'll explain it to you hopefully you went ahead and imported everything that you needed to and you will see one error right here which is handle click create Pipeline and we're going to build this in just a second so scroll up top right up here and we're going to say const handle click so let's go ahead and paste that I'm going to copy that and I'm going to go up top here and say this is equal to an async sorry just a an arrow function and we're going to utilize the set open model from here in here so we're going to say set open model we're going to get a custom model the same thing guys and we're going to say create a pipeline we're going to put some subheading heading text use whatever you'd like and now we need to build this form okay so it's also very simple form nothing too complex so uh this actually has only one field so we will be copy pasting this entire form okay so let's copy this first copy this title name go into your forms oh we have to go into components then go into forms and create a create Das pipeline Das form. TSX file and we're going to say um TS and I'm just going to paste that and now I'm going to copy so go into GitHub copy this create pipeline form there's nothing in this form I'm going to explain it it's it's super super simple okay you will see some errors such as the types and queries that's it and we're going to fill that in in just a second okay I see one more error here so we'll fix that so first thing to do is scroll down here to the activity change this to sub ID and then scroll up and we need to create these types I'm going to build that type right now actually just to save us some time so um create pipeline form schema uh go into Libs types scroll to the bottom you can put it in here if you'd like actually I think it's better to put it right in there okay it's fine just keep it in here okay so import z uh from Zod just do this and now that error will be solved and now for so for this one it's basically name so create pipeline form schema Z doob name z. string minimum of one okay and you can have a message if you'd like and then in here the upsert funnel so we need to build this type so the upsert funnel is going to be the following so I'm going to copy this name here and let's go into our queries scroll to the bottom and I'm going to say uh upsert so export const upsert funnel is async function and it takes in three parameters the first one is the subac account ID which is a string and the funnel which is of type z. INF for type of create funnel form schema so where did okay I need to create this one as well so let me go into the types file so go into your types and we're going to just create that right here okay so the create funnel form schema is basically this create funnel form schema equals z. object with the name description subdomain name and favicon okay and it's the same thing copy paste you can put Min one for each of these no problem okay so go ahead pause this video if you need like a quick break pause it and type it out okay awesome I'm trying to speed this up so because we have to build these so many we have to build so many things right so once this is done let's go back and let's import this okay hope we didn't have any errors that's nice so once that's done in here let's also import Z from Zod like this so what we're doing here is we're creating the funnel okay but we're having this extend live product so we're extending it with one um extra object okay so when we pass that in we can get access to these live products and um then we're basically doing something in here okay so then in here we're going to say cons response equal await db. funnel. upsert um where ID is funnel ID where update sorry and we're going to update the funnel or we're going to create a new funnel with everything inside this funnel but the ID is going to be funnel ID or we're going to create a new ID using V4 okay this is basically uu ID and sub account ID is going to be the sub account ID we passed in and let's go ahead and return this so now that will solve one of our problems and then finally we have one more which is the upsert pipeline and I'm going to go ahead go back into queries scroll to the bottom and I'm going to paste this which is basically export const upsert pipeline Prisma just going to import Prisma from Prisma client and you can put this in the types file if you like but it's an async function with a pipeline set to Prisma pipeline unchecked create without Lane input okay so hover over this there you go and you'll see what it's supposed to look like okay nice and then we're going to say const response equal to con response equal to await db. pipeline upsert where the ID is this pipeline ID that was passed in or we're going to create a new one we're going to update the pipeline or we're going to create a new pipeline very very simple okay now let's go back in here and you should not have a single error inside this component now okay if you have errors guys pause this video watch this step by step or and I'm also reading each and every line so you can type as I'm reading and also I'd like your feedback if you guys prefer this method where I'm giving you some copy paste and I'm only explaining the more complex things go ahead and just put it in the comment section and you know let me know all right now that we have completed that form let's go ahead and import it so click on the pipeline info bar and go ahead and import this component from components forms now when you click on the drop down you'll see the create pipeline button which you know of course comes from here when you click on it our form uh shows up on the screen okay and of course it's responsive and all that kind of stuff great job guys now head back into your pipelines so right in here so click on pipelines the page inside the pipeline ID and now we can continue this from here so after the infobar right here you're going to create a div and this div is going to have a tabs trigger inside it which comes from components UI and have the value set to view and class name set to important BG transparent like this and we also want a width -40 and just to help you understand what this is is just the buttons that show different tabs that exist so the first one is pipeline View and then copy this right below and this one is going to have settings as the value and everything stay stays the same and just change this to settings okay okay what seems to be the problem I'm having that issue again just give me one second guys I'll just go ahead and restart uh my server okay so I'm just going to go ahead and remove this class Name by the way I don't like it it's acting a little weird here yeah that is so much better just go ahead and remove that class name all right guys now that we have these triggers after this TBL list we're going to use the tab content and this one has to have the value set to view so what to show so if the trigger was clicked and it the value was view anything in here is what will be shown in here we're going to just say pipeline view for now and we also want to create another content right here and this one is going to be called settings and change this to settings View and now when you click through this you should see it change all right awesome so now we're just going to replace these strings with the actual components so this one is going to be called pipeline view component which we'll import and create as well and the other one actually let's first work on the settings cuz that's a little easier right so we'll just say pipeline settings like this okay and let's go ahead and create this component so open your folder like this go into the components and create pipeline Das um settings. TSX and just return some component in here and I think we can paste that okay nice so this is basically a form okay there's nothing else in here it's a form U that allows us to you know change some stuff okay so um yeah so what we're going to do is we're going to create um the components in here and we're also going to have an alert dialogue okay so again guys this is very very similar to everything that we have done in the past so I'm going to copy and explain in just a second okay all right there we go so I just pasted that in here so the only only thing that is different is the pipeline thing in here which is the delete pipeline query so copy this don't worry I'm going to explain everything okay just give me a second so we're going to go into this queries and we're going to create that uh Delete pipeline query okay so since we have done so many uh queries already I want I want you to take this up as a challenge go ahead pause the video and try to create this very very simple query just to see test just test yourself to see if you actually know um you know what you're what you've been working on so far right so go ahead pause this video create the delete pipeline query and then come right back to this video okay hopefully you did it and you got it right if not this is what you're supposed to do so you're supposed to say export const delete pipeline which is an async function which takes in the pipeline ID and we're simply going to say await db. pipeline. delete where the ID is the pipeline ID that's it okay so let's let's go back here sorry let's go back here and let's import this pipeline uh settings component okay and um also I'm just going to quickly explain what this component is so in here um forget about this alert dialogue so I'm just going to skip through this okay so we're just going to have a form there's nothing else in here guys there's just a form and that form is basically going to um it's just going to allow us to update the pipeline information okay so I see some error here let's see what seems to be the problem well the okay I know what the problem is the problem is we actually did not pass in the values inside this component so let's go ahead and pass in uh all those all those values real quick so first um this is going to have Lanes set to Lanes okay let me go into actually sorry guys this is the wrong thing um okay so what we're going to do in here is we're going to pass in the pipeline ID is going to have pam. pipeline ID the pipelines is going to be all the pipelines that we just captured in here okay and the sub ID is going to be pam. subaccount ID okay so now when you click on this very simple you see the information of that specific pipeline okay looks great so let's also understand what's going on here nothing it's it's just an alert dialogue so we have an alert dialogue trigger and the alert dialogue content so when you hit delete it shows this alert dialogue that's why you have all these complicated things I wish see this is the thing if you're using shat C nuui everything is like an independent piece okay um so that's the reason why it looks so complex but if you're using like Tremor or some other mui you would just use the component U like this it would look like this okay so it's not a drawback really I personally like this because you can customize everything as your as for your liking okay so we just have the alert dialog header which has the title and description okay and the alert dialogue footer which has the cancel button and the alert dialog action button so if the action button is clicked we're just going to go ahead and delete this um you know delete this Pipeline and if not we're going to go ahead and just um you know Skip it this is what the cancel button does and and again uh you can take up a challenge here so here's a challenge go ahead and save the activity log okay so activity log all right go ahead and give this a shot uh take this up as a challenge and build this awesome so now for the pipeline view go ahead and go into your components create a file call it pipeline dvw okay. TSX and just go ahead and turn something in here so I'm just going to say pipeline view like this okay and now to let's just kind of understand what this pipeline view is it's very simple the pipeline view is the con Bond board itself okay that's it nothing nothing complicated okay so we need a lot of information in here so I want you to pay close attention um this is kind of crucial because uh we're going to need this uh we're going to understand this logic here and then we're going to implement it later and then we have a challenge for you at the end okay so just pay close attention to what we're going to be explaining right now so go ahead scroll to the top and change this to a use client component okay and in the props we're going to we're going to need access to Lanes which is uh Lane details and I'm just going to paste the types in here so the lane detail is basically a custom type okay so I'm going to go ahead and create the lane detail just give me one second oh it's already created sorry just import Lane uh Lane details and it's an array of that and then the pipeline details is going to be um a new type so let's go ahead and create this type so head over to your types uh your types file which is inside Libs types okay we're going to scroll to the bottom and we're going to create that type so all that type is is basically export type this one okay this variable Prisma promise return type get pipeline details okay awesome and now if you go back you can import that type all right nice let's also go ahead and import this Lane and import the ticket and I'm just going to explain what it is so we need the pipeline ID sub account ID the pipeline details is everything right with the tags and the tickets and if you don't know what the tags are don't worry we're going to look into that I hope you watch the whole demo I really really recommend if you skip the demo go look at that cuz you really want to be proud of what you're building right so with that demo it's going to help you understand everything that you'll be building and that way you can also you know speak to your employers or your clients and show off you know whatever you've done so now the update Lane order is basically a function here okay and um this one the ticket order is also a function here and it gets access to the lanes which is an array of lanes and the ticket which is an array of tickets so you can kind of change uh change the order basically okay so what we're going to do now now is let's go back into our pipeline ID uh inside this page. TSX and we're going to pass in these props so go in here and we're going to pass in the following so the lanes are going to be equal to Lanes like this the pipeline details is going to be the pipeline details the pipeline ID is pam. pipeline ID sub account ID is going to be pam. sub account ID the update Lane order and this one these two things are basically a new query okay so go into your queries which is right in here okay and scroll to the bottom and we're going to create this update Lane order uh query okay so I also need to import Lane here okay nice so in here we're going to say try uh const update update this okay and transaction and we're going to say lanes. map so for each of them we're going to get the lane and we're going to say db. lane. update where the ID is lane. ID and the data is going to be ordered lane. order okay and um after that here we're going to say oops sorry about that let me quit this what did I do here okay and then here we're just going to say a db. transaction do um sorry and invoke that and pass in your transaction which is this right in here okay and then just do you know we can do a console.log or console.log here as well okay nice and then finally we need one more which is update ticket order so let's go to the bottom here okay and the update ticket order is going to be an async function with the tickets set to a ticket array array of the ticket which comes from Prisma client okay and we're going to do a TR catch we're going to create another uh transaction in here we're going to say tickets. map ticket where db. tick. update where the ID is the ticket ID and the data has the order set to the ticket order and the lane ID set to the ticket Lane ID okay nice and here we can just go ahead and say db. transaction and we can invoke that and pass in our transaction and here we can just say done reordered and you can also put the error uh print the error in the console okay now if we go in here we need to import this so go ahead and import both of these okay I went ahead and imported and we also need to import this component I forgot to do that so let me go ahead and import that component as well nice now we don't have any errors so let's go back in here and now we can go ahead and build out the component so the first thing we're going to do is we're going to uh get the modal okay so we're going to say set open and equal to use modal we're also going to get router so I'm going to say cons router equal use router and let's import use router from next navigation and then we're going to need a user actually we're going to create another state guys and this state is going to be called all Lanes okay and go ahead and import U State and Lane details so this UST state is basically going to have all the lane details and you can see here it's the lane details and its tickets with the tags okay all lanes and set Lanes in here and then finally we're going to create a use effect and this use effect is going to uh let me use effect like this okay and in the dependency array you're going to pass in the lanes okay and let's see what happened here okay that's because okay we did not import everything so I'm just going to go ahead and uh extract uh destructure all of our props and now we're can we can say Lanes in here okay so in the lanes updates we're going to set all Lanes to be the lanes like this okay nice so what this is doing is just setting the um when it loads it's just setting all those Lanes in there and the next thing is we're going to um scroll to the bottom here okay and we're going to render out some some stuff in here okay so to make this whole con Bon board possible we are going to use the help of um react beautiful DND okay so go ahead open your terminal I'm just going to quit this server like this I'm going to say bun add react D beautiful I don't know why I said beautiful like that that's that felt weird B oh I I spelled that incorrect sorry guys one second let me just copy this so I don't make any unnecessary errors okay so bun add uh react beautiful DND and just go ahead and enter and that should install the package for you okay awesome and now we can actually use this to create you know our drag and drop functionality so in here remove this and you're going to say drag um drop okay so it's not importing um let me go ahead and import that from up top so go up top here and import this let's see what's going on okay so I think it needs the types so what I'm going to do is I'm also going to import these types from here okay uh okay so go ahead and say bun add and paste that and it should import the type for you and now this should not throw an error anymore okay nice so if you scroll here you can now enter that drag and drop context so say drag drop context like this okay and this is going to need an onag end so the on drag end is going to have um our a function that we're going to create right here so this is a really big function so just pass in a regular a normal function for now and then we'll come to this in a second okay so for the draag do drag uh drop context it also needs some children so create a div with a class name and set the class name equal to the F so it's going to have BG D white by 60 dark BG Das Background by 6 60 rounded XEL P4 use automation zoom in so this is going to be a special um CSS animation that I created and if you have copied and pasted the CSS file you will have it in there you can just take a look it's very very simple okay and inside here we're going to create another div and this div is going to have the following class names it's going to have um let me say class name equal Flex item Center justify between okay and then we're going to create an H1 tag with a CL class name of text to Excel and we're going to pass in the pipeline details name okay and let me see what's happening here let's go ahead and import this gu so let's come in here I have it in here what seems to be the problem do I have to okay that's because we didn't say bun that's why Bun Run Dev and let's refresh the server nice now it works so let's go back into that component and let's continue so after the pipeline uh after the pipeline name we're going to create a button here okay and I'm going to import this button real quick right here and this is going to have another uh function okay so this function is basically going to be built here we're going to say const uh handle add Lane which is an async function um and we're actually this does not have to be an async function we're just going to say custom model and create Lane form which does not exist so we will have to build this in just a second um so let me see if we can we might be okay yeah let's just go and build it guys it's easier to build this way right so copy this go into your forms right in here into components forms and create uh a form called L uh Lane form. TSX and just return a component in here and I'm just going to paste that okay I don't like this being called create Lane form I think it's better if it's just Lane form and I will also change this component from here to Lane form and I'm just going to go ahead and import the um the lane form from there so we can use it that in here okay so this needs access to the pipeline ID so I'm going to go into this component and now we're going to build this now again this is very similar to everything that we built before I'm going to copy it and I'm going to paste it in here and I'm also going to change this one to Lane form just give me one second guys okay so here's what you're going to do you're going to paste it okay I don't want you to get stuck so just copy what I'm doing so you see the name of the component right now has to be Lane form so I'm going to change that change this to Lane Lane form okay and we have a type in here so I'm going to copy this type called create Lane form and I'm just going to change that to Lane form schema and we're going to go into Libs type okay now we can build out that type in here so just scroll to the bottom and I'm going to paste this here which is export const Lane form schema okay which is z. object name z. string minimum of one and now that should solve that problem for us and then we have a new uh action a new query in here so it's called upsert Lane so let's go ahead and build that uh function as well so click on the libs query and if you don't know how to do that guys here hold command on Mac and click Libs queries okay it's going to take you to that file so at the bottom I'm just going to say export const upsert Lane which is an async function the lane is going to be Prisma Lane unchecked create input okay and in here we're going to say let order is a number if Lane um if there's no lane. order then Lane equal await db. lane. find many where pipeline ID is of type Lane uh pipeline ID is lane. pipeline ID and then we're going to say order equal lanes. length okay and if you don't know why we're doing this we're basically creating one create getting the first order for that lane okay the first number and that should be the length so if it's zero it's going to be zero or we're going to do the same thing in here okay we're going to say lane. order so whatever was passed in here and then we're just going to say db. lane. upsert where the ID is lane. ID or create a new Lane uh and then we're going to update that lane or we're going to create that lane so depending on what we want to do that's why we're using upsert in here so let's go back to our form and let's okay so now if you scroll here to 51 you're going to see this so I'm going to change this occurrence across the entire file okay so this occurrence will no longer happen will no longer have this error so I'm just changing it to Lane form schema and that's going to solve that problem and then I have something here here change this to sub account ID and that should fix that now let's go back to our pipeline View and we have the plus icon here so I'm going to go ahead and import plus icon from Lucid react and now I can actually create a lane so there you go so if I create a lane it's showing Lane details and you just go ahead and put in the stuff and that's about it so let's look at this Lane form as well uh just really quick to understand what's going on nothing it's the same thing as the um as the pipeline as well okay so we have a card card header card content which has a form and that form has one form field in here and that form field has a form item with the form label set to Lane name and the control here with an input inside it called name okay you can change this to Lane name if You' like no problem and finally the button is going to have a disabled setu is loading and is loading basically comes from form. form state. is loading I know I hope you recollect us doing this before and then type is going to be submit and then form. form state is submitting if it's submitting we're going to have the loading um you know component or we're going to we're going to say save so now you can save it like that okay that's about it now if you go back let's go ahead and close this here okay and um give me one second okay and after this button guys you have a div here right so hit enter and we're going to create a droppable so this droppable right here so say droppable and this droppable uh is going to have the following props okay so it's going to have the droppable ID set to Lanes the type is going to be Lane uh direction is going to be horizontal and key is going to be called Lanes okay and it's going to say children is not a function because how react drag and drop works is you have to pass in a function in here um so let me put this curly bracket and in here we're going to say uh create a function and for this function we're going to return something so in here we're going to get access to provided okay like this and inside this we're going to return a div and this div is going to have the following class name so class name equal to flex item Center Gap X of two and over scroll overflow of scroll okay and inside this you have to also use a spread operator and pass pass the provided. droppable props and we want to say ref equal to provided do inner ref like this okay and inside this we're just going to create a div so say div with a class name of flex and margin top of four okay and inside this we're going to create all lanes. map for each of this we're going to get access to the Lane here so I'm just going to say Lane and we'll also get the index and let's create a pipeline Lane component like this okay we of course haven't created this yet so we'll just come to this in a second um I don't know why we have this in here guys oh that's because we have this curly bracket so remove the curly bracket and that should return that component and after this curly bracket here we're going to create another one and say provided. placeholder like this okay nice now this pipeline Lane is going to be another component so let's go ahead and build out that component okay so go into open open your directory and in here create a pipeline dlan component. TSX and uh please guys just follow with me okay don't forget keep following with me you're going to you're going to see what this looks like looks like in just a second okay and I'm going to copy this so go into the GitHub copy this entire component paste it in here we're going to go step by step across this entire component and understand how this works okay we're going to have a lot of Errors just bear with me I'm going to you know walk you through this so the first one is let's finish let's just import everything okay so follow just follow with me so first we need the delete Lane so go into the queries file okay and this uh just scroll to the bottom all the way there wow we have like 700 queries that's a lot so yeah and we're just going to say const delete Lane equal async function with the lane ID which say string and we're going to say con response is aait db. lane. delete where the ID is a lane ID okay we're just going to return this so that's done nice you wouldn't have that problem again now ticket with tags what is this this is another um this is another type that we're going to import so go into your Libs type scroll to the bottom and we're going to say this right here and now we need to create this function okay we need to create this um this type uh sorry this query so so tickets with tag is Prisma promise return type type of this specific query so go into your queries file okay and I'm going to scroll to the bot scroll to the bottom and I'm just going to say const get tickets with tag equal pipeline async function with the pipeline ID is a string we're going to say db. tickets. find many because there are many tickets in a pipeline okay where the lane is pipeline ID okay where the lane and for that lane the pipeline ID is equal to the pipeline ID okay and we're going to include the tags assigned to and customer now let me explain what our tags if you guys are kind of confused so when we're creating tickets we can actually create custom tags and assign those tags to each ticket that's what these tags simply are okay it looks nicer and it has more meaning so go back into your types file and sorry it brings more meaning to the ticket so go ahead and import that that query now and let's go back and see what other uh things we need to import real quick so okay pipeline ticket that's one more thing which is another component and what else do we have up top we have the custom model so this looks like an issue so custom model where is a custom model custom model has been imported but it's saying cannot find let me do that one more time so I'm just going to import custom model by you know manually okay and that looked like it solved the problem I think it was just oh maybe our name was different okay and let's remove this ticket form and um where is the ticket form this ticket form needs to be created so copy this ticket form okay and you're going to go into your forms right in here I hope you're following through with me okay just pause this video if you're getting stuck all right but follow up with me okay so go in here and say ticket D form. TSX and just return a component like this and inside this component U we are going to have a bunch of stuff okay so what we're going to have is we need the tags we need any we need the contact our search results when we are searching for the tags we need contact list right because we need to assign some contacts we also have an assigned to which mean we can which means we can assign a tag to a team member and so there's a bunch of stuff in here okay so just play uh pay close attention we're going to work through all of this and I'm going to build this entire component from scratch um only some things like the input field I'm not going to waste your time I'll copy that and you will just have to follow through me and you'll understand what I'm doing okay so go up top here and we're going to say use client and first I'm going to import the ticket form from that other component so go ahead and import that and now in here we're going to have the following props so we're going to have Lane ID okay in here which is a string suban ID which is a string and get new ticket which is going to be ticket with tags uh the first one so that's just a ticket in here okay and now in here we're going to uh also extract these so okay extract those props and in here we're going to create a couple States so first let's also use the model so I'm going to import this okay I'm going to say default data from uh from this data we're going to say use model and then we also need the tags so what I'm going to do here guys is I'm going to create um a state called Tags with set tags and it's a use State and it's going to have a type of tag which is an array array of array of tags sorry okay and then we're going to have the contact because a ticket can be assigned to one contact only uh contact and set contact like this and then we're going to have search and this is what we're searching for searching for tags for example so search set search and now the contact list so let's say we're searching for contacts we want to show that contact right we want to show that contact along with other similar contacts with that name so that's why we're going to create this list so in here say uh const contact list equal set contact list equal U States and I'm going to import this contact from from uh Prisma client and then finally uh actually not finally there's a lot more so we're going to have assign to and set assign to with UST State default data is uh default data. ticket so why do we not see this well the reason is because we haven't created this inside our provider so let's go to our provider file which is inside our components um right here where is that providers and let's go into modal provider okay right in here and now we need to um update that in here so you see this right after agency hit enter and you want to say ticket okay like this and this ticket is going to be of type ticket details uh ticket give me one second okay we need to probably create this oh I don't think we have to create this do we huh maybe we have to create it never mind well we'll do that no problem so create uh we need to create this ticket details and we're just going to get the first one okay so let's uh copy this and we want to go into our types which is uh in here so go into your types file and uh we're going to create the following okay so down here we're going to say ticket details equal to Prisma to promise return type type of get ticket with all relations now this is a function we're not supposed to ever create so uh not supposed to use so it has an underscore so right above this you can put it in here or you can put it in the queries file so in the queries file just uh we're going to say this we're going to say export const uncore get tickets with all relations which is an async function with a lane ID set to a string and we're going to say await db. ticket. find many where the lane ID is the lane ID and it includes assigned customer Lane and and the tags okay I'm going to return this so I'm going to go back to that type file and import this um uh this query as well okay and now let's go back to our modal provider and let's import that ticket details so now inside our create pipeline uh create sorry sorry create the ticket form we will not see that error anymore because it exists on our modal provider okay now after this we're going to create one more thing called save timer ref and if you guys remember from that insane Amazing Project we built last time we use this which is to debounce the uh user's input okay so as you're searching we want to debounce the user's input and send it to the database to fetch information so that's why we need this save Tim ref okay awesome so you've created a bunch of States going to move this up here so it looks a little more organized nice now we're going to create a use effect okay so this use effect in here is going to say uh let me also import this like that and get subcount T members we have to create that and set all team members as well so what is this looks like something is wrong here okay we need to create that it's one more state so after this just go ahead just go ahead and say uh all team members and set all team members equal to um type user an array of users and now what is this use effect so when this component loads we're basically going to get the sub account team members so all team members that are are you know sub users all right and that's it nothing else we're just going to get that and we're going to save that information here so that when the user is creating a ticket and wants to assign that to a sub account to one of the team members they can access that from you know this list okay U so click on this and we're going to go ahead and build this out so let's go to our queries file okay and um I'm just going to copy and paste so just follow this with me so we're going to say export const get sub team members equal async sub ID which is a string and we're going to say const sub users with access equal to await db. user. find many okay where the agency and its sub accounts where some of them have the ID of the type sub account ID in here and the role is sub user and we're going to get their permissions as well okay I hope this makes sense and let's go back into our ticket form and let's import this function right in here okay awesome and now let's proceed so after this use effect we can um I think we have a bunch of other stuff might as well do that right yeah let's let's just build it as we go so we're going to get set close as well which comes from use modal scroll up top and say set close like this and we also need router so I'm going to say const router equal use router from next navigation and now we're going to uh scroll down here and since this is use form I'm actually going to put it up here okay after yeah right here so I'm going to say our less just put it yeah let's put it right uh below the router okay so const form equal use form and it's going to be a function like this it's a hook actually let's import that hook and we're going to pass in a type here so this type for this is going to be z. import ticket form schema uh we need to create this ticket form schema don't we okay yeah we do have to so go into types and um in here we're going to say ticket form schema so uh the ticket form schema is going to be Z doob uh z. string for the name right z. string minimum of one and description is z. string optional with the value said to z. string refine the value where the currency number reg x. text uh. test for that specific value and the value must be a um a valid price so this is a helper function that we're just going to build up top it's I mean it's not a it's not a function sorry it's just a regular expression test and this is what it is okay so copy this from the GitHub okay don't mess this up and this basically uh tells if a value is a um a value is a valid price okay nice and now let's go back into our component and let's import that ticket form schema okay nice and now we're going to have another use effect and what is this use effect going to do so let's look at that so this use effect is going to check if default default data. ticket exists if it does then we're going to set that information so if we ever wanted to update a ticket if we click on the ticket right basically we're going to uh we're going to populate that uh we're going to pass in that function right and that's how we have the data stored inside our model right our model provider so that's how we're getting it from there we're going to say default ticket. ticket do default data. tick. name description default data. tick. description and same thing here for the value and um if the default ticket. customer ID so this is some stripe related stuff we're going to set the contact set contact to default data. tick. customerid okay and then in here we're going to say cons fetch data equal async um const response equal await search contacts so this is another query that we have to create so go back into your queries file I'm just going to click one of these so it takes me in there okay and we're going to say export cons search contacts equal async Search terms okay which is the string that you're searching for right like that which is a string we're going to check db. contact find many where the name contains the search term okay and let's go back in here let's import this right here okay nice okay no error and I had this typescript ignore okay this typ typescript ignore um has to be here because it's just throwing some errors so just just put this in here okay nice and um so yeah so first we're going to fetch the data we're going to search for the contacts when the default data updates okay and then we're just going to get all of those contacts and we're going to save it in here uh and then uh y that's pretty much about it okay and then we're going to set the contact list to that response nice and now let's Al extract is loading so I'm going to go up top where we have our form oh guys it looks like we haven't completed that form stuff yet so sorry about that let's go back and let's finish that okay so const form form is going to be equal to use form here let's move this let's move this stuff to the bottom okay right below all this so default values Zod resolve okay it just needs Zod resolver so use form z. infer type of ticket form schema the mode is on change the resolver here is Zod resolver with the ticket form schema and the default values is going to be name uh this here or this um description is from uh this one or empty and the value is going to be uh this one one or zero okay cool and uh that that's how we can also extract is loading right here okay nice and now what we're going to do is after the is loading we're going to create our onsubmit function and onsubmit is also pretty simple so I'm just going to copy this paste it in here and let's take a look at this onsubmit so onsubmit is an async function which has values z. in for type of ticket form schema and uh we have oops sorry about that and if there is no Lane ID we want to return okay so if there's no no Lane ID return but if it does uh then we're going to upsert ticket which we have to create so let's go into our schema file again where is that uh search contact let me go from here okay nice and we're going to go ahead and upsert that ticket so I'm going to paste this in here go ahead and build this out with me okay so first import this tag from Prisma client and in here we're going to say upser ticket is an async function that takes the ticket which is Prisma do ticket. unchecked create input okay and the tags is going to be an array of tag we're going to say let order number like this and then if that there's no ticket order we're going to create the order like this okay and same thing here too we're going to create that ticket order or we're going we're going to create that ticket order with the length or we're going to set the ticket order to this right here okay and then after that we're just going to say db. tick. upsert where this ID is equal to ticket ID or new a new ID and if it if it does exist right we're going to update it with this information and the tags we're going to set the tags to uh these tags or we're going to create it and we're going to connect the tags with that with the with the tags that we're sent in okay we're going to pass in the order as well and we're going to include assigned customer tags and Lane and we're just going to return this response right in here and let's go back and let's import this upser ticket now okay nice no errors the screen just flickered I don't know why but okay no errors there and now we have the save activity so um you guys know about this so import that and change the sub account ID like this okay nice and then finally the toast so to do toast I'm just going to import it from UI use toast okay and that solves that problem so you guys are seeing a pattern here right there's nothing different it's literally the same thing on and on so let me go ahead and refresh this guys I'm seeing this problem one more time uh Bun Run Dev all right just give me one second all right all right now now is a good time to go ahead and pause this ticket form because we just needed it only to show um these components okay so go ahead pause the ticket form that we were creating go back into the view and we need to import some stuff and kind of first figure out the lanes and then we'll figure out the uh the tickets okay so go into your form View and in here so this is um sorry not form view it's pipeline View and we're going to pass in the following props okay so the props are all tickets equal all tickets okay so go up top right here okay and we're going to create uh some values in here okay so create this const ticket from all Lanes equal ticket and tags go ahead and import that it's an array of this and that's equal to an empty array okay and then we're going to say lanes. for each items. ticket. for each so for each of these tickets we're going to say a ticket form lanes. push okay and if you're wondering how you can do this it's const you can do that it's fine and after that we're going to create another state in here and this state is going to be called all tickets is equal to um the you state with tickets from all Lanes okay we're just going to pass that state in here and then what we're going to do is we're going to create some um some stuff in here just give me one second okay so what I meant was after this so just scroll to the bottom okay and after this droppable component in here we're going to say all lanes. length equal to zero then we're going to just return a div like this and this div is going to have the following class name it's going to say Flex item Center justify uh center with full and flex column okay in here create another div like this and give this the following class name we're going to say opacity and set this to 100 and in here create a flag and this flag comes from Lucid react and we're going to say width is 100% and height is 100% as well and that's it so that's it for this and you can see looks great right you can also make that um you can change the color if You' like so say class name text- muted D foreground so it looks a little subtle all right much better okay nice and now we're going to go ahead and import this first and we need to also change a couple things so here it's asking for the pipeline ticket and uh we did not create the pipeline ticket yet right so that's why we're having that error so we will solve that error in just a second first let's go down here and remove this and we're going to just say sub account ID so sub ID and then uh we also need to solve this eror here so where is this being used it's being used in here so I'm just going to return a div and set the key equal to ticket. idid okay just for now and let's go up and just hide this here and let's create a work in progress flag and we're going to say um wire up tickets and now if we go back we should not have any errors here awesome so if we create a lane we should see that lane in here let me just cross check give me one second okay so it looks good but I think I may not have explained this area so I'm going to just go ahead and quickly look through this pipeline Lane so basically we're going to have these props we need these props set all tickets um and then we need all tickets and this is a dispatch set State action and then we're going to get the tickets with tags and then we're going to get pipeline ID Lane details sub account ID and index okay and in here we're going to get this set open and the router and we're going to create this amount to basically kind of U use this to format the currency and we're going to say new um inl number format undefined and we're going to pass it an object with the configuration set to style currency and currency is USD and then the lane amount is going to be uh use memo okay and the reason why we're doing this is every time the tickets change only then are we going to create the lane amount so we're going to get and recalculate our lane amount and that's why we need this so we can cash that okay we can memorize it that's the right vocabulary to use there terminology sorry so we're going to say tickets. reduce the sum and the ticket and we're going to say sum plus number we're converting the ticket. value to a number or we're just setting it to zero and then I also did this really fun thing here I just create a random color using this hashtag and basically creating this back tick here and we're going to say math. random. twoing 16. slice 2 to8 and here I'm going to say add new ticket so this is a function here and this is going to basically just get access to the ticket with the tags and we're just going to set that to this ticket so if we're adding a new ticket then we can use this okay but that's not important right now I just want to show you the lane stuff but I just wanted to read through that and then we have a handle delete and we have a handle edit Lane okay so this form as you know we created this Lane form this Lane form right here this Lane form basically has also the default values right the default data that we can pass in so that's what we're using there uh to update if we need to and then delete very straightforward we're just creating a delete Lane function that will basically delete for that lane ID and we pass in this description which is delete Lane and the sub account ID and then refreshing it and nothing else just console. login and error and here what we're doing is we're creating a dragable and this draggable is supposed to have a draggable ID okay so we're going to say draggable ID equal Lane details ID do2 string and then we're passing in the index and we're passing in the key okay just follow through guys it's going to all sum up okay and then we're going to also uh pass in this provided so this is a function for a draggable component pass in a function like this and what you're going to return here is just put the curly bracket and inside the curly bracket you're going to say if snapshot. is dragging just use this typescript ignore we're going to say const offset equal to an object with X and Y AIS X set to 300 and Y set to zero and then again typescript ignore e const x equal provided. draggable props do style. left minus offset X and now you may ask why are you doing this the reason why I had to do this is because react drag and drop has this weird thing where when you have an absolute container it's using fixed by default so because it's using fixed by default when you drag the element it snaps to some other location in the page so I had to manually push it around and make it work so that's what I did here so just follow through and this should work if it's not working tweak this number a little bit until it looks perfect okay and then const y equ could provide a dragable props dostyle dotop minus offset Y and then again the same thing here and we're going to say provided. draggable props do style is equal to an object with everything except you know the style here but top Y and left y then in here we're basically saying creating a div with you know this provided draggable props and we're passing in a ref with the provided inner ref and class name is height full and then in here we're passing an alert dialogue so all this is basically like redundant like not redundant but this is not really complex this part okay this is just a component that has a drop down with a delete icon edit icon and a create ticket icon and that comes when you click the more icon right so you can see all those things but anyway let's go up here and we're going to just create a drop- down menu just wrap this inside a dropdown menu provider and the alert dialog provider create a div here with the following class name okay you guys can see here pause the screen and type this out and then we're going to create another div in here and pass in all the dragable props okay and then that's going to have a class name of this one pause the screen and type it and then here we're going to have a div with a class name of height full Flex item Center padding four justify between cursor grab and a border Das bottom of one pixel and then we're going to say Flex items center with full Gap inside this div and this one is going to be another div with the random color so you can think about this as the lane uh header it's like a top section of the lane okay and I'm going to see what it looks like in real time just give me one second and then finally we're going to have the the drop down menu trigger okay also we're going to have a badge here with the amount. format the lane amount so whatever we created where's that oh right in here using that Ed memo that's what we're passing in there okay and then we have the trigger right here and we're going to have a droppable component so that we can drop that lane okay that's going to have the droppable ID key and the type is ticket and then we're going to pass in a function here same thing provided and in here we're supposed to pass in those tickets okay so this section is pretty much doesn't apply to us yet so you can com comment it out if you want or you can you know just keep it there no problem and then the drop- down menu context is just the option with the separator and it has the alert dialogue trigger so when you click on this menu item it's going to show the delete alert dialogue and then we're going to have an edit which um you know does the handle edit Lane which basically sets a custom model and then finally we're going to have the create ticket okay which will show the same ticket form for creating okay and then finally the alert dialogue content so what do you want to see in side and you guys can pause this video and just type this out or copy paste it as well both are good so let's go ahead and see how this looks okay so let's create a lane and we're going to say lead start no what's good what's a good name here I think something like interested right and let's just say save okay so something happened wrong just give me one second okay I think this is the weird error just give me one second guys okay cool sorry about that let's go ahead and click on the create Lane so let's just say lead and just hit save there there we go now we have a Lane right here and now you can drag this right but it's not going to do anything of course because there's nothing there we also don't have the on drag setup okay so yeah the tickets are going to be in here so we're almost there let's go ahead and create more Lanes to make sure our styling is um good too so let's create another Lane so new lead okay engaged and now if you want to change this you can hit edit it's going to show this and now you can remove this and you can change it to something like a we payment and hit save there you go and that updates and you see this won't work because um we don't have that on drag end setup Okay cool so looks great already and go ahead and create some more if you want to just you know make it look nice we're going to proceed with the other sections now okay all right now we can go ahead and proceed with the uh pipeline tickets okay so you want to scroll up here um let's see where did we leave out on that stuff ticket right here I think this is where we left it right yep so we're supposed to pass in a pipeline ticket here and we already created Created our pipeline um add handle create ticket function right here okay so we know what this looks like it's I mean we we know we kind of built this a little bit right so we have to proceed with that but I'm trying to see if I can also render out a pipeline ticket before that so you guys can actually build that first so okay let's let's try that so I'm just going to pass in the pipeline ticket right in here and um we need to also create this components I'm just going to copy this go in here and inside the components I'm going to say pipeline Das ticket. TSX and let's just return something in here and quickly paste that and now if you go in here you can actually import this component so there we go awesome and now what's what's the matter here okay so the problem is because we didn't I totally forgot we didn't even do anything in here right so let's just go ahead and build this out so we can see what it looks like so let's go to the bottom um right here and we're going to do the following so let's remove this and we're going to create this div and this div is going to have uh that Pro um that provided stuff okay actually first we need to create a droppable draggable sorry so since this ticket is draggable let's go ahead and create a draggable like this and we want to say draggable ID is going to be equal to ticket. ID do2 string okay and we don't have this yet so hm let me think if we don't okay so we will have to actually pass this in here so what we're going to do is I'm going to get the props from here which is set all tickets which is dispatch like this and set a state action going to import that as well and ticket with tags okay so um that's the first one and then the ticket is the tickets with tags sub ID which is a string all tickets which is tickets with uh the tags and then we have um Index right here and a number okay and I'm just going to go ahead and and import this okay awesome and I think that's it and in here we're going to also uh put in some stuff inside this draggable component okay so inside the draggable component go ahead and hit enter here and we're going to create a function so the function looks like this and this function is going to give us access to the provided and the snapshot like that and inside here we're going to say if provided so if oh sorry if snapshot is dragging so if it is dragging then we're going to do that offset thing that we did okay so const offset equal to an object with X at 300 and Y at 20 and then we're going to use this typescript ignore forget this error guys it's going to here let me just solve this error real quick return a div okay so and in here what seems to be the issue here okay we need to pass in the index so we're going to say index equal to index okay and um then we want to say const y equal provided draggable props do style. toop minus the offset Y and then we're going to just create the object here okay and in here we're going to return a div and this div is going to have the following so we're F first we're going to say um uh provided so use a spread operator and we're going to say provided. dragable props and then in here create another uh spread operator we're going to say provided. handle drag uh props okay uh drag handle props okay and then the ref is going to say provided doin ref all right and in here we're going to say alert alert dialogue which comes from components uh components UI and this is basically the provider right and then we also need the drop-down menu this is another provider and then we're going to do uh the following so this is going to be a card so I'm going to go ahead and create the card component and it's going to have the following class names so you're going to say margin uh margin y of four dark of BG slate -900 um and then you want to say BG Shadow none and then transition all okay is this wrap okay it does wrap why is it stuck there I don't know all right and inside this we're going to have the um the card header so the card header is going to also have title in description so in here go ahead and say card uh header like this and card header is going to have a class name of um class name of padding of 12 pixels like this and inside this we're going to use the card title component and the card title is going to have a class name of flex items D Center justify between okay and inside the card title we're going to have a span with a class name of text- LG and with- full and we're going to say um ticket. name okay so it's going to be the name of the ticket and um it's kind of like the header how do I explain it um like the top section right and inside this we're going to have that more horizontal icon so we're going to say drop down uh wait give me a second yeah drop down menu trigger okay menu trigger and this is going to have a actually no class name on this and inside this we're going to have the more horizontal icon okay and it's going to have the class name text- muted D foreground like that and um I'm also going to close this component here use it as okay yeah that's so much better and now after this um trigger after the card um yeah after the trigger we're going to actually close H let me think real quick sorry guys this drop down trigger has to go inside this title yes it has to go inside the title so just put it in there okay so after the span go ahead and put that drop- down trigger inside that what is this error span does not exist what do you mean span does not exist oh typescript is so weird sometimes what give me a second guys let me see what's going on here okay it was just typescript anyway so yeah and after the C title go ahead and create another span so hit uh just say span like this and give it a class name of text- muted D foreground and inside actually let's also say text- Xs and this one is going to be uh the date so we're going to say new date in here so new date uh in so new date invoke it.2 local dat string and invoke that as well okay and then after this go ahead and create a div so after this span create a div with flex items Center Flex wrap Gap 2 and tickets so we're going to map over the tags and then we're going to um say tags. map and we're going to show h tag component so what tag was uh was used okay and um the tag component is going to be something that you actually have to copy because it's just just Styles okay so let's go into the pipelines in here and actually this is a global component so I'm going to go into components go into Global and I'm going to create the tag. TSX okay and in here we're going to say uh typescript rafc and I'm just going to paste uh tag component like this okay and um this one actually here yeah I'm just going to copy paste from GitHub U so don't forget to copy paste okay and the tag collector uh tag color comes from this right here actually we don't need this so I'm just going to remove this sorry guys this is not needed so just remove that and we're just going to render this component so just to explain what this component is it takes in a title the color name and the selected color so this is a function that gives us the selected color okay and U basically what we're going to do is we're going to say um return a div and this div is going to have the following Styles so we're using clsx here and these are just standard so P padding two rounded small um Flex shrink zero text small excess sorry and the C cursor is going to be pointer and then in here uh we're going to uh sorry we're going to say um BG so and we're going to put this hex code so go ahead pause and type all this or copy from GitHub okay and we're going to say text Dash and uh this one one so the text is going to be this color and the background is going to be this color okay and that's true only when the color name is of type blue and then the same thing for this it's like a like a peach color I guess and a salmon color I guess and you can put this in here the text as well and the color is going to be orange all right and for row we're going to use this and text this with rose this so same thing all right and also we're going to add a border and the border is going to be um right here okay so this one's going to be dimmer and the border is going to be super bright and then we're going to say blue and no title so if there's um yeah so if this one this one and this one so if this is true right then do this it's it's Turner operator okay and same thing in here as well and then the key is going to be the color name we don't actually need this key do we hm we don't need this key all right I'm not sure why I put this key in here why do I put a key in here okay sorry guys and we're going to have onclick or let's just put it I don't know if it maybe okay if it's not wired up it's fine okay we'll remove it later and then onclick right here so if we have passed a a function then we're going to get the selected color so why do we need this so basically um when we are using those tags right we want to just use the same element for kind of like a color swatch like we're going to show color swatches like this and the user can click on the color swatch and then we'll get access to that color that they selected and then we can create a tag with that color okay really cool feature so and then yeah we're just going to pass in the tile in here so if there's no title it's just going to show a box like this and if there is a title it'll look like this thing right here you see something like this okay nice and now let's go back into our component right in here and let's import this tag component right in here okay and now after this div go ahead and say card description with a class name of width full okay and I'm just going to import that as well and it's going to say title. description in here okay and now we're going to use something called a hover card and if you don't I don't know what that looks like it's a newer component I think or maybe I'm wrong let me see um okay hover okay it's not a newer component it just looks really cool it just shows more information like this so we're going to use this component to show the contact information okay so after this card description go ahead and say hover card okay like this and in here we're going to say hover card trigger and we're going to set this to as child okay and inside this trigger we're going to pass an a div like this with padding to text muted foreground Flex Gap 2 hover BG muted transition all rounded large cursor pointer and item Center and this is going to have a link icon so let me go ahead and say link icon like that nice and then a span with the contact okay and after that we're going to have the hover card content so after the trigger say hover card content okay and we're going to say side equal right and the class name is going to to be with- fit okay and inside this we're going to do the following so I'm just going to copy this and paste it right in here okay nice and what this is is it's just a div okay so I just copied this div with flex justify between space x-4 space X that's cool and inside that we're going to have the Avatar going to import this Avatar image the Avatar fallback okay um did this even import it did import it's just taking time uh the Avatar fall back fallback and this is going to say ticket. customer. name slice so the first two characters and we're going to set that to uppercase and then we're going to get a div in here we're I mean we're going to create a div in here with space y of one H4 is going to say text SM font semibold ticket. customer. name and then we're going to have a paragraph in here okay with the with the customer's email with the text set to muted foreground and small okay and then we're going to have the contact 2 so I'm just going to import this from Lucid react and I'm just going to give it the styling so pause this and type it if you want or copy paste from GitHub and then we're going to say span text SS XS text- muted D foreground joined like this and then we're going to put this basically when they uh when they join so ticket. customer. created at. loal string okay that's it and um let me think what else we have so after this header we're going to say card footer okay let me make sure I imported this card footer from the right okay from the correct folder all right everything looks good let's let's go back to the Bottom now and this card footer is going to have the following uh class names so we're going to say margin zero padding two border top of one pixel border muted foreground 20 Flex item Center and justify between and inside the card footer we're going to have a div okay so I'm going to go ahead and copy this too um give me one second and we're going to say div class name Flex item Center Gap two and inside that we're creating an avatar the same thing okay and the Avatar image is going to be the ticket. ticket. assigned Avatar URL so the the basically the sub account user that was assigned to this ticket okay and the fallback is either going to be the um assigned name okay assigned. name or it's going to be if nothing assigned. user ID does not exist then we're going to just use this icon okay we're going to set uh this size to 14 and the BG is primary and text is white okay cool and then in here we're just going to say um who they're assigned to so div Flex Flex column justify Center span text XS sorry text SM texted D muted D foreground and we're going to say ticket. assigned user ID with the assigned to or not assigned okay and then ticket. assigned user ID if that exists again we're going to return a span with a ticket. assigned name and that's just going to have the following styling okay so just go ahead and do that and then after um this div so we have a div right here so after that there's one more div here hit enter and create a span and we want to say text SM font bold and if there's no ticket. value okay so I mean not no ticket we're creating we're converting this into a Boolean okay so ticket. valal and why are we doing this sometimes the value can be zero and if you did this right it's going to actually so show show zero if you did something like this so that's why I have to convert it to Boolean and we're going to say and we're going to convert that number using that number formatter so you're going to say new inl number formatter undefined with style currency and currencyusd do format uh plus ticket. value this actually is a trick to convert something to a number okay and um that will actually convert that and then after the um after the card footer we're going to also have the drop- down content so after this go ahead and create the drop- down content I'm just going to go ahead and import all of these okay hopefully you went ahead and imported all these uh components and now the handleclick edit I'm just going to go up top and I'm going to create that function so let's go up top right in here and um inside this so where is that inside H okay we can go completely outside this that's fine so in here I'm just going to say custom modal ticket form and we're going to also need the set um sorry what is this the set open so I'm going to go ahead and import set open and we also need router so let's go ahead and import these two so use router from use navigation and use modal nice and that's going to be set up there and now we have the ticket form and the get new ticket is going to have the edit uh new ticket function so let's go ahead and pass that to okay so this edit new ticket is basically a function that gets the tickets with the tags okay at zero so just one ticket basically it looks like this okay and then we're going to set all the tickets to um all tickets. map so if if t. ID is equal to ticket. ID then we're going to return the ticket if not we're going to return TT okay all right and um so that's how we can edit that so why is this not imported oh sorry guys I put this inside the handle click edit so I'm going to remove this and I'm going to put this up top all right sorry about that and um yeah that should fix this problem edit new ticket even the edit new ticket let's let's remove this out out of this uh function right in here and that should solve that problem too okay much better and now let's scroll back to the bottom and that should solve our handle click edit um error that we had um right here okay and now we need um a couple more things so now that we finish this we need the just bear with me guys I know this is a bunch of redundant stuff but it's going to be super super impressive if anyone's in fact I actually submitted something very similar to this to you know um a big project in the past and I got the job so it's going to work for you if you do this too okay so yeah go ahead and um just do what I'm doing and this is going to be one of the best projects you have ever seen and you will ever have on your resume so we're going to create an alert dialogue here so I'm going to say alert dialogue content and just go ahead and um just import this so just copy this from the GitHub or just pause the screen and type it and I'm just going to go ahead and import okay give me a second okay so this handle so o sorry all right so hopefully you went ahead and copied it and imported all the components we have to also fill in this handle delete ticket so I'm going to copy um the function and I'm just going to build it it's a very simple uh async function that basically makes an API call okay just give me one second so I'm going to copy this we're going to scroll to the top and after this here I'm just going to paste it in here so handle delete ticket is going to basically set all tickets to ticket. filter so we're just changing the local state okay and we're going to say await delete ticket it so this needs to be created and we're it's an async basically it's a query so we're have to build that in a second and then we're just going to show a toast so let me import this toast from use toast okay and we're going to just say deleted delet a ticket from the lane why is this throwing an error okay never mind and then here we're also going to pass this in so I'm just going to import this too and we have to change this if you remember okay nice and then let's just go ahead and create this uh query it's a very very simple query so copy this I'm going to go up top if I see query in here just going to click on that nice scroll to the bottom and um I'm just going to say const delete ticket equal async function okay with a ticket ID is a string and we're going to say const response equal await db. ticket. delete where the ID is a ticket ID and we're just going to return that so let's go back in here and let's import that real quick nice okay no errors everything looks great and I think we're almost done with this I think we're pretty much done yeah all right we are pretty much done now one problem is we did not do the tag component so if you um so if you go to the tag component in sorry if we have to complete our ticket form I remember right so let's go into our lane and in the lane you should be able to create a ticket where is that let's find it okay right here handle create ticket and let's go into the ticket form okay and the ticket form is where we're going to have um a bunch of other components right now we only have this right it's just a placeholder so let's go ahead and build that out okay also I'm not sure if you guys saw saw this part I may not have showed this you might you may just have something like ticket or something like that but uh basically I just created a card with the card header and a title and card content okay and I hope you guys have all of this it's just an onsubmit um the use effect I think you do because I did mention this yeah all right I think you guys do have this all right so let's proceed to this part so inside the content we're going to say form okay not this form we're going to use the form from UI and then we're going to use the uh we're going to destructure form form in here let's make sure we have also created that where is that form okay cool destructure form and in here we're going to use native form and this is going to have the onsubmit and the class name set to form. handlesubmit onsubmit and the class name is going to be Flex Flex column Gap four okay and inside this form we're going to have the form field so I'm just going to paste this and I'm just going to go ahead and import this as well so this one is for the ticket name okay I see some error here let me see what is the issue so it looks like it already is imported don't know why we had that issue anyway so um yeah this is for the name of the field the name of the ticket okay so ticket name and then we're going to have the description of the ticket so right here we're going to say form field description like this and in this one's going to use a text area so I'm just going to import that from UI text area and then we're going to have a H3 tag so after this an H3 tag called add tags and let me see if if we can create a ticket okay cool we can see that and after this we're going to use the tag Creator component and the tag Creator component um is not created we have to actually create this in just a second so what I'm going to do is I'm just going to hide this for now and then we're going to get back to this in just a second okay and in here um also I'm just going to put a work in progress flag so I don't forget um let me see work in progress okay work in progress add tag Creator okay don't want to miss any of this stuff and I will also do a full check at the end to make sure we didn't miss anything so after this we're going to say form label assigned to team member okay and if you need to import yeah and if you need to import this component just you know go ahead and import it and then we're going to create a select so this select I'm just going to copy and paste it and I'm going to explain it in detail all right so after this it's a very simple um select component okay so select first I'm going to go ahead and import everything so I'm going you can also by the way guys you can go in here click on select so if you were ever building it from scratch right let me show you a cool way you can just copy this import statement okay and in fact I'm going to do that right now so it's quicker there you go and that should solve these problems okay I did that a lot I mean that's how I was building it now you guys have GitHub in production you're not going to have me so that time this is what you have to do okay um so I'm going to use Avatar image Avatar fallback user 2 okay and that should look good all right cool so I went ahead and imported everything these errors should disappear in a second all right and I'm just going to explain that real quick so we're going to have a select okay with the onchange set to set assigned to and the default value is going to be assigned to so if we got anything um from the API call right or whatever data we got if you see this default data. ticket. assigned. ID right we're basically going to use that in here and then as the default value then we're going to create a select trigger with the select value having a placeholder and that placeholder is going to have div class name Flex item Center Gap two okay and let me see if we can see this okay just like this all right and then we're going to put an avatar image with the contact and the Avatar um fallback is going to be the user to size of 14 okay just like this and a span and we're just going to say not assigned because by default it's not assigned to anyone right cool and after this we also have to have the um the select content and the select content is going to be all team members. map and get the team member and we're going to return a select item okay and the select item is going to have a key it's going to have a value set to that team member's ID and for each team member we're simply going to have the Avatar image okay and we're going to have um what is this the source which is team member. Avatar URL and the Avatar fallback is going to be user 2 okay just give me give me one second let me make sure yeah okay and then we're going to and we're just going to have the team memb name in here okay all right awesome so let's see if we can actually test this cuz I want to see what it looks like so I'm going to go to our agency and let me go into team and I'm just going to assign this team member so let's go in here click on edit and let's turn that on okay awesome so they now have access and let's go back and see if we can actually find this user okay okay our dashboard is not wrapped in blur P guys so don't be alarmed that's why okay but we're going to go into pipelines all right let me click here create ticket there we go awesome you can assign a ticket to a team member just like this okay the exact same thing happens for tags as well just you know a little more complex and the same thing happens for customers okay so I'm just going to build that I want you to go ahead and take this up as a challenge this is not easy I know I understand and if you can't do it it's fine you need to try so pause this video give it a shot after this so right after this select component you want to create the customer component okay very similar to this and the logic is already done I think right let's see okay we have the contact list and we're already setting the contact list from here so we're getting all the contacts search contacts right from you know where this search term is like this try to see if you can do this okay you have to have a um just give you some quick tips so what you're going to need here is you're going to use the command component it's the pop over command component you can scroll in here go to the the command component and imagine when you make a search here you want to basically set you want to use the clear timeout and you want to get those contacts and save the contact list through an API request okay that's literally it and when you get the results you want to set the contact list to that result and that will basically show the result of your search with the contacts if you can give it a shot go ahead if not no problem I'm going to show you in just a second all right so now you want to go in here if you got it right great job if not this is exactly what you have to do and I'm going to show you uh from scratch okay so let's go ahead and say pop over like this from UI pop over and this is going to have the pop over trigger okay so I'm going to say pop over trigger components and this trigger is going to say as child and we're going to say class name of width Dash full not fit full okay and inside the trigger we're going to have a button so this button is going to be the following variant with outline and let me import this as well it's going to have a rule called combo box and it's going to have the class name set to justify between and all we're doing in here is we're saying contact if the contact exists then we're going to say contact list. find where the contact. ID is equal to this contact okay and this contact is basically a string right that's why we just did contact here if that does exist from the contact list we're just going to get their name and show their name in here and if not we're just going to say select customer okay and this is the Chevron up down icon just going to go ahead and import that as well nice and outside this popover trigger right here we're going to use pop over content okay and this is going to have a class name of width set to 400 pixels and padding is going to be zero okay like this and inside the popover content we're going to have the command component so I'm going to go ahead and copy this and I'm going to explain it in detail all right so let me hit enter here let's paste that in here and I'm just going to take a second to just import this okay so all you have to do is create a command component and that command component is going to have a command input okay so first put a command input inside that and we're going to say placeholder search and class name of height 9 and the value is search and on change capture what we're going to do is we're going to have an async component so when we change the value here right cuz it's an input we're going to say set search to value. target. Value okay and then we're going to say if the save timer ref. current exists we're going to clear that timer out and then we're going to create a new timeout by saying save time ref. current equals set timeout and pass in an async function okay and this async Arrow function is basically going to say cons response equal await search contacts this is another query we created which needs the search term so go ahead and say value. target. value okay and just use typescript ignore here it just does some really weird stuff so yeah put that in here and then after that we're going to set the contact list to the response that we get and we're going to set search to empty okay and set that to 1,000 milliseconds so this is how it works okay so when you make a search we create a timer and when the timer expires it searches for the results and sets it and if you make a change before the timer expires we're going to clear the previous timer and create a new timer okay I hope that makes sense and then we're just going to say command empty in here and after this we're going to create a command group remember I told you to create a command group and we also have to give a name here but that's fine I think it's working here so I think in that situation as well you don't have to have a a command group with a name and we're going to say contact list so all the contact list. map and we're going to get the command item okay and this command item is going to have the key set to the contact. ID the value is contact. ID and on select so when we select this contact we're going to say set contact to be current value equal to the contact if true then put an empty string if if this is true just use an empty string if not we're going to set this current value okay which is a string right here and then in here we're just going to put their name okay so the contact's name and then we're going to have a check icon and this check icon is going to say if the user is selected right if that contact is selected then we're going to say class name CN function just import this and we're going to say margin left of Auto height of four and width of four and the contact if it is equal to the contact ID okay that means which one is selected then we're going to set opacity to 100 if not it's going to be zero so it's going to be hidden okay that's literally it that's it guys if you got this right you are amazing if not no problem you're learning and you're going to learn so much more so now after this we also need a button to submit all of this data right so after the popover go ahead and create a button here and we're going to say type equals submit and form. form state. is submitting if that's true we're going to say loading component from Global loading or we're just going to say save in here all right done now we have one more thing that we didn't build that is very very important which is this okay so I did the work in progress flag and I found this and this is not a it's not a very simple component but it's not too bad okay and we're going to look at that actually it's not too bad guys it's not too bad okay I promise you so I'm going to uncomment this and let's go into our Global components and we're going to say tag- creator. TSX okay and we're just going to return something from here and I'm just going to paste that whatever I just copied okay so this component is going to be a use client component okay and how this component works is when the user searches for some tag let's just say this is an input field if the user searches for an input for something in here here we need to show we need to filter out the tag and show what they're looking for that's the first thing then we also have to have the ability to create a tag directly in here so if they're searching for something like priority let's just say difficult okay they're searching for something like this then we need to basically search that and show it to them but if it does not exist we have to give them the ability to create that tag okay and for creating a tag we need the color and we also need the title so what name right so it's not too complex I promise you all right so first thing in here is we're going to have the following props which is subaccount ID which is a string the get selected tags which is going to give us which is a function here and it's a tag of array it's an array of tags and the default tags is going to be an array of tags as well now let's go ahead and destructure all of these from here okay awesome and inside this we also need to create another type guys so this type is called this right here I'm just going to put it right up top const tag colors is blue orange rose purple and green as const okay and then we're going to export a tag color type in in case we need to use this and it's going to say type of tag color at number so we can actually get from here okay we can get it like this and then inside this we're going to create some states okay so the first state is to keep track of the array of tags okay so this array of selected tags so let's go ahead and say set selected tags and selected tags will UST State and let's import this which is an array of tags okay and it's going to have default tags or an array and after this we're going to also get access to all the tags so these are the ones that were selected and these are the ones that should be on the page okay so tags and we're going to again put the same thing same data type in here and then we also need routers I'm just going to get that as well and just import this from used navigation and then next we need to have the value okay and the value is basically what they are looking for okay and then we also need the selected color so if they are selecting some color we want to save that state as well and this selected color should be of this type but that's fine we can just put it as a string for now and then we're going to create a use effect and this use effect is going to do the following it's going to get selected tags so when this spins up right when it spins up a function is going to be provided to us from the props we're going to invoke that function and we're going to pass in all these selected tags okay so every every time these selected tags change we're going to give that function the new selected tags that's basically what's happening here after this we're going to do a bunch of stuff but let's move on to the design part and then as we need we'll just keep filling in okay I mean we're already pretty much done it's not too complex so we're going to say alert dialogue and in here we're going to have the command so and the command allows us to get the functionality of that search feature right we're going to say command command from UI command and we're going to say class name is BG - transparent okay and inside the command we're going to say we're going to do the following so we're going to say this right here okay which is select the tag has a length if length exists then we're going to do the following so we're going to return a div okay which is flex Flex wrap Gap two padding two background is background border two border border and rounded medium and then we're going to say the selected tag. map okay we're going to map over all the selected tags and we're just going to return each tag so if you're wondering what this would look like it would look like this okay so imagine this is a tag right it would look like that another tag next to it a tag next to it and it will just have their titles in there like for example Pro right some something whatever there words in here that have some meaning right so that's what it would look like and um in here we're going to also import this tag component that we created and we're also going to import X and I'm going to explo explain this in a second okay nice and um in here we're going to say return a div with the key set to tag. ID class name is flex item Center and we're going to say tag component okay and we're going to say title and color name and in here we're going to have an X icon and this icon is if you click on it it's going to remove the tag from the selected tags okay and the handled delete selected tag is going to be a function so let's go up here and just create that so const handle delete selection is equal to an arrow function which gets the tag ID that we just selected and we're going to set the selected tags to be filtered out to where the tag ID is not equal to that tag ID okay that's it's very simple after this we're going to do uh we're going to create another div so hit enter after this here and say div Flex item Center Gap -2 margin y-2 okay and we're going to say tag colors and this tag colors all of this right map color name we're going to return a tag component for it with no title okay let me see if we can actually get a glimpse of this Let me refresh okay tag Creator is not defined um let's go in there and let's import this component sorry guys tag Creator so I'm going to go ahead and import that okay tag Creator there you go so now it shows the different tags right so you can click on these and that will basically set the colors so now it's set to orange red you know something like that right so this is what we need that for so let me open that one more time and let's go into this this tag uh Creator and let's continue from here and after this we're we're going to create another div so hit enter here and say div class name relative and command input so I'm going to import that is type A command or search sorry I copied this from shadsy and UI so search for tag okay and then this is going to be a plus Circle icon so let me input that as well did hello did you input okay there we go and this is uh another function we're going to create which is handle add a tag so when we add a tag we got to keep in mind we first have to add it locally and then we also have to add it so locally in the sense to our states right to our selected tags and we also have to update the database so keep that in mind okay so let's go up here and I'm going to create the following and I'm going to explain it in detail so const handle ad tag is an async function if there is a value so if they were looking for something okay remember the input field in here okay on change is actually setting that input field value and the value is set here so we're setting that value and saving it in here so if there's any value then we're going to if there's no value we're going to just say hey tag needs to have a name and we're going to return but if and if there is no selected color we're going to say toast destructive please select a color so let's go ahead and import this okay nice and you can also import this from sonar guys it's a newer uh newer toast from another library and I think it's actually amazing so you can use that if you'd like I'm just going to use this one for now and I think somewhere else we're going to actually use sonar we'll see if we ever get to that okay cool and in here we're going to say if there's no selected color throw an it's just like show a toast okay and then we're going to say const tag data equal to T it's of type tag and we're going to just pass in these values so let me import V4 so we're going to pass in the color created at ID name sub ID and the updated at okay and then the set tag so we're going to set all the tags that we have to everything that's already in there plus the new tag that we just created in here okay and then we're going to set the value to empty because we already created the tag right and we're going to set the selected color to empty as well nice and now we need to create this action so now we need to save it in the database right so copy this and we're going to go into our queries file and we're going to create this function okay this query so let me see where can I find that okay nothing in here so let's go down to Libs queries I'm going to scroll down and I'm simply going to say export const upsert tag it's an async function with sub ID set to a string and the tag is going to say Prisma tag unchecked create input and this one is going to say const response equal awaits db. tag. upsert where the ID is this tag ID or a new ID and the subac account ID is the following sub ID okay and we're going to update the tag or we're going to create it if it if it didn't if it did not exist now let's go back and let's import this okay no errors nice and now we're just going to throw a toast and say created the tag and we're also going to uh use use this to create a notification and let's change this right in here nice and this is going to say toast variant destructive could not create the tag so if some error happened we're going to show that in there and we're almost done we're almost done okay now we also need to delete the tag right so just remember that so we created the tag where is that um right here um and now we need to delete this as well so after this div we're going to get another command list okay and in this command list we're going to show all of the tags that have been fetched okay so now we have added tags but now we want to fetch all those tags and show them in a list right so I'm going to go ahead and copy this here and I'm going to paste and explain in just a second so give me one second also I'm just going to import this okay okay so I just went ahead and imported it I mean sorry imported all the components and you're going to have two errors here the first one is ADD handle selection and handle delete but anyway we're just going to ignore this and we're just going to look at this line by line okay so first we're going to create a command list pass in the command separator and a command group and set the headings a heading to tag okay and after that we're going to have a command mty and we're going to set this command mty to know results found and inside the command group we're simply going to Loop over all the tags so map for the tag we're going to return some tag right and that tag is a command item so we're going to say command item and we're going to set the key to tag. ID like this and the following class name so hover BG secondary BG transparent Flex item Center justify between font light and cursor pointer and then we're going to have a div in here and this div is basically to create to had handle the ad selections so we're going to say tag component okay we're going to create this tag component and div onclick so when we click this we're going to add that tag so what is this function so we're going to go ahead and create this function uh right up here just give me one second okay so let's scroll up here and we're going to say handle add selection is going to get the tag which is of type tag and we're going to say if selected tag every okay where t. ID is not equal to tag. ID okay then we're going to set the selected tags to this so what does this mean basically it prevents us from adding a duplicate tag to our selected tags that's it so we're just making sure that uh this tag does not exist in this array that's that's what we're trying to do here okay and uh we want to make sure right we don't want to duplicate that on and on so that's why we did that and then we have an alert dialogue trigger here which is if you want to delete the tag itself from the sub account you can click on this trash icon and all that trash icon will do is it's going to send a alert dialog and it's going to say are you sure with the description and the footer is going to have a cancel button and if you are if you're sure you want to actually delete um this tag then it's going to give you this um section right here okay so let's go ahead and create this function so I'm going to scroll up top right here and I'm going to say the following so handle delete tag is an async function which takes in the tag ID and it also takes a string here so we're going to set the tags to tags. filter so we're just locally updating our state okay filter where tag ID is not equal to this tag ID and then we're just going to say try catch and the try catch we're going to say con response equal delete tag and this is a new server action so let's go ahead and quickly create that going to scroll up top queries go to delete tag where's that actually I like to click on this so it takes me to this and then I can paste it here so that's easier right because we want to put all related stuff together so upsert tag after that you want to say delete tag async function that takes a tag ID const response equal await db. tag. delete where ID is tag ID and then we're going to return this response let's quickly close this and let's scroll down here and let's go ahead and import this delete tag from here okay so now we can actually delete that and we're going to send a toast and we're going to say deleted tag okay and now we're going to also save the activity log okay change this to sub account ID oops that's it and then router. refresh and we're also going to show a toast okay nice and you also don't have to do this let me see okay you have to do this because all right because the the there is still cach Purge uh cach data so even though we locally are setting this we have to purge that cache data so we have to do router. refresh because if you come back the same API response is going to be cached so it's going to give you the same data that's why we're uh doing router. refresh Okay so so let me scroll down that's about it guys awesome right so let's see I can't wait to see this cuz this was this looks amazing so let's go in here and I'm going to create a ticket okay so there you can see you have this if you click this it's going to say tag needs to have a name so I'm just going to and also there are no tags so it says no results found right so let me just create something say uh let's just say high priority like this and we're just going to add this and it's going to say needs a color so let's say red color and let's create that boom there you go so now if you click this it shows it on top in the selected tags and you can also remove this from here that's how amazing this is and now if you actually click out right and if you try to create a tag um let's refresh that okay if you try to create a tag okay so it looks like something did not work let me see what happened guys give me one second okay so the reason why we are not seeing data here even though it is in the database is because we're not fetching them and setting them so let's quickly do that so at the bottom here or with all the use effects that's where's the other use effect okay right here we're going to hit enter we're going to say we're going to say this okay we're going to say if subon ID exist cons cons to fetch data we're going to fetch data here and then we're going to say async function we're going to get await get tag for sub account which is a new function new query so let's go ahead and quick quickly create that it's very simple so I'm going to go up top click on this I taught you guys all the tricks okay going to go in here and we going to say get tag for sub which is an async function which needs a sub ID which is a string and we're going to say cons response equal await db. subac account. find unique where the ID is a sub ID and select is and we're going to select the tags and we're going to set it to true so we're going to get all the tags for the sub account we're going to return those tags now let's go here and quickly import that and if response exists we're going to set our tags to response. tags and there you go now it actually updates okay so every time you know we create a new tag it's in refresh refesh I mean we go out we come back in here you're going to see that populate just like that okay awesome guys great job all right now let's go ahead and give this a shot and see if it works first okay I also want to see if we're also rendering some uh some tickets so let's go into the sub account sub ID pipelines we want to go into the pipeline ID page and let's just see here so we have the view let's go into the view um we are rendering pipeline Lane so let's go into the lane and let's search and see if we are rendering any tickets so here we are rendering a ticket and the ticket is has already been built out as well cool just wanted to make sure that we have that stuff so let's go ahead and give this a shot um right now I'm just going to create a ticket okay let me expand this and we're going to set this name to um let's just say website request okay the customer wants a full redesign isn't that amazing and now we're going to select this tag and maybe let's create another tag called web development okay and we'll go ahead and select the blue color and hit this plus and now we can select those tags as well and let's go ahead and assign it to this team member and just to show you that this works if you look for something you see it made a request and since there were there was no data it just removed everything and it showed nothing in here so this is actually working and now let's go ahead and hit save awesome guys there you go now you have tickets and this will not work and the reason why this will not work is because we don't have that on drop end function wired up that is kind of like the magic here all right it looks like we missed one field which is the value field I don't see it in here um and you see it's set to zero so let's search for value ticket. value at the bottom yeah we need to have that value field so give me one second guys let me go ahead and find that okay so let's put this value field after the description so I'm just going to search for description like this um okay and we have okay this is the pipeline ticket guys we need to go into the ticket form and I'm going to look for Value okay and actually I don't find the value here so let's go yeah so let's go to this description and after this I'm going to say form field disabled is loading control form. control name is going to be value and for render just going to return a form item with the form label control the input and it's going to have value as the placeholder and you know everything uh using the spread operator from here from this field now let's go ahead and try to first let me try to delete this tag we never did that before so I'm going to delete it awesome deleted perfect now if I create another tag here we're just going to say website redesign again and I'm just going to say customer wants a Rebrand okay um and then we're going to come here and we're going to we're going to change this ticket value to let's just say $5,000 and let's make this high priority and set it to web development let's assign it to someone and let's go ahead and create that so there you go it shows the ticket value and the lane basically shows the total of all the tickets that are in that lane and if you don't know how that works I already I hope I did explain it but basically it is very simple in here we have that memorized value right so let's go ahead and find that there you go it's a memorized value right and that memorized value Loops over all the tickets and it reduces everything to one single number okay and that number is what you see in here so every time the tickets get updated so when a new ticket comes in basically this Lane amount gets you know kind of refreshed right because it's using used memo and you will get the new cached value that's what's happening here okay the new memorized value so that's how you see this value awesome okay so now please please pay close attention because we are going to do something very crucial to make this entire drag and drop feature possible okay so you want to go into your pipeline view okay and right here we have the on drag end right we have to do a bunch of stuff in here so it's one function that we're going to build out right now so scroll down all the way to the bottom and we're going to say const on drag end equal to a function that has drop result okay and drop result is of type drop result so let's just go ahead and do that let me also just console.log in case we need to print this out I don't think we need to but I'm just going to say console.log drop result so we can see what's going on all right and then we're going to say const okay we're going to destructure from the drop result we need destination we need source and we need the type okay and then we're going to say if there is no um destination so I'm just going to paste this in here if there is no destination or the destination. droppable is equal to the source. droppable and the destination. index is equal to source. index so this means that we are not dragging over some new element okay we're just dragging over the same element right so um if that is the case we're just going to Simply return from here and then uh we want to check uh the drag and drop okay so now we're going to do a switch statement so just say switch like this okay and we're going to put the type in here and inside this we're going to say the case is equal to Lane and if this is the case then we're going to do the following we're going to say const new Lanes equal to an array with everything inside all Lanes okay but then we're going to say dot to spliced and we're going to say source. index comma 1 okay and then we're going to do two spliced again and then we're going to say destination. index and then we're going to pass in zero and all Lanes is going to we're basically going to get this uh index from this array so we're going to say source. index okay and uh once we get this we want to say map okay and we're going to Loop over that and we're going to say Lane and index okay or here let's just do this so map and we want to say Lane and let's just spell this index and then in here we're going to say return an object with everything inside Lane but order is going to be equal to index okay like this all right awesome so now we have basically just um you know kind of refreshed this locally in our local state right nice and then after this const we're going to set all the lanes so let's go ahead and set it to the new Lanes like this and then we want to say update Lane order okay and this one comes from the API uh query we passed in right um when we created it initially so we're just going to pass in the new Lanes like this and it's going to create a transaction action and it's going to get go ahead and update that for us okay now what if the cas is of type ticket so go to the bottom here after this blue curly bracket we're going to say case ticket and we're going to do the following we're going to say the new Lanes equal to all Lanes okay and then um we're going to say const origin Lane is equal to new lanes. find Lane where Lane ID equal to source. droppable ID and then we're going to say const destination Lane so which destination do we have to send it to equal to new lanes. find where the lane ID is equal to the destination. dropable ID and that's basically the same thing okay so and then um after this we're going to say um if one does not exist right uh for example it's dragged outside the Border then we're going to say if no origin lane or no destination Lane then we're just going to return okay just like this and then we're going to rearrange the tickets here so to rearrange the tickets we're going to say if source . droppable ID equal to destination. droppable ID then we're going to say const new order tickets so let me go ahead and copy this so I didn't make any Elling mistakes so const new order tickets equal to everything in origin. tickets okay but do two spliced Source index to one and then two splic destination index0 to origin uh lane. tickets at this index and then we're going to say map and we're going to return a new item okay with a new order and then after this so uh inside the if statement itself we're going to say origin tickets okay equal to new order tickets and then finally let's go ahead and set the new Lanes right here then we need to update the ticket order so go ahead and update the tickets order and let's go ahead and refresh uh the page as well so we're updating it in the server right and let me make sure yeah yeah it takes in the tickets a new order of tickets all right nice and then it just goes ahead and you know just refreshes the page and then finally if this is not the case so right here else we're going to say and we're going to say const current ticket so we're just destructuring this from here so the origin uh lane. tickets. splice source to uh source. index to one and we're going to just get the first one so current ticket we're going to put it in here and um then we're going to say um at the bottom here origin lane. tickets. for each for the ticket and the index we're going to say ticket. order equal to index okay and then we're going to insert it into the destination Lane so we're going to say destination lane. tickets. splice destination index oops sorry guys destination in. index to zero and then we're going to say a current ticket Lane ID and destination. dropable ID okay we need to we have one more step which is to rearrange these tickets so rearrange the destination Lane so you're going to say destination lane. tickets. for each uh ticket index and ticket. Order equal to index okay and then finally let's go ahead and set the states uh so set all the new Lane States like this and we need to update the database so I'm going to say update ticket order to destination lane. tickets and origin lane. tickets and finally let's go ahead and refresh okay nice now I'm going to go ahead and spin up the server give me just a second okay so now I just went ahead and spin up the server and the next thing we need to do is go to this drag drop context and we're going to remove this and we're going to put our new on drag end function in here so now we can actually do this right awesome so let's hope everything works fingers crossed okay so let's U oops let's extend this sorry give me one second yeah so let's go ahead and move this here and now if we drop it there we go guys it updates and also the value of this Lane changes as well how awesome is that so if you bring it back to this one um right here oh why is that not working oh okay never mind we just had to move it somewhere else so there you go now it shows $5,000 here too and now if we change the lane there we go the lane order also changes so let's try to refresh the page awesome guys so it's working perfectly so go ahead and you know you can create as many tickets as you like and you see we're just hovering over this it's not showing anybody here because we haven't assigned it to a contact but once we get to contacts and we create a contact then we can actually assign them to this and you will see their details in here okay great job guys I'm super super proud of you we have so much to learn in just this one single video so let's just keep pushing through now we're going to go ahead and finish up the settings page so go in here and I mean we already created the sub Details page right so we just have to render that component so scroll up top to to your sub account and create a folder called settings and then inside that create a page. TSX and then um all you're going to do in here is you're going to render out two things okay so I'm going to shrink this so you guys can see more and I'm going to return uh the uh sub settings page like this and in here we're just going to do a couple things so first thing go ahead and uh type in pams so pams is going to be an object with sub ID set to a string and now let's go ahead and destructure this from here like that and in here we're going to say const o user equal to await current user from Clerk nextjs and then we're going to change this to an async component and let me move this side a little bit more and after this we're going to say if there is no o user then we're just going to return okay and then we're going to say const user details equal to await db. user so let's go ahead and import DB like this. user. find unique where email is off user. email addresses at 0. email address okay like this and then we're going to say if there is no user details we're just going to return again and then here we're going to get the sub account so we're going to say const sub account equal await DB subac account. find unique where the ID is of pam. subaccount ID and then if there's no sub account go ahead and return and then once we get that we also need the agency detail so let's get the agency detail so we can show some stuff which is agency. find unique where sub. agency ID is this okay and um let's go down here and then we want to say if there's no agency details go ahead and return you don't have to return null I'm just going to remove this I'm going to just quit this server so we don't see this uh error and after this we're going to return the component so in here return the blur page component and inside this go ahead and create a uh div like this and we're going to give it the following class name it's going to have Flex from large devices Flex row Flex column and GAP four okay and let's remove this too and inside this we're going to have that subac account details so go ahead and import that component and we're going to pass in the following props the agency details the details user ID and the username okay and after this we also need to have the user detail form so put that in here and let's import that from our components and that's going to have type of sub account okay so if you look in here we have type which can be agency or sub account so that's why we have this here so go ahead and say sub account put in the ID as pam. sub account ID and then you want to put in the sub accounts and user data okay that should be it so let give me a second let me go ahead and spin up the server now if you go to the settings page and you click this here click on settings you will now see all the details of the sub account okay as you can see sub account information and all this kind of stuff right here and you can also change your user information so if someone else is logged in they will see their information and they cannot change this here okay awesome great job guys so now let's uh move on to the next part hey just wanted to check in on you I hope you're having fun but I just want to let you know that you're just one step away from becoming a prodigy and all you have to do is subscribe because we are going to be the best web development community on YouTube and I want you to be a part of this journey all right I hope you have fun watching the rest of this video and I have a really cool announcement at the end for you all right now we're going to build the contact page so head into your sub account ID create a folder called Contact and a page called page. TSX and just return a component in here and change this to contact page like this and in here first we're going to get the props which is going to have pams which has sub ID which is going to be a string okay so I'm going to put that in here and I'm going to quickly go ahead and destructure it from here as well like that nice and now we're going to going to create a type okay and this type is called sub with contacts and this is a sub account so go ahead and import that and it extends to have a contact so let's go ahead and create this type and then we're going to say ticket okay so this contact extends the ticket which is going to be an array of tickets because a contact can have multiple tickets assigned to them right so that's what we're doing here and now after this we're going to say const contacts equal to await and let's go ahead and change this to an async component and let's import DB and say sub account. find unique okay where the ID is ps. subaccount ID okay just like this nice and you can also I mean if you want you can destructure the sub account but that's fine okay just do it like this so pam. sub ID and we're going to include the following we're going to include the contact but in here we also want to include include the ticket and in here we want to select um the value so where value is true okay and after this so right after include statement so right here you're going to hit enter and you're going to say order by created at and then ascending like this okay nice so let me make sure this is exactly what we're supposed to do here all right we have the value nice and at the end here we're going to say as sub with contacts okay so now you see this okay it's of this type and this type looks like this nice and then at the bottom we're going to say const all contacts equal to let me change this also to capital c equal to contacts. contact okay like this and then we're going to get the format total so what is this format total we're just going to get the estimate of that contacts ticket okay so what their value is so in here that's the Discord blowing up guys sorry about that so we're going to say const like this format total equal to an async function and this async function is going to take in tickets which is going to have ticket and an array of them and if there's no tickets or there's no tickets. length like this okay then we're going to Simply return dollar sign uh in a string dollar sign 0.0 zero like this cuz this is the value of that contact okay and after this if not we're going to say const amount equal new we're going to use the um inl okay intl number format pass an undefined and an object with style set to currency and currency set to US Dollars and then const Lane amount equal to tickets. reduce so this is where we're changing that okay and we're going to reduce it to the following so we're going to say um sum so we get an arrow function right so this is the arrow function and this is the default value so it gives us access to sum and the ticket itself so we're going to say sum plus number ticket. value we're just converting it right here and then we're simply going to return amount. format Lane amount like this nice and after this we're just going to return a table component and this is a much more simple table component um so nothing complex so here we're going to first do blur page AG like this okay and then we're going to create an H1 so this needs to have a child so H1 like this and we're going to call this contacts so if you go to the contact page okay it's not present so something seems to be wrong here this should probably be contacts I think so let me refresh that all right there we go it's contacts all right so just make that change here guys Chang this to contacts and we're going to have the blur page and then we're going to say table up sorry we're going to also going to have a create contact button so we're going to have a create contact button so we'll come to that in just a second so I'm going to say work in progress create contact button okay and in here we're going to have a table so go ahead and import table from component UI table and in here we're going to have the table headers so what are the headers these are the headers right here so table header table row and table head import that too nice awesome and now that is all imported so it looks like this so these are the table headers okay and inside this going to have the table body so after the header go ahead and create table body and it's actually very simple so I'm just going to copy this and paste it here okay nice and I'm going to import these components like that nice so go ahead pause this and just go ahead and import everything okay so I went ahead and imported everything and you will probably have this error here which is to import format and this format actually comes from a package page that's already imported uh that's installed from shat ceni so let's go ahead and say import format from dat slfns SL um format like this okay and now that error should go away awesome nice okay and now basically when a contact comes in it's going to basically show up in here okay and it's going to have you know their Avatar logo and all that kind of stuff and the Avatar logo is actually just a fallback component nothing else okay so now let's go ahead and fill in that create button so I'm going to remove this work in progress in here and let's go ahead and create that button so this button is called create contact button and this is actually let me just close this component I want it to be a closing tag and this component is going to take the following so let's go in here first and inside the contact create a folder with underscore components okay and we're going to say create contact button. TSX and let's simp simply return something from here and I'm going to change that name and in here we're going to get access to the sub account ID which is a string and let's go ahead and destructure this from here and now we're going to first get the modal so now if we need the modal this has to be a use client component so I'm going to say use client and let's go ahead and import use model nice and now we're going to create a create Handler which just shows a form on the screen okay so take this up as a challenge okay I'm going to build just this one part here so you get the idea right here so we're going to have a button and here is your challenge you are going to create this handle create contact button what this button has to do is when the user clicks on this button a form should show up to get the contact information which is only the username and stuff like that so let's see right here what we have so let me go into the contact so we can see more in depth we have contact in here so the contact oops sorry we need to go into a Prisma schemo where am I going so we have a contact okay and this contact is going to have the name the email and of course it you know we also have to send in the sub account ID and this ticket okay I hope that makes sense all right and this ticket here um is just an array so you don't have to add anything but I'm just giving you an idea of what you have to create give this a shot okay if you can't build it I'm going to show you in just a second so go ahead pause this video give it a shot and come right back all right hopefully you got it right if not this is exactly what you need to do so go ahead and create a function called handle create contact okay and this set open we're going to invoke it and the first parameter I mean the parameter is going to be the custom model so let's go ahead and import that as well and we're going to pass in a new form called Contact user form okay so let's go ahead and create this um contact user form so go into your components in here go into forms and say contact user- form. TSX and let's just return a component from here okay and inside this it's a very simple component okay we're only going to have name and email that's it as the fields so I'm going to replace this guys don't worry we're going to break it down in in depth okay so in here we're going to have first the use model use router and we're going to do the form stuff you guys know how this goes right we have the form we have the use form and a Zod resolver and the form schema is going to be the following so we need to create this so let's go into our types right in here and we're going to create the contact user form schema so just paste this in here and this is basically z. object with the name which is z. string minimum of one and required okay and the email here is also minimum uh I mean is it's email field okay so let's quit this go back here and that looks great now um the other thing we need to do is let's just read this and we'll fill it as we go okay so now we have a use effect that basically checks the um data so this data comes from our model okay so when this model is opened we actually populating it with data so we're going to say data. contact so if contact information exist then we're going to basically do form. reset data. contact okay and it's saying contact does not exist on modal data so try to make a guess why is this happening hopefully you got it right and if you didn't it's because inside our modal provider we don't have the contact in here here so let's go ahead and say contact okay and import the contact like this from Prisma schema okay from our Prisma that's it now if you go back in here contact does exist awesome great job now in here we're going to Simply reset this once the data changes so when data gets populated we're resetting the form and now we're going to have the isloading here so form. form state is loading and then we have an handle submit so when the form is submit mitted what are we doing we are upserting contacts and we're saving all the contact details we're saving the email we're attaching and connecting the sub account ID and we're also passing the name of that contact okay you can do other stuff too like mobile number you know whatever you want no problem okay but this is what we need and here what is this sub account so go ahead and change this to sub ID all right and then we're going to show a toast once we uh upsert the contact which we need to create in a second and then we're going to refresh show the error if something happened wrong so let's go ahead and create the upsert contact so I'm going to click on this uh Libs queries I'm going to scroll all the way to the bottom and we're going to do the following we're simply going to say export const upsert contact is an async function that has contact set to Prisma do contact unchecked create input this is what it looks like okay and then we're going to say const response equal await db. contact upsert where the ID is contact. ID or create a new ID and we're going to update the data if it exists or we're going to create a new contact if it doesn't exist now let's go back and that should solve that error looks amazing now what does this look like very simple there's nothing in here two fields we have a card we have the card header card title and description okay we have card content so let me shrink this so it looks so simple for you we have the card content the form and you know this form and now we have two form Fields what are these form fields for first one is name second one is email that's it and then we have a button at the bottom which has type of submit and the is loading States and if form is is loading right then we're going to show this loading or we're going to show the Save contact details so if you got this right great job to you all right you deserve that and that means youve really learned a lot from this video if not don't worry just keep doing the same thing and you're going to understand something called pattern recognition Okay and as time goes you're going to understand how to write things without even knowing what happens behind the scenes then learning behind the scenes is easy because the Discord is open to you so all you have to do is say hey how's this actually working and we got you okay awesome so now let's go and import that contact form so import this nice and we also have to import the create contact button nice and this needs the following it needs sub ID which is equal to sub ID which comes from pams do subaccount ID like this all right and uh give me a second second guys I will go ahead and restart the server again all right awesome now if we try to create a contact the form is going to show up and now if I say something like um let's just say Jacob okay and we're going to say Jacob fake em mail@gmail.com and if we save the contact detail there we go we have their information and they are set to inactive because the value of this contact is zero Z so they are an inactive contact now if we go I want to show you something really really cool if we go into pipelines and who that animation is really cool right and if you go in here and if we try to edit this we can actually assign a contact see we can assign Jacob so if I search for Jacob like that we can click on their name and we can hit save information and now that is updated so if you hover over the contact you now see Jacob's information here and he is assigned to this ticket at $5,000 value now if we go into contacts we see there are an active client that has a $5,000 ticket value how cool is that you can really really run an amazing business just using um this you know feature because you can see your estimated pipeline value um which we will build in just a second um and your clients can see that on the screen and they can know how much they are expected to close and make if they closed all their pipelines basically awesome guys great job I'm super proud of you let's move on now all right guys we just have to make a really quick change here so if you click on the notifications and if you have a bunch of them you're going to notice that all these notifications are kind of cramped okay and the reason is because of the flex so go ahead and remove this flex and flex call and that should fix that problem but now you can't scroll so you want to say overflow scroll okay and now you should be able to scroll like usual all right awesome and the other thing you're going to notice is this this does not work I tried it I thought it I thought it was wired up but I know the problem and the problem is actually happening right here so on our switch component instead of onchange capture we need to do unchecked capture okay so I'm going to use on checked here let's do that one more time so on change and now when we change this now you see it's actually updating okay so that was the problem guys I'm really sorry about that I messed that up but yeah that that was the solution to that problem so now if you log in with a different account so just to show you right so right now this is a sub account they will not see that anymore right they won't see that thing up top but they will see all the sub related information so updated a ticket updated a contact Pipeline and so on so forth but they will not see this one up top which is updated a sub account because that is only available for the agency so right here as you can see um I created another sub account right called Cloud so that's the notification that's showing right there okay and you won't see that in there and of course you won't see this joined as well um inside the sub account so that's what we needed to fix so all right let's move on now all right guys if you have come so far I am super super excited for you because you are going to see how to use stripe to connect any account into your application because that's what we're going to be working on which is stripe okay and we also have a really really fun feature that we're going to be working on shortly right after that which is the funnel Builder it is a full website builder that I built from scratch and I could not find a single resource on the internet that uses a decent engine okay so we did not use any package for that nothing it's completely from scratch and I'm going to show you guys how to build something like that okay and with the help of that funnel Builder guys you can build almost any website I'm sure you guys saw in the demo so I would love to see you guys build out some websites and put them in the Discord after this video okay so what you're going to do first is you're going to go to stripe all right and go ahead and click on start now and it's going to prompt you to log in so go ahead and log in and come back once you're done all right so once you're done logging in go to connect so you can search for connect here and click on connected accounts like this and it's going to take you to this page page okay and also guys if you want you know I do have that entire breakdown fully documented of the entire stripe process and if you guys want that just let me know okay and I'm I'm sure I would have probably put some link somewhere for you to access that as well all right so what you want to do now is to click on get started with connect so make sure you're on test mode first of all and click on get started with connect and it's going to do something here and in the meantime what we're going to do is we're going to populate these three fields so because we're working with stripe we need to populate some of our environment variables so I'm going to go ahead and quit our server like that and the first thing is the subscription percentage so as the platform owner that means since you own the platform plura you get to charge a percentage of every single transaction U that happens through a subscription and that is going to be 1% of every single transaction whether it's from the agency sub accounts whatever it is okay and then you're going to have a one-time fee of $2 so if there was no subscription and there was a onetime like a product or something like that the sub accounts were selling on their websites you charge a $2 fee okay and then finally we're going to have the platform agency percentage this is a challenge for you and I'm going to show you I'm going to teach you a bunch of stuff and I'm going to give you the right guidance to you know do this to how to transfer money into another account but with the knowledge you have right now which I'm going to show you in a bit you will definitely be able to do that and if you don't know you know the Discord is open because this is a real challenge for you okay you need to take action and try Okay so go in here and once you're done doing this you're going to go to connect and it it's just going to spin up some stuff and first you need to verify your email okay so go ahead and do that I'm going to pause this video and I'm going to do it so just give me a second guys okay so I went ahead and verified my email and then you're going to scroll down here and you're going to click on complete your platform profile so open this and go ahead and click on start okay awesome so once you come to this page scroll down here and click on website building or hosting and then go ahead and hit continue okay so where do your customers purchase products or Services well from your seller service provider uh from your platform website let me see which is the best option the first one looks like the best option so select that and go ahead and hit continue so whose name is listed with the transaction on the customer's credit card statements so for us it is the service or the seller right it's not plura right so we're going to see this one which is Squarespace customer see the business they purchased from on their credit card statement or we have lift writer see lift on their credit card statement we don't want this uh we want the business they purchased from on their credit card statement uh this one looks better so go ahead and hit continue so who should customers contact if they have a dispute so we're going to say this seller or the service provider okay a Shopify customer would contact the business about an issue with a product or service they're not going to speak to PLO okay we don't do anything we just make money okay we just make a monthin one subscription that's it so go ahead and review this make sure everything's okay and click I'm not a robot apparently I'm not a robot and go ahead and hit submit okay why does it say an unknown error okay maybe you just needed me to sign in one more time let me do that okay great hello stripe oh what is going on guys let me let me sign up one more time okay give me one second guys okay I just refreshed the page and it took me to this which looks like the correct page and I guess it works okay so um creating a connected account we're going to let me just click on this real quick which is recommended so we want to click on that okay so it's just routing me to that okay so these are the different options right can have a standard account that can be connected you have transfers where you can allow connected accounts to receive funds from your platform so this part would be your challenge but we're just going to skip this okay and then we're going to have the direct charges which means it's the easiest way to enable your accounts to process payments okay so guys again I broke everything down in the documentation you will go crazy guys I spent months literally looking through all this documentation all right awesome so give me one second I will uh move forward to the next process now all right awesome so um once you're on this page right this is where we were click on connect settings just click on these breadcrumbs and it's going to take you to this page all right guys I really hope you're doing this with me so just continue okay if you haven't just follow through okay so um this one is going to say a different country even though I'm not here because I was here as a vacation never mind and everything else looks good I think so give your connected accounts full access to stripe dashboard which is good okay capability card payments allow connected accounts to process their own cards all right required all right so here we're just going to say um you can create the you know business name so this one we're just going to say uh plura okay like this uh copy your brand settings to new connected accounts actually we don't want this so I'm just going to leave that I'm going to also leave this stuff here and for the brand color um you can just change this to you know whatever color you'd like I think the blue one looks really nice I'm just going to put blue okay nice and now um there's no save button save branding okay just click on that okay it went ahead and saved the changes and now scroll to the bottom and you're going to see this client ID and redirect URLs so first let's go in here and copy this test mode client's ID okay go ahead and copy this and you want to go into your environment variables and you're going to see this client ID right here okay paste this now keep in mind when you go to production you have to change this to the real client ID okay since we are on test mode we're seeing the test mode client ID all right nice now uh what's the next thing we need to also get um a bunch of other stuff so what is this enabling an oath flow allows your users to on board to stripe using oo for that account type um so we can actually turn this on we want this to be on and there's no save button I don't think there's a save button all right cool and the redirect URLs we have actually need to set this so just give me one second guys all right so we're going to click on this add URI and we're going to paste this link in here okay HTTP localhost 3000 agency so add that URL and then we're going to add one more and this one is sub account okay so these are basically the links that stripe would redirect the user to after they have connected their account all right so once you've done with that I think uh connect is only available in test mode activate your accounts all right we don't care about this part I just wanted to see what that was okay cool so I think we pretty much have these steps let me see uh what are the other steps we need to complete okay I think we're good there so now what we need to do is you're going to go and search API Keys okay and click on that it's going to take you to this page and now you want to go to this publishable key and copy this publishable key so click on it it's going to copy that and I'll go into your environment variables and you see stripe publishable key right here go ahead and paste that and it should say PK in front of it okay now we need the secret key so to get the stripe secret key reveal the stripe secret key right here and you're going to go ahead and copy this from here okay and now you can come in here and paste that secret key in here now this web hook secret ID we're not going to get right now uh we will get this in a second okay so just give me a minute I will uh get you to that page okay now the next step is to go ahead and wire up stripe um at least to some extent inside application okay so go in here inside your Libs folder create a folder called stripe and then create an index. typescript and then actions. typescript and then stripe Das client. typescript okay and in the index file we're going to type the following so we're first going to install Stripes so open your terminal first let me shrink this and we're going to say bun add stripe and let that install okay and now up top right up top here we're going to import Stripe from stripe like this and then we're going to say export const stripe equal new stripe like this invoke it and we're going to pass in process. EnV and we want to use that stripe secret key okay so put the stripe secret key and then we're going to put the uh this optional chaining here and then we're going to put a comma here and an object and inside this object we're going to set the AP version to 2023 1016 and then the app info right here is going to be plura app like this and the version is going to be 0 0.1.0 okay now you want to go into stripe client which is in here and in here we're going to import another uh package so go ahead and say bunad at stripe slst stripe DJs and go ahead and install that now we need to import the following so we need to import load stripe and Stripe from this package and then we need to say let stripe promise is of type promise like this and we're going to say stripe or null okay and then after this we're going to export const get stripe equal to and this is going to be a aror function and we're going to pass in some custom values here okay I know this is this is not going to make sense I understand it's fine basically we're creating creating a function here that allows us to load stripe and if there is a sub we're going to put in that connected account ID okay if it doesn't make sense don't worry just follow through so connected account ID which is going to have string like this and in here we're going to say if there's no stripe promise then uh we're going to say stripe promise equal to load stripe invoke that and we're going to pass in process. env. nextt uh next public stripe publishable key and you're going to pass in this string here and then you're going to pass in an object like this so hit enter pass in an object and this is going to have the stripe account okay so if you pass in a connected account ID it's going to use that ID okay if not it will use um this publishable key okay I think that's how it's set up but if not U you'll see as we're using it uh and how it works so now we're going to return the stripe promise like this this okay so let's go ahead and build out an action real quick and this action is going to have this page is going to have use server up top and what is this action so you can think about this uh like admin actions okay so when we're performing some sort of actions in here that time we want to um when we're performing some actions from stripe which come from our web hook we want to create subscriptions and things like that so that's why we need this okay I hope that makes sense all right so in here first we're going to go ahead and import the following packages from Stripe from DB and from our local page Stripe Right here okay and then what we're going to do is we're going to export const subscription created okay so subscription created which is equal to an async function and this is going to take the following parameters which first one is the subscription which is stripe. subscription and the customer ID which is a string okay and now we're going to set a TR catch in here and we're going to say const agency equal to await db. agency. find first where customer ID so customer huh let me see what's happening in here okay so I think we did not actually put this hm yeah I think we didn't put this in the in the schema let's inspect our schema okay so give me one second okay so go to the agency here and after the connected account go ahead and say customer ID like this okay and then because customer ID is only going to be there for the agency okay because the customer ID is basically the ID of the user that is subscribed to our services okay to plura basically so go ahead and put that in there the sub accounts will not have that they will only have the connected account ID okay so now open your um terminal and say bun X Prisma generate and Bun X Prisma DB push like this all right awesome and that went ahead and updated that for us okay cool and now um what we need to do is we're going to go back into our actions here and we're going to say customer ID like this and after the wear we want to include the following we want to include the subscription and set it to true and now we're going to say if there's no agency then throw new eror and we're just going to say could not find an agency to upsert the subscription okay but if the agency existed then we're going to say const data equal to active subscription. status okay equal to active so we're going to create a data here but we're going to create this set here the data set and we're going to say agency ID is that agency ID with the customer ID and then we're going to say current period end date is new date subscription. current period end into 1,000 and then we're going to set price ID to be subscription. plan ID like this and subscription ID to be subscription ID and plan to be subscription plan. ID okay and after this data we're going to say const response equal await DB db. subscription. upsert okay and we're going to say where agency ID is agency. ID and we're going to create data or we're going to update data like this nice and after this we're just I'm just going to print a message here saying created subscription because this will help us debug so and in here I'm just going to print if any error happened and then finally I'm going to have one more action in here which is const export cons get connect accounts products so this is for the sub accounts when they have a website running and they have products online that time we want to get their connected account products right so that will be right in here so we're going to say async and this is going to have the stripe account this is going to be of type string and in here we're going to say const products equal await stripe. product. list and you're going to open this curly bracket here we're going to say limit to 50 products and we're going to expand something we're going to expand the data. default underscore price like this and after this object go ahead and create another object and we're going to say stripe account just like this okay and then finally go ahead and return the products. DAT and this if you hover over this you'll see it's returning that product data okay and this is an array of a bunch of products Okay cool so now that we have this now we're going to go into our app folder in here let's shrink everything and inside the API we're going to create some sort of routes okay so create stripe in here and inside this stripe you're going to create the following folders so the first folder is called create Das checkout D session and um it's not sessions actually it's session like this and then we're going to have one more in here which is called create customer okay and then we're also going to have create subscription just like this okay nice so let me cross check please don't make any spelling errors here take a look at it and cross check as well okay so inside the create subscription create a route. typescript and in here we're going to do the following so first we're going to import DB from our folder Stripe from Libs so please be careful this is from Libs not from stripe okay lib and stripe and then next response from next server and then here we're going to export an async function so I'm just going to say async Arrow function or just say export async function post like this and we're just going to do this okay and in here we're going to get the request and this request is of type request and now we're going to say const customer ID and price ID is going to be equal to await request. Json okay cool and then if there is no customer ID or there's no price ID we want to go ahead and simply return something here so we're going to say return new next response and we're just going to say customer ID or Price ID is missing okay so I'm just going to put that in here and make sure you pass in the status so the status is going to be 400 like this and then after this if the subscription already exist we're trying to find that right so subscription exist awaits db. agency. findfirst where the customer ID includes subscription true and then we're going to create a TR catch Block in here so go ahead and say try catch like this and the first thing is we're going to create an if statement so put an if statement in here and it's going to say subscription exists do subt subscription. subscription ID so that means the subscription exist and their subscription is active Okay then we're only going to update the subscription instead of creating one because it already exists right there's no point in creating another subscription so we're going to say here we're just going to make a quick check if the ID actually does not exist then we're going to throw an error and say could not find the subscription ID to actually update it okay and I'm going to put a message in here so I can actually see what we what's happening right so console.log updating the subscription and then we're going to say current subscription details so let's get their subscription details which is 08 stripe. subscriptions. retrieve the subscription exist. subscription um. subscription ID okay and then we're going to say const subscription equal to await stripe. subscriptions. update subscription exists okay do subscription subscription ID so we're going to update that ID okay and we're going to set the items to to be ID current subscription details. items. dat zero. ID okay like this and then we're going to say um this so deleted uh true okay deleted true and then we're going to say price U to and set it to the price ID and this price ID basically comes from the URL so whatever um from this Json okay from the request so whatever they send whatever they clicked on that price ID okay and then after this we're finally going to expand the latest invoice. payment intent because we need this information to send it back to the client okay so after this hit enter and we're going to say return next response. Json subscription ID which is this ID and the client secret this is an important one okay which is subscription. latest invoice. payment intent. clients secret and please put this typescript ignore stuff all right um it's because we're expanding it's not part of the default object so it's causing that error and now if this subscription does not exist let me search for that ending bracket right here we're going to say else and we're going to create another bracket in here okay so first I'm just going to say now we're creating this subscription so just put a console log message and go ahead and create the subscription so we're going to say con subscription equal A8 stripe. subscriptions. create uh and we're going to put a customer ID in here and then items um we're going to say price price ID so whichever subscription they wanted so that price and then payment behavior is default incomplete please put this super super important okay default incomplete the payment settings is going to be save default payment method to be on subscription okay and we're going to expand this payment intent so we can send that payment intent to the client so after this right here hit enter and we're going to say this so we're going to say return next response. Json subscription id. subscription so this this ID here and the same thing we're just returning the same object here and that's pretty much it now when an error occurs we need to print that so go in here we're going to say console.log error return new response internal server error and we're just going to send this response here okay so we pretty much have this set up um and the next one is to create a customer okay so now go in here go to create customer and create route. typescript and in here we're first going to import the same thing so I'm just going to import this and we don't have this type guys we don't have stripe customer type so I'm just going to go ahead and build that okay so give me 1 second what you want to do now is go into your Libs types and we're going to create the following stripe customer type so go ahead and say export type stripe customer type and uh we want to say string shipping which is going to be shipping info and address is going to be address so for shipping we're going to have the following types so the shipping info is simply going to have address which is of type address and the address is going to be of this type right here okay this address and then that's it okay that's it for that shipping stuff and then we're going to create another type here which is called price list okay so go ahead and say export type price list equal to this stripe. API list and open this here and say stripe. price and this stripe actually comes from here so go up top and import Stripe from stripe okay so now you should not see that error anymore okay looks great guys and now let's go back into our route so we can continue and we're going to just create a function here like this so create a function called post request is request and in here we're going to first extract the data okay from that customer so we're going to say address email name shipping which is of type stripe customer type and we're going to get it from uh request. Json okay and then we're going to say if there's none of this is not satisfied we're we're just going to return and say missing some data okay with status of 400 and then we're just going to create a simple TR catch does the following which says await stripe. customers. create with this information and we're going to return that customer ID so that we can save it in the database inside the agency okay so if you realized we actually didn't have this setup in the beginning right so we're going to do that and also again for the error just go ahead and do you know this thing right here okay so now we're going to go back into your queries so give me one second so go into queries where do we have that all right guys sorry that wasn't here that's actually inside the forms so I got a little confused there so let's go into forms hopefully it's here and let's go into agency details and let's look for where we are creating the customer data okay customer okay customer ID we have something in here so that's good news let me see where do we put this so This is called customer ID I'm just going to change this to cust ID like this and okay so we're upserting the agency so that's where the error is happening in here okay so after this response let's see so this if statement in here we're going to say um just do the following okay so it's const customer response equal await Fetch and we're going to say API slst stripe SLC create customer and we're going to pass in the following data we're going to pass in the method which is going to be post we're going to pass in the following headers as well so let me get those headers so we're going to say headers content type of application Json and then we're going to pass in this uh body um which is json. stringify and we're going to pass in the body data and then after this response const customer data equal this type customer ID which is await customer response. Json invoke that and then we're going to set our customer ID to that customer data. customer ID and work in progress customer ID all right we put that in here so here we got to say I'm just going to remove this and I'm going to say no data. customer ID and no cust ID then we're going to do the following and in here we have to go ahead and pass in that customer ID like this so we can create that and that should remove our errors nice and then finally we have the router refresh created account okay created agency all right I think this looks good guys so what I'm going to do now is I'm going to go ahead and delete this agency so let's go in here go to bolt shift okay I need to spin up so and just spin up the page and let's go ahead and delete that agency I can go ahead and do that too okay so I'm going to scroll down here into the agency info we're going to delete this and let me make sure this is from prodigies testing for delete this agency and just go ahead and delete that okay nice now when we create it we should actually see some data inside the customer ID so what I'm going to do now is I'm going to say bun X Prisma studio so I can open that up right here and inside Prisma Studio we can actually keep track so now there's nothing in here cuz we deleted everything right so let's go ahead and say the following so what we want to do is I'm just going to create so go ahead and just create an account guys okay just create agency and then come back okay so I'm going to go ahead and save this Agency information and that should um save that something is happening wrong what's what's going on all right give me a moment guys let me debug this real quick okay here's the problem what I did here was wrong so after this what we're going to do is we're going to say return here so if this does not satisfy how can you actually create right so go ahead and return here and this we can just we can remove this here what is it a tri catch what is that okay there's no TR catch there so I can actually save that response and I can check the response data too so I'm just going to say this so con response equal await upsert agency okay so we can save that response and then after showing this toast we can uh check here so we can say if data. ID then return uh router. refresh so I'm just going to save this and and if there is a response then I'm going to say return router. refresh as well all right hopefully that solved our problem and I'm going to try this one more time so go ahead and give this a shot sorry about that error um let me click on this upload this and I'm just going to set some uh what is it bolt shift okay that's the name just put some info here all right fingers crossed save info there we go guys yeah sorry about that I don't know why I did that mistake you probably missed that okay awesome now if you go into Prisma Studio you should refresh and you will see the agency if you click on that you will see a customer ID so we successfully created a customer ID from um you know with the help of stripe okay so nice so now we have this customer ID but you will notice here that there are the subscription is not created and we don't have that uh subscription basically set to active right so they don't have a subscription at the moment all right so just wanted to do that so great job let me just take a quick little break and I'll be be right back okay so now go back into your stripe dashboard and look for product catalog okay it's going to bring this up it's going to bring this page let me just expand this a little bit more and what we're what we're going to do is click on add a product like this and you're going to set the following info so you're going to change this to plura and you can probably say something like the perfect plan for your agency and in this keep it to standard pricing and I'm going to change this to US dollar and we're going to change the price to $49 uh $49 that's okay and this is going to be recurring okay please make sure you click on recurring and the billing period is uh monthly and what we're going to do is we're going to see if there's any additional price description okay we have some stuff in here so what I'm going to do is in the price description I'm going to set this to basic like this all right this looks good I think yeah nice and then I'm going to add another price in here and this price is also going to be US dollar and we're going to change this to $1.99 per month okay make it recurring and monthly payment and change this right here we're going to change this price U sorry we're going to change this to unlimited SAS like this okay and U go ahead and Shrink this and you should see two pricing information in here okay you don't need any image or all that stuff you can go ahead and put that if you want want to but that's fine and um I think this is good the statement descriptor can be U empty this looks good guys yeah we don't need any of this stuff and go ahead and save this product okay so now you should see a product in here um with the following information just like this so two products um or two sorry two prices but one product so this ID right here copy this this is your product ID okay and what you're going to do is you're going to go into your EnV right you can put it in here if you want and we're just going to say plura okay next plura product ID and we're just going to set that to that ID okay just to kind of save it somewhere um so that we can actually use it all right and let me expand this real quick and now you have two price IDs here right copy the first one for the $49 copy that price ID go into your code editor and you're going to do command shift F and you're going to sh uh check for price underscore so wherever you have used this price we now have to change that okay so I'm going to go into my constants and now I see some price IDs in here right so for the basic plan I have this which is mhu okay so that's the basic plan so that's where we have to set the $49 per month so mhu is this one right so I'm going to change this to that new price ID okay and then in my schema as well you see mhu here click on that and go ahead and change this okay nice and now I'm going to shrink this and I'm going to copy the next one which is this one right here okay and let me make sure this is fj9 why do they have the same ID do they no they don't huh oh they don't they don't okay this is so similar now copy the 199 plan and you just have to change the other one so I'm going to change this and I'm going to go back into this here let me expand this real quick I'm going to click on this one and I'm going to change this one to this new price ID okay now open the terminal and we going to quit this and say bun X bun X Prisma generates and Bun X Prisma DB push okay do you want to ignore the warning okay it looks like there is some warning let me just take a look at that okay so I'm just going to hit yes here it might I don't think it's going to delete any of our data let me take a quick look if I refresh this I don't think it should yeah it's not going to delete it that's fine okay so now we have updated our product cataloges with the correct price IDs and I think we are pretty much set for this side okay so let's head into our folder structure in your billing click on page. TSX and now we're going to change this page so first go ahead and say pams and agency ID string so we're extracting that and destructure and get pams from here okay and the first thing we're going to do is we're going to get the add-on products okay now we haven't created the add-on products and I'm going to show you how to do that in just a second all right so I'm going to import stripe and this stripe actually comes from lib stripe guys so let's go up top and say import Stripe from lib stripe like this and the addon products so where do you get this add-on products well it comes from the constant file so let's go into constants right in here and we're going to scroll to the bottom or we can just Scroll after this and we're going to just say export const addon products equal to an array with a title priority support and the ID is going to be this product ID so we have to change this okay so what I'm going to do here is just set this work in progress flag just in case change priority support okay and we're going to go ahead and create that product as well okay so open this up go into product catalog and go ahead and create a new product so hit add product okay and it's going to show something like this in here you're going to change this product name to Priority support we can also provide some description and we can just say skip the line and get ahead you know get the help you need with this VIP service and the pricing details changes to us doll and we're going to change this to $450 per month okay and recurring Revenue I think for some additional let me see what we can pass in here give me one second okay I think for this one it's fine we don't need anything in here we just need the name and the description so go ahead and save this product and the priority support has been created so copy this product ID go in here and change this product ID to the new product ID okay I hope you guys are doing this with me all right and now we can remove this work in progress flag confidently nice and now let's go back there and let's quickly import add-on products. products like this and we just want to import it okay nice and now after we get the add-ons so by the way guys this is a challenge here so I'm going to put a little note here challenge create the addon products don't worry I'm going to show you how to create the regular products that we just made and similarly you're just going to wire up the add-on products okay cool and now we're going to get the agency subscription so agency subscription equal await db. agency. find unique where oh oh okay we pam. agency ID okay and we're going to get the customer ID and its subscription and then we're going to check the prices so we're going to say um const prices equal await stripe. prices. list okay and now we're going to say product and we're going to get this product from ourv file so let's go down here Tov copy this plura product ID remove this EnV again so you can go back here we're going to say process process Oops why is it doing that env. next plura product ID and then we want to say active and set it to true so whichever product is active only okay I think all these products are already active let me take a look yeah they they should be active okay cool and then we want to go down here and you want to say current plan details so con current plan details equal pricing cards so let's go ahead and import this from Libs constant .find where the price ID is equal to agency subscription. subscription. price ID so whichever subscription they have get that specific uh plan details from our constant and then we want to get the charges so these charges come from the stripe charges. list and the customer is agency subscription. customer ID so all the charges that have been made on this specific customer okay so go ahead and get that and that way we can show the the charges in the um what do you call that the um you know the little table at the bottom okay so now the all the charges okay we're going to we're going to uh create this variable here all charges so const all charges actually let me just past this yeah all charges equal to an array with everything inside charges. data okay and we're going to map each of those okay we're going to return a new array basically and we're going to get the charge but we're going to return description as charge. description ID as charge. ID date is going to be new date charge. created star 1000.2 local time string and then we're going to put a space and we're going to put um another variable in here which is new date charge. created 1000 to local date string okay and we're going to change the status to paid and we're going to put the amount in here okay nice and after this at the bottom here now we can create our component so create a re react fragment and we're going to create an H1 called billing in here and let's go to our billing page oh okay so I have to run this so Bun Run Dev okay nice and I just went to the agency and clicked on billing and after that we're going to use a separator component so go ahead and say separator and import it like this from components and then after this we're going to have another H2 saying current plan okay and then we're going to have a div here okay and this div is going to have all the pricing cards and stuff inside it so let me go ahead and create this div and inside this we're going to create a new components called pricing card okay so let's open this up go into components and we are just create a file called pricing card if you don't have it um and inside this we're going to do the following okay so you can feel free to actually copy this entire component but uh let's just go step by step all right I think you guys like that more so um first I'm going to just return a component in here and I'm going to change this to pricing card uh pricing card like this and in here we're going to get access to these specific props okay which is the features string array of string button CTA title description amount duration highlight title highlight description customer ID the price list which we created remember import that and pass in data okay and um then we need plan exists Boolean okay and in here now we're going to go ahead and extract all of this so go ahead and extract it okay cool I think that's about it that's all we need really I think there's one more all right that's about it and after this we're going to use use the model okay so go up top and change this to use client component and in here go ahead and import this model okay so basically when we click on the button inside the pricing card it has to show the model where they can actually click on the plan they want to purchase okay so now I'm also going to get the search pams in here so I'm going to import search params from next navigation and I'm going to get the plan from the URL okay from the URL par why am I doing this sometimes by default we want to get access to what you know the user is trying to access so that time we can actually use this to show okay um it's kind of like caching the value like saving it right and then we can actually show it on the screen and then we're going to go scroll to the bottom here let's remove this let's create a card and inside this P pass in the following class name so we're going to say Flex Flex Das column like this okay justify between LG width of half the screen and ins inside this create a div and inside the div create card header okay card header I made a spelling error there card header like this and go ahead and import this component and inside the card header we're going to pass in uh the following class names we're going to say Flex Flex column from medium flex row and justify between and then create a div and create a card title title like this and we're going to go ahead and import this okay and create the card description okay description and let's go ahead and import this component as well and inside the title you're going to pass in the title that came in and for description pass in the description that came in now let's go back and let me see what we have in here okay so we have this I want to actually import that pricing card component okay let's do that guys let's first import the pricing card and let's pass in some data okay so I'm going to say pricing card okay and I'm going to make this a closed component closing tag and I'm going to first pass pass in plan exists okay plan exists and then I'm going to pass in prices and then the customer ID which we have already gathered then we need the amount which is going to be the following which is agency subscription. subscription. active if it's active if it's true then get that specific price okay from the current plan details if not we're just going to return $0 okay and then we're going to have the button CTA in here and then we're going to have highlight uh we're going to have some description text right so I'm just going to put description in here I'm going to just say highlight uh description want to modify your plan and you know something in there and then we're going to have a highlight title and this one is called plan options and then we're going to have another description in here and this description is from the uh the plan details okay so if they have a plan if they have a active subscription get it from the current plan details and this is what it looks like okay we have a description in here and if you see up here there you go you see that okay we're getting it from there so after that if not we're going to just return something custom in here okay let's get started or we're going to return something let's get started pick a plan that works for you okay and after description we also want to pass in the duration and we're only using per month and the features here are going to be the following agency subscription if they have if the agency has an active subscription go to current details. features or return an array and the feature is an array so if you click here you see it's an array of strings right so we're going to return that in here and after features we also have title so go ahead and put the title if they have a plan return that specific details title or just return starter okay nice good job so now you already see it working it looks great already awesome guys look at that but of course it looks horrible we got to go fix it right so go into this pricing card and we're going to just make the couple make a couple changes in here okay so let's look at this after the description we want to hit enter we're going to create a paragraph tag and we're we going to say class name is text d-6 XL font D bold okay and then inside this we're going to say AMT amount and then we're going to create a small tag okay we're going to set the class name to text- EXs font DL okay font dlight and text- muted D foreground and in here we're going to say duration like this not donut chart what duration okay uh duration where you at all right right there nice and now it just say say $0 per month okay and after the card header create the card content and inside this passin ul and inside this passin features. map for each feature we're going to return something so get access to the feature here and we're going to return a list elements okay not this it's li like this and let's pass in the key equal to feature like this and we're going to pass in an a class name so go ahead and pass in the following class last name okay list disk margin left of four text muted of foreground and inside this Li you're going to say feature like this okay nice and now um let's see if it shows any features okay zero I think it does it does it have any features let me print it out here so console.log features let's see what we get okay we have an array of zero so nothing's in there I think hm let me see what's the plan uh what's what's happening guys give me one second okay okay so what we're doing here is if there's nothing we're just returning an empty array if they don't have a subscription but the free plan actually has something in there so what we're going to do is a pricing cards. find okay like this find where the where we'll just say pricing or feature yeah let's just say pricing like this okay and we're going to say something in here we're going to say where the pricing do title equal to and let's go into this actually and I just want to take the starter pack up package in here I'm going to say this and we're going to pass get the features from that okay now this is going to say it cannot return undefined so I'm just going to return an array in here just so it doesn't scream but um yeah and then in here we can also return this like this okay or we can remove this this is fine I think that should work too let's see okay so since there's no features here we actually have to pass this in uh right here so this can technically just be an empty array like this and we won't have any problems okay so let's go back in there guys and let's fix this up real quick so now we have the features let's go ahead and render out a footer so after card content after this div hit enter and you're going to say card footer is going to have card like this another card in here and we're going to have with full we're going to have a div in here with flex Flex column and flex row and from medium devices item Center justify between rounded large border Gap four and padding four and then create a div in here with a paragraph tag and another paragraph tag with the title in the description and this is going to have text small text muted foreground and then let's create this button okay and then we're going to have a function called handle manage plan okay and we're also putting the button CTA in here so what is this handle manage plan it's basically going to show a form okay it's a form that we're going to create which is called subscription form wrapper and we're going to show a bunch of stuff on the screen so um scroll up here okay and go ahead and create that function handle manage plan and let's import the custom modal all right see this modal stuff is so so you know useful so I love that and now we need to create the subscription thing so as you can see in here this is what it looks like okay so it looks great now and looks nice Okay cool so um huh something seems off is it this month not sure what the problem is but something looks off maybe it's just the device size guys or maybe this card content goes inside the card header which would be weird but hi oh no oh that's awful let me go back okay card let me just take a look guys give me one second okay okay I think everything looks good um I'm not sure what's going on but that's okay we just need to move on you guys can fix the styling and stuff okay so now that we have this we need to create this form which is subscription it's called subscription form wrapper and all it does okay is it takes in the customer ID and the plan exists so if they have a plan already okay and what this um subscription form is going to do is it it's going to show the different plans available and we get to select you know something from that so let's go ahead and create a form in here so go into components forms and create um a a folder actually because we're going to need multiple for the subscription form okay so subscription subscription dform and inside this create subscription D for- wrapper. TSX and then just create one more it's called subscription or just say index. typescript okay and in here we're we're going to return a component and just say subscription form wrapper like this and for this one we're going to return not index but did I say t typescript or t okay I said typescript so this has to be index. TSX and let's return the subscription form like this okay and first thing we're going to work on is the subscription form wrapper so in the subscription form wrapper scroll up top and make this a use client component so go into that wrapper component make this use client and in here we're going to get access to two things right we need the customer ID and plan exist and now let's go ahead and destructure this from here okay and then in here we're going to basically first get the model so cons data and set close equal to use model and then we're going to say cons router equal use router okay and then we're going to get the selected price SI so this is I mean we're creating a state here called selected price ID and set selected price ID and let's import Ed States and it's going to be of type plan which comes from Prisma client so only these two okay or an empty string and then we're going to say data. plans but this does not exist so let's see if you can make a guess you should get it right now but why do we not have this here good if you said it's because we don't have that in the modal data that's correct so let's go into our provider modal provider and we just need to create that type in here so say plans is going to be an object with the default price ID okay set to plan I'm going to import this from Prisma client and the plans is going to be data uh price list at data like this okay and let's go back now and now you will not see any error good job if you actually guess that correctly okay nice and after this after we create this state we're going to create one more uh state right below called subscription and set subscription which is a which is going to be an object with these two things okay subscription ID and the client secret this is what goes into Stripes form okay and after this we're going to say const options equals stripe element options and I'm going to import this okay from stripe um stripe JS give me one second guys I think we actually have to give me one second okay so just go ahead yeah so just import this we also have another another package to import and we'll do that in just a second so import use memo as well and this is basically going to memorize this object okay which is going to have client Secret and appearance theme flat because we're going to use components from stripe react components okay and that actually needs this object to you know get the client secret so it'll render the stripe form and it needs the appearance flat on it as well so what I'm going to do is I'm going to open the terminal quit the terminal now refresh the page and say bun add okay bun add at stripe SL react dstrip DJs okay and go ahead and hit enter and there there we go that installed it for us already so now we can use this okay I think we might need types let's see if we do if we do we'll install that as well so cool and now we need a use effect so when this component renders what we want to do is we want to fetch the uh we want to create a subscription okay which gives us a client secret and then we're going to store that and then render out the form so I'm going to say bu run Dev so we can see what we're building as well and let's go ahead and build out our use effect in the meantime so here go ahead and say use effect okay which is going to be a function here with an empty dependency array for now and um like this and this this dependency array will now need data selected price ID and the customer ID not custom sorry customer ID like this and inside this use effect we're going to do the following so if there is no selected price ID return okay and and if that does exist then we're going to say cons create secret equal to an async function okay like this oops sorry and in here we're going to um say const subscription response so con subscription response equal await fetch like this and inside this we need to pass in first the endpoints and the endpoints is API stripe SLC create subscription let me make sure we also built this I know we did I just I just want to make sure so stripe create subscription route all right nice yeah we built that um let me go ahead and close this okay and we want to say this endpoint and then after that we have to pass in the method and headers right so after this put a comma and you're going to say the following create an object say method post headers is content type application Json and the body is going to be json.stringify with the customer ID and the price ID okay and then after um this right here so after this fetch command hit enter and we're going to say const subscription equal to subscription response data equal await this response. Json okay CU that's where we get the client secret and then finally we're going to set the subscriptions uh subscription state to hold that client secret and the subscription ID okay now if the plan exists so go actually inside this itself if the plan exists in here I'm going to import toast give me one second import toast as well if plan exist and where does this plan exist come from this plan exist comes from our props okay if a plan already exists then we're going to say your plan has been uh successfully upgraded okay and then we're going to set close so we're going to close that and router. refresh okay nice good job I know that was a lot of stuff but you're getting there and at the end of this function go ahead and invoke this creat secret so when this spins up we're basically going to show this so if I click on this well nothing is is there right now right we don't have that subscription form wrapper uh imported so let's go ahead and import that subscription form wrapper I think I made a spelling error here let me copy this subscription okay I'm just going to copy whatever I have here and I'm going to paste subscription form wrapper like that okay and now that solves that problem and let me go into the subscription form wrapper so we can continue this component and after this is done remove everything in here inside this and say class name is equal to border none transition all okay and then create another div with flex um flex-all and GAP -4 okay like this and inside this you're going to create an object oops this has uh done the same problem just going to quit this all right guys let me know if you see that by the way it might be because of the middleware and you know everything refreshing but I didn't see any problem in production okay please let me know if you guys see that see that error as well and in here we're going to say data. plans. plans like this so data. plans do uh plans. mapmap okay and we're going to return a card okay and this card is going to have a key set to this plan in here so I'm going to say price actually and we're going to say price. ID okay and then an on click and some class names so let me first put the class name so the class name here is going to be clsx I'm going to import that and relative cursor pointer transition all and this and Border primary if selected price ID is equal to price ID so whichever one they're selecting on we're just changing the color the Border color of it okay and um after this we're going to have this card header okay so the card header is going to be very simple it's just going to have the following so I'm going to import these components and it's going to have the card title card header right card header card title which is price unit amount and we're just going to convert that divided by 100 or we're just going to send zero and then we're going to save the price nickname okay hm I don't know if we did we even put the price nickname let me see so in here huh we'll see okay if it shows up nice if it doesn't well too bad okay and let's go ahead and import our pricing cards okay just like that and this is just guys this is simple stuff okay we're rendering a paragraph I'm not going to explain this you guys are not newbies anymore okay you're a pro all right and after this after the header go ahead and say selected price ID equal to that price ID then we're going to return this it's like a just like a round emerald uh green color button that shows on top of the card if it's selected okay that's it there and then finally after the card so hit enter enter here we're going to say options. client secret so if that exist then we're going to say um and also make sure that there's no plan right then we're going to say H1 and we're going to get elements and the subscription form and this elements comes from stripe okay so let's go ahead and do that give me just a second so first thing you want to do is I think we already installed a package right I think I think we did install the package yep so let's go up top and I'm going to import elements we don't need this so just elements from react stripe JS let's scroll to the bottom okay right here and now we're going to import get Stripe from our Libs and we have our options which is a memorized value and the subscription form which we're going to create in just a second but right before that at the bottom after this we're going to say if there are no options sorry um where is this hit enter here and say if no options. client secret and the selected price ID then we're going to return the this div with just a loading screen so that basically we're loading the client secret okay so let's go ahead and um render out the subscription of form which is in here so I can actually import this right now subscription form why is it not importing let me see subscription oh what is this subscription form okay just import that all right and now okay there we go now we can see it all right so go into the subscription form and this is going to have the following props so it's going to take the selected price ID and it's going to be of type string or a plan and then we're going to destructure this here okay and in here we're going to say use toast so if we do this we have to make this a client component right and also since we're using this in a client component we have to make it a client component anyway or you know next chest we'll convert it to a client component um either way right and now let's say elements equal use elements this is from react stripe okay and then we need the stripe hook which comes from UST stripe so I'm going to import that as well all right nice and after this we're going to say price and price error so if there was any error we want to show that right there so import you state and then we're going to create the handle submit which is a little big so let's first just create the form okay so scroll down here and I'm going to say return form on submit equal to a handle submit and payment element which comes from stripe and the button which comes from component UI see how we're uh combining both stripe and ours our stuff too guys so this is why you know I didn't find this personally very easily on the internet so it took me a lot of time so I'd really really appreciated it if you gave this a like okay awesome and that way I can provide more more free value for you guys so I'm going to put close this bracket here actually remove this sorry about that and now let's go ahead and create that handle submit function right here so this hand handle submits don't worry if you got overwhelmed I'm going to explain it okay it's very very simple so this handle submit function let's shrink this so it looks nicer and easier for you to understand all right look at that so much easier it's an async function which is a form event okay and if there is no selected price ID we're going to set the price error to you need to select a plan to subscribe because they click submit with no price selected okay then we're going to set the price error to empty if there's you know if the price exists and then we're going to prevent default okay and then we're going to say if stripe hook or if no stripe hook or there's no elements return okay and let's reduce this to one more line nice and then we're going to set a TR catch to say const error await strip hook. confirm payment okay elements and then confirm params we're going to say return URL which is process. nexu URL agency okay we're going to send them there and then it's just going to reroute now why are we doing this so we're doing this because um we want to kind of you know create that code and all that kind of stuff too right so that's why we have this in here then after that if there's an error we're going to throw this error and you know um we're also going to show some in here like a toast and let's open this and here we're going to catch that error and show the destructive variant and console.log the error okay cool now let's go back make sure we I think we already imported a subscription form okay I want to give this a shot I'm very curious to see what happens so let me do Bun Run Dev give me one second guys let me restart my server all right so now if we hit to get started there you go you see this right here it shows this and if we click on a plan okay let's see what happens so if we click on something okay something seems wrong what's wrong we will figure it out okay so first thing is when I click nothing is happening so that's the first thing I notice so let me go ahead and fix that problem guys give me one second okay so when I click on this okay so it has to be some onclick stuff so we have card header this card okay there we go there's no onclick so how's it going to work so create an onclick which is a function okay and in this function we're going to just set selected price ID to price. ID like this as plan okay and now let's see if this works if I click here there we go guys and now it renders that and there we go the entire form shows up by the way if your form is not black color the reason is because I'm using a plugin uh let me see if I can show you it's really cool it's called chrome/ Flags or something like this and basically there's a dark mode and I just I just did that it's so much nicer everything is on dark mode now that's why my stripe is on dark mode you guys don't have this okay there we go see another cool trick Okay so now stripe works and if we hit submit here you're going to notice that this is throwing an error right so just leave whatever you're doing I'm going to explain just stop whatever you're doing I'm going to explain how this works okay so how stripe works is it listens to a web hook okay there's a web hook that runs and every time an action is performed like a subscription updated or a subscription was created this web hook will invoke an endpoint you provide that's it now we haven't created that web hook endpoint we're going to create it in here but that's how it works okay and that web hook will invoke the endpoints and the endpoint is going to save the subscription data so if you see in here that's the reason why in here after confirming the payment we did not update the subscription data okay so go into your stripe folder and now we're going to create this web hook it's actually very simple so go in here create web hook like this and inside this create a route . typescript and inside this route first I'm just going to import the following stuff up top which is next request response headers Stripe from stripe this Stripe from lib stripe and then subscription created from our actions okay so that we can invoke that and then we can save it in the database so these are some of the web hook events that stripe fires okay so I'm just going to create a set out of it and put an array and just put all these values in here okay and then I'm going to export um a function called post like this okay and this is going to take next request like this and first I'm going to create the stripe event okay so let stripe event equal to stripe event like this and then I'm going to get the data so request. text I'm going to extract it and call it body in here and then we're going to get the signatures the stripe signature so you're going to say stripe. headers doget signature um right here and then we're going to get the web hook secret now we don't have this yet but we have our our variable stored right right in here we have the stripe web hook secret so we will be using that okay and you also notice there is a stripe web hook secret live this is not created because in production you would have to put that okay we don't have that running right now and then we're going to say process. env. strip web hook secret and then we're going to use a TR catch in here so go ahead and create a TR catch like this we're going to say if there's no signature or no web hook secret throw an error okay just print an error and return uh if this is all good we're going to say stripe. web hooks. construct event body with the signature and the web hook secret and then we're going to catch any errors and return a next response if something happened wrong and then we're going to create the main body of everything this is where everything happens so after this create another TR catch and in the first in the starting we're going to create an if statement that checks to see if the stripe web hook has one of the events that we have okay stripe event. type so this one okay we want to make sure the event that came in through the stripe event has that specific type and if it does then first we're going to get the subscription which is stripe event. dat doob as stripe subscription okay and then we're going to check if there is no subscription. metadata. connect account payments and if there's no metadata. connect account subscription then what we're going to do is we're going to create a switch statement now I want to make a quick disclaimer okay so the reason why I did this and this is one of the most confusing things with stripe and I did not know this this is how it works but in a local environment all stripe web hook events come to one web hook endpoint only I might be wrong and if I'm wrong please correct me okay but in production there are two endpoints one for stripe events from the subscriptions and one endpoint can be set only for connected account payments okay so your question is going to be will this work in production ction no you would have to make that change okay and that change is simply you would have to create another endpoint okay guys I've taught you so much you should be able to do this if not I'll help you in the Discord but you have to create another endpoint and that endpoint is supposed to accept payments uh for the sub accounts or connected accounts and then another endpoint that will accept payments for the agency subscriptions okay so to distinguish this in a local environment I am adding metadata to every payment that has been made or every subscription that's being made through the products that are being sold or this in here okay and that's how we're controlling this all right guys so let's go ahead and create a switch statement okay and we're going to say stripe event. type in here so stripe event. type like this and based on the specific type we're going to do the following actions so first there are two types that we're going to catch which is these two cases subscription created and subscription updated okay and and for these two cases we're going to do the following so I'm going to just copy this paste it in here and explain for this case we're going to say if subscription. status equal active then we're going to say await subscription created okay and you know where this is coming from right and then um you can import this if you don't and then we're going to say subscription and the subscription. customer as a string and then we're going to just print out a message saying created from the web hook okay and then after that so else console.log skipped at created from web hook because subscription status is not active Okay and after this we're going to say uh default is console.log unhandled relevant event because none of them are satisfied and we're just going to print out the stripe events that was used okay and now after this if statement right here hit enter and we're going to say else um we're just going to do the following we're going to just print out a message saying skipped from the web hook because subscription was from a Connect conned account not from the application itself okay so um after that finally we have to do a catch so we have a catch here and I'm just going to print out an error so in here I'm simply going to say this console.log error and finally at the end of everything okay after this I'm just going to say return next response. Json web hook action received true and turn a 200 response okay nice so now it's going to actually work let me Al read refresh this guys give me a second all right now go back into your stripe remember we need to actually wire up the web hook so we can fire it right so go into stripe go into your dashboard right here okay we're going to search for API Keys like this API Keys click on that and then it's going to give you this click on web hook and then click on test in local environment and it's going to give you something here okay now you have to download the CLI to be able to do this so click on this guys click on this this and follow through with this okay follow through with it uh since we are using bun you can do bun ey or you can also use Brew or whatever in here okay so make sure you install follow through this entire process okay you can also use a terminal for Mac so do this and then once you're done with all of this log in do all these steps everything okay the whole login stuff in here so once you're done logging in only then come in here okay so I'm going to go ahead and do that just give me one second so just as a quick side note when you try to log in it gives you a URL you can click on that URL and then it's going to take you in here and then you can just do access granted or whatever okay so uh it's going to show you something and just give it access so I see an error message I don't know why I see this authorization key you provided does not match okay but I am logged in right it says access granted well let's find out okay let's find out what happened okay it's completed I don't know why it says error there maybe the live mode okay we're not in live that's probably why now follow this instruction okay follow exactly what I'm saying create two different terminals one is going to run this Local Host terminal here so copy this okay paste it in here but you're going to change the following so change this um Local Host make it 3000 so 3000 like this and it's going to be SL API SL stripe SL web hook okay and go ahead and hit enter and let's just see what happens okay nice so it did that and it created some sort of a signature and it gives you access to a key okay a web hook key copy this entire web hook key don't make a mistake here okay I really can't save you after that copy this all right and guys if anything happens I'm there in the Discord I'm just kidding but copy this web hook key go into your environment variables right in here and we're going to go to stripe web hook key and just paste that key in there and now open this and now we're going to run a quick little test so trigger events with the CLI go ahead and copy this event and paste this in here and just hit enter let's just see what it does okay so it said 500 some error has taken place um let me make sure web hook secret or signature does not exist no respones returned from the route Handler I don't think our route is running okay let me quit this guys so quit the server refresh and let's do bun runev again and let's refresh this and let's just see what happened okay so now I am going to do this one more time if it throws okay so I knew it I knew it's some stupid problem here never mind I think what happened is because we changed the environment variable we need to refresh our application so just quit and refresh the server refresh the browser and then restart again okay do Bun Run Dev and then that should work awesome now if you see 200 this means your stripe web Hook is working now very very important when you're doing anything with stripe you have to have your web hook open I can't can't emphasize this enough well what's going to happen you're going to create a subscription in stripe but the subscription is not going to be saved in your database now we just lost okay so the web Hook is needed to sync your database with stripe that's it okay so keep that in mind all right so I'm going to keep this running and we're going to go back in here and I'm just going to shrink this here and now let's go back to our billing page let me just take a look and make sure our billing page is actually wired up okay so the building page is not completely wired up and we're going to update this we didn't actually complete this fully right we have one more thing which is to wire up the add-ons so what we're going to do is we're going to scroll down here so we have a div here so inside the same div inside here at the bottom we're going to paste this okay which is add-ons is data. map. add-ons we're going to get the pricing card plan exist we're going to pass in this data so just copy paste this there's nothing different it's just a bunch of strings and the only difference is in here um which is uh add-on. ID okay and add-on. default price. unit amount and we're just dividing it by 100 and converting it to a number so there you go you see it's populating so we created an object an array of objects inside our constant files with all the possible add-ons available okay and these add-ons simply have the product ID with the title okay so populate this with as many as you like no problem and then here we're mapping over them and and we're simply getting those product lists that's what's happening in these IDs okay we're mapping and getting the product ID creating a new array and that will fetch all the IDS you can also technically remove all of this and just pass it an array with specific IDs okay now after this pricing card we also need to show the payment history right so I'm going to uh put a h2 tag right after let me see after this div right here okay put in H2 and then I'm going to create a table component in here okay and I'm going to import the table component from component UI table this is the styling for it okay background card border one uh border border and rounded medium and inside this table we're going to have the table header we already did this right it's a very simple table so let's go ahead and import all this stuff guys okay hopefully you imported it and um you shouldn't see any error or anything okay and then after that we're going to have the table body so after the header we're going to say table body is going to have a class name a font medium truncate okay we're going to have all charges so every single charge in here we're going to map over that and we're going to return a table row and the table row is going to have table cells that's it it's very simple this table's actually really nice but it doesn't have a bunch of cool features like filtering and all that kind right that's why we use the other table in the previous example so go in here and is defined multiple times what seems to be the problem okay I see table I'm going to remove this and just use this one there we go so now you see the stable cell is this right here okay and all the data will basically show up at the bottom inside this okay good job I'm going to see if I can fix this problem here with the features all right well let's test that in the end guys it's just design stuff we will fix that okay so yeah that's it I'm going to try to give this a shot fingers crossed hopefully it works first thing I want to make sure and I want you to make sure is you have your stripe running so I have my endpoint running and um that's about it and of course I have the server running to right so let's expand this and I'm going to click on this package here and I'm going to probably subscribe for $49 per month and you see it says for serious agency owners it's literally giving some information and go ahead and put the fake card information which is 42 4242 okay and 42 for this too and 42 this as well and here go ahead and just put 42 or just put some something okay I'm just going to put some number in there and go ahead and hit submit okay it took took me to plura so it's going to redirect me to the agency page and boom that's it now it comes back in here okay it comes back to this page they routed me to that agency and if I go into my billing okay so it showed the charge here but my number has not been updated here let me see if I refresh this okay something is wrong guys I'm going to fix this however the charge has been made so that's good news right so let me go ahead and fix this issue okay so I want to kind of debug on the Fly so you guys can see how to debug too um just keep in mind I might make some errors okay so just uh go through with me okay so I'm going to open the Prisma Studio first thing is where are we getting this value from so let's find out we go up top we have the pricing card in here okay and we have the amount so the amount here is agency subscription. subscription. active equal true okay and then we're going to say current plan details. price so first thing I want to do is I want to go into this and I want to print this out I want to print out console.log agency subscriptions and let me see what that looks like okay I see a customer ID and I see a subscription of null so subscription was not created okay so that's probably why and just to confirm if we go into Prisma studio and refresh this you would see no subscription in here okay let me scroll to the right no subscription in here so that's the problem okay and at the same time did our web Hook Fire Let's see so our web hook didn't actually fire what seems to be the problem let me see so if our web Hook was fired we should see some messages in here guys but we're not seeing anything you see there's no messages so that means our web hook did not work even though it did so done let's hit done here what's going on let me see add an endpoint test in local environment we already did this I'm going to go ahead and cancel a subscription from here so where is that let's go back in here go into the payments okay damn someone just paid yeah this person just paid here I'm going to click on this and let's go into this customer okay and we're going to Simply cancel their subscription okay so I have to go into customers first and then I see this here and then I'm going to click here delete customer or you can create subscription where can I delete a subscription I can refund the payments subscriptions here update cancel subscription right there okay so I'm going to go ahead and cancel the subscription they just paid so cancel this subscription from here no refund too bad let's go ahead and cancel that all right that subscription is cancelled and I'm going to go back to payments that doesn't have any problem now let me figure out why my handpoint is not working so I'm going to run this one more time and hope this works okay let me refresh this page okay and we're going to try to run the subscription one more time so this might mean that they might get charged multiple time guys I'm not completely sure but we're going to try okay we're going to try so 49 oh let's try the 199 all right guys so it's still not working I'm not sure what's going on but I am going to find the solution so just give me some time I will get back to you the solution all right guys I finally found out what was going on and don't worry I'm going to show you the debugging process as well as what was going on okay and the solution so first thing is when you do stripe login it's going to send you it's going to give you this link and you can click on it and open it in the dashboard and it's going to ask you to just confirm that the pairing code is correct okay now when I did that I think for some reason it was using the live test key in here okay so to the solution was to basically do strip login dasi which means interactive so it's manually uh we're manually doing it so once you do that it's going to ask you it's going to prompt you for the code so it's going to say something like let me see if I can find that where is that right here it's going to say enter your API key go ahead and copy your stripe key and paste it in there okay and hit enter and it's going to ask you how would you like to identify and just hit enter because we want Dev up Dev local okay that's it and it's going to say something like this it's going to say done the stripe CLI is configured and it's going to give you the account ID and that's it you're pretty much set now you can go ahead and forward uh just do the the same thing that we did right which is the forward to localhost sl3000 API SL stripe SL web hook not R.J like I added a mistake here so just do that and then when you hit enter it's going to wire up that so see I made that mistake and I wired that up and it worked and now everything looks good so I'm going to go ahead and do that one more time okay and if I fire this succeed succeeded payment intent I get 400 okay it's because something's wrong here so I'm just going to refresh my browser so say Bun Run Dev and go ahead and refresh this and let's go back okay and I'm going to quit this and let's just give this a second to load up guys okay and now when you go down here to your stripe and you forward it to localhost sl3000 to the web hook and now if you try to fire the event okay we see 400 and why do we see 400 no signature found matching the expected signature let me go in here and hit done first of all okay I thought I just fixed it no signature are you passing the raw request body you received from stripe I think so I'm not sure all right I guess we're going back to this so give me one second okay okay so it looked like okay so it gave me a new web hook signature um signing secret I need to copy this and ours is outdated so go ahead and remove that and paste in the new one and now if you call payment intent succeeded we need to refresh the browser too of course cuz we changed our environment variables right so go ahead and say Bun Run Dev so uh refresh the browser here and say bun runev and let's go ahead and refresh this let's just give that a second to spin up okay and now if we call this endpoint nice there we go 200 so you see how we deboed but I want to show you how I actually got to the bottom of this so the first thing I did was I went to stripe and I looked at the end points okay cuz everything was wired up clearly we were seeing you know the success response locally but everything coming from stripe was not firing so that means I think we were doing something wrong with the local listeners so I came in here and I realized there were no local list like this page wasn't there right so then I hit add local listener or I I mean it's it had a test account at the bottom or something it says add local or test in local environment so I clicked that and it took me here and then I went ahead and you know put all the info again and I did the same login process and then yep that's it and it showed up it took me a while to get to this but this is how you debug okay cool great job and now let's go ahead and try to create create that subscription for this poor user for the third time so let's go in here click on this and let's give them the maximum plan okay $199 and we're going to say 42 so just put this fake credit card information and give me a second I'm just going to populate this okay and now go ahead and hit submit fingers crossed let's see it's loading it takes us back to Local Host agency and it brings me back here and then when I go to billing there we go okay so something happened weird it only signed me up for the $49 plan now what happened there like when I okay so probably when I was clicking I didn't click correctly let me hit change plan and click on 199 H customer subscription updated okay so I'm going to go ahead and click on this let's put in some data in here hit submit let's see what happens okay all right guys I know what happened so this is what happened the subscription setting is set in such a way that when you update the plan the the user only gets charged at the end of this current existing plan and any pro-rated amounts are charged that's what's happening okay so that's why when we updated the plan here we saw the change immediately in here but in this area it did not show the 199 plan and the reason why it was also not showing inside the subscription and was showing as incomplete is because I mean it wasn't made right we it was still pending for a future date so that's why that was happening but like locally it's updating inant L okay so that's the problem so now for example if I change this plan and I quickly change it to 49 immediately it's going to process everything it's going to update it to 49 but it's not going to show in here okay that's what's happening okay so now here is an amazing amazing challenge for you if you haven't watched the last video you probably don't know what I'm talking about but that's okay because in the last video we explained this this feature basically if you go into our main page which is the Local Host 3000 you will see that each and every Clan has a level of access so we have three sub accounts two team members and unlimited pipelines right so what you have to do is based on the you know the price or their subscription tier you have to give access to these okay it's a very simple I and tell you how to do it basically you are going to check if they are on this tier and if they are You're simply going to prevent any action from taking place so for example in the place where we are creating a sub account we want to check how many sub accounts they have okay and if they have three already then we're going to show a toast saying hey you have reached your max benefits and consider upgrading to get access to Pro features that's what you have to do so go ahead and take this up as a challenge and I hope you get this right and if you don't know how to do this you can go and quickly take a glance at the previous video which was amazing and we had everything covered in that of how to plan options and to give you an idea of where it is it is towards the end of the video inside the stripe configuration okay you can take a look at that if you'd like all right guys so now we want to have the ability to connect stripe accounts for the agency let's go into Launchpad so you're going to see this Stripe Right here this is what gives us the ability to create that connection feature so the first thing you want to do is go into your agency agency ID and page. TSX for the Launchpad and we're going to do the following so after this go ahead and say const stripe ooth link okay is get stripe oo link and this actually comes from helper function so we're going to go into Libs we can go into stripe sorry let's just go into this one okay which is utils and in utils I'm going to paste it in here like that and now we can go ahead and import that from that component okay so let me go up to Launchpad and import that right here so after importing this what we're doing here is we're getting the oo link so with the agency and we're doing Launchpad uncore this so we're just creating that link basically okay now what we want to do is after this this we're going to say that connected stripe account is equal to false by default and then we're going to check if there are any search params so if you remember I did explain a while ago that inside the page. TSX right the root page out here/ agency what we're doing is we are checking for that code and the state right and then we're sending them to that specific agency or sub account or whatever it is and we're also passing in that code so we need that code here to basically use stripe ooth to authorize that's what we need this for this stripe comes from lib stripe so I'm going to go up here and I'm going to import that and now if you scroll down here you're not going to have that error so what we're doing is we're saying if search pam. code exist then we're going to check if there's no agency details. connected ID so only if there's nothing then we're going to try to connect so we're going to say try cons response equal A8 stripe off. token Grant type authorization code and the code is supposed to be search pam. code pause this video and type this please don't make this mistake in any spelling mistakes here cuz it's going to be hell for you to debug okay and then here we're going to say await db. agency. update where the ID is like this and we're going to just set the connected account ID to response from here do stripe user ID that's it and then we're just going to say connected stripe account equal to true and then after this here at the bottom we're basically going to use that to determine whether to show the a check mark for this or not okay so you want to scroll down here where you have this image which this P tag which says connect your stripe account we want to basically change this button okay so this is no longer going to be a button it's actually going to be a link so go ahead and remove this button and say the following so we want to say agency details. connected account ID if that exists then we're going to do this so if this is true then we're going to check this connect stripe account so if this is true or this is true one of them then we're going to just show the check icon if not we're going to show a link with the following class name so go ahead and put these class class names too and the hre is going to be set to the stripe oo link and if you see what this is let's go in here and read it okay sorry we skipped this so I I just wanted to show you that first and then I wanted to explain so we have the agency and sub account type so the stripe ooth link basically sends the user to this specific address okay and it says type code client ID and it's going to put the client ID that we stored right remember that client ID that one and then it's going to say redirect URL which is going to be this to whichever account type they want so sub account or agency and we're going to pass it another param with the state and the state is going to be that ID that I was talking about okay awesome so that's what's happening so we're going to send them to that page and then stripe handles all the onboarding we don't have to do that manually if you want to do it manually you can do that as well you just have to have like 100 fields to get all their information and it makes it very very difficult so the good thing is stripe actually makes it a little customized where they give you the ability to to you know hide their logo and all that kind of stuff well not completely hide but you can brand it to your liking right I don't know if you remember we did that in the start so that's what we got to do in there all right all right guys what we're going to do now actually before we click on that link we need to make a quick change so go into agency and page. TSX not this ID and here we actually only using two underscores this has to be three okay so change this one too and let's go into sub account and see if we have that problem there too which is inside sub account page we have okay here we have three so now it should work now if you are doing this for the first time what I would suggest is go and create a stripe account for this user that you use to log in I hope you did not use the same account as the owner of as plura because plura is a business right now we are operating as the business owner we're not operating as the agency okay these are just our users for our application okay so keep that in mind we're going to go here to Launchpad click on this and now when you click on stripe uh it's going to take you to a page but basically create an account in stripe with this agency user email okay go create an account and come back okay so once you're done creating an account in stripe you can also do it through this onboarding process but the problem is that it's going to ask you a bunch of information it's going to delay it and I it's it's just too annoying okay open stripe like this and create an account for this agency email and hopefully please if this agency email is the same email that you use to set up stripe and all the products and stuff like that go ahead and delete that agency delete the user to and log in with a new user okay and that user should not be that same email so now go ahead and click on stripe here okay and now it's going to take you to this page if it shows you this click on this and click on switch user okay if it doesn't then just type it like this and then hit continue now it's going to take you to a page here if you do not have the account created it's going to ask you to create the account it's going to show you a bunch of stuff but if you have already created it it's going to ask you for the password to login so go ahead and put that and log the user in and now it's going to show their unnamed account so once you come here do not hit connect go up here and hit skip this form it's going to fake submit it's going to go back take the code take you in here and boom there you go now we have connected the stripe account so if you refresh this page there you go guys the stripe account is now connected so you can go to Prisma refresh this and go to your agency and you would see the stripe account ID all right how awesome is that now you can literally do anything with this you can send money deduct do whatever you want right great job guys I'm so proud of you we did a lot of cool things right now so let's move on okay now we want the sub accounts to also have the ability to connect their stripe account so go into their Launchpad right in here and we're going to basically scroll up here and remove this work in progress uh work in progress tag and we're just going to do the following so first I'm going to say stripe o link and it's the same thing guys nothing different okay so I'm going to import this and I'm just going to you know say let stripe account like this literally the same thing nothing is different okay only the things that are different is the you know the different uh variables that we're passing in here like here we're using sub account and here we're using subac account details. so pause it and just type it out okay and here I'm just going to import stripe like this and we're going to do the same thing here nothing different except db. subac account. update okay we're going to update this and just change all this stuff too okay you guys know you guys are Pros now okay and now we're going to scroll down to the bottom where do we have that connect connect Stripe Right here and we need to replace uh we need to put a button in here right or the what do we call that the link so after this paragraph tag you have this div hit enter and you're going to say subac account details. connect ID or this exists and if it does show the check icon if not show the link so if I go to the sub account so I created a new sub account here so you're not going to see anything in here because the dashboard has nothing but let's go into Launchpad okay and now if you see this it's showing this start link right here so let's go ahead and click this okay and let me see so here I'm using Pro okay so I'm using this account let me verify my team members too okay all right we don't have any team members all right looks great so what I'm going to do now let me go in here okay and I'm going to go to the Launchpad click on start it's going to take me to that page and now I'm going to go ahead and click on this and I'm going to switch the user to a different user okay I'm just going to use a different account go ahead and continue here it's going to ask me for the password because I've already created um this user create your free oh it's asking me to create let's see what happens here okay and hit continue okay in my I I'll show you what it looks like okay let's see if it shows um all that process so let's see okay what is this what if I skip this form let's just see let's skip this form here and see what it does okay it did this and now if I refresh nice and if I go in here and refresh go into sub account okay there you go you see a connected account ID that's exactly what I want to see right awesome and let me also make sure the account IDs are different so 10 Z10 let's go in here 10 z0h hm okay let me go back to sub account okay nice they're different for a second I was like what okay cool nice so now even sub accounts can connect so we have two accounts that are connected in here right now and since we have connected with that email I'm also going to connect that give access to that user so let's go to Team and I'm just going to give access to that user here so add and we're going to send it to um this email and they're going to be a sub account user I'm going to send the invitation you're going to see this error because you know I told you the clerk email stuff right and and now I'm going to go ahead and log in all right guys so just give me one second okay I also want to show you guys something real quick take a look at this so if we go into bolt shift let's go back into our agency wow that was fast and let's go into settings and if we change this to not you know and um if we remove white label agency and save this we're going to see um let's go ahead and okay so if you go back to another sub account right another sub account user now you will see their logo will show in here so it's like basically we're not white labeling everything right that's what we're doing here so that's why it's called White Label so now you see our logo and you'll see their sub account logo nice I just wanted to show you guys that cuz we never tested it all right all right now we're going to build funnels so this is the really I I guess the most fun part of this whole project right so let's go ahead and open the sub folder inside the sub ID we want to create another folder in here called funnels like this and create a page. TSX okay so there's going to be a bunch of stuff in here guys just give me a second um we're also going to have uh let me think yeah we're going to have the funnel ID so create a folder a dynamic folder with the funnel so funnel ID okay like this funnel ID and inside this funnel ID we're going to have the editor so say um editor in here editor like this and that editor is going to have another folder inside it called funnel page ID okay so go ahead and say funnel page ID like this and the funnel page ID will have another will just have a page. TSX um inside this okay so I know this was very deep but that's the only way to do this okay so I'm going to go back to the root of this and let's start from here so this might be a little painful okay and the reason is because we are using the older table in here so I don't want you to waste any time so here's what you're going to do go to GitHub Okay click on funnels don't copy everything because there's a bunch of stuff we need to wire up okay just go to funnels page. TSX so that page only nothing else okay and you're going to copy everything from that file and paste it in here please follow exactly as I say okay you see there are so many issues in here so copy that and paste it in here okay pause the video do it and then come back nice now we're going to go into your folder structure and inside this funnel you're going to create um data- table. TSX okay and inside this you're going to go ahead and uh go to GitHub again copy everything in that uh data table and paste it in here guys there's nothing in here there's literally the only thing that is in here is um what do you call that um is you know it's just the funnels right it's a funnel it's just showing all the funnels in a T tabular structure that's it okay it gets more advanced when we go into the funnel ID that time we'll build it out okay so copy that and paste it now go into columns inside your GitHub too so go to GitHub and go to columns and I'm also going to create the file here so columns. TSX and I'm going to paste everything for the columns file and now go ahead and fix this custom model here so delete I'm going to remove this go to custom model and repport that like that okay nice let me close this and then we have another error inside this page so the create funnel columns is also causing an issue so let's see what the problem is so inside columns what is the problem there let me see so columns from columns okay so in here we need to I'm exporting something incorrectly here let me go see what I'm exporting from this columns file okay so I'm going to go into columns one more time okay we're exporting huh what did I do in here guys sorry I copied something incorrect so you want to go into columns. TSX sorry about that and we're just going to paste this right in here okay sorry guys I actually copy the wrong file so copy the The Columns and just place the columns it's nothing but just I'll explain it okay just copy it for now there's nothing in here other than the name of the funnel the last updated and the status whether it's published and we're not even using this one so just copy that and paste it and now I'm going to solve each of these errors in here so first get funnels we need this query so so I'm going to go ahead and um copy this function uh copy this query go into Libs query scroll to the bottom and I'm just going to paste it in here okay very simple thing it's just going to get the funnels or the sub account ID is like this we're just fetching okay nothing but the other additional thing is we want to include the funnel Pages as well okay that's the only additional thing so please please follow with me okay follow with me you'll be good and then after that we're going to uh get the create funnel and this create funnel is actually um a new form so I'm just going to say funnel form okay it's renamed and I'm going to change this to funnel form okay so go into your forms now right here where is that components forms and create funnel D form. TSX like this and I'm going to copy so go back into your GitHub go into GitHub go into create funnel. TSX okay that's inside the form all right go into that it's a it's just renamed if we just renamed it okay so it's going to look like create Das funnel like this okay so rename that to funnel form so that's that's all you're doing we're just copying copying the same content from there copy and paste the content in here okay and I'll tell you what this uh this component does too so file upload we need this file upload what's the matter with this let's see so let me go to the bottom where we're using that file upload component and I'm going to re-upload this reimport this and that should fix that error okay nice and the sub is going to change to sub ID like this you know you guys know this problem right okay sub account ID awesome so we solved the error here so let's go back into the component and import so this create funnel is now going to change to funnel form okay so change this funnel form like that and that should solve that problem nice and then let's close this and go into your data table we see custom model going to remove this go down and import this directly from here okay nice and okay that solved my problem nice and inside the columns. TSX I see funnels for sub account okay so this is I think this is another type that we need to create so what you're going to do is go into Libs type and we're going to create a type okay so scroll down here and we're just going to say export type funnels for sub equal to Prisma promise return type and we're going to import we're going to import get funnels okay go ahead and import that and that should solve that problem so now I'm just going to explain what this is don't worry there's nothing here other than a bunch of tables so if you go into funnels you're just going to see tables in here there's literally nothing else okay and it has the create funnel um you know form where you can put the name description subdomain so this is the thing which I'm going to explain so let's go back um just a second okay so now we're going to go back into our funnel form uh right here okay and I'm just going to Quick you know quickly just go through this you guys probably know what it is but I just want to show you so right here again we're getting the modal uh we don't even need this I'll remove these things we just need set close we need router and we're just doing use form and this is is going to have the name description favicon and subdomain now what is this subdomain now the subdomain is where um the this funnel is going to be hosted so for example web prodigies plura app.com or something like that right so that is the subdomain so that's the subdomain people have to put the user has to put in here to see their website go live okay and then you know the description is pretty straight forward so if you scroll down you have the description component right here which is a form field so please I hope you copy pasted with me if not go back and watch and do it exactly with me okay form field in here form field in here for favicon okay and we're not even using this but I put it in here so you guys can take this up as a challenge okay I'm just going to put a challenge note up top here challenge use favicons okay do some research I already I did a lot of research for you at least you know learn how to use images okay and then we just have the button to submit that's it so when you create that it's going to show up in here and if you don't know how to create this unique this I mean complex table which has a search functionality and all this stuff you need to go and watch the previous table okay we did it in here right that was for uh one of the other pages I think that was for team members so go and watch that so you understand how to create this table from scratch but if not just copy paste it okay save yourself a bunch of time nice so now let's go ahead and create a funnel so I'm just going to say let's call this funnel hm lead generation okay and I'm just going to say this is to get lead leads and the subdomain is going to be R prodigies okay and I'm I'm just going to skip this for now and let's go ahead and save awesome there you go it saved it and it did this okay and um this is just you know a legion this is a link so if you hover over it you see at the bottom is showing the link there right sub account SL whatever right so when you click this it's going to take you to the other route what route is that open this folder scroll up top I'm going to shrink everything so it's easier go into app main Sub sub ID funnels and now it's going to take you to that specific funnel ID okay so that funnel ID in here is going to have a page. TSX so open this and create a page. TSX like this shrink everything else it's not needed and inside this page. TSX we're going to do the following so let me go in here and I'm going to just return something okay sorry just going to return something in here and I'm going to change this to funnel page like this so funnel page okay let me shrink this so you guys can see clear and in here we're first going to get the pams so pams is going to give us funnel ID which is going to be a string okay and we are also going to get sub account so sub account ID which is going to be a string like this nice and then let's go ahead and destructure from here okay we get pams and then we want to um we want to do the following so first thing we want to do is change this to an Asing component okay and in here we're going to say const funnel Pages equal to get funnel so not get funnels get funnel okay so we're going to go ahead and create this so go into your queries file which is in here scroll to the bottom Libs queries and just say const oops sorry not this um const get funnel equal async funnel ID okay we're going to uh go into the funnel and we're going to check where the ID is like this okay but we're going to include all the funnel pages and we're going to ascend uh we're going to sorry order them by ascending order okay and now we're going to go back back in here and we're going to import get funnel don't import get funnels okay get funnel and then we're going to check if there is no funnel page redirect the user to the subac account p/ funnels okay and if there is a funnel so a funnel actually exists now we're going to use the same thing we did um you know the tabs right for pipelines right we used some tabs we're basically going to use the same thing in here so was it for the pipeline yeah I think that's where we used it right let's let's see yeah right here we use these tabs right so same thing so what we're going to do here is we're going to basically say blur page so remove this blur page and inside this blur page we're going to pass in a link component and this link comes from next link and we're going to pass in an href and a class name okay the HF is going to say sub account SL perams slf funnels and then this one is going to have this thing pam. subac account ID sorry guys and then the class name is flex justify between Gap four margin bottom of four text muted a foreground okay and then after this link so this can just actually yeah let's just say back in here like this and after this link I'm going to create an H1 tag and I'm going to say funnel page. name so let's go back to the funnels here and if you click this it's going to take you to that funnel page okay and it says lead generation awesome and now after this H1 tag we're going to have the tabs component so I'm going to copy the tabs component we're going to have some errors we're going to fix that in just a second so go ahead and import all these stuff and even after importing you're going to see this and this throw up as an error okay that's fine throw an error okay so just go ahead and import all of these just give me one second okay so now there are two uh triggers so two parts in here one is the funnel steps and one is the funnel setting so the funnel steps is basically the entire funnel um structure right we also using drag and drop there so that's here and then after that we have the funnel settings so for the funnel set settings what I'm going to do is I'm going to um go into the components right or you can just build it in here actually yeah so let's uh inside the funnel ID create a folder called underscore components like this and inside that we're going to create funnel Das settings okay. TSX like this and inside the funnel settings we're basically going to uh return something in here okay now um basically I'm just going to paste this all right and we're going to address this one by one so uh first thing is this funnel form okay so create form is going to change to funnel form and this is funnel forms so let me go ahead and import that manually so we have create funnel here this is funnel form um create funnel form what did we call that guys oh I think I know what's wrong so let's go in here into our forms and our funnel form has a different name cuz we copy pasted it right so change this to funnel form copy this and go to the bottom and change this to and now if you go to that component um inside funnel settings you can import funnel form that's that's the problem there okay so funnel form is imported um what is it saying card so what I'm going to do is remove all of these go down here and import just one so import card from UI card and then I'm going to go in here and paste all of these in here okay nice and then we have this funnel products table now this is another thing where we're going to show all the products that can be sold inside that funnel so how does this work well the user can go into their stripe account and they can create products in there and strip and our app will basically automatically fetch all those products and it will show it on the screen okay and now the user can check each product that they want to sell or remove them from the uh from that specific funnel and each and every funnel can have you know a different variation of products Okay cool so this is super Advanced you see like I'm sure you've never seen something like this so what is this basically it's a funnel settings page okay this is not rocket science and we're just getting the sub Account Details okay and then we're checking if no details just return but if sub Account Details exist then we want to check if their connect account exists and if that doesn't exist then go ahead and uh return but if it does exist then we're going to get the connected accounts products so right here sub account Det tails. connect account account products okay so now there's one challenge here when we try to access the products right if the account is not cancelled we should not show The Funnel page so try to use some logic to basically prompt the user to go connect your stripe to sell products something like this okay I'm also going to show you a great example of this because we're going to build the same thing for dashboard so that will be a good good example for you to um you know use that knowledge and build the same functionality for this too so in here uh we're going to get those funnel products and then we're going to pass those products into this funnel table okay so we can show the table and this is just a funnel form guys for so that they can fill it fill it in all right so let's go back here to the funnel steps where we're seeing that error in this page and I'm going to hide the funnel steps and I'm going to import funnel settings from here okay so we can see something at least okay what seems to be the problem modules not found funnel products table not found okay that's because it's not built so what you're going to do now is you're going to go into these components right here so remove this funnel product table um I'm just going to copy this name so it'll be handy and I'm going to go in here and inside components I'm going to say funnel Das products funnel Das products I think products yeah okay funnels products- table. TSX okay and in here we're going to render that um that funnel products table okay and this is also a very simple table nothing crazy but I'm going to copy it and paste it and explain every single thing in detail all right so first thing is I'm going to import everything so go into uh go into GitHub copy this component paste it in here and we're going to you know import each and everything one by one okay so go ahead and do that and come straight uh to this video all right awesome hopefully you went ahead and up uh up you know imported all the components you are going to have some errors the first one is the queries cuz we never created this query so if you went ahead and already imported that great job okay but if not I'm going to show you don't worry about all this okay just forget about it for a second I'm going to explain so let's go ahead and go into our queries file scroll to the bottom here and I'm just going to paste this update funnel products so basically we're going to get the products and the funnel ID okay so we're going to say um data awaits db. funnel. update where ID is funel idid and we're going to set data to live products to the new products okay we're just updating it in there so let's go back now and now you should not see that error so what are we doing in here basically we're first getting some default data okay which is the funnel like this and then we're getting all the products which is of type stripe. products and it's an array of them now in here we're getting router is loading you know what this means and then live products so this is a state we're setting locally okay and its default data is being set in here so I wish I could show you guys what this looks like so let me zoom out okay it's not it's not working but basically what this looks like is um it's an object with a product ID which is a string reoccurring which is a Boolean okay and it's an array of that or it's going to be an Mt okay and what we're doing in here is we're saying default data. live products okay we're converting that we're doing json.parse or we're just setting an empty array um as a string here so and we can parse that okay cool now um so right here so we're creating a custom object all right guys don't forget we're creating a custom object for each and every product and then we're converting that into Json and storing it in the database that's it that's what we're doing so in here um let's scroll down so we just have a table table table header table rows all this kind of stuff okay and all the steps and uh uh all the headers and then we have a body so the table body is the following so we have a row here so for each uh table entry right we need to have a row so we're going to say table row we're going to say uh for all the products we're going to map over that and create a table row with the table cells the first cell is going to be the input box so what is this input box this input box is basically a checkbox so if you check it it's going to go live if you uncheck it it's going to you know not be live anymore so um default checked is pro if live products. find okay where the product. product ID equal product. default price. ID okay if that is true then we're going to set that as the default check and then on on change we're going to say handle add product to the product so when you tick it we're going to handle add product here and this does a bunch of stuff what does that do this is what it does so it says product ID exist so if the product ID exists live products. find sorry um we're setting this variable here live products. find that specific product ID that came in here okay and if we find that so we're going to say if that exists then we're going to set live products okay live products. filter um the products where this is not equal to this okay so it already exists so that means we have to turn it off so it's not going to be live but if it does not exist then we're going to create the new entry so product and the reoccurring so remember this right here okay that's it and then let's go down here and the next one is the image of the product so this image comes from stripe okay so product. images at zero and then the name of the product which is product. name and then we have the recurring or onetime payment so we're going to put that in here and then here we're going to also have the default price so what is the price product. default price um do unit amount and we're going to put that um you know value in here okay that's it and then we have a button to save the products simple right nothing crazy okay so now let's scroll up um so this is for the products table I'm going to close this and see what we have in here so yeah going back to our funnel settings go ahead and import funnel table like this so This aror goes away okay if you refresh now you you go into funnels click on this funnel now you can see the settings so now you can see the product table in here and you see the funnel details so you can go ahead and update whatever you like or you can uh you know save the product so if you save this now there's nothing so there's no point so let's go to um stripe and let's see if this works okay so this account um is owned by let's see who so let's go into what is that team okay is owned by this account okay so go ahead ahead and log in with that account that you just created so if you created a sub account go and go to your stripe make sure you have already connected this sub account in here to make sure you connected the sub account through the Launchpad and I think I have all right I have so now go ahead and log into stripe with that email okay I'm going to do it so just give me a second awesome now when you log into stripe through that sub account right you're going to notice it's going to show that you are in partnership with plura right here this is how cool that feature is right this is why we have stripe connect um you know wired up so now if you go to products so I'm just going to look up product catalog like this we're just going to go ahead and create some products here so I'm just going to say uh website development okay oops this is wrong website development let's I'm just going to go ahead and also add some images in here so I have some already saved let me see yep I already have some saved so I'm just going to add this one uh maybe I'll add this one right here um best websites in the world okay and then we're going to set this to a onetime payment and we're going to set it to $4,000 and U that's it that's pretty much all you need save this product and just go ahead and create as many products as you want okay so I'm going to go into product catalog and create one more product in here and this one is going to be a reoccurring payment this time so I'm going to say uh design so web design service and I'm going to upload an image I'm just going to use this image and I'm going to say um get unlimited support for your design needs okay and then scroll down and we're going to say um 1 1997 per month okay on recurring and that's it and then you can go ahead and save this product as well nice and if you go to product catalog you should see both of these products products in here okay so let's go to plura let's go to our funnels click on our funnel go into the settings and now you can see both of those products in here how insane is that and also the prices are also you know wired up in here so if you update this and hit save okay it's going to save that and if you refresh the page that product is now live on you know that funnel when it comes okay so I'm going to take down everything right for now uh but this is how you can create products I'm sure you guys are going to love this cuz I I personally think this is one of the best projects I've built right so all you can do is give this video a thumbs up if you really want free value like this okay so let's go to the steps so I I hope you guys like this uh new method which is you know copy pasting redundant stuff that you have done 1 million times and just focusing on the main aspects right awesome so let's go into the fun funnel um where is that into page. TSX and now we're going to build the funnel steps all right now go ahead and open the funnel ID page. TSX scroll down here and we're just going to undo this um this code right here and I'm going to copy this go into my components folder and I'm going to create funnel DST steps. TSX and just return a component and paste what I just copied okay and I'm going to quickly import this as well from here so go and import funnel steps click on it so it takes you into that component and I'm going to quickly just Place some props in here which is funnels which is going to have funnel for sub like that and funnel page okay sub account ID and the funnel ID so now it's not going to scream anymore okay and you see the funnel steps right here so let's quickly go ahead and also destructure this so I'm going to say this here like that I think um one more okay and finally this is going to be a client component so scroll up and say use client up top and in here we're going to do a couple things so the first thing is we need to uh understand which funnel step is being clicked correct so let's store that in a state very simple so I'm going to create a state called click page set click page and import US state like this and this is going to be a to type funnel page or undefined okay and um we're also taking Pages at zero by default so we're clicking the first page when uh by default okay and then the next thing is we want to uh get the pages State okay so we're going to paste this in here Pages State and we're going to pass all the pages in here to kind of like store all those pages okay and then we're going to scroll down right here to this place and we're going to create the following stuff so first this is going to be wrapped in an alert dialogue okay and in here we're going to create a disc div with a flex border D1 pixel oh actually I don't think that works let me do that again from scratch okay so we're going to create a div here so we're going to create a div here and I'm going to do this and inside this div we're going to create an aside okay so go ahead and say aside like this and this aside is going to have a scroll area so the left side is going to be all the pages and the right side is going to be the settings for that page okay I hope that makes sense so go ahead and create a scroll area so I'm just going to copy the scroll area paste it I'm going to explain in just a second so shrink this import the scroll area okay and we're going to say scroll area height of full and then we're going to say div we're going to import this check from Lucid react to check icon with a funnel steps okay it's just going to say funnel steps up top it's kind of like the header okay the top section and then we're going to have this drag drop context okay and this drag drop context guys it actually comes from uh from our react uh beautiful drag and drop okay if you remember so I'm going to scroll up top and I'm going to import all this stuff up here so drag drop uh drop context drag start uh drop result and droppable because I'm going to need these things okay and then in here we have that imported nice and these two functions are needed so we're going to get back to this in a second and um inside so we're basically getting all the pages and for each page we're returning a dropable okay a droppable like this so um yeah we're just returning a droppable in here and that needs a provided okay the provided function and that gives us access to Something in here so we're just going to say div and we're going to use the D structure and put this in here and say ref is provided. interf and we're going to get the pages state. map okay for each of the pag Pages State we're going to get all of the pages and we're going to create a funnel step for each of those pages okay very simple so this way we can see cards on the left hand side and if you want to see what this looks like you can go and go back to the starting and you can take a look at that okay so the first thing we're going to do is let's just complete the this on on drag start it's a very simple function okay and this on drag start actually does this okay so let me go in here and I'm going to say on drag start so the event is drag start okay let me make sure I imported that too all right nice and the current chosen page so we're going to get this uh draggable and event in here okay and we're going to basically say value pages. find um I'm not sure if we're actually going to H all right I don't think this is actually needed guys but I'm just going to keep it in here anyways yeah I don't see this doesn't do anything in here I think we I think I just wrote something and just forgot about it so yeah sorry about that but anyway so then um I'm going to just populate the on drag end okay that's probably what we need but yeah so I'm going to copy the on drag end and let's look at that in detail so what this is is basically on drag in is a function okay that takes a drop result and we're going to say const destination and Source we're going to destructure it from the drop result okay then we're going to say if there's no destination it's the same thing as the last time okay or the droppable ID is the same as the source so we're basically dropping it on the same right same place so no destination and it's the same position return if not we're going to change the state okay so what we're going to do is we're going to say new page order so the New Order is going to be everything in page state do two spliced Source index to one and then two spliced destination index to zero and then page State at zero at at source. index we're going to get all of them and we're going to return a new object okay with everything in page but we're going to put the new index as the order okay the new order as the index sorry about that and then we're going to set the page state so now we have them uh locally uh you know swapped around and then we're going to just make um you know uh an API call to save it in the database very simple so this is another async function uh as query so let's go ahead and create this so what I'm going to do is I'm going to go into queries up here okay I don't have that imported so I'm going to copy um this function and I'm going to go into my queries file okay scroll to the bottom and I'm just going to paste this so basically what we're saying is um upsert funnel page this is going to need a sub account ID the funnel page and the funnel ID and this type is a custom type so I'm going to go to the Prisma um sorry go to types in here and in here I'm just going to say type upsert funnel page equal to Prisma funnel page. create without funnel inputs okay good now let's go back and import that real quick like this nice I'm going to also shut down the server guys because we don't need it right now okay so once you do that what we're doing here is we're getting the funnel ID we're just upsert we're updating that funnel page or we're creating the funnel page okay so um we're going to say if sub accounts we're going to and I mean if these are not present we're going to return and if they uh do exist we're going to say db. funnel page. upsert so we're going to create a funnel page with this ID okay or um empty string right and then we're going to say update everything inside funnel page or we're going to create a new funnel page and the content so this part won't make sense right now but it is um basically the default um component to show to render okay and we're just going to say funnel page. content whatever is given in or we're going to create a new a new editor okay so we're going to say content the ID is body the name is body in here and styles is going to have background color of white and the type is of uncore uncore body okay nice and this way when the editor loads it has this as the first content to show on the screen nice and here we're going to import in revalidate path okay and then we're going to say sub so we're going to revalidate this path okay sub slub ID funnels funnel ID SL um like that and we're just going to say it's of type page that's it so this is the upsert funnel page so let's go back and let's import this now so that solves one problem and just import the toast stuff to you guys know about this all right let's use sonar why not actually sonar is a little different guys so I'm just going to use the regular uh used toast okay all right nice and let's go down here and now we have to create the funnel step card so I'm going to spin up my server again just give me one second okay awesome now there you go you can see something in here right so now we have to um let's just skip this for now and we're going to show the settings in here so I'm going to hide this component okay hide the step card and in here we're going to go after the scroll area and we have this aside right so uh let me think real quick guys just give me one second okay yeah so after um after the scroll area I hit enter and we're going to create a button okay and this button is to create a new Step so import that button right here okay and we're going to use set open which comes from modal um use modal so we don't have that imported so I'm going to scroll up top and I'm going to go ahead and import that as well so let's go ahead and import that just like this okay and now I can actually use that at the bottom so we're going to say set open bring in the custom model and now create funnel page this is a new page a new form that we're going to create so again um this is actually very a very simple component okay not too bad so go into your forms create another form called um funnel um or let's just call this it's is it a funnel page or I think this is more like the page so we have funnel form Okay so so funnel page. TSX this is okay this works okay and the funnel page is going to have the following stuff so I'm just going to copy it go ahead and just copy from GitHub it's not too bad okay there's just a couple things that might alarm you but we will create it don't wor we will we will look look upon it okay just give me a second so the first one is a funnel page schema I'm just going to import this stuff because I don't like errors on the page and the funnel page schema going to go into types and here I'm just going to paste this okay okay so it basically is name and path name that's it nothing else crazy and then um what's going on here okay and then we have another function called delete funnel page so I'm going to go ahead and um create that as well so go into your queries file okay and I'm going to scroll to the bottom and I'm just going to say delete funnel page where the funnel ID like this is equal to that funnel ID just delete it that's it and then that should solve that problem too nice so two errors are solved this one you know the save activity log error change that and then something at the bottom here save activity log again okay now let's look at this component okay cuz we blindly copied it and it looks like there's a lot but there really isn't a lot okay it's just a lot of logic inside the button so um now use model is throwing an error so I'm going to go back into that component um where is that the Ed model up top and I'm going to import that use model and also import the the create funnel page down here okay create funnel page um all right why is it not updating all right it is updating all right there we go nice and um now I'm going to go into that funnel uh page that we were working on which is in here okay create funnel page and that comes from the funnel page right here so what is this very simple component basically um so let's look at this component again okay so this component is very simple it has the router toast we're using form and the default values are path and path uh name and path name that's it and whenever the default data which comes from the uh props change we're going we're just going to do form. reset and we're just going to reset those specific values that's it nothing crazy and now this onsubmit is just going to save all the data okay so let's take a look at that so if the order is not equal to zero and the values. path and there's no values. path name okay then we're going to return an error and say path name the pages other than the first page in the funnel require a path name because the first one okay um is going to be just this like this and after that it's going to have something like second step as you see as an example so that's why we're throwing that error okay I mean we're just showing the form error and we're returning from there if that's not the case then we're going to say upsert funnel page so we're going to create the funnel page and we're going to say for the sub account ID and um we're going to say all the values so the name and the path name for this ID we're just going to create if there's default ID we'll pass that or we'll create a new ID and we're going to pass in the order okay the order that comes in and um then we're going to pass in a path name so values. path name like this okay and this order if you wonder where it's coming from this order comes from the create form funnel so let's go back and see what that looks like so this order is basically page Pages state. length okay and if you go into this um we're basically passing that in there so every time we create a form and we create this funnel page it's going to actually um use that okay it's going to use that order um now that I think about it you might want to actually use default data. order hm let me do default data. order like this or we're going to just say order okay this is much better all right this way we are not overwriting the data right okay and then the path name is going to be values. paath name or an empty string okay and then we want to pass in the funnel ID in here just like this nice U so we're just saving that funnel page for that funnel ID then we're saving an activity log sending a toast refreshing the page you guys know the drill all right and same thing here we have two Fields one for name one for path name and then we have some buttons here that look a little crazy so I'm going to explain that so first one is a submit button okay that's just going to say loading or save page and then we have one in here this submit button is basically to delete the funnel page okay it looks crazy because we put the logic in here nothing else so we're just going to say type button not type submit okay very important we're going to have an onclick in here and we're just going to delete the funnel page okay with and we're going to pass in default data. ID so here we're making sure that the default data exist and then we're going to return this component that's it nothing else crazy in here so we're going to show a trash icon and if we are actually deleting we're going to uh show a loading icon okay and then here we have another one which is default data. ID and this is actually the upsert funnel page so we're going to update the funnel information okay so um we're going to um click on uh we're going to actually first say get funneled so we're going to get all the funnels okay and then we're going to get the last funnel page okay the last funnel page and we're going to say response. find where the funnel ID is this funnel ID and then we want to get the funnel pages. length so we're getting the last funnel page and then we're going to say upsert funnel page okay to be the sub account ID like this with a default data ID like this the order is going to be the last funnel page if this exists pass that in as a last funnel page or we're going to say zero so when we're creating this right um we basically want to let's see what this say says here yeah save funnel page details so when you're creating this we basically want to um h i see one more here which is save details and this does what does this do this is a submit okay sorry guys I'm just trying to read this to make sure we're doing everything correctly okay so this one is only updating I think okay and this one is creating okay so in here if the last funnel page exist then we're going to use that for the order or we're going to use zero because the first funnel page and then visits are going to be you know put to zero and then we're just going to you know create a name because okay I know what this is guys sorry about that this is the copy functionality duplicate functionality so if we have a funnel page that we want to duplicate which is going to be so so important all we're doing is when you click on that right we're going to duplicate it by simply getting the last funnel page and uh first we already have this funnel page right we already have this data so we're going to say default data. content and we're going to set the path name to this slash and just put copy and then we're going to change the name also to copy that's why we did this really really sorry about that confusion um there's a lot of code on the screen right so I'm just trying to read through it sorry about that guys so that's it that's what we're doing in here and that's how we're uh creating that um you know new entry now let's go back to our page okay and after this we have something else to show so on the left on the right side what are we showing here well we have to show the funnel page details right we need to show the exact details of that specific funnel page so let's go ahead and build that okay so after this aside go ahead and create another aside and this is going to say Flex um 0.7 background muted and um P of four okay I'm just going to quit the server just give me one second guys Let me refresh real quick okay and inside this we're going to do the following so I'm just going to copy this give me one second okay and I'm going to copy this and paste it I'm going to explain in just a second so we're checking for the page length if the page length exist only then only then are we showing um this stuff in here or else we're saying create a page to view the page settings okay so I'm going to go ahead and import these components and it's basically the card stuff so let me go ahead and import that just give me one second okay and then I also have this link component to import so I'm going to import the link component and then we have this Lucid react um edit component let's go ahead and import that to and then we have this placeholder image okay this placeholder image is actually uh from here so if you look into your icons um you should find it in there okay so I'm going to go ahead and import placeholder image like that let's see if that comes through all right awesome and then at the bottom I have one more external link icon let's go ahead and import that too okay so this looks crazy I know don't worry I'm going to explain it so if the length exists if we have pages to show okay something is wrong here UI card sorry about that let's go ahead and import this um one by one actually here I'm just going to update that import so let's go ahead and say card go down here okay I'm just going to copy this and I'm just going to say card here import that sorry guys wow I'm just wasting time so sorry okay cool and now that should look good I'm removing this at the bottom and put this from why did it not import okay here I'm going to copy all this just paste it in here okay wow that took way longer than it should sorry guys and now let's go down and we see something in here card header okay all that stuff updates and what's the error this might be typescript okay so I'm just going to reload this real quick let me reload this browser I mean this window okay and that solved the problem great okay so what is this we're just returning a card here okay and this card is going to show um the settings okay so first first it's going to have the title of the page description of the page and the description okay in here is actually going to hold all the components okay so please pay close attention so we have a div here which has a border of two it's kind of like a placeholder okay and we have a link for the entire placeholder so it kind of looks like an edit icon okay and then let me go ahead and create one actually let's see if we can see that guys so I'm just going to say um landing page okay and this is default so it's going to have this thing here let's create that awesome funnel page is created and if I refresh this we will not see this card because we didn't create that but just to show you what this looks like okay so now you see here we have first this border here okay rounded large so uh large border um and then we have small width of 80 like this and width of full on mobile devices and overflow clip okay and this is the placeholder image I just created this in canva and I converted it to an SVG so it's an SVG image so you can actually change the color of this to light and dark mode check this out Okay Okay the reason why you don't see this as light mode is because I'm using Chrome's default dark mode okay that's the reason but it'll be it'll become white basically there you go you see that update awesome and um then um you see you have the name here and all this kind of stuff okay so if you refresh this um there you go you see the you see the page name okay nice and now in here we have this placeholder okay and the link is basically sub slid funnels the funnel ID editor SL that specific editor um ID so if you click on this it's going to basically take you to that page but we're going to have an error if we do that now here we also have the preview link of the domain so if you click this it's going to actually take you to that page but since there's uh I mean there is a page so now you see there's a domain right here okay and if for example the domain was something else which does not exist okay we're going to do some logic in here to throw an error okay not found error so let's go back to our component and yeah this is what it is right nothing crazy in here and then um what else this is just Lucid react so that's how we're creating this so copy paste this guys it's it's just CSS magic if you don't know all this stuff don't worry let me know in the comment section and I will help you guys out in the Discord to understand every single thing in depth okay um and then here we have another link so this one is actually um this is a little important so let me explain this so this is basically the external link so how this works is we say href process. env. the scheme okay and if you go to EnV file you'll see what the scheme looks like right here htdp okay and that has to update to https when you go to production environment okay so change that in production and then we're going to say the funnel. doain right the subdomain and then we're going to have the next public domain so dot localhost 3000 or whatever and then we're also going to have the clicked page Pages path name that's it and then we have a class name in here nice that's it okay and in here we're just rendering out that thing so the scheme plus the domain our website and the path name so no path name right here so we just have the trailing slash okay and then at the bottom we're just using the same create funnel form that we used and we're just showing that at the bottom there that's it okay nothing crazy and finally um we're also rendering this no uh create this page to view page settings so if they don't have anything we're showing that all right now let's go ahead and quickly build out the funnel page step which is right here okay so what we're going to do for this is I'm going to undo this real quick I'm going to copy this and I'm going to go into my component and I have steps in here okay so what is this so sorry what is this step card okay so I'm going to create a funnel step funnel uh what is this called funnel step card so funnel DST step- card. TSX and I'm going to just return something in here like this okay and the funnel step card is going to have the following props it's going to have funnel page which is of type funnel page the index which is a number and active page is Boolean okay let's go ahead and quickly destructure this stuff from here too okay and let's import this funnel page card nice and now it should show something in here so we see some data in here it just looks horrifying but we'll fix that okay now um in here um so I had to actually create a portal for this guys and the reason is because react Dragon drop was acting really really weird and I know Pangia actually fixed the issue but react Dragon drop was acting really weird here so I had to go ahead and create a portal so just follow through with me okay we're going to say let portal equal document. getet element by ID invoke that and we're going to say blur Das page okay and after this we're going to return something in here so we're going to return draggable from react beautiful and we're going to say draggable ID equal to the following funnel page. ID okay do twring and invoke this and inside this we're going to pass in the function okay and this function has to be inside this curly bracket like this and in here we're going to get provided okay provided and we're going to also get snapshots I'm going to say snapshots like this and in here I'm going to pass in the following so I'm going to say if um what happened here okay so if snapshot. is dragging then we're going to do this so I'm going to also return something in here so it doesn't scream at me return null for now or I can probably just huh it's supposed to it's not supposed to scream at me actually okay I don't know what's going on so droppable it needs yeah it needs some jsx elements right so I'm going to say if snapshot. is dragging offset is X of 300 and I'm going to do this here okay provided. draggable dostyle left offset dox and then I'm going to say provided. draggable props and we're going to create this and pass in X okay nice and then inside this we're going to say components so here instead of directly returning we're going to do the following okay so I'm going to say const components equal to this okay just give me a second guys I'll explain this in a second and then after this we're going to do this in here okay so create portal go ahead and import that from react Dom and let's do this one more time so what does this mean so basically we are creating a components in here okay we're just is creating sort of like a component to have all the logic done in here okay and then we're creating a portal what is a portal a portal basically creates another section somewhere in the Dom where you can actually insert the element into and handle it relative to that uh portal right it's literally a portal in the document okay so we created this here and we're using blur page so if you go to blur page you will see that has that ID okay that's actually make sure it has that ID um where is that Global blur page okay and maybe it's not here let me let me check from here directly so or maybe we don't have it anywhere okay so we have this blur page as the ID or maybe we're not all right give me a second guys I think we have to put that blur page or else it this may not work okay nice I'm glad we actually checked that so go into your Global components and GL go into the blur page right here and we're going to add an ID after this say ID equal to blur Das page okay nice I'm glad we actually checked that and now let's go back and now what does uh dragable say dragable is saying something in here so I'm going to go ahead and read this error okay so first let me just import all this I think that's probably what's causing this issue here so card content um let's go to card cont content and import that too mail and arrow down okay yeah all right um was that actually causing the problem not sure let's refresh this and see okay something is wrong here H okay so what we're missing is index in here so say index equal to index like this sorry guys that's what we missed now you can see we have this um we have this page here which can be dragged but it's not going to work because the on drag end is actually not set up right right so um just going back to what we were building here that's what we're doing we're just building a portal somewhere in the document and we are rendering that component inside that specific portal which is that blur page and then relative to that we're moving the elements around that's why now it works um you know on this display okay it works fine not on mobile device unfortunately so nice and now let's go back and we need to finish the on drag in so let's go to that so click here and go into funnel steps okay and after this function um let's see okay we have on drag end huh all right I think we already build it out so it should we built it out so it should work so I'm going to go ahead and create let me duplicate this I'm going to click this and hit duplicate it's going to duplicate the funnel page okay and if you come back here it's let me just refresh okay if you click this nice it's updating if I move this up here refresh okay awesome it worked great job so now we have the funnel Builder working so how does this funnel build Builder order actually work when we are on a page and we hit next or we create a component like let's say we are using a um what do you call that like a customer contact list form right when we hit submit we want to actually go to the next page so we want to check what we have right we want to check if there's a next page and then we want to go to that page that's why we need that order stuff in here okay so technically this can be used as a website as well you can just use different pages in here and then you know forget about the order right you can just have some pages and you know so on so forth so it's completely customizable guys you can build so many things with this all right now go ahead and stop what you're doing just give me your attention because we are going to try to understand how the editor works and the architecture what an element is and all that kind of stuff all right please stop what you're doing just listen for a second so first of all just a quick side note we are not going to be using any external libraries like uh grape JS or anything like that to make this work we're not even using the dragon drop react beautiful Dragon drop okay I'm going to show you how to do that you know natively where you can drag elements and drop them onto the editor so first of all guys our entire editor is comprised of these three parts we have the navigation editor sidebar and we have the editor itself okay pretty straightforward and we're just going to wrap our entire application inside a data layer okay you guys already did this which is a provider right like modal provider and that provider is going to hold the entire editor State and the editor state is going to have two things one is the editor itself and the other one is the history stack now just keep that in mind okay you don't have to focus on what that is exactly yet because we're going to break down what elements are so right now you notice inside this editor we have a couple elements by default we have the body element so if you remember at one point we were creating the editor right we were creating funnel pages and by default we set some default values here which is the body tag if you guys remember that so that element by default will populate in here now the body tag again can have many elements inside it and so on so forth as you can see in here we have container container and a text element that is like this now let's understand what these elements are so there are two types of elements we have the custom static elements and then we have the recursive elements so what is these static elements so they are elements that don't have elements inside of them and for example like text video image or contact form these are just one solid like independent component that's it think about it that way okay and then we have the recursive elements so what are recursive elements so this is more like elements that have things inside it like other containers or other static custom static elements so as you can see here they are elements that have other elements inside them like a container or other containers inside okay like payment forms and stuff like that now what we can do is based on what component we need to render we can either show this or we can show this so to make this much more understandable we're going to put that into a master recursive element all right super super important please listen carefully the master recursive element it's kind of like a wrapper that determines which element to show whether to show a a static element or to show a recursive element and you can also see here right decides what element to return now these recursive elements these are elements like containers we just saw above right containers and columns and things like that like if you have a two column row then that would be a recursive element because it has one column outside I mean one row right which is basically one solid column and inside that we have two column so that clearly means it's a recursive element this master recursive element just does the logic of deciding which element to show inside the editor so every element here technically is a recursive element because the recursive element is a container okay it's a wrapper awesome I hope that makes sense now let's understand what does that recursive element so what does that element itself what does it look like an editor element is going to have the standard properties which is ID style name and type and the type right now this can be some example of different types which is text section container contact form payment link image video and all this kind of stuff even the body tag is also an editor element so it's going to be there here as well now every element is going to have a special property called content okay it's a special property that gives more information about that specific element so let's say this element is a container element its content will give us some information about it so the content can be of two types for different type of ele elements so for the recursive elements our content would be an array but for custom elements that means it's a single independent component that doesn't have anything inside it right that can have special properties like inext Source href or any custom properties you guys want literally anything like for example let's say you created a special type of a component called hero section you can have one property here called hero section Banner image you can have literally anything you want for that element okay I hope that makes sense so let's look at a quick example to see what that looks like in terms of some code right so this is the Json object you can think about it that way so this is an example of a custom element so a custom static element you see it has ID name style and type but it's content is just the properties itself that's it nothing else in here and if you go in here now you will notice that an example of an editor element is it has the same thing name right ID Styles and type but two column here but it's content is actually an array of other editor elements you see this and you see we are also passing some default Styles and its content also if you want to provide some additional default elements inside this you can go ahead and create whatever you like and to summarize this if you ever wanted to create a custom component like something like a hero section all you would have to do is have this container and that container can probably have the top section which is let's just say title right so you can have one element static ele mement called text and you can set its properties in here just some default properties and you can say inner text right and you can set that to some value and then at the bottom maybe you want to show two buttons so that can be two like a a container and its content is going to have two static elements with the type button and then you can just put some default properties for it as well I hope this makes sense okay because I think this is amazing how I got this together so please remember this because when you are speaking to your employer you definitely want to impress them and this will definitely impress them the next Super super cool feature of the entire editor is the history State Management okay the history State management such as redo and undo feature so let's just quickly understand it's actually extremely simple so our entire State here is this is one whole state because one our whole editor state has an editor and the history stack okay but I'm just going to remove this and just explain them independently so the history stack is nothing but a stack that keeps track of different editors so let's say right now on by default when we spin up the browser right where you spin up the editor you're going to see some default state so that will be this example then if we make a change it's going to have another editor State we're going to store a copy of that editor state in here then if we add another element the new editor we're going to store a copy of that editor inside this state and we will set the current history position to this one right here now when we try to undo what we're doing is we're simply moving that current history State we're changing the index to point to this one and then we're going to update our editor state to show from this history stack to show the element number two and in code it would be this minus so the current index minus one that's what we would do and of course all these properties would also reflect exactly what that editor state is and now this is actually redo sorry about this so what about the redo so for redo basically we're just moving the current history position back up one level so we're going to check if there's wherever we are pointed at is the last Index right we want to check if that is the last index or not and if it is not the last index that means there's more elements past it so then we will move up one level and then we will simply set the editor to this copy so we're taking the copy and we're setting it right here same thing like this here when we go back we're taking this copy setting it right this copy and setting it right here so finally just to show you when we add an element this is what happens so we put the new editor okay we create a new copy of the editor we store it in here and then we move the position pointer to this editor like this and then you can see its elements will also update awesome guys I hope this makes sense this is just the breakdown the overview of how State Management and all that kind of stuff works I'm also going to show you inside the code how we are going to transfer data while dragging and dropping components into the editor okay it's a simple very simple native way of doing it and I'm going to get straight to that all right guys so go ahead and open your directory structure and you want to click on funnel page ID page. TSX and in here we're just going to Simply return a component and let's go ahead and extract these props so we're going to just say pams okay uh pams like this and this is going to give us sub account ID which is going to be a string and then we're also going to get the funnel ID which is also going to be a string okay and then uh we also need the funnel page ID which is all going to be a string and by the way all these names okay I'm sure I mean we're too far into this tutorial now to say this but please make sure they all line up with this okay they have to be the same ID okay awesome and let's go down here and let's go ahead and import all of these so importing pams like this nice and inside this first actually let's go ahead and change this uh name we're just going to call it the uh page this is fine and in here we're going to change this to an async component and say const funnel page details equal to8 db. funnel page. findfirst okay we're going to invite this and let me extend this a little bit more so you guys can see clear okay and in here we're going to see say where the ID is props sorry pm. um funnel page ID okay and once we get that we're going to check if there's no funnel page details then we're going to Simply return the user and redirect them to the following page so I'm just going to copy this link because it's annoyingly long but basically it is the sub account okay slpms sorry pam. subaccount IDF funnels slams. funnel ID okay and then at the bottom here now we're going to return that entire uh editor stuff okay so please just focus copy paste with me if I'm doing any copy pasting or if I'm typing just typey type with me okay so in here let's go ahead and remove this page and we're going to pass in the following class names so say class name equal to fixed top zero bottom zero left zero right zero so it's basically taking the entire screen and Z is going to be 20 background uh BG background and overflow hidden okay and inside this we're going to pass in um the following so first we're going to have the editor provider so we're going to go in here go into your providers where is that providers we're actually going to create a folder here guys and we're going to say um editor uh editor like this and inside this we'll say editor- actions. TS uh TSX or TS actually that's fine just put TSX and then in here we're going to also say editor- provider. TSX okay and um also since this is going to be a page that can only be tested on a larger screen I'm going to try my best to kind of have you know two things running okay we might have to go back and forth like this I hope you guys don't get annoyed but that's the only way to see it okay because a funnel a website builder is pointless to to make on a mobile device okay but for now we're just going to build this provider to so just stick around with me and what we're going to do guys this is going to be a lot of code but just bear with me okay so first I'm going to say export uh type and this type is the device types okay so when we're switching between all the devices these are the only available devices which is desktop mobile and tablet and then after that we're going to create our first type and this this type is export type editor element okay which is equal to remember we explained that right in the architecture so we're going to have the ID we're going to have styles which is react. um. CSS properties and then we're going to have the name of that element and then we're going to have the type of the element and finally the content now what is uh what is this content um okay we also have to update um this editor buttons so go into your const uh constants file and I'm just going to paste this it's in the it's of course in the GitHub repository it's just all the types okay all the different types and I'm going to go ahead and import these editor buttons like that nice and now the content is going to be of two types right it's either going to be the editor element and an array of them or it's going to be remember that special object so how do you do that we're just going to put a pipe here and say editor element and an array okay or it's going to be an object and this object is um essentially going to have I'm just going to put inner text okay string and then as we're building I will update this so you know actually here let's just keep it like this and I'll show you as we're building how to update this okay um let me I don't think we need to okay that's fine and then after this um at the bottom we're going to create the editor okay the type for the editor and the editor is going to have live mode set to Boolean Elements which is all these elements right so editor elements and array of them selected element is going to be an editor element so if we click on something we want to populate the sidebar right the properties tab with that specific elements Styles right so that's why we need the selected element and then which device we're selecting and I mean we're editing on preview mode and the funnel page ID okay and then we need the history state so say export type history state which is equal to an object and this is going to have two things first the history which is the editor okay so an array of editors remember the stack that we explained and the current index which is a number and then we're going to have the editor state so this is the entire state of our application okay of of our editor which is the editor and the history okay so history is going to have history. history I know that's weird but this is how I could wrap my head my head around it okay and now let's go ahead and create some initial States for each of this so this is how reducers work right you need initial States for it so the first one is going to be the initial state for um for the editor so I'm going to go ahead and say initial editor state is of type editor State at editor okay so this one and we're just going to pass in the default value so the first one's going to be body by default right so in case something happens we always want to show this body tag we're going to say selected which is you know nothing you can also make the selected item this one by default but that's okay I'm just going to put nothing in here and then we're going to have the device desktop preview false live mode false and and funnel page ID is also uh empty okay and now the history state I'm going to go ahead and say history is the initial state so I've created an error array and I've passed in this as the initial state in the beginning so it's nothing right now and the current index is zero perfect and then finally the initial state of our entire editor is this which is editor is going to be this initial editor State okay which is this one and the history is going to be this one right here okay cool and now we're going to go ahead and create that reducer so um we're going to say oh messed up okay sorry video editor I got to do this again okay and now we're going to create that reducer so scroll down here and we're going to say const editor reducer equal to a function like this and this is going to get the state which is going to be editor State okay like this and um its default value is going to be initial State okay and the action is going to be editor action which we don't have and we're going to get in just a second so go in here um where is this yep right here click on editor action and we're going to go ahead and uh create a bunch of actions okay so go to GitHub copy the actions file and paste it in here there's nothing crazy I'm just going to explain okay so it's just an editor action which can be of type of any one of these so anytime we need to change this state we have to dispatch one of these actions so for example we can dispatch an ad event or an update element or delete element any one of this action and we need to provide all the values inside it that's how a reducer works if you guys know Redux we're basically creating Redux from scratch okay um awesome so it's a great learning experience for you so this editor action is what we need in there so we're just saying the action can be any of any one of these types okay so go back in here and import that okay awesome no error here and this function is going to be is going to return this so I'm just going to say editor State like this okay what seems okay the reason is because nothing was returned in here that's why it's throwing an error I think uh neither undefined or void nor any must return a value okay yeah because we haven't returned any value so first go ahead and say switch okay like this and this switch statement is going to take um the action. type all right action. type like this and based on a bunch of cases we are going to do the so see it's already giving me this this is insane so I can I can just pull every single type oh I never even knew that that's pretty cool okay so the to just to solve this typescript error I'm going to create one um State here one case here called default and I'm going to return State like this so now this uh typescript error should be solved so I hope this is easier to understand now so we're creating uh actions for each of these um actions here right we're creating reducers so what to do if this action was dispatched so let's go to add element first okay and we're going to do the following so we're going to say um const updated editor State okay and this is equal to I'm just going to copy this so please follow through so this is going to be equal to the following so we're going to say uh create this object here and then we're going to say editor. state. editor so everything inside the editor but the elements is going to be this new helper function we're going to create and we're going to pass in all the elements that already exist and what we got from the action okay and what that function looks like essentially is this right here so scroll up here and we're going to say the following we're going to say add an element it's going to take the editor array so everything all the elements right editor elements and the action and this action can be any of these types so first we're going to say if the action type is of add element if it's not of type this then we're going to throw an error okay because we can only do this action and I mean I don't think we need this to throw an error here but this is what we can do here and then we're going to return a new array because that's what we're trying to do here we're going to save that eventually so editor array. map we're going to say if the item ID is equal to action. payload doc container ID and the array do is array right then item um I'm sorry for item. Content so let me try to explain this a little in detail just give me one second all right guys I think there's a better way way to explain this I'm just going to explain this right now so this is actually a recursive function sorry I forgot to mention okay and what this recursive function does is when you dispatch this action with the container let's say if the element was a container that can have that is inside another container right then we're going to basically search for that container here based on what we get from the payload and if we find that container then we're going to put set its contents to everything that's in there and we're going to add the new element in there that's what we're doing here but if we don't find that container ID right then we're going to check item. content okay so that means there's something inside the contents and it's an array okay so uh the item. content is an array then we're going to come in here so now it's an array so this means it's a recursive function okay and in here we're going to return this item and its contents we're going to invoke this one more time and pass in the item. content and the action that's what we're doing here I hope this makes sense okay so that's how we're able to add an element to any container on the on the editor so if we drag it into a container that's completely nested then with the help of this container ID we can tell you know which one to put that element into that's how this works because an El um a standal alone static element cannot be placed inside you know nothing it has to be placed in a container so that's why this container ID is so important so until we find the container ID we're going to keep looping and when we do we're going to place the element inside okay I hope this helps you really understand what's going on now um let's uh we still need to complete this so let's go down here and after this update updated editor State we're going to update our history stack so I'm going to say updated history okay is an array so we're going to set a new array with everything inside state. history. history. slice zero to state.is current index + one okay and then we're going to put the new updated editor States in there so this is how we're keeping track of the newest one okay so this is everything else before that and this is the newest one nice and then after that we're going to get the we're going to create another object for our new editor state which is going to be everything in state the editor is going to be this one here and our history is going to be everything inside that history right everything in state. history and are um everything else inside history and then history itself is going to be set to the new updated stack and the current index is going to change to the whole length of the array so the whole length of that updated history stack minus one okay that's going to be the new index now because we added a new element and then finally we're going to say um return new editor state right here okay now I did do one additional feature but I do feel that is too much for this entire you know course but basically what that is is how can you save all all of this inside local storage so that you know you can spin it up anytime the user you know loads the page the editor you can spin up the history as well so I I mean I already did it and it's in another repository I'll put it in the Discord if you guys want it okay but I'm just going to skip over that for now it's unnecessary awesome so now let's go to the update element okay let me see what else we have here we have delete element change clicked element change device okay so let's do the change device okay or let's just do everything why not right it's the same thing so first we're going to perform the logic to update the element in the state and great I also put comments here guys so you can literally understand what's going on okay so we're going to call another function called update an element to get the updated elements all right and that function looks very similar to to you know what we created before so I'm going to go up top here and I'm going to create this function so update an element needs an um an editor element which is an array I'm just going to quit this for now and it also needs the action okay and it's going to return the editor elements array so if action. type is not equal to update we're going to throw um an error and then we're going to return editor array.map okay editor array.map here we're going to return um if the item. ID equal action. payload do. element details. ID so we if we found that element we're trying to update then go ahead and update that element by simply saying return everything in the item but also add the new details in here but if we don't find it if we don't find that item then we're going to say if the content right if there is content and the it is an array so that means we can Loop over it so we're going to say items. content so items and the content is going to be we're going to re we're going to call this one more time recursively and we're going to pass in the new cont contents in there that's what we're doing in here okay and if for example we cannot find this and we cannot do this that like something is broken here okay so it's not an array and there's no elements like that makes no sense so um that's why I mean this is the logic this is what works here okay awesome and this is what update element does so let's scroll down here so that's how we're updating this and then we need to continue this so so now we're going to also update our history okay so updated history is SE um updated element is selected okay so this is the first thing um and update the history to include the entire updated editor state so state. editor um this is actually this is something else guys this is not the correct thing here so we're just checking if the updated element is selected and we're going to say state. editor. selected element. ID equal to action. payload do element details. ID and if that's the case then uh we're just going to store that in here and then we're going to say the updated editor state with the update is going to be everything inside the editor but the elements is going to be the updated elements and the selected element is going to be the updated element is selected okay um if this is oops sorry if this is true so if that element is is selected then action. payload do element details so it's kind of like where we are just setting that because we updated it so if you update something we want to you know show that element as selected so that's why we did that here or we're just going to put nothing is selected um right here okay and after this we're going to also update our history so um why is this like this huh something seems to be wrong here okay if I click this it's taking this even though it should actually take this anyway so I'm going to say updated history with update right is everything in state. history. history slice you guys know this zero to state. history. current index plus 1 and then everything in the new updated State okay so we're saving the copy right here and then finally we're going to create our new updated editor like this with everything in state and the editor is going to be the updated editor state with the updates history is going to be the new uh is going to be everything inside state. history but history is going to be reset to this new uh you know value here and the current index is going to be update history with update. length minus one and then finally we're just going to go ahead and return this new updated editor like this okay awesome now what about delete element delete element is actually very very similar to updated element so go ahead give this a challenge okay give this take this as you know a challenge and give it a shot and see if you can create this delete element action okay hopefully you got it right and if you didn't no no problem I'm going to show you exactly what to do okay so first let's go ahead and delete this element so we are creating the logic here so we're going to get all the elements after deleting the element the user wanted to delete okay so let's go up here or is that okay after this and we're going to create the delete and element function and this function is going to again take the editor elements and the action okay and it's going to return an array of the editor elements and if it's not of a delete element action we want to throw an error and then we're going to say editor array filter okay if the item. ID is equal to action. payload so whatever we sent inside then go ahead and return okay else if the item. content and the array. isarray item. content we're going to send this one more time into this uh function so recursively we're going to call this function and we're going to pass in that items contents again so from that it's going to check if it finds it no if it didn't find it it's going to go back in here it's going to try to find in here and you know if it's still you know if it comes here it's again going to call this and it's going to keep doing that until we find this item okay that's what's happening and then if not after this we're just going to return true for everything else um we're just going to return true here okay so let's go back down and let's complete this delete element so now we're going to say the following we're going to say updated editor state after deleting okay is going to be everything in the editor but the the elements is going to be set to this new updated elements after deleting and then we also need to update the history so the history after deleting is going to be everything in you know the same thing right current index plus one we did the same thing up here right so that but we're going to put the new editor state after deleting in there and then finally we're going to create a new state we're going to just call this deleted State and we're going to say everything in States and the editor is going to be the updated editor state after deleting the hisory hisory is going to be everything in history but history is going to be set to this new history State here and the current index is going to be uh length minus one okay and then finally let's go ahead and just return that deleted State like this and now the next one is if an element was clicked so change the clicked element so if we click on something if you're clicking on one of the elements we want the state to also keep track of that so let's go ahead and this is actually a very simple one um so this is what it looks like okay so basically we're creating const clicked state is everything in state and the editor is going to be set to everything in editor and the but the selected element is going to become action. payload do element details or we're just going to put an empty object so like if for example we never sent it that's why okay I think this is just for typescript stuff so yeah pass in the element details and the history now is going to be everything in history but history here is going to be an array with everything in state history. history. slice pretty much the same thing okay to one I mean plus one oops sorry guys like this plus one and then we're just going to pass in our new uh pass in our state. editor okay because we're saving a copy of um the state and then um let's go down here so if you may ask here you may have a question here we actually saving that um new updated state in the history but here we are not because I don't want to keep track of everything that's clicked okay okay but I think still hm it will still do that but it will keep only one before okay that's what we're doing here okay and then after this finally let's just go ahead and return uh The Click State okay nice and now let's work on our redo functionality so our redo functionality let me see that we have redo okay so I'm first going to do the change device because this is the order we have here so I'm going to say the following so I'm just going to say changed device State okay is everything in state but the editor is going to have the state. editor so everything inside that but device is now going to become what we pass in through the payload okay and then go ahead and return the change device State like this okay that's how we reset that and then we have one here called to um toggle preview mode and for toggle preview mode all we're going to do is we're going to do this here we're going to say const toggle State equals State everything in this but editor is going to have everything in the state editor but the preview mode is going to be the opposite of what it currently is at okay and then we're just going to return this like that and then toggle live mode is going to be const toggle live mode equal editor state which is an object everything in state but the editor is going to have everything in the state. editor but live mode is going to be set to action. payload if this exists then we're going to say action. payload doval if not we're going to set the opposite of live mode okay um nice and then um why yeah and after this we need to also return this so I was wondering why are we not returning that's why okay we just forgot to do that so let's go ahead and return toggle um live mode now for the redo functionality we're going to basically say if state. history. Curren index is less than state.is doh. length minus one so only if there is something ahead we can go forward right that's what we're checking here and then we're going to get the next index which is state. history. Curren index + one and then we're going to get the next editor state which is next editor state is um this object here which is everything in state. history. history but we're going to get at the next index okay cool and then we're going to create another object here called redo state which is everything in state but the editor is going to be the next state editor okay and the history is going to be everything in state. history but the current index is going to be the new index here and after this we also have to uh return redo state so I'm going to return uh redo State here okay and if this is not the case so if they fired this for some reason we need to also return the state like this so if they fired this redo but there's no more uh you know items remaining in the history stack we have to go ahead and return what we have in the state already okay okay and for undo guys we're going to say this if state. history. current index is greater than zero so there's something to undo then we're going to get the previous Index right here which is state. history. current index minus one and then we're going to get from the history stack we're going to pull out that you know editor state so we're going to say state. history. history at the previous index like this and then here we're going to basically basically create a new object called undo state which is everything in state but the editor is going to be previous editor State and history is going to be set to State everything in history but the new uh previous index is going to be current so now when we when we redo it's going to go one up that history stack okay and again we have to return um undo States we're going to return it inside this like this and if all else fails like if this condition failed we also have to return our state so this is the one that we're going to skip but uh I'm just going to copy paste this if you guys want you can copy paste it just give me a second okay so I just copied something in here or all right guys actually instead of copy pasting the load um local storage data since we're not using it I'm actually going to go into actions and just remove it from here okay I unnecessarily confuse you okay so where is this um we have load local storage just go ahead and remove that action right nice now we don't need that action anymore and then we're going to do load data so what this is is it like we can basically load some new data when we refresh when we are trying to access the domain right or a page for example so we're going to return a new state with everything in initial state but the editor is going to be um the initial state. editor okay but the elements is going to be what we get from dispatch okay what we get from here and the initial editor state do or the initial initial editor state. elements okay worst case scenario scario and then live mode is going to be action. payload dowith live so this is um basically when we want to load data from production that means from the domain directly that time we're going to pass this flag in here so based on this we will know what to do here okay so if this is not there it's going to be false so by default you know live mode is going to be off okay and then we have one more which is the set funnel page ID so for set funnel page ID first let's go ahead and get the funnel page ID from this from our payload we're going to do this and then we're going to get the updated editor state with the funnel page ID which is everything in the editor um like this and the funnel page ID like that and then we're going to go ahead and update our history with all with that funnel page ID too so we're going to you know create a new stack um create a new element a new editor on the stack here so pass that in here and then we're going to go ahead and create the final state to return which is a funnel page ID State okay that's what we're calling it so everything in state the editor is going to be the updated editor with um state with funnel page ID and then history is going to be everything in the history but history is going to be set to this one and the current index is going to be the length of this minus one and let's go ahead and of course return this here like that nice and there we go guys we are pretty we are done with our entire reducer I'm sorry if that was a lot of code but this is complex okay I told you guys this is one of the best projects on the internet so I don't expect it to be baby stuff okay you want baby stuff there's plenty of other videos this is for the you know the people who want to actually improve on their skills so I'm going to go ahead and now create our uh our context provider so first go ahead and say export type editor context data equal to an object and this one is going to have the following uh properties so we're going to have device which is the device types okay preview mode which is Boolean set preview mode which is you know Boolean here and set device here as well okay so you can change the device and then we're going to create um our context so I'm going to say export const editor context equal create context and import that from react not from VM and then State and dispatch okay so dispatch I'm going to import this from React 2 and then sub ID funnel ID and Page details this way from um our production right from the domain we can actually pass in this information to get access to the the specific funnel page details okay and I'm also going to import this from Prisma clients all right nice no errors there and then we're going to create another type called editor props so this is going to take children sub account ID funnel ID and Page details okay and then we're going to return our provider so our provider is going to be called editor provider equal props editor props okay so all of these and um we're going to create a state here called State and dispatch and this comes from use reducer so all everything we did was just for this one hook called use reducer okay and then we're going to return our provider and the children so we're going to wrap everything inside this okay and we're going to give access to those specific values which is the state dispatch so we can change you know dispatch actions sub account ID funnel ID and the page details just like that okay and at the bottom guys I'm actually going to create a use editor hook um okay yeah let's create a use editor hook so I'm going to say export const use editor equal to a function and in here const context equal to use context like this and we're going to pass in the editor context in here and then if there is no context we need to throw an error basically so we're going to say Throw new error and we're going to say the use editor hook must be used within a editor provider within the provider okay like this and at the bottom here if true then we're just going to return the context like this okay and that's it so let's go ahead and Export default editor provider like this default okay nice and now we can go ahead and use this guys great job so far all right now go ahead and go back into your editor funnel page. TSX okay so this is inside this one editor funnel page ID page. TSX and now we can wrap our components inside that editor provider so go ahead and say editor provider invoke that I mean just import that and we have to pass in the sub ID which is going to be equal to the following oops what is it doing there okay we're going to say props uh pams pams do subaccount ID and then we also need to pass in the funnel page ID which is going to be equal to params funnel page uh funnel ID guys not funnel page ID and then the page details is going to be funnel page details um just like this okay so let's see now it also needs children so that's what's missing so for now I'm just going to put a div here but what we're going to put in here is essentially the funnel editor the navigation the sidebar and the editor itself okay so go in here inside this funnel page create a folder call it underscore components oops components and inside this we're going to first create the um funnel Das editor dnation okay. TSX and inside this component we're are we are basically going to render what we see up to top okay so click on your funnel editor navigation and we're going to just return a component here and I'm going to change this to funnel editor navigation like this and this is going to become a use client component okay and inside this we're also going to get some props so let's get the funnel ID which is going to be a string and then we're going to get the funnel page details which is going to be of type funnel page and finally the sub account ID okay and in here I'm simply going to destructure this you guys know the drill already and after this let's import router from use router like this from next navigation and then we also need our use editor hook so I'm going to go ahead and import use editor okay don't worry I'm going to spin the server up in just a second but let's just get some of this set up okay and um actually yeah let's go ahead and do that so just give me a second guys I'll just refresh my browser okay awesome so I went ahead okay nice I went ahead and spun up my server so I'm going to go back into the page now and I'm just going to import that component here um so we're going to say let me remove this first and I'm going to say funnel editor navigation okay and this can be a closed component just looks nicer and let's go ahead and pass in the the props that were required okay like this funnel page ID and I'm Al going to remove this here funnel page ID funnel page details and the sub ID so I'm going to go back in here and now we can actually work with this component so if I click on this let's actually see what happens okay so we're using some sort of a react component U you are importing a component that needs used reducer it only works in a client component H so where let me see all right just give me a second guys okay so I know what we did wrong go back into your provider Oops why did that not open editor provider and at the top of the file there we go we have to use use client okay because it's a client component and now we will see our funnel editor awesome right looks great cool and now let's go back um to our component which is the funnel editor and now we can you know kind of work with this component right here so our navig is going to have a couple things okay and the first thing we're going to do is we're going to just use a use effect here and we're going to set the funnel page ID so I'm going to import this and we're just dispatching an action called set funnel page ID and we're setting the payload to funnel page ID is this funnel page details. ID okay and this is a dependency W to need in here nice and then after that we're going to go ahead and um return the the following so scroll down here and change this to Tool tip provider okay and inside this go ahead and create a nav component with the following class names so we're going to use clsx for this and go ahead and import clsx and this is going to have border border bottom of one pixel like that Flex Flex item Center justify between padding six Gap two transition all height is going to be zero padding is going to be zero overflows hidden but that's only if state. editor. preview mode is true okay and inside the navigation create an aside like this with the following class names Flex items Center Gap D4 not this it's a gap D4 and then we're going to say Max width is going to be 260 pixels so go ahead and say two 60 pixels like this and then the width is going to be 300 pixels okay nice and then we also have to put a link so I'm going to create a link inside this and this link I'm going to import it from next link and this is an arrow left Circle go ahead and import that too and it just shows the uh funnel page so it's showing the um Circle which looks like this and it's supposed to show something here why is it not showing ah okay I know why that's because this is is actually showing up on top hm okay so I'm going to keep it at around this withd guys and then once we go once we you know uh finish this part right um I'm going to actually try to make this a full screen display and then I'll try my best to you know go back and forth okay sorry if that gets you a little dizzy but that's the only way to understand this and now after this link go ahead and say the following so we're going to create an input component here and this one is going to be div Flex Flex column with full with an input and a span that just shows the path okay and you can pause and copy and paste these Styles if you'd like or you can copy paste with me no problem okay and now this handle blur title change what is this this is a function that allows us to save the title when the user clicks inside it so let's go here uh when the user clicks outside it so if you click on it it becomes an input field and now you can change it and when you click outside it's saves it okay so let's come in here and I'm going to import this stuff so Focus event handler import that and then we're going to have the upsert funnel page import that to and I'm going to import the toast like this and that should solve I think I did a small problem okay I imported it from sonar we want to import it from here oh so this one is from sonar so you want to try it out let's go ahead and give this a shot okay so I'm going to import these toasts from sonar okay now um you see this is what it's doing it's saying if the target value is equal to what it had before then just don't do anything but if it does have something so if this is not true then we're going to go ahead and upsert so we're going to save that funnel page details okay we're just going to pass the name order all this kind of stuff that's it and then if it's true just show a success message and do router. refresh so now if I click out it's not going to save but if I change this and click outside it did save but soner didn't work and I think I know exactly why soner didn't work so that's probably because we did not wrap um our component in a provider if it needed it or we did not put it so give me one second guys I think that's that's what's going on okay yep just as I predicted go into Source go into app go into layout. TSX and below this toaster you want to import sonar toaster okay so I'm going to just copy copy this paste it here so sonar toaster and to import sonar toaster you would have to I have to manually import it what okay I'm just going to manually import it so I'm going to import toaster as sonar toaster from this component okay so now when I click on this click out it's not going to save but if I change it there you go it shows and it's so much actually I like this a lot more than the regular toaster but it actually has some other additional features in it that make it super super cool okay okay and now let's go back to our component and let's continue where we where we left off which was right around here okay and after this aside guys go ahead and create another aside and we're going to paste this in here which is tabs all right you guys already know what this is so um let me go ahead and import tabs like that um what is it saying okay and here device type import this to all right so this needs to have a closing tag like that all right so we're going to pass the default value as desktop with Fit value is going to be state. editor. device okay and on value change is going to be this uh is we're going to dispatch we're going to change that to whatever we selected okay and I'm going to show you how to get that value so now we're going to create something called tabs list okay don't worry I'm going to copy paste and explain everything so go ahead pause the video and just import uh I don't think you'll see any errors here yeah so just just pause and import all these okay all right guys nice so all I did in here I'm going to go ahead and explain just give me a second so create the TBL list okay and we're going to say grid with full grid columns 3 background transparent and height of fit okay and then this is basically going to be wrapped inside tool tip so wrap all uh everything in here inside tool tip so just say tool tip here like this and Tool tip like this and and for this one we're going to have a tool tip trigger with tabs trigger okay and the first tab is the laptop okay and the content is going to say desktop so if you hover over this it says desktop tablet and mobile okay and the same thing go ahead copy paste this three times below that's it and you want to just do the same thing for tablet use the tablet icon from uh from um you know Lucid react and for the final one a smartphone okay that's about it so that's how we can create this feature here now when you click on this okay Shad CN UI does all the logic for you when the value changes it goes and dispatches that action okay that's all that's happening so uh so if you don't know where we're getting dispatch here I already told you up top from this editor we're getting the state and the dispatch so we can listen to State you can do whatever we want here or we can send actions to the reducer okay cool now after this aside we're going to create one more aside okay and this is going to have the following class names we're going to say Flex item Center and gap of two and this is going to have a button so this is basically the undo functionality and things like that so first paste this button in here this button is basically um the preview link okay so it's going to have this ghost icon looking thing okay I'm sorry the eye looking thing okay so I'm going to import this from um from what is this called one more time from Lucid react icons and we're going to have this one function so let's just see what this looks like so you know what I'm talking about there you go it's just that I icon okay so this handle preview click very simple we're going to go up top where is this right here and we're going to just say handle preview link preview click we're going to dispatch um a function huh what seems to be the problem here oh just type oh my God never mind guys so yeah dispatch for the first type called toggle preview mode okay and we also want to dispatch toggle live mode and what live mode does is it removes the borders on all the elements so that way you don't have those name tags okay so that's why we need to um change both of them now let's go back down and after this icon we're going to go ahead and paste the um undo button okay and we also need the redo button very simple stuff nothing crazy no rocket science okay now go ahead take this upate challenge you learned how to fire and dispatch actions to the reducer right so go ahead and try to create this handle undo and handle redo function it's very simil similar to what we did here just dispatch the action and go ahead and you know send the appropriate action along with the payload so pause the video give it a shot if you don't know I'm going to show you exactly how to do it awesome if you got it correct and if you did this great job if you didn't no problem okay no hard feelings don't don't be too hard on yourself just follow what I'm doing so you want to just create this function here handle undo and we're going to say dispatch with a type of undo same thing for redo okay that's literally it nothing else that's why I said it's very similar to what we did above now after this button guys we also want to have I'm just going to put some additional you know stuff stuff here just to make it look nicer so where is this so after this button go ahead and hit enter and I'm going to create a div here okay a div with flex Flex column item center with another div called Flex um Flex row and um item Center Gap four and then draft okay so I made a small error this switch comes from components UI okay and then I'm just going to say draft in here and the other one is published and you can basically turn this off and on but by default fault it's already published right so I just want to make it look nicer that's it but you can actually change this cuz there is a value inside SK inside our Prisma schema that can handle this functionality too okay so I made it in such a way that you guys can actually expand a little bit on it so after this switch we have a span here that basically shows the last updated date so if I change this okay it's going to update but of course if this was tomorrow right it's going to show this date today's date so I'm going to change this back here nice all right so our navigation is pretty much done this is what it looks like on a slightly larger device and now we're going to move to creating the um the other parts all right guys we forgot one more thing here in the navigation which is the save button okay so I'm just going to go ahead and create that it's very simple too so after this span uh after this div create this button here and we're going to create this function okay this function is actually you guys have done this like a million times okay so I'm going to scroll up here here and I'm going to say handle on Save equal async function we're going to get the content okay and we're going to say json. stringify we're going to convert it into a string we're going to convert all the elements so editor. elements into a string and then we're going to just you know do the following so we're going to say upsert funnel page we're going to pass in that content and then I'm going to go ahead and save this notification 2 and change this problem here and then we're going to use uh okay I'm using regular toast here so this is going to be toast um what we can do is we can just use the sonar toast here this was actually pretty nice so let me replace this here okay and I'm just going to say saved details right or saved editor um like this and then if it failed oops message saying could not save details okay or editor like this nice so now we have a button and if you save there you go save successful okay save the editor nice all right so the next thing I actually want to build is the sidebar first so go ahead and say funnel editor sidebar like this copy this go in here and inside your component say funnel editor- sidebar. TSX and I'm just going to return a component from here and change this to whatever we just copied now this one is a little tricky okay because the folder structure is going to get a little annoying okay so just bear with me so inside this these components what you're going to do let me let me expand this a little bit more so you guys can see okay so this sidebar is actually going to be inside another folder so inside components create a folder here and we're going to call this um we're going to call this tabs okay or we can keep the sidebar here too um let me think okay that's uh or here let me just say all right this is fine sorry I'm just a little confused I don't know what's the best way but it's fine so just create the finnal editor sidebar in here and inside the tabs or guys I actually think this is this makes more sense so funnel editor sidebar. TSX I'm sorry uh sidebar like this and move this inside here okay and go ahead and change this to index. TSX okay and inside this funnel editor sidebar you're going to create another folder called tabs like this okay just follow through with me you're going to understand what's going on in a second okay and this is um this is also going to have um the following so also hm are we I'm not sure are we going to be able to access this or not I don't think so okay here we go guys so this is how you can read documentation I just went to nextjs and you see this folder opts the folder and all child segments out of routing okay great that's exactly what I wanted I just wanted to make sure because I didn't want to you know not end up getting access to that I mean end end up being able to access that through the routes so inside this funnel editor sidebar we have these tabs right so inside the tabs we're going to create another one called components Das tab okay and inside the components. tab we're going to have all our custom components in here and these tabs what are these tabs so these Tabs are the sidebar tabs like for example the um layers media bucket and the settings okay so let's go into um the index. TSX okay and in here we're going to build our sidebar the the skeleton for our entire sidebar so first of all go in here and get the sub ID which is going to be a string and go ahead and also destructure this from here sub ID nice and then in here we're also going to need access to use editor so to get that this has to be a used client component and then in here we're going to say const State and and we're going to get dispatch so dispatch like this equal to use editor import that and invoke it nice and then we're going to return our component so this is not going to be a div this is going to be a sheet component sheet component from UI sheets okay and this is going to have have open equal True by default and modal is going to be false okay so okay so funnel editor sidebar needs to be imported so go back to your um let me shrink this and show you so funnel page ID page . TSX and import this okay and pass in sub account ID equal to pam. subaccount ID like this okay and now if we go back we should be able to see something in here well not yet because we don't have the sheet component being rendered okay a sheet content being rendered so first thing we're going to have is tabs in here so I'm going to say tabs okay and this is going to have class name with of full and default value is going to be set to setting so by default def fault we just want to show the settings tab okay and let's go ahead and create those tabs so I'm going to say sheet content okay inside this this tab sheet content go ahead and import sheet content from components UI and import the clsx here too okay and it's going to have TBL list so we're going to get to this in just a second so this is going to have show X as false side of right class name of clsx and it's going to add margin top of 97 pixel with 16 z uh index of 80 sh Shadow none padding zero Focus border none transition all and overflow hidden and hidden is going to be true if we are on preview mode okay I'm just going to refresh this all right and it looks like this because this is the tiny sidebar on the right side okay and check this out guys when you refresh it has this really cool sliding animation I really like that too if you can see this on full screen mode this is what it looks like okay nice now let's go back okay now open your directory and inside the tabs create index. TSX okay not TS TSX and just return a component here called TBL list okay and I'm also going to go ahead and import this component here so undo this and import TBL list from tabs okay and let's go into this component and this component does not need any props but it's just a bunch of TBL lists okay so I'm going to copy that and I'm going to paste it in here so you can see what that looks like and I'm also going to go ahead and import all these components um into this file so we're going to have TBL list okay that's going to have multiple triggers so the first trigger is the settings tab and that's just going to have the settings icon very simple next one is components tab it's going to have a plus icon and then you know I'm just going to expand everything now so you can see everything and then we're going to have this one for the stack icon to show all the stacks right so to show the layers and then we're going to have the media to show our media file so if you go in here this is what it looks like okay very simple so if you refresh you see that cool loading animation too and now let's quit out of this and go back in here and after the tab list we want to create another tab here so um after this after the sheet content create another sheet content so I'm going to copy this just give me one second and I'm going to paste this in here okay sheet content it's going to have show X as fault side right CLS x with margin top of 97 pixel width is going to be 80 now Z is going to be 40 Shadow none padding zero margin right of 16 back BG background height full transition all and overflow hidden and this is going to be uh hidden only if preview mode is set to True okay so this is like a second sidebar so you see that insane loading animation I actually really like that nice and inside the sheet content we are going to render um which specific tab we're clicked on so if we click click on database we want to render a database tab if you click on these layers you want to return that and you know so on so forth and yeah and you can also wrap this in tool tip if you'd like to give more information similar to what we did here right so go into your um your tab components so not this one guys this right here okay and we're first going to create um actually hm let me see maybe it's better to First build this part just give me one second okay sorry about that confusion so you want to just go back into your tabs um index dot so sorry funnel editor which one is this so funnel editor sidebar index. typescript and we're going to first build out a couple of the tabs okay so the first one is tab uh we're going to say div here so say div like this and it's going to have the following class names it's going to have grid like this grid grid four height full padding bottom of 36 and overflow of scroll okay and then we're going to have the tabs content and this tab content is going to have the settings value inside it okay and inside this create the sheet header and the sheet header is going to have class name of text- left and padding of six like this okay and inside the sheet header go ahead and create the sheet title and go ahead and create the sheet description like this and we're just going to say styles show your creativity you can customize every component as you like and after the sheet description below the sheet header we're going to render the settings tab and this is not created so go ahead and copy this okay and you want to open your directory go into tabs and create a file here call settings- tab. TSX okay and I'm going to return a component from here and just paste what we just copied so that's going to be inside these tabs and now go ahead and just import the settings tab and and now you can head into that component and you can do whatever you like in here okay so for the settings tab it's I mean I came up with an architecture that makes sense it's very long okay it's a very long component but I'm just going to build maybe one or two to show you guys how it works and trust me guys it's the same thing just copy paste and all you have to do is change an ID for any of the style you want that's it so if you want it a font size right just put size color just change change the ID to color that's the architecture I came up with that makes it super super easy for you to use almost any styling you want okay um so go in here and we're going to use a bunch of accordians okay to kind of group everything together so first thing this is a client component so go up top and change this to use clients and come down here and we're going to use the accordion component so our accordion component is going to say the following so it's going to say um accordion here and I'm also going to import this and it's going to have type multiple class with full default values are typography Dimensions uh decorations and flexbox so by default all these values are going to be open okay all right now inside this accordion I'm going to create an accordion item so this is what the accordion item looks like okay so let me shrink all this so we can explain in detail so the accordion item is going to have a trigger so this is called custom so anything inside this okay is custom properties for um you know for the the content basically okay so I'm going to have one accordion item in here and this is going to have an input for the um basically to show the path name okay so domain example SL paath name something like this in here so I'm going to go ahead and input uh import these components and I'm going to show you exactly what I'm talking about so State this state comes from our um from our use editor hook so I'm going to go ahead and and say use editor and import it as well okay so now that should solve that problem and now you're going to notice something here so first is on change we have this which is uh you know this is missed out and then the value here right here href cannot be found it's saying that this does not exist on this so how do we create that so this is basically any any custom values you want to put in here you would have to create an accord like an input field okay and you would just need to um change this ID for it so right now I created one called link path so this is basically a video I think right I think it's a video component and if the video component is showing see let's see here editor state. editor. select element. type okay equal link so if it's a link component guys sorry not a not a video component if it's a link component then we want to return this input field so that you can change the link of where it should go to okay so now if you wanted to create a video component which we are going to create but if you wanted to create a video component what would you do in here try to make a guess nice if you said you would create another input field and you would have it set to you know you would do the same thing in here and you would check for it and you would change this ID to Source right I think that's what is that's what it is for the video component that's exactly what you have to do okay nice so I'm going to go ahead and go into our provider so that we can solve this error right here so go into your providers go into editor and editor provider and right here you're going to see the content go ahead and say hre and make this optional and set it to a string and now you will no longer see this error here okay nice and now we need to create this special custom value uh Handler okay so go up here and we're going to create a custom value handlers there's only two handlers guys even though we have like a 100 different fields to show we're not having a 100 but even though you can potentially have a 100 fields we only have two handlers for them so that's the power of this okay so first the custom Handler does the following so it says con setting property okay so which property is it we're saying e. target. ID so we're getting this right here and then we're saying value equal e. target. Val so whatever value they wanted and then we're creating a style object so we're saying creating an object here with that property and the value okay and then we're dispatching an action and we're saying type equal to update element like this and we're saying um payload like this okay and we're passing in element details as everything in of state. editor. selected element right and the content is going to have state. editor. element selected element. content so everything in there and everything inside the styled object okay and the style object if you know what this is it's basically going to be like for example ID or something like that okay that's what we're doing in here and uh I hope this makes sense that's how we're basically setting all those those Styles okay nice so that's it guys this is for the custom element now what about what about a normal element so scroll down here after this accordion item I'm going to create another accordion item okay accordian item like this and this is going to have the following value set to typography okay and it's going to have a class name of padding X of six padding y of zero border dasy of one pixel okay like this and now we're going to have an accordion trigger called typography in here and and the accordion uh accordion content as well okay but just give me a second guys let me just go go ahead and copy this and I'll show you in just a second all right and inside here I'm just going to paste the following which is flex Flex column Gap 2 a a paragraph that says color and an input field with the ID and this ID keep in mind is the property that we want to change the CSS property okay and on change we're going to come to this in just a second and the value is going to be state. editor. select element. styles. color okay that's what we're passing in here nice and um that's it and then this one is the handle change so how do we create this um you want to scroll up top after this go ahead after this uh function we're going to past this and guess what this handles every single element you want to change okay so here's what we're doing we're basically creating a style object again okay and in here we're first getting the ID so what style setting the value of the style setting and then we're just creating that object and then we're dispatching an action to update that specific element okay and the element details are going to be the following so it's going to be everything inside the selected element cuz of course we are changing the styling only of the selected element right so we're passing everything in there but the Styles is going to be set to everything that's already inside that specific elements Styles but we want to add this new property in here okay now you change that value it's going to overwrite inside that's how it all works okay so if you want to create it create one for size you create another one here change it to size and you're done that's literally it okay so um I'm going to go ahead and copy everything in here also guys you can change the component you can change this input to a slider I used a slider and I will show you an example too um give me one second okay okay so I just I'm just going to use one more component in here which is a slider just to give you an example okay I don't want to just leave you like that I want to show you as much new things as possible so that you can uh you know implement it as you like okay so in here we're going to have um this where is this yeah so it's going to just be a div with a label saying opacity and we're going to use a slider for this opacity okay so we're going to create a div here and say Flex item Center justify end so this number is going to be towards the ending so right towards the right side um maybe I need to refresh my page can I see anything probably can all right give me one second guys let me just refresh okay nice so right now um you see this here right so we can adjust this and it's going to change and it's also going to update the state but now right now we don't have any elements selected so it's not going to make any sense but I'm just showing you what's happening okay so you see right here we have the color if you change this it's it's going to change the selected elements style and it's going to add the color property with this value so if I change this to something like you know H something like FFF whatever right it's going to actually set that color and for opacity when I move this you see the number is updating here and it's also changing the style in our Global state so let's go ahead and take a look at that okay so right here we have the small Val the small variable this is this one right here and it's set to justify n so that's why it's all the way in the end here okay and then what we're doing here is we're saying type of state. editor the selected element styles. opacity equal to number okay if that is true then state. editor. selected element. styles. opacity okay um for this we're going to say um this one right here right we're just going to return this value here so whichever opacity or we're going to convert it to a float variable so we're going to say par float we're going to pass in that opacity or we're going to pass in zero and we're just going to change it so replace the percentage here with nothing okay and then um that's it and we're just putting this here to as just for typescript and we're just returning a percentage here so that's how this works so by default it's going to be 100% of course and then everything else you know you can change okay I hope this is fun so all you have to do now is create a bunch of these and also check out the tabs guys so if I click on settings it's showing the settings tab if I click on plus it's going to show this we'll get to that in a second um this one I'll be even more in depth okay the settings is the same thing like I'm going to literally copy paste and show you one more um give me one second okay so this one's a little cool this is actually a background image okay so it's a div here Flex border 1 pixel rounded MD overflow clip and then div here okay and inside that we're just having an input and the placeholder is URL and the ID is background image that's it okay so just keep in mind these IDs are not the type that you would see in CSS which is like background- image it's not like that okay it's uh basically the JavaScript version um of it and you can use chat gbt if you want if you want all this okay there's just it's camel case that's it so on change we're doing the same thing and we're setting its default value um as well Okay cool so um that's it and if you look at it there you go you have the you know you can put and I've done a bunch of cool stuff and this is how powerful this is you can change the background image to a real image with URL or you can do linear linear gradient you can do literally whatever you want and whatever you set will also show up here that's the cool part so you can see here inside that div we're setting the background image to this property and we're using the style property guys because um we cannot use Tailwind CSS okay it's not possible in in here so y now some people may have one more question what about custom elements that you want to create so let's say you are creating some sort of a really cool um you know uh editor here like it's not an input field or it's not this sort of a slider how do you get the value from it so I'm going to show you an example so for example I used something called tabs okay let me just copy paste this so I can show you what it looks like just give me one second so after this I'm just going to paste this and we also have some icons here so I'm just going to Simply import these icons okay so I'm creating a tabl list here and this tabl list is basically for the uh flexbox okay so I'm just going to say flexbox and where is that where is the tabs just okay it's yeah it is for flexbox so um you know you can create you can create an accordion or whatever you want to do and just put that in here but um you get the you get the idea right so this is for justify content and and stuff like that so let me just go ahead and put this in here like that okay and you see this here right justify content this is like left right side Center and stuff so how do you get the value from these custom components these are not input Fields nor are they sliders well very simple you're going to have the onv value change on the tabs correct what you're going to do is You're simply going to invoke the handle on change and hardcode the values by saying Target is an object with the ID of what you want and the value of what you want that's it and this default value you can just set to this you can say um what is that um states. editor do you know styles. justify content and these tabs actually have those values too so space between space evenly so this is real CSS guys this is this is not Tailwind CSS and if you guys don't know how to use that I'm very sorry you have to learn okay Tailwind is not it's not real CSS okay it's just sugar coded CS CSS but yeah so it's going to go and update this it's going to save this style with this specific value if this trigger was clicked so if you click this one the value is saved with you know justify space between this is uh space c uh justify Center okay I hope that makes sense so I've showed you three different variants you can go ahead and use you know a bunch of these sliders or you can use a custom uh you know just an input field or you can use these tabs to create multiple different styles okay so copy everything inside my settings and replace it in here okay and I have to also change some imports I think so if not I'm happy if if I okay I don't think I have to and this is what it looks like okay so just you already know how I created this right and for the check uh for the flex box I have a check boox here same thing if you check it I'm going to send that handle change with those custom properties and the direction um here I just put something in here so you can change it to column or row okay so I just put a text field here and yeah this is opacity change it to you know whatever you like oh I made a mistake here but you guys can fix that I think so for Border radius let's see where is that um border radius in here what is its value default value okay see for border for Border radius I said this so this is border radius okay and here's the cool part you get everything from here from typescript as well so let's go ahead and change that okay so now it should work uh refresh okay it's it's working but um the small value where's that okay up here so border radius this also needs to be changed to border radius nice and now it's going to work perfect nice so yeah that's it I just used Flex box and made these side by side and I set top bottom right left for padding for margin and so these are the section sections I created I created custom typography Dimensions decorations and flexbox okay so go ahead copy that or if you want to genuinely take this up as a challenge pause the video try for yourself just give it a shot create font family create weight I use select component here okay just try all right nothing's going to happen so give it a shot try to build some and if you can amazing I'm super proud of you if you cannot no problem just copy from GitHub um it's the same thing right we just explained just some CSS styling we're putting it left right and all that kind of stuff copy it paste it here and we'll continue with the other sections now all right now we're going to create the media bucket tab so go into your folder structure and above this just go ahead and say media- bucket- tag uh tab. TSX and return a component here call it media bucket tab okay and I'm going to shrink this so you can see more and this component is going to have have the sub ID which is a string because we want to fetch all the media buckets from there right so that's why we need that so go up here and say use client and this is a traditional like old you know School uh react component okay so we're going to have a use effect that's going to do the fetch to get all this data okay and we're going to get media so I'm going to import that we already created that previously so when this component renders okay first when the component mounts for that we're going to it's going to call this use effect in here okay so when it calls this use effect that's time it's going to fetch the data so after the component renders then the first so once it's mounted it will invoke this okay so after this we also need to save the data so we're going to create a state and that state is going to have data and set data and the get media files imported from our types cool so now when this loads we are fetching all the files and we're storing this in here nice very traditional style and then finally inside this div we're actually going to return a class name I mean we're going to return a div here and I'm going to put the following Styles so I'm going to say say height 900 pixel overflow scroll and padding of four and then go ahead and return media component like this and this is going to have data set to data and then subac ID set to props do subaccount ID you can also destructure this if you want no problem so now we have this so go back into our sidebar which is inside our tabs and now we have to create that sorry not in here inside this one guys so inside funnel editor sidebar index. TSX and if you scroll down you should find this first tab right which is the settings and after this you need to create that another tab for showing the media bucket okay so I'm going to scroll down here after this tabs content and I'm going to put another tab content here called media bucket tab like this and I'm going to pass in sub account ID into it and no need of any class name so I'm just going to remove this and the value is going to be media so when I click on media this one it says no media Let me refresh this okay because we don't have any media files so go ahead and upload some media so I'm just going to upload an image I'm just going to upload this one okay and I'm just going to call this workstation okay or let's just say office upload this file and let's just give this a second okay I'm also going to change this to office room and go ahead and upload this specific media okay and now when you click on this media now you will see this so literally users can copy image links and go into the settings and they can change the background URL so they can say background URL and they can paste that in there how awesome is that right that's why we have that feature that's why we have the media buckets directly in here great job job guys now we're going to skip two processes for now and we're going to get back to that at a later stage okay so those are basically the two different tabs which is components Tab and the layers tab okay because we need components on the screen to show the layers right so it doesn't make sense to build layers first so that's why we're going to skip that so now go into funnel page ID and click on this page. DSX okay and if you look in here you're going to realize we have the navigation in here and we also have a sidebar in here here but we're missing the editor so go ahead and create a div and this div is going to have the following class name height Das full Flex justify Center okay and inside this div we're going to create a component called funnel editor and it's going to take the sub accounts ID as a prop so go ahead and pass that in as well just you know might as well and copy this go in here go into components and we're going to create a folder in here called funnel D editor okay and inside that create index. TSX and return a component in here and just paste what you just copied all right now we want to go back into page. TSX and let's go ahead and import this component from here okay and let's go in here and through the props let's get the sub ID which is a string and let's also destructure that value right in here okay now let's understand the purpose of this component this component is basically going to act as the first element for our editor so you see our editor here right it's going to return one element and let's see if you can guess what that element element is nice if you guessed recursive element that's exactly what this editor is going to return just one recursive element and that recursive element is going to decide whether to return more recursive elements or to return a static component a static element okay nice I hope that architecture helped you kind of understand at least a little bit of what's going on okay so let's go in here and what we're going to do guys is first change this to a client's component so use client top and in here we're going to get access to the sub ID right and we're also going to get access to a couple other things all right sorry guys this is not sub ID this is actually funnel page ID so go ahead and change that to funnel page ID like this copy this pasted here and let's go back and also change this as well and change this to funnel page ID okay sorry about that and let's go back into this component and inside this component we're going to first change this to a client component and let's also get our our use editor hook setup so use editor not use effect like this invoke it and let's get State and dispatch from here okay these are the only two things we need if we need other things we'll import them as well now first we are going to have a use effect okay and this use effect is going to do the following so basically it's going to check if we have passed in live mode okay so I'm going to also have one more in here called live mode which is optional and it is Boolean okay and I'm going to go ahead and also destructure it from here so if I have passed in live mode and live mode is true then we're going to dispatch and set and toggle live mode to True okay and we're going to pass in a value here and set it to true that's what we're doing here why do we need this well in production inside our domain route so you see inside this domain route in here we're going to render that component right so when we render that component if it's in production this is pretty much in production we want to render that live mode so that that way we can hide all the borders on the elements the navigation bars and all that kind of stuff okay nice and now there's one more thing we need to do in here before we move to the bottom which is to get all the funnel page ID information okay now here's a challenge I'm just going to put it here for now and I will address it later okay and if I don't you guys can at least keep this in mind okay because there's so many challenges across the entire project so this challenge is basically to make this more performant okay and I'll tell you what I mean by that so this is the use effect so what we're going to do here is when this page loads we're going to basically get all the details of this page okay we're going to get the details that way we can get access to the details and we can set the state to hold those details okay so that way we can pass in the contents right we want to show the specific content on the page that's why we need that so I'm going to go ahead and create this get funnel page detail query so go into queries here queries and at the bottom I'm just going to say get funnel page details which is an async function with funnel page ID which is a string and the response is db. funnel page. find unique where ID is funnel page ID okay we're just going to return this I'm going to quit this here and go ahead and import this okay and now when you import this basically what's going to happen in here is we're going to fetch these this data and then if there's no response we're going to return but if we did get a response we're going to dispatch the load data action and we're going to set all the elements you know to those elements and we're going to change with live to say if this component had live mode then convert that to a Boolean and pass that in here okay I hope this is making sense and why do we need this like I said in production when we you know spin up the page we need to basically show something on the screen right so that's why we need this right here live mode that's it and now what do I mean by make this more performant now think about this if this is being Ren Ed on the client that means if you're fetching the Page information on the client that means in production when we're accessing that domain page and if we refresh and try to load it don't you think it's going to take some time right it's going to take some time to load because it's going to fetch the information on the client side so basically what you will see is a black screen or the background screen which is this color right here and then after a second or half or whatever how long it takes to load it's going to then populate the state so don't you think that's going to take some time right so you would basically have to fire this load data from somewhere but how is that even possible how can you do that that comes in handy this comes in handy through the use editor hook so basically you can pass in some values into this use editor and you can probably you know set the the state manually or you can also just um use the provider itself and you can set the states manually so what I mean by that is inside the domain you basically get the information of the page details and inside the provider you want to pass it as a prop so when the component renders because it is serers side render it already has access to the page details okay I hope that makes sense and if it doesn't the Discord is always open I'm going to sit there and explain until you do okay all right guys so let's go back here now and we're going to return the components I'm going to shrink this you can see more and remove this and return a div with the following class names so this is important so just copy it from GitHub and I'm going to explain in a second okay so paste this here and import clsx so what is this based on whether we are in preview and live mode we are going to show this right which is padding of zero and margin right of zero okay so what that means is right now the margin right is actually set to something else so if we go in here oh right in here you see we have the margin right set to 385 pixels right but when we are are in preview mode we want this which starts from here to take the whole screen that's why we're setting it to margin right of zero and padding of zero so it's completely flush with the screen okay and also if it is on tablet mode we're going to change the width mobile mode change the width and desktop we're going to make it full screen okay and then we're going to have an onclick so when we click on this element when we click on this because this is the body element technically right we're just going to assume it's the body element we're going to do something in here and what we're going to do is we're just going to dispatch an action and this action is change clicked element and we're going to pass in no payload so it understands that you know it's the default element that's supposed to be selected okay cool all right now the other thing I want to show in here is a little preview icon okay like this IE icon so when you click on this preview mode you see it goes away but now I want to show that in here right how can I show that icon so I can go back very simple we're going to create a button here and this button is is basically going to have this ey off icon inside it okay and we're going to have an on click in here too and basically when the state editor is in preview mode and the state editor is in live mode okay then we're going to return this component okay so let's let's see what that looks like so if you click this you see that okay but when we are actually inside the live okay if we are only in live mode preview mode will not be selected correct it won't be true so that time we will not see this I this IE icon it won't be in here okay so let's go ahead and finish this up so to uh handle this preview very simple we're going to go up top create this function we're going to dispatch two events toggle preview mode and toggle live mode the two events are going to be fired so now when you go in here click on this it does this when you click on this it shrinks so check out those animations guys if you show this to your employer they are going to hire you there's no way they're going to be like H this is such a bad project who is going to tell and look at look at that that's so nice I just want to do this all day all right anyway and after this we're also going to return some components right so this component is going to be the body tag basically so let's go ahead and build that okay so now you want to open your directory and you want to go into the funnel funnel editor and you want to create another folder and you want to say funnel Das editor- components okay and this component is going to have the recursive component and all components with respect to the editor not this one okay we're not building this now we're building that later okay so and now we're going to go inside this funnel editor components and we're going to create a file called recursive ttsx okay and this file is very simple it's just a switch statement so go ahead and just return a component and just return recursive there okay and this is just going to be a simple switch statement so I'm going to remove what we see in here and I'm going to say switch okay and this is going to get some props in here so we're going to get the elements which is going to be of type editor elements import that and we're going to say destructure this to and say element like this element. type so based on the type we're going to return specific components so the first case here is going to be type text okay so I just made an error here I said case like this and I put it that's why it wasn't showing so you want to say case Okay and then put this and now you can pick each and every type so I'm going to just say text and for text we're going to the following okay so remove this and you'll be returning some specific component like text component like this okay this is what we're going to be doing we're going to return this text component and of course we don't have this and we're going to get to this in just a second but for default we're going to return null so if you don't return if you don't have anything in here we're just going to return none now go into your folder structure inside these editor components and create text. TSX and return a component in here and we're going to change that that to text component let's go back and quickly import this component like that and I'm going to go into this component and it's going to get access to the element which is the editor element okay and I'm also going to pass this in here so I'm going to say element equal to element like this okay nice and also inside this component we are going to do a bunch of stuff in here so we're going to have the component itself we're going to be able to also change its properties so we have to have that ability right so there's a bunch of things so just pay close attention so the first thing I know I need is the use editor hook so I'm going to change this to a use client component and let's go in here and let's say const equal to use editor okay and I'm going to remove this and I'm going to get access to dispatch and States because I know I might need both of these okay and let's go here and we're going to remove this text component and we're going to say draggable okay and the reason why we're saying draggable here is not because this is draggable because that is is something we are not doing okay we are not adding drag drop here okay we're only adding drag drop from the navigation bar okay but I have dragable in here actually let's just go ahead and remove this we don't even need it okay but the reason why I'm putting it in here is I want to show you something eventually so I'll keep it now and I'll show you and you guys can do that as a challenge okay so draggable we're going to have class name and we're going to set the class name to the following so I'm going to just use clsx okay so import clsx like this and don't worry guys I'm going to explain so we're going to say padding to withth full margin 5 pixel relative text 16 pixel and transition all and then this one is going to have a border of blue 500 states. editor so if state. editor. selected element ID is equal to this exact element ID that we got in here then oh this is wrong here so this is element like this okay so if we are selecting this current element then we're going to have a border blue around the element element okay and we also want to have the Border be solid so if it's equal to that solid you can put this on the same line actually if you'd like but I'm just going to put it in here and then border dashed okay border one pixel and Border slate this is true if it is not in live mode okay cool all right so by default basically we have this and only when you click on it we're going to have this blue border so of course you're not going to see anything right uh because we haven't rendered that and let me also refresh this so we can see what we're doing all right and also go into recursive and make sure you change this to element guys um because we changed that right so nice so once you do this um while while the server is loading up okay server is loading just come in here and we're going to do the following so we're going to say if the state. editor so if we are selecting that editor then we want to have a little badge icon that shows on top of the element so at the top left corner we want to have a badge that shows the name of the component okay so I'm going to go ahead and put that which is state. editor. selected ID so if we're selecting this element and we are not in live mode okay so we don't want to be in live mode if that's true just return a badge from components UI badge and put it absolute with top of -23 pixels left of negative 1 pixel rounded none and rounded top LG okay and now we're going to have the name inside this you won't see it of course because we don't have any elements so don't be alarmed it's going to take us some time to see any okay and then we're going to have a another span component so what is this span this span is basically to delete the element so before we put anything in here so I have something that I would like to do so I'm going to create a span in here okay and we're going to say content editable we're going to set this to if we are not in state. editor. Liv mode okay and in here we're going to say onblur is equal to a function like this set this to e and in here we want to say const span elements equal to e. Target as HT ml span I think we have something span elements right yeah okay and then we also want to dispatch an action so what we're doing in here is this span can actually be editable so you can click on the screen and you can change it so initially what I was going to do here was have a setting in the custom settings but I think it's so much more better if you can click on the screen and change the text right so that's what we're going to do here so I'm going to say dispatch invoke that and we're going to pass in the type and set this to update element and payload is going to be an object with element details set to everything inside inside so Props do element uh like this and the content okay something is wrong here why is it not giving me okay this is I made this an array on accident sorry guys this this is an object okay element details is everything in here but content is going to be set to Inner text of span elements. inner text now you're going to have an error here why I want you to try to guess why do we have this inner text error nice if you said the reason is because inside our provider we don't have this custom element set up with this custom property that's the answer so let's go to our provider and up here you will see we have only href so let's go ahead and create inner text as well and set that to a string and this of course has to be optional there we go and that's going to solve that problem so this is how we can set custom properties right so this is why we need this inner text thing right in here and now in here we're going to say if the content is not an array we don't want it to be an array because if it's an array that means it is not a text component it's not a static component it's a recursive component so this component does not deal with recursive components it only deals with static components right so we're going to say if array. isarray props do element. content then and so we're going to say and here props oops not prop props do elements. content do inner text so if this exists um so if this exists here so if this is true then we're going to just return the inner text that's what we're doing here okay and then after this finally we're going to show a delete button at the end of the component so we can delete it so I'm going to go ahead and copy this and paste it in here and all this is doing is is saying if state. editor. selected element ID is equal to this element then and also we are not in live mode go ahead and return a div which is absolute BG primary padding X of 2.5 padding y of one text of excess font bold negative top of 25 pixels right of one p negative 1 pixel rounded none rounded top LG and text of white and we're going to return a trash icon okay and I'm going to complete this handle delete element which is actually insanely simple let's go up top and we're going to say handle delete element okay it's going to dispatch an action that says delete element with the payload and the element details which is props do element okay that's what we need to delete so nice and now let's go in here okay and now we have to complete the onclick so when we click on this we want to do something right so I'm going to say onclick equal to handle on body so we clicked on this body we clicked on this tag basically right so what this is going to do is I'm going to copy this okay we're going to go up here and this is very important please please pay attention we're going to say handle on click body which is an event which is react. mouseevent we're going to stop propagation the reason is because because these elements are within each other and because of event bubbling this event is going to go all the way up the child all the way up the tree and fire at the body tag we don't want that we only want this to fire at this specific element so we have to do e. stop propagation okay we're going to dispatch a type called change clicked event and we're going to pass in the payload of element details as payload do element all right guys nice now the next thing we want to do is we want to get the styles for this element so we're going to say const Styles equal props do element. Styles and in here we're going to basically say Styles equal those Styles so now we're going to overwrite it with whatever we're putting inside our editor okay now what I'm going to do guys is I'm going to just remove this for now because we don't need it actually in this component it was just there for the challenge and um I'll see if I can mention the challenge at the end so that you guys can go ahead and give it a shot okay nice and so now we've created one textt ele element so I also want to create the body element so we can render something right so go in here and I'm going to create a quick case here called body and we're going to create container now this container is a custom component that we're going to create and in my opinion it is the only complex component in here okay so copy this go into your folder structure in here and we're going to say container. TSX and let's return a component and paste that in there so let's go up top and let's go ahead and change this to use client and also want to make sure that my other component has used client 2 okay and inside the container let me go ahead and import that so/ container and go into this component and this gets access to element which is of type editor element okay and in here I'm going to extract some props ID name sorry about that so I'm going to say elements here like this and I'm going to destructure from this the ID the name style and type okay and I'm also going to get use editor so const equal use editor invoke that and we're going to get access to these two dispatch and state okay nice now I want you to keep this in mind a container is an element that is recursive so what that means is inside a container you can have other elements and you can also have other containers so basically what we're going to return in here is not text not something else we're going to return another recursive component so in here we're going to just return another recursive and then we're just going to pass in the details into that component so that's how we're going to know what component has to be rendered okay that's what we're going to be doing here but let's go back into this container so another thing I want you to keep in mind is if this component can have elements inside it that means we should have the ability to drag elements from the sidebar and drop them into this container correct so that means we are going to use some drag and drop features in here okay so what I'm going to do now is I'm going to go to the bottom here and I'm going to give this style and set this to props so did I take Styles here yes I took Styles so I'm just going to import uh I'm just going to put these Styles in here okay and this is going to have the following class name so this is a little bit not complex it's just a long class name okay so let me go ahead copy and paste it and I'm going to explain so I'm going to import clsx like this and this is going to be ID so change this to ID okay nice and I'm just going to explain real quick just focus so we're going to have relative padding four transition all and group okay this is important group now it's going to be Max width of full and width of full by default okay and this is if the type is container or the type is two columns so a column is also a container keep that in mind okay um sorry a two column is also a container with two containers inside it and then we're going to say height fit if the type is of container and height full if the type is of body so if it's a body tag we want it to take the entire screen right and then we're going to say Flex Flex column MD of flex row if it is two column so we're using the same container for two calls too so if basically look at recursive right if we go to recursive for two call for the type two call here we're actually going to return the same container itself all right nice and okay and then after that here we're going to say border blue of 500 if the element is selected so selected element from the editor is equal equal to the ID so this exact element and it's not in live mode and the selected element type is not of type body okay because we're going to have a special color for the body tag all right I hope that makes sense and we're also having a special border WID here so if it's Bo body tag we want to show that hey you're clicked on body tag and that's going to be yellow color okay same thing here state. editor. selected is the same ID and um state. editor is not in live mode and we have the type of underscore uncore body okay only two underscores not three all right everywhere wherever using this body only two underscores and then a exclamation border of solid so this is true only if state. editor so if it's we're selected on this element and we're not in live mode then we want this to be solid and we want it to be Dash dashed if we are not in live mode but preview mode is there right so that's why so by default it's going to be this so if we're in uh live mode then we're going to replace this okay cool and now inside this component we're going to have an on inside this div we're going to say on Dr on drop okay equal to we're going to get e here and we're going to pass in handle on drop and we're going to invoke it and pass an e and this uh this element itself and now what I'm going to do is I'm going to scroll up top here and I'm going to say const handle on drop equal to a function and this function takes in so and this function is going to take in event which is of type react. drag event okay and the type is going to to be of type string and inside this we're going to first say event.stop propagation because when we drop an element inside an inside a container any element that has on on drop will also fire so we have to stop propagation and then we're going to say a very switch uh simple switch statement in here and this one this key in here is going to be component type okay and if you want to know where we're getting component type that's from here so we're going to say const component type equal to e. data transfer doget data and we're going to say component type like this and we're going to set this as editor buttons now this is not going to make sense I know and I'm going to explain it right now so when we drag an element from the sidebar there is this thing called data transfer we can basically attach metadata okay metadata or any type of data into this event when it's dragged across the page and the handle on drop event basically gives you access to that data transfer so if you want to see this in action we're going to see this in just a bit okay U just hang in there just follow through it's all going to make sense so in here I'm going to say component type okay and the case in here is if it is of type uh text for example so if an element that was dropped into this component was of type text we have to dispatch something we're going to dispatch and add an element right we need to add an element cuz we dropped something in here and we we need to add an element into this element so that's where we need that container ID so we're going to say type equal add elements and payload is an object with container ID set to this ID and element details set to content so I'm going to copy this and paste it okay just give me one second so this element details is going to be this object with the content set to Inner text as text element okay because it's a text right and the ID is going to be V4 just import that name is going to be text Styles is going to be this color is going to be black okay and default Styles where does this come from so you're just going to go into your constants in here and I'm going to create an object called default Styles and it just has some basic stuff that we're going to use for every component okay object fit cover background repeat text align left opacity 100% And background position of Center okay and let's go back in here and import this huh what's going on let's go back into to that file real quick not sure why it is not default Styles export const default Styles going to go in here okay it's not showing guys so I'm just going to import it from here default Styles like this okay and that imported it well that's that's just bad so yeah I'm going to have the default Styles in here and the color set to Black and the type set to text so this is how we add elements within a specific container okay awesome also after this text I'm going to create one more case in here for the container and I'm going to dispatch an action called add element with the payload this container so inside this container we're going to set the element details to add to this one so content is going to be an array V4 the name is going to be container Styles is going to be you know our default Styles and the type is going to say container and now same thing guys you can literally copy for all elements but these are the first two things that we need to kind of get set up okay and now let's scroll back down into the div and we want to have another thing in here called on drag over okay on drag over and we're going to set this to handle drag over so we're going to go up top and we're going to build this function now for some reason this function has to be there or nothing works okay and I think the reason is because we need to like it's because of event bubbling clearly because we're doing event. prevent default so it's basically the default Behavior I think is not to do what it's supposed to do what you think right so that's why we have to prevent it like for example if you hit the submit button it kind of refreshes so we have to do event. prevent default right same thing here okay so you have to put this in here so go ahead and put that in there and now I'm going to have a dragable in here and this draggable is going to say type is not equal to type body okay and then we're going to have an on drag start and this on drag start is going to have an on drag start function right here and let's scroll up top here and I'm going to create this on drag start which says react do drag event okay why is this indented okay type as of type string and we're going to say if the type is equal to body return and if not we're going to say e. datat transfer. set data component type to type so this is how it works guys this is how we can transfer data into that event so you see here when we drag an element we're just attaching some metadata called component type to this data transfer and then we when we drop it somewhere we can extract that by saying get data component type that's what we're doing okay cool okay so I know there is some kind of indentation error somewhere what is this right here okay that's what was causing it okay so I'm going to remove this I don't know why I copied that and sorry guys I just made a bracket problem there so just create this function up top okay and then finally we're going to need an onclick which is going to be handle on click okay and we're just going to say handle onclick body and then this function is going to do the following we're just going to set the state to basically say that this is the element that we have clicked on okay so what is this error here let me see so the elements here okay I understand so here because we need this element we cannot just destructure it so what I'm going to do guys I'm going to remove this I'm going to say const like this equal to element and I'm going to destructure these values in here like this okay and now I can actually refer to that element from here directly ly okay nice so here when we click on this div or the container we're basically stopping propagation first and then we're saying dispatch change click event and we're setting our element in uh and passing it into the payload so this element will now be clicked and that way we can you know show the border and all and yellow border and all that kind of stuff okay cool and inside this container going to remove this and return a badge very same thing similar to what we did everywhere okay so it's a a badge that has a following class name and it's going to say absolute negative top of 23 left one pixel rounded none rounded top and hidden and block so it's going to be there if state. editor so if we're selecting this right so if you selected this element and we're not in live mode okay let me remove this too okay I think this is good and after this we have to return that recursive element remember so this recursive element basically will determine whether to return some kind of static elements or other containers as well so go ahead and import this recursive recursive from here recursive element like this and just to uh let's understand this too so if the content of this component right here if this content is an array then we're going to map over that and we're going to return a recursive element for each of those elements so what that means is let's say this element had the content and its content was an array of multiple elements now each of those can be another container so that's why we're returning recursive elements for each of them so see I'm explaining in- depth okay and if you have you don't understand I got you I I'll see in the Discord okay all right and here we're going to have the delete button same thing what we did everywhere State editor selected element is equal to this element's ID and we're not in live mode and the state editor. selected element. type is not equal to body okay if that's true then div class name absolute BG primary uh the same thing okay and trash we're going to have the delete functionality and the delete functionality up here I'm just going to scroll up top and say handle delete element which is dispatch delete element and the payload is going to have element details set to element okay that's it so this is going to grow as we keep going but it's literally copy paste copy paste that's it okay nothing else you guys got this I know you're almost we're almost there guys we just have to build payment forms and I'm going to show you how to create some more static complex static components like payment form contact us form and things like that okay so that way you can sell products directly in here from stripe okay go ahead and open this and click on the funnel editor click on index. TSX and the reason why we're not going to see any components in here is because we're not returning that recursive component right so let's go down here after this I button thing okay we're going to say the following so if array do isarray stat. editor. elements and state. editor. elements. map so basically if this is true then we're going to map over those elements so first let's get the child element here and we're going to return the recursive element like this so where is that funnel editors recursive okay and we're going to pass in key and set it to Child element. ID okay and we need to pass in the element itself which is the child element okay now you won't see anything in here I feel okay we do nice I thought because we saved the page we would have some errors but there you go nice now you see this so you can click on this and let's go down to background color and I'm just going to say white and there you go it changes let me save it actually and refresh awesome guys there you go now it's set up and the reason why you can't see the body tag is because it's kind of pushed okay I wish I could show you I can show you actually I just just have to push this down but I'm just a little lazy I'm not going to lie but I promise you it's here okay and you cannot delete this because it's a body tag so this is how it works so now you can click on this and so on so forth awesome so now let's move on to building this I think it's a good time to actually build this component drag and drop functionality okay all right now go ahead and create a folder inside this tab folder called components dtab and create an index. TSX and just go ahead and return a component in there okay so first we're going to say const components or elements and this is going to be of type of an array of a specific type of object and it's going to say component okay like this component which is react. react node and it's going to have the label which is going to be a string and we're also going to have the ID which is going to be of type editor button okay and we're going to have group so this is going to say either layout or elements so I'm creating two different groups inside our sidebar now let's quickly understand what is the what is this component sidebar so if you remember we have the plus icon right so when you click on that plus icon we want to have a list of components that we can simply drag and drop onto the editor that's what this is okay so this components tab is going to have a bunch of placeholder components and these placeholder components are just little widgets okay that you can drag and drop that's basically what this is all right I hope that makes sense so uh what you're going to do now is uh scroll down here and we're going to say accordian so remove this stuff and say accordion like this and this is going to have type equal multiple class name equal with full and we also want to set the default value to be an array with layout because we're going to create two right so layout and the second element is going to be elements like this and inside the accordion create an accordion item so I'm just going to copy this and paste it so save you save you some time so accordant item like this with the layouts and I'm going to go ahead and import this component as well with value layout and the class name is px6 py0 p border y of one pixel okay and inside the accordion item go ahead and create a trigger so this trigger is going to have layout inside of it and it's going to have no underline uh just like this okay and the content to show inside this accordion item is basically this so say accordian content so everything from the these elements okay we're only going to get the layout elements that's what we're showing inside this accordian item so filter the element group where it is equal to layout and then we're going to do a DOT map and we're going to return a div in here and just pass in a key with the following class name Flex call item Center justify Center and flex and we're just going to Simply render the component like this saying element. component we're also going to create a span and say element. label okay awesome and then after that we also going to have other elements so go uh right outside this accordion item and we're going to create another accordion item like this and this accordion item is going to say elements as the value with this class name px6 py of 0 the accordion triggers is going to say elements here and it's going to have no underline the according content is going to say Flex Flex wrap Gap two and we're going to filter where the elements. group is equal to type of elements I got to change this here guys sorry I made a spelling error so change it to elements and then we're going to get all of them so map and we're going to return a div so pass in a key and the class name is flex call items Center justify Center and flex and then we're going to pass in the component inside that and a span right below that to show the label okay and you can make it text muted foreground awesome now what are these components what are these components going to look like so now we only have the text and um a container element correct so what I'm going to do is I'm going to build out those two components because we have those so the first one is an object here with a component text placeholder which we're going to create in just a second label is going to be text ID is going to be text and the element group is going to be element so it'll be grouped under uh it'll be grouped under this accordian item okay so go ahead and open up your uh directory and inside the components tab you can create a file in here and you're going to call this text- placeholder.svg this process when you need to create any sort of component inside your navigation okay inside your sidebar and don't worry I'm going to give you a detailed uh illustration as well at the end of this to show you know a one-step process on how to create components which is first build it here then build it inside the index then go ahead and build your component I'll show you the whole process in just one image just one picture okay but let's go ahead and build this first so this is going to get um the following so we're going to just return a div here because this is a text return a div with draggable this is very important because it should be draggable on drag start um on drag start is going to be equal to a function okay and this is going to give us e which is the event and I'm going to call a custom function here it's called handle drag start invoke it pass an e and we're going to pass in the type which is text and now let's go in here and say const handle drag start equal to this function so equal to a function up here okay and it's going to take an e which is react. drag events and um we want type to be editor buttons okay one of this so that's how we can pass this in here and so basically when we uh when we drag uh when we first drag this component we need to attach that data transfer right so we're going to say if type equal to null we're simply going to return okay and then we're going to say e. data transfer invoke it uh actually no need to invoke it say set data invoke the set data and pass in component type don't make a spelling error here okay and we're going to pass in our type just like this so now when we drop this element this placeholder into any component that has that uh on drag drop right on drop right then inside there we're going to get and extract this data transfer which is the component type and we're going to get the type from there and based on the type we're going to update the editor state that is all we did okay that's why in the other component the container component we had that data transfer stuff in there okay I hope this makes sense all right awesome so now inside here go ahead and give this a class name okay just to give it some styling so I'm just going to say this height 14 width 14 background uh muted rounded LG Flex item Center and justify Center and in here I'm going to use a type icon okay which comes from Lucid react and I'm going to set the following props so I'm going to say size 40 class name of text muted foreground okay and now let's go back in here into this component and now we will have this component render okay but nothing's going to show of course so just give me a second guys let me first refresh and set my server so go ahead and open up your directory and you want to go into let's see which is that I think it's this index y so go into funnel editor sidebar index. typescript okay and inside this right here after the media we're just going to create one for the components okay so I'm going to hit enter after um let me see we have a tab content here hit enter and create one more tab content and we're going to go ahead and import the components tab just like this okay so it's just nothing just tab content with a value sets of contents sheet header which is a title description okay and the uh component that we want to render so now when we click on this there you go you can see we have um this accordion here and we have one for all the elements so I can drag this and I can drop it anywhere into this element okay so let's go ahead and test and see what happens so if I drop it boom there you go you see the element now and when you click on it that element becomes the selected element and that's why we see all these you know the badge basically and you can also go ahead and delete this element and it removes it how awesome is this guys wow this is actually insane I actually love this so now if we click this I want to show you what happens if you click this everything goes away even the borders and I can't even drag it okay and if you see this icon here right you can click this to go back to edit mode and you can also shrink the page guys you can see what the website is going to look like on different devices this is actually very important in all website Builders right so that's why we need this feature here so yeah so I hope this makes sense now let's go ahead and build um we have a bunch of other elements in layouts so I'm going to build the container as well to show you how that works okay so now let's say you wanted to create a new component you're going to come in here you're going to say component and you're going to set this to a new component so I'm actually going to call this container placeholder okay like this and I'm going to go ahead and copy these things here and I'm just going to change this um as well so I went ahead and changed this to container and this is small letter container and it's going to be grouped under layout and of course we don't have this so then you're going to go into your components tab you're going to create a container Das placeholder TSX and you're going to return a component here and just do that okay and inside this component first you're going to say const handle drag start equal to a function so basically the exact same thing for every single component you want to create that's why this is so reusable imagine if a new team comes in they can immediately just change this uh just add components here and it's all going to work the way it should right so I'm going to get the two parameters right inside this function and those two parameters are uh this which is the event and the type as well and if there is no type we're going to throw um I'm not throwing an error we're just going to return right so let's do that here we're going to return here and I'm going to go ahead and put the same props the exact same thing from the text inside in here however uh this is on drag start guys RT okay on drag start like that and it's the same exact thing the only thing is when you are dragging you want to pass in the different type so for this one is container so I'm going to pass in container if you don't know where this is coming from it is one of our editor buttons okay awesome and then inside this I'm going to remove this I'm going to create a div with the class name set to the following so the class name is going to be border dashed border 1 pixel height full rounded SM BG muted border muted foreground by 50 and withth full I'm also going to just make this a closing tag like this and now if I go back to my tab components which is the components Tab and index. TSX I'm going to go ahead and import this and now you can see inside our components we have our container so if I drag a container okay drag a container okay something seems to be wrong let me go ahead and figure out what's going on guys okay so I think the problem is inside our recursive um element right in here because for body we have something but what about for the rest so go ahead and you're going to create another container type here so you're going to say case container and you're going to return a container so this was the problem here now if you go back and drag this okay it already showed it up so I'm going to delete this and refresh the page okay you click this there's nothing in here if you go into components drag a container now you see a container right awesome so you can see that container and if you drag a text inside it it's going to place that text inside that container okay it looks like it also created another container here it's not supposed to do that but that might just be a mistake um you know from where we are setting the component so let's go inside the text component and in here okay not in there it should be inside a container right so inside the container for the text component we are returning this all right guys all our logic was perfect what we missed here is inside our container so go to your funnel editor components and go into the Container not the placeholder when we are dropping the component we are doing exactly what we're supposed to for the text component but we did not put break here so what's happening is it's jumping to the next line and also performing all these actions so remember after every case you either have to have a return statement so you can return here or you have to have a break statement now if you drag text components inside this you will not see any more you know of those weird containers being placed after them okay sorry about that error but that's it that's literally the fundamentals that's literally all you need to know to you know to build an editor like this and now you can click in here and change this to welcome page and you if you save it right and you refresh the page you will now see that element and if you go into preview mode this is what the website is going to look like right you see right here and we can get out of this now there's another thing I wanted to show you which was our elements as well for example a container has an on drag over this is not a placeholder sorry on drag start and this is not a placeholder why are we doing this well this is a challenge for you right now when you can also drag these elements around okay and the problem is when you drag these elements right let's see uh let me show you something here so when you drag an element you can technically drop this anywhere right so I can drop it here and it's going to create a new uh container for me so what I want to do is I want to have the ability to duplicate Elements by simply dragging and dropping them that makes it so easy imagine I could drag and drop five cards and that's it it's done right so I want to have the ability to do that and also check out our undo feature how cool is this you can undo and redo stuff right so I want to have the ability to do that I want to have the ability to copy the component so here's the challenge when you're dragging a component itself I want you to send a new state so right now when we drag an ele element from here right we're only sending the component type right only the component type but now we want to send the entire component itself so that we can rebuild or just copy that component below that so this is a big challenge I know but if you go for it I know you guys can do it you've learned a lot I've I've literally explained every single thing in detail um and if you need more support right I'll be more than happy to help you in the Discord okay and everyone is helping each other out in there like everyone wants each other to succeed so we will help you but I'm just saying that's how you know um that's what we want to accomplish in this uh in this challenge so go ahead pause the video if you'd like and give it a shot if you don't want to do it now you can finish the project and put it on your to-do list do it and then share it with everyone in the Discord or post it on your stories or whatever CU everyone's you know super excited about what we're building okay awesome all right now I'm going to show you the entire process in one shot of how to create a new component okay so so far we went and just created um a text and a container but now we want to create um another component called video component okay so I'm just going to show you the entire process first thing I would do is I would go into the sidebar placeholders right in here into the components Tab and I'm going to go into index and I'm going to quickly create a component in here okay so because this is a video component I'm going to create this object call it component video placeholder label is going to be video the ID is going to be the video group is going to be elements okay and copy this and next step is I'm going to go into my uh my funnel so right here into the sorry into the components Tab and I'm going to create a new file in here and I'm going to call this video- placeholder.svg next thing I'm going to do is I'm going to create my on my handle drag start which is the exact same thing you guys know what this is right it's just taking uh two event two properties U sorry two um parameters in here and we're just returning if there's null and we're setting the data transfer to whatever type we get and in here all we're doing is we're going to return a div with the following with the same exact props okay nothing different so we're going to say draggable on drag start drag we're going to handle drag start here pass in the events and we're going to pass in a video as the type and the class name is going to be height 14 with 14 the same thing okay and for this I'm going to use YouTube icon from Lucid react and I'm going to set the class name and the size to the following so size 40 class name text muted foreground okay nice and then next step is you're going to go back into your components tab which is this one index . TSX and you're going to import this video placeholder and now I'm going to verify to make sure that I can actually see this component there we go I can see it but if you drag and drop nothing is going to work because inside our container we need to listen to this component and we need to change the state right so I'll just show you see if I drag this and drop nothing is happening in here because it's not listening so next thing I'm going to do is I'm going to go into my container TSX and I'm going to do something in here so after this case I'm going to create a new case in here and this case is for the video okay and I'm going to dispatch an action called add element I'm going to put a payload and the payload is going to have this specific container ID and the element details are going to be content uh the ID the name the Styles and the type video but the source is going to I'm just putting some random video in here but the source here has to be add added manually so because this is a special type of um static component I'm going to go into my um provider which is in here okay go into provider I'm going to scroll up top and here I'm going to add this special prop okay the special property in here so now I can actually use that um to kind of show this now that I have this container listening for these specific uh elements and firing these display patches to add the element to the to the um to the editor State now we want to render a component out for this so let's go to the recursive component in here and now for a case video we have to go ahead and return that video component so that's going to look something like this so I'm going to say case video and I'm going to return a video component which I'm just going to build and pass in the element and this video component we're just going to open this here and you're going to create video. TSX and in here just going to return a component and change this to video uh components okay because video just sounds weird so yeah just say video. TSX like that and just put this in here now go up top and change this to use client and here we're going to get the element which is going to be editor element and I'm going to destructure this uh or we'll just keep this this is fine okay and now I'm going to say const equal to use editor and I'm going to get the dispatch and state okay and then I'm also going to scroll here and we're going to remove this or we can keep this no problem and first I need the Styles okay so the styles are going to be the props do elements. style okay I'm going to get the uh style from that element that's being passed in so I'm going to kind of get that value there you can also use use memo and store it no problem and then I'm going to pass the style into the element so I'm done with the Styles now next thing is if I ever wanted to do the duplication um you know feature I'm going to go ahead and pass that feature in here too so make this draggable on drag start and I'm going to quickly create this um this component I'm sorry this function as well and this function is going to look like this so it's going to take the drag event and the type which is the same thing as what we did in the placeholder right and we're going to do e. datat transfer. set data for now I'm just going to do uh component type and passing this type okay it's your it's a challenge for you to go ahead and figure out how to do that duplication but it's very simple okay I already explained the logic if you need help I'll I'll help you just reach out to me then after the on drag start now when we click on this I also want to be able to set this as the selected element in the editor so go ahead and get the event from here I'm going to say um actually we don't need the event from here because I'm just going I just all I need to do is just passing a click Handler so handle onclick um like this and I'm going to go up here and say const handle on click is equal to a function okay and this function is going to take in the same thing again okay it's going to take in an event so this event is called react. react um sorry react. mouse event and inside this the first thing I'm going to do is I'm going to stop propagation and I'm going to dispatch a chain change click element um action and I'm going to set the payload to this specific element okay so now that I've done that let me see what is the next step okay the next step is to give the borders and all that type of class names the The Styling right so I'm going to go ahead and say class name equal to the following so clsx padding 2 pixel width of two media uh margin of 5 pixel relative text of uh 16 pixel transition all Flex item Center justify Center and then I'm going to say border blue and 500 here this is important uh this is uh we're going to say important here if it is the selected element from the state right and then we're also going to say it's going to be solid if it again it is the selected element and then we're going to say border Dash border one pixel border slate 300 if it is not in live mode okay and then inside this now I'm going to render two things first the back for this to show the element right and then the delete button so I'm going to go ahead and paste that and we already did this in all the components right same thing so go ahead and say if it is the current current selected element then we want to also want to make sure it's not live mode then just show the badge for uh the editor's name right sorry the the element's name and then after this I'll just hit enter here and I'm going to paste the one for the delete icon and the delete icon is if it's the currently selected elements and it's not live mode then go ahead and show this delete icon you can pause this and you know type it out or you can copy paste if you'd like I suggest you type it's much better it's going to help you learn a lot okay so I'm going to go up here and I'm going to create my handle delete element function because when I click on this trash icon I want to fire this function which simply dispatches an event called delete element with the payload set to this specific element okay and we're just passing that into these details and now I need to pass the special stuff in here right so what is it well for a video we actually use iframes I don't know if you know but that's how we use videos in HTML go do some research as Chad GPT okay you can do some research and you'll find it so I'm going to go ahead and return an iframe like this saying if the content of this element of course it's not not going to be an array but I have to check to make sure because typescript is going to scream at you so I'm going to say if not is an array prop. element. content then I'm going to return an iframe with the width set to any specific width that they gave or 500 height set to any specific height that they gave or you know this specific number and the source we're just going to pass in so whatever Source they provided that source is going to be uh put in here okay and the title is going to be YouTube video player and you I'm just going to pass in some stuff in here okay which is autoplay and all this kind of stuff awesome so now that this is done let me think what else we need let me see if our recursive okay so go into recursive and import this video components okay so now you should see video here if I drag and drop let's just see what happens awesome guys there you go now you have a video so if I go to the settings and click on this element oops sorry okay didn't mean to play the tutorial but if I click on the video something's wrong here I did not import the badge from the right components okay so go into badge okay I'm going to delete badge here I accidentally imported from Lucid react and import badge from components UI okay and now when I uh go back here because I refreshed the page I lost that data if I paste um a YouTube video and click on it I see video in here okay and then what I'm going to do is go into settings and you can actually change the width so say 400 or 4,000 or 100% or 50% literally whatever you want so if I don't put anything it's going to default to whatever number we have okay and now if you see this in in production this is what it looks like looks bad but you can build literally almost anything okay as you I'm sure you already saw from the examples and guys I would love to see you guys build amazing websites using this Builder and actually put it in the Discord okay and I'm going to share it on you YouTube I'm going to put it in the in the communities okay in the community post sorry all right let's go back so now that we done with this this is the process to create a custom element okay I hope it's broken down pretty well and don't worry I'm going to show a quick picture on the screen right now that like an illustration that's going to show you the process as well okay all right guys so this is the illustration to understand the entire process in just one picture so that you can have a mental image of of how to create new components so first go ahead and create the component placeholder object okay and this is what it looks like then go and create the placeholder itself so what you have to see in the in the sidebar basically then verify your new component shows in the sidebar this is what you created this is what you see now then update the container component to listen to your new events then build the component in itself and finally update the recursive component to return that component if needed all right so I went ahead and copied the link placeholder component and the two columns placeholder component okay if you went ahead and took a step forward and did it by yourself no problem but if you didn't just please follow through with me and pause the video and type any code that you need to okay so first I copy pasted this which is this object to create our component and make sure sure you follow this guideline okay of exactly how to create a new component so create this thing here first and then I went and created the placeholder and the placeholder is inside the components tab okay and I went ahead and created that in here and again I changed this to link okay then after I did this so after created the placeholder I verified the comp component shows so I went to the browser and now I see my link component right here perfect then what's next update the container component to listen to your new event so I went into my container which is inside the funnel editor components and I went into the event listeners right this is technical not it's not an event listener I'm just going to call it a listener and I added the link right in here and what I added was dispatch type add elements payload container ID the element details are basically an object with you know the content set to Inner text called link elements and a set to this hashtag okay and then after that I created the ID the link name and the Styles I'm just going to say color black and I put some default Styles and I set the type to link and then what's the next step let's see build a component itself so I went in here and I created created a link component like this and the link component has the handle drag start very same you know similar to whatever we did in the past it has this to get access to the dispatch and state it's a client component okay we have this coming in from the props as well and then I created the handle on click so when you click on it you want to set this as the selected element so I did that action in here then I extracted the Styles then I also have the delete elements and then I created a div have the Styles here set it to draggable even though it's not needed but this is a challenge for you right and I have this for the challenge too and on click handle click uh handle onclick and then I have this class name here which is the exact same thing as every single element and then then in here I have the badge and at the bottom I have the delete button now in here I want to just point out and we're rendering a link when we are in production and when we are not in production we're rendering a span that way when you click on the link you know annoyingly take you take you to that page right you don't want it to just like keep redirecting you to that ugly page so that's why I have this thing here so I put a span in here and I put a link in here so I'm saying if this is not an array of course if the content is not an array and we are in preview mode or live mode if this is true then we're going to go ahead and show this link okay and if we're not in preview mode so state. editor and not in live mode then go ahead and show the span like this okay so now when I drag this link and put it in here and if I click on it I do have some custom properties which I can change so if I click on this it's not going to take me to some other page okay so for example if I changed this link path here if I changed it to google.com Okay www.google.com okay if I click on it it's not going to take me to that page if I view this now I can actually click on it and it will take me to google.com so if I click right it's going to take so that's why I had that thing in there so that it doesn't actually take me to that to that page okay I hope that makes sense okay then once I finished creating the component I went into the recursive component as you can see in here of update the recursive component and I went ahead and added the link in here with that link component and then there's one final step that's not actually a part of the component creation process but it is to add any custom properties in the tab in the sidebar if needed so basically if you go into the sidebar go into your settings tab right you might need to create some custom properties in here so right now I don't have anything except for this right HF stuff so I'm saying link path this is the only thing I have in here so uh similarly maybe for the video element you can render a custom element so I just wanted to show you just in case you wondering how to change those properties okay so now I pretty much showed you everything except for one more which is the two columns placeholder so I did the same process right follow the same process here but I'm going to but I'm going to just um walk you through the component itself and what it looks like okay so the placeholder is pretty much the same okay just has two divs here just to look like this right here okay and then let's also go into the component itself and take a look at that so we have two columns here and let's see what this looks like so this is going to have the same div okay as the previous container so you can literally copy paste that and you can paste that in here okay and we're going to change this ID to Inner container like this okay and we're going to say on drag Actually I don't even think we need this anywhere yeah we don't even need this I think I was just doing this to distinguish between something but yeah just put it in here it's fine okay I think it comes from probably CSS I'm not entirely sure uh let me see maybe we're doing that in CSS so I'm going to shrink all this stuff inner container okay it doesn't look like we're doing anything in here okay I have it there so it's probably for some reason that's not important anyway but it's okay just put it so yeah we have the same things in here okay and on drag uh start we're setting container and inside here we have the badge and um we also have this recursive element elements so basically what we're saying is for the two column elements we're going to check if its contents are if its contents are in Array and if it is we're just going to return recursive elements for that and inside our container this is what we're doing for our two column element we're basically returning the content as an array of two containers that's it nothing crazy in here okay so that way when you go to this if you drag and drop two containers you see we have two containers side by side and now you can put elements inside those as well like this text and um a video and things I'm just going to undo this real quick okay nice so let's go back so that's basically the two column elements now we have the contact us form as well as the payment form which is the most important one because there's no point in having funnels if your customers cannot sell products on those funnels right so let's go straight into it all right so go ahead and open your directory and go into your components Tab and we're going to first work on the contact form okay so go ahead and uncomment it if you have already pasted that in there and we're going to just do this so copy this component okay copy this name and you're going to open your structure again your directory structure and we're going to say uh contact-form D placeholder TSX and just return a component in here and inside this component we're going to say the following it's pretty much the same thing guys okay we're just going to have different icons for them right so just go ahead and import this editor buttons from the correct file and basically it's a div that has the following class name so height 14 withd 14 background muted rounded LG Flex item Center and justify Center and here we have the contact two icon so if you go and see what it looks like okay we didn't import it so let's go back and import this component now okay and now we should see the page render with no issue and now you see the contact form Okay so so now we can drag this and drop but nothing's going to work of course right so of course I'm following this guide as well so follow this guide if you want to create components right so now that we're finished this let's go ahead and see what's the next step okay which is verify we did that update the container component to listen to your new event so I'm going to go into container and I'm going to basically say contact form so case contact form we're going to dispatch a new type called add element sorry the same type called add element and we're going to say the payload is going to have this container ID and the element details is going to be the content with ID V4 and the name is going to be contact form okay and styles is going to be just an empty object and type is going to be contact form okay so make sure you do this too next we are supposed to build a component so go to your directory structure create a new uh file here call it cont contact-form dtsx and I'm going to actually say component because I know we have you know a bunch of other uh forms and stuff like that so I don't want to have some confusion and in here I'm going to paste the following so this is what we're going to do just please focus on what I'm doing there's a lot of stuff in here I'm going to break it down though okay don't worry about it so first things first let's just look at this forget about the import statements let's just look at our component okay you know this you've seen this before right this is the same thing so go ahead pause um you or copy paste it okay so now in here we're returning the badge and we're also returning the trash icon so you guys know this too now what is this it's a contact form that we need to create so it's a new contact form that we're going to create so go into your forms okay right here go into forms and you're going to say contact okay so this is different this is not um the contact uh what do you say so this one has email and name hm I'm thinking could we just use this all right guys so unfortunately we cannot use this and I think that's because we wired I mean we can but it's going to take a lot of time for us to wire it up so go in here and create a new form here we're going to call this contact-form ttsx okay and in here we're basically going to return a component and call it contact form like this okay and we need to get the following uh props so we need the title subtitle and the API call so what is this we're basically going to have the ability to pass in a function that we can invoke While submitting the form while saving the contact so we're not going to oh we do have this okay which is contact um I don't think we do have it let me see okay so just go ahead and import this I think this is the same thing name and email that's all we need so we're good to go and import Z from Zod okay and inside this we're going going to basically destructure these values okay and inside this we're going to say const form equal use form import that from react hook forms and you guys know this so I'm just going to paste this here paste this here too and say Zod resolver nice and we're just saying use form in for type of this schema mode onchange putting a resolver here and default values or name is empty and email is also empty and now the is loading state is going to be from form. form state.is loading and the component is actually relatively very simple compared to the other contact form so I'm going to return this specific component in here and I'm also going to go ahead and import these components so import card import header title and the description okay so now you know what the first part is now what is the content that's it we only have this content in here so the content is going to have a form inside and this form is going to have you know a native form with flex Flex column and GAP four okay and if we're going to have form. handlesubmit and we're going to actually pass in the API call this time so when we submit this form we are not going to have an onsubmit and create the contact instead we're going to have the ability to pass in any type of API call in here and I'm going to also import form fields and all these fields as well so now I have an name field and email field okay and you guys know what this is right you've built probably how many forms now look at that how many forms you've built okay nice and the button is this right here guys I really suggest you type if you typed this entire project by hand for sure you're going to understand patterns and once you understand patterns you're going to be able to build anything on your own so type it on your own I really really recommend you do that because when you type redundant code it just gets stuck in in graved into your mind you will never forget it I promise you okay give that a shot all right so and we have this button here which is the submitting and we're just going to show loading or get a free quote okay so what is this form basically on the website we want to have the ability to have contact forms so that we can get leads from our websites right that's the goal we want to have leads from the websites and here's another challenge for you and this might require you to actually make a change in the schema okay but if you want to do this challenge um good go for it basically we want to have the ability to create tags for each lead that comes from the form okay so you want to give the sub account the ability to create tags okay we already created tags so that's why I'm saying this but these tags are a little different what these tags are is you should be able to attach this tag to the contact okay that way for each form here okay you can pass in along with the API call you can basically pass in a tag and you can save that tag to each lead this way you know which specific form the lead came from okay cuz now the leads are just coming in but we don't know where they're coming from right so you can do that to actually create some tags to understand and map where the user is coming from awesome so now we built this form um let's go ahead and close this okay and now I'm going to go back into my contact form and I'm going to import this contact form okay cool awesome and then we also have this contact form schema so I'm going to go into Libs types and I'm going to go actually we already do have this right contact user form schema this is good too and editor buttons I'm going to import the editor where is where we using editor buttons right here just imported from there okay cool so um let's see what we have here contact this will be contact user form schema now okay just don't worry about all these changes okay we're going to go through it one by one sorry I'm just jumping all over the page but basically um this component is going to first get access to our editor and then we also have router we're going to have an on drag start and the um you know these things right we have this because you're going to do the duplication uh feature but if you're not you can just skip over this and now when we click on this element globally we're going to set the clicked element then we're getting the Styles and then we have this page this is the API call basically okay and then we have an on delete element so when you click on this we want to also delete and then we have an on form submit okay so this on form submit is um what we're going to run when we submit the form okay so let's go up here go to next page and this go to next page guys is part of this onsubmit okay so yeah right here so if there is a next page we're we're going to go to that next page okay that's the whole point of funnels so same thing here we're building the div with style with draggable on drag start and we're setting this to contact form we're also having onclick and the same class name okay and the same badge here and the same trash icon here as well and now where we imported that contact form right we're just going to render that out right here so we're showing the contact form saying contact us want a free quote we can help you and the API call is going to be the on form submit so let's look at that function so this is going to take in values which is of type z. in for type off contact user form schema which is email and name and then if not in live mode just return okay because only in live mode do you want to get these contacts or else while you're editing you're going to end up you know sending form data you want don't want that to happen and then here we're going to do a TR catch which is to upsert the contact so we're going to save the contact by saying everything uh by saying you know by putting all the values and for that specific sub account okay we need to pass this in here that's why we need subac ID from the editor provider okay that's why we had to pass that in here so that's how we're getting access to this so we're going to pass that in there and that way we can save that contact information and then we also need to save the activity log so I'm going to put an activity log in here and say a new contact signed up okay and then we're going to go to the next page if it exists so I'm going to take this put it up here actually and then we're going to go to the next page so let's see what that looks like so the go to the next page is basically saying if we're not in live mode then return okay and then we're saying funnel Pages equal get funnel with this ID okay and it's going to return um this right here okay it's going to return all the funnel Pages as well then we're going to say if there's no funnel Pages or no page details just return what are the page details uh this comes from our editor okay if there's no page details return because we need to get the order from that okay so we're going to say if the length of the funnels is greater than the page details. order plus one so that means we are on the last step of the funnel okay um sorry not the last step that means we have more we have more to go okay if we have more to go I'm going to remove this console lock then we're going to say con next page equal funnel pages. funnel page. find where the page order is equal to page details. order + one and then if there's no next page so for some reason there's no next page then we're going to say return or we're going to say router. replace and we're going to say process.env dopu scheme so https or HTTP and we're going to say funnel page subdomain okay dot the domain itself of our application slash next page path name okay so we're going to go to that next page if it exists that's it that's that's the form in here and now if you go into so let's see what's our next step update the recursive component go into recursive and let's go ahead and remove this from here and let's also import this contact form component like that okay nice and now let's see if we see this component so we see this I'm going to refresh this page okay we see the contact form if I place it in here there we go now we see the contact form and this is what it looks like in production so you could literally get leads from this and if you try to submit right if you put something in here put something in here try to submit gmail.com and try to submit it's not going to submit okay because we are in production and I mean we're not in production and even if you in preview mode okay it actually it actually did submit all right you guys can fix that okay I'm tired all right so let me go back let me click on this all right um okay so basically some logical error um probably what we're doing here is inside here here when we submit we're saying if we are not in live mode and also if we are not in preview mode so you want to do that too okay that's why and yeah that's about it for this so now we can also create the payment form so same process I'm going to go into this index file and I'm going to essentially just uh remove this checkout placeholder and I'm going to copy this and create a checkout placeholder in here so checkout dplace holder. TSX and I'm going to return a component and I'm just going to save this in Here and Now basically this component is let me also go ahead and import the checkout placeholder and let's go into this placeholder component and I'm also going to reimport editor buttons from the right path and yeah so basically this is the same thing it has a Handler and we're passing in payment form this time but we have an image with stripe logo so if you look in here now have the stripe logo saying checkout okay and then after you create this image let's go back so we did this part so what's our next step okay verify the component and now you need to update the container component to listen to your new component so go into container so that this is so helpful right so follow this guide guys and go in here and I see the payment form in here so in our container we're creating another case in here called payment form and we're dispatching an add element event and we're passing these elements okay to element details which is content is nothing an array you can actually just pass in an object too and the ID is V4 name is contact form and type is payment form and then what's the next step build a component so let's go ahead and build that so I'm going to go in here into my components and I'm going to say checkout. DSX okay and we're going to return a component in here and I'm going to say checkout uh checkout yeah this looks good too okay so for the props we're going to get the element so let's go ahead and get the element like this and I'm also going to import this element and this is a client component so scroll up and say use client like this okay and in here first we need access to use editor so I'm going to do that I'm going to import this use editor and then we also need router from next router from next navigation sorry so I'm going to uh import that too and then we need the client secret so if you remember the checkout form we created um you know for our page right it's very similar however uh we're going to do this okay so we're going to say you state here and we're going to get the client uh secret but we also have live prices so this is the difference here okay we have live prices and then we also need a state to keep track of the sub connected ID okay right in here so first thing we're going to do is we're going to basically say when the uh sub account so let's um let me quickly here let me remove this real quick okay so when the sub ID from our useed editor comes in so that's the dependency in here so when that updates we're going to check if that exists if not return and then we're going to fetch some data what are we going to fetch well we're going to get all the sub Account Details because we want to get the sub connected account ID that's what we need so go ahead and import this from queries we've already created it so we're going to say con subac Account Details equal await get sub Account Details okay pass in that ID and then if sub Account Details exist if there's no connected ID return but if there is then we're going to set that and store it in here so that's the first step now what's the next step we need the funnel ID so let's go ahead and say when the funnel ID comes in from our use editor then we're going to say const fetch data so we're going to fetch some data in here and we're going to get the funnel so go ahead and import this so we're going to get the funnel and then we're going to get the live products that's why we need the funnel information so say set live products json.parse funnel data. live product so we're converting this to a string I mean we're parsing it from a string into Json or we're just going to um you know parse this empty array okay and then we're going to go up here okay and we're going to create a use memo and import this and this use memo is actually going to have the options for our payment form this is needed for stripe to work and that Ed memo is going to have an object that has client Secrets stored in excited and the dependency is every time client secret changes we're going to store that in there okay now you may ask what is this client secret or how are we create getting this client secret nice we're going to go ahead and create another use effect so let's go ahead and also import toast okay nice so this use effect when the component renders it's going to fire when we have live prices sub ID and the connected accounts ID so all of these things have to be available so what it's going to do is it's basically going to make sure all of them exist and if they do exist it's going to make um a call here so we're going to fire this function called get client secret client secret then is going to basically first create a body object here by converting all of this into Json okay and then it's going to send this to an API endpoint that API endpoint is called API SL stripe SLC create checkout session and then um we're going to pass that as the fetch endpoint and we're going to pass in method with the headers set to content type and application Json and the body is going to be in here okay and then we have to have cons to response Json and we're going to extract the response and if there's no response we're going to throw an error but if response. error exists also throw another error and if response. Json the client secret exist we're going to go ahead and set our client secret and store it in there that's that's all we're doing and then if an error you know any something else happened we're just going to show uh this right here okay and we also you know bring this all the way up top and we're just saying oops something happened wrong okay we're just showing the error message from dripe as well so let me see um if we have this endpoint all set up so go into API stripe create checkout session okay it looks like we haven't built this out yet and that makes a lot of sense so let's go ahead and build this out so you want to create a file called route. typescript and inside this file you're going to do the following export an async function called you know post and this is going to have request which is of type request okay and in here I'm going to first extract some values that come in from request. Json so I'm going to say I want this sub account ID if you guys remember um we had that from the checkout form right right here you see we passed it in here so we're just extracting that from here so extract the values and these are the types the prices are going to be product ID you know uh this one right here and then the sub ID so go ahead and extract that and then we're going to get the origin header so we're going to say origin equal request. headers doget origin and then if no sub account connect ID exist okay or we don't have the prices prices. length don't exist we're going to say stripe ID or Price ID is missing and we're going to just throw this status 400 okay and after that we're going to say if process. env. platform subscription so none of these percentages exist okay then we're also going to throw an error and I know we already populated this but just to confirm okay we already populated it so I'm going to go ahead and close that nice and after this guys we're going to create a variable here called agency ID connect account ID okay and we're going to get the DB sub account find unique so we're just going to get that sub account okay um find unique where the account is of type sub account ID and we're going to get that specific Agency for that sub account and then we're going to say const subscription prices exist now let me explain please stop for a second and just pay attention so stripe I did a lot I took so much time to research this guys it's it's actually very very complex to uh read stripe documentation but basically subscription prices and onetime prices Can it can exist together but the way they're set up they need to be you know they need to be set up a slight bit differently that means inside the uh checkout session you have to provide information on whether they are payment intent data or they are subscription related data and if they are subscription related data you can only charge application fee percentages and you can only charge application fee amounts for payment intent data and for a subscription so let's say if they had a subscription okay the subscription must have of course one subscription so you cannot have you know a subscription-based payment intent and not have any products in there so that means we have to identify if they're selling any reoccurring products before we do that I know it's a very complex concept and I understand if you cannot wrap your head around it the Discord is open okay I'll help you in there but it's it is a little complex trust me it took me some time to find out and I had to read thousands of lines of code literally so we need to First identify in simple terms we need to know if there are any subscription prices before we move forward so now we're going to say if there's no agency connect account so we cannot find the agency's connected account ID then go ahead and return and I'll go ahead and create a try catch and inside the tri block we're basically going to create um a session okay so inside the tri block go ahead and say the following so don't be afraid I'm going to explain what this stuff is okay so go ahead and import stripe first from lib stripe so this is what it is okay so we're creating a session in here this is what I was talking about it's a session and this is checkout sessions. create so we're using stripe embed so I already showed you guys how to use stripe custom forms now I'm going to show you the stripe embedded page we're not using external pages I I see a lot of people on YouTube use external pages so that's why I wanted to show you how to use an embedded page okay so in here we're going to create a checkout session and first we're going to pass in the line items now what is this you may ask this is all the prices that are onetime payment products okay so that's why we're passing it in here price. product ID you can see it right here so this prices basically comes from here and it looks like this so we're just passing that value in here and this is actually not the product ID it's called price ID but we are storing it in our database as product ID okay so it's basically the price so each price goes in here so these are one-time products and then we're dynamically using two different type subscription data and payment intent data so if there are subscription prices then we're going to use a subscription data intent if not we're going to use the payment intent so that onetime payment type so based on subscription prices exist we're going to say subscription data pass in the metad data and say connected account subscriptions true now if you recollect when we were creating subscriptions for the plura app we had some metadata that we were looking at right this is where that comes from okay and the ation fee percentage you know where to get this from it's from our process. EnV and we're doing this little es6 trick here to convert it to a number and then in here we're checking if there's no subscription products if there's no subscription products then we have to use a payment intent okay and the payment intent we're going to charge an application fee of this times 100 okay and then the mode is subscription prices exist so this is why we need this right you cannot use one of them apparently it works really different I had to actually speak to the stripe team to get more info on this stuff so subscription prices exist then we're going to use subscription or we're going to use payment and then the UI mode here is going to be embedded so you can change this you can change it to whatever you like right and you can see we're going to get some intelligence hosted and embedded so we're going to use embedded hosted means it'll take you to another page and Weir un completion is never because we are embedded form and then here we're going to say stripe account is the stripe connected account because we are making the payment on behalf of these people right in behalf of the sub account that's why we want that and finally when we're done we're going to go ahead and say next response. Json and we're going to return the client secret back to the client and this is very very important do not forget this and do not make any spelling mistakes I think we might have to update this somewhere else too but please copy this from GitHub copy this and paste it it's basic access control that allows um this endpoint point to be called from any page okay because it's public page right it's a public page so we should be able to you know call this from anywhere so that's why you have to provide it so in here now I'm also going to print out an error like this oops what am I doing okay print out an error and we're going to return the following so I'm going to say next response. Json error okay that's causing yeah that's fine error. message okay and then after this I'm also going to have one more thing in here now this is something that nextjs 13 or nextjs 14 is supposed to create by default but this took me like one week to find out because I did not know what was going on but apparently my project was not creating the options by default and options are actually created I think for every API endpoint so the options are basically you know all the headers and things like that so you have to create this uh manually and then I think after that if you remove it it works but just do this here okay say function options say request is of type request allow origin request. header. getet origin and then you're going to say response new response null and this object is the options so status is 200 100 and the headers is going to be Access Control origin allow origin or uh star image means anything and this is the access control allow methods get post delete and options and put and then for the headers we're just going to pass in some stuff in here okay don't worry about it and then that's about it cool so now we have created the session so let's go back to our payment form okay so now we have this API endpoint wired up we can actually get a client secret from that endpoint and that way we can actually create the form and actually show the stripe form on the page so the next thing you want to do now is after this go ahead and create a handle drag start and this is not needed but if you use the challenge if you're going to do the challenge then of of course you're going to need this okay so I'm just going to put that in here and then we also have a handle on click body so this is basically to set this element as the selected element so we're going to say e. stop propagation dispatch change clicked element and pass in the payload and then I'm also going to get the Styles and what I'm going to do is I'm going to put the Styles up here okay props do elements. Styles and then I'm also going to have a go to next page function and you guys know this we did this for the contact form same thing okay okay and we're just going to send them to the next form so you can copy that same function from there too and this thing is not wired up with the submission of this form specifically but uh let me see yeah so it's not actually wired up and you can wire it up if you want to so I'm just going to put it in here okay so after that we're going to have a handle delete as well and the handle delete is here so don't worry about this guys you can technically just remove it okay I'm just going to put it in here in case I want to wire it up with that okay so after this handle delete I'm now going to render the component so my div is going to have the following Styles very similar to the other elements too so the Styles the draggable and clsx here so on drag start if you're doing the challenge so these two for the challenge onclick and the class name is clsx we're going to pass in the same thing we have everywhere okay and then the badge which is the same thing we have everywhere honestly I might as well just put this into a different component I don't know why I did this but sorry about that but you guys get okay so I'm going to pass in the badge in here and then I'm going to go ahead and pass in the delete trash icon so at the bottom just say delete trash icon I'm going to import that okay and I'm just going to hit enter and in here we're going to have the payment form okay so that payment form is going to look like this so basically um also guys you can also copy and paste as I'm doing I'm sorry I know I'm running really fast but we have a lot of things guys I'm going to try my best to do this as quick as possible okay so that's why I'm really sorry about that but pause go copy paste you guys already have it in here right so now let's look at this so first we're going to say div border none transition all and then another div in here that says Flex Flex column and GAP four and this one is options. client secret so if this exist and the connected account for the sub account exist then we're going to return the embedded checkout provider form sorry this is actually from stripe and we're going to import this in just a second this is the form okay this is the provider so here we're going to go ahead and import this which comes from react stripe.js and this get stripe is coming from our stripe client that we created and we're also passing in that sub account ID in there and this is also another component from react stripe.js and our loading form here is from Global loading so basically if everything exists a client ID exists client secret then we'll show the form if not just show loading that's all we're doing there okay and now yeah that's uh pretty much about it okay and let me see what else we got okay so now I'm going to go ahead and try to give this a shot um fingers crossed I hope it works so I'm going to drag the stripe and paste it right here all right I don't think anything what's going on here let me refresh this page real quick okay so something's going on uh let me figure it out guys just give me a second okay so the reason is because in our recursive component we actually don't have a case to support our checkout form so I'm going to go ahead and import like that okay and now we should be able to drag so let's hopefully you know let's hope this works okay the page loads keeps loading so if it keeps loading that usually means something is wrong just give me a second guys I'm going to go ahead and debug all right so I did a bunch of research and you know messing around and basically inside the create checkout session here's what's happening when you're returning here you're not supposed to return like this you're supposed to return some sort of next response with some data okay or some status that way you can throw an error okay but the problem here is we're not doing that we're just returning that's the first thing okay so make sure you just return something there um so I'm just going to return maybe something in here like this and return something in here too and for this one I'm just going to say fees do not exist okay and for this one you're going to say the agency account is not connected now you won't see this message I feel because we are returning a special type of error right yeah we're returning this one so let me do this here I'm actually going to return Json instead of this so fees do not exist I'm going to take this and put that in here like this okay let's go ahead and remove that and I'm going to do the same for this one too agency account is not connected like this nice and I'm going to remove this Okay cool so basically what's happening is in here our agency account is not connected so because it's not connected throwing some sort of error okay so what this means is that we're going to come into this if block and pre previously we were just returning nothing and when you return nothing from an API endpoint especially because we're trying to get Json data because there's no Json data it's going to throw an error and that's why we were seeing that unexpected end of Json error okay so the solution first to fix that is to return some Json data so you can return some Json data here because we need that Json data and that's how our form is actually wired up now the next thing I want to point out is this section is actually not really needed right it was part of the challenge so you can technically remove this but what the section does is it checks to see if the agency account is connected and then if it's connected then we can transfer fees into their account too so for every transaction we're going to send them a piece of the cake as well okay but we don't care about that we just want to take money from each of the transactions made as well for plura okay we don't care about the agency we're not going to send them any money but if you want to take it up as a challenge remember I told you in the start of the video that is a great challenge to do here okay so basically you want to send or transfer money to a connected account and it's actually insanely easy I just don't have time to do it guys I really really don't have time to do this because I have to do the dashboard as well and deployment okay I don't even know if I can finish this video so that's why I can't do this okay but you can take it up as a challenge and I'll put the stripe docs I have all the docs ready okay I'll put some links in the description if there's no links in the description it will be in the Discord or I will be in the Discord or everyone else will be in there to help you okay so that's the first thing here now if you remove this part so let's go ahead and remove this so let's let's just see what happens okay let's go into this funnel click on this and let's render this so now you'll see this agency account is not connected that's the problem here okay so but even if you try to hide this for now I'm going to hide it okay because it's part of the challenge if you hide this let's see what a subscription sorry guys you want to hide only this part and hide this part cuz we don't need this so if you go in here and now if you drag T you're going to see a different type of error it's saying in order to use checkouts you must set an account business name at this dashboard so you want to basically be logged in as the sub account okay the sub account user the basically the account you use to connect all of this stuff right so make sure you log into that stripe account I'm going to do that just give me one second back in here and let's close this delete this component let's see what it says now oh my God awesome it works I'm so happy all right guys great job so far now this works so let's see what it looks like here okay looks really really horrible that's because of some styling problem I think you can go in here and change the width to 100% or 100 okay I don't think this one is set up that way or maybe it is I'm not sure let me see what do we have here okay but I'm I'm happy that we fixed this problem this was the big problem apart from that everything else looks good okay okay so I just went into the checkout page and I just put with full here and with full here as well and that fixed the component okay now I see this other thing here for the entire body tag and it looks a little weird so what I'm going to do is I'm going to go into all right that was actually very simple so I just went into the Container component and I noticed that this is the body tag so if it is the body tag we want to make it scroll right just like this so what I did is I simply said overflow scroll and if the type is equal to body then this is true so if this is true then it's going to use this so that's why now it looks much better so if you shrink it now you see it's also responsive all right awesome now here's a challenge for you I have showed you how to build a recursive component all you have to do is build the layers tab in here and the layers tab is basically a Dom representation in a tree structure you should also be able to click on this and focus on the element being clicked now just to show you what what these now just to show you what the layers tab is supposed to look like I'm going to build out a page real quick by the way I'm coming from the Future Okay so I already built a website so I'm going to show you what the layers tab looks like with a fully built website as you can see here we have a bunch of elements on the page if I click on the layers tab you can see all the recursive components inside it so a recursive component is a container right so two columns is a container and all containers in here are also recursive and those containers will show more recursive components that decide whether to return a static component or another recursive component the answer to this will not be there on GitHub the answer is only available to our private community so why are you waiting go ahead click the link in the description and I will see you in there so now I quickly also want to test to make sure that this page is accessible so if I go in here and click on this web prodigies localhost I see domain now now okay so basically we have to build that functionality so before we move on to building the dashboard Pages I'm just going to quickly finish this section so go into this shrink everything actually go into Source app go into domain and click on page. TSX and in here I'm going to change this to an asnc component and we're going to get access to pams okay and this is going to be an object with pams which is an object again and it's going to have domain so domain like this domain set to string okay and let me confirm domain all right perfect and once you get that in here we're going to first get the domain data so we're going to say const domain data equal to await get domain content and we have to create this query okay so go into your queries file inside Libs queries and I'm just going to paste it right here which is basically going to say it's going to need a subdomain name and we're going to say funnel. find unique where subdomain okay and we're just going to include the funnel pages and we're going to return that data so let's go ahead and import that real quick okay awesome no errors great and then we're going to say if there's no domain data turn not found okay so this does that logic of determining whether to show a page or not okay so now if I go here and click on this okay I see the page but if I access a page that does not exist okay there you go it throws a not found error so now after this guys we want to say con page data equal domain data funnel pages. find okay where the page is where we want to basically find where the page does not have a path name okay so find that page and then if there's no page data go ahead and return not found as well just like this and put a space here and in this one here right before this actually we want to update the funnel page so why are we updating this we want to update the visits we want to increment it by one so I'm just going to say where ID page data dat data visits set it to increment with one okay we're just updating it to get some data basically so let me just copy paste this so I'm going to render the editor provider like this and import this component as well and it's going to need the sub ID which comes from domain data so this looks good and this needs children as well so this is now going to have the funnel editor nav bar okay and we're going to pass in the funnel details okay so I actually created a nav bar here so that we can actually wire up that page with light and dark mode but I'm just going to remove that for now because we're using hard CSS style so it doesn't really matter okay so I'm going to say funnel editor like this and we're going to import the funnel editor and we're going to set the funnel page ID equal to page details so page data. ID okay and then we also need live mode and now this is going to be set to True awesome so now this is basically I mean it's going to render the component all right there we go so now we're here everything works awesome take a look at at that but now you see the drag problem here right I hope you realize what's happening I can drag this component everywhere so we have to turn this off but the reason why I did that is because I wanted to just show you guys that you can do that to duplicate components but all right now the website is live and ready to go and I can scroll on this page see everything it's so so it's literally a full website that is hosted okay so yeah spend some time make it look all pretty and then take a screenshot and show me cuz I'm very curious to see what you got now next thing you want to do is go into path and click on this path name and in here we're going to render the pages for that path name okay so let's go ahead and get access to the props here so I'm going to say params okay and this is going to be an object with pams which is going to give us domain which is a string and finally we're going to get path which is also a string okay and in here we're going to get the domain data so we're going to say const domain data equal await domain content so going to go ahead and import that and change this to to an async component and here we're saying pam. domain. slice 0 to -1 so we're taking the domain data we're basically you know kind of splitting it a from that period okay and then we want to get the page data now so we're going to get page data equal domain data. funnel Pages find where the page name equal to this pam. path which is the page name right and they want to say if there's no page data or there's no domain data go ahead and return not found like this and invoke that and then we're going to return the editor provider again so remove this return the editor provider import this component everything else looks good we just have to return the funnel editor so go in here and say funnel editor like this and we're going to pass in our funnel ID and live mode set to True okay so now we can also access each path so we set that up as well nice cool great job guys super proud of you hey guys just a quick announcement for our free freelance course so if you want access to the that just listen up one of the most important skills as a web developer apart from the web development stuff is knowing how to freelance and how to make money on your own and there's a lot more benefits that you can gain as a freelancer than doing a 9 to-5 job because the problem with only having a job is that you're exchanging your time for small dollars now why do I say small dollars well it's pretty obvious you only have so much time whereas when you freelance you're basically exchanging your expertise and the value you have to offer for a fixed price and one of the best rewards that you get out of freelancing apart from the monetary part is that you can work from anywhere like it really is possible you could sit halfway across the world and deliver the same if not better results for your clients and just through freelancing alone you learn so many things like how to get leads how to run an entire sales call how to show somebody your expertise and have them build trust in you to invest in your services and the best part is you get to work with other people build a team and you're building a brand for yourself so here's what I want to do for you we have opened up limited spots in our private community and I want to give you access to this community for free because I want you to start learning and the fastest way to do it is be a part of a supporting Community that's already making money doing freelancing be around people who are where you want to be so I want you to get access to this knowledge because it's not available anywhere else so I am creating a completely free freelance course to get you guys started and that course will be available for anybody who is a part of that private community and here's the best part if you join before we actually lock this community every course we release in that Community will be completely free for you now here's the criteria if you join the community you have to have a display picture because people want to know you and I'm sure you want to know other people this is not a Discord channel so if you want to just hang around and this is not the place for that this is the place only for success-minded individuals this is only if you want to meet successful people and see some real progress in your career please please be understanding because we are only opening up limited spots in that community so if you try to log in and your request gets denied it's probably because we're either at cap or we're no longer offering this opportunity if you want to start freelancing and also get personally mentored by me and be a part of a community that is absolutely crushing it in the field of freelancing scroll down to the description and you are going to find the link there click on that and join and I will see you there so now we're going to go ahead and build out all our dashboards so open up your trory structure go into agency agency ID and click on page. TSX okay so I'm going to shrink this so you guys can see better so the first thing guys I'm just going to create some variables up here okay so right below this go ahead and say let currency equal US Dollars let sessions total closed sessions total pending sessions let net potential income and closing rate so to be honest with you like see if you're showing this as a project for someone else it really doesn't matter as long as they see data okay I'm going to get some good data but but you can update this to show different type of data and whatever you prefer okay but I'm just going to use these uh metrics right now so after we do this uh we're getting the agency ID from pams we also need one more property in here which is called search pams okay and this one is going to give us code which is going to be a string okay nice so go down here now and we're going to first set the current year so let a con current year equal to new date. get full year okay and then the start date I'm just going to say this here or actually you can change this just give me one second guys and then we're going to say start date equal to new date with the current year and then we're just going to put this number just put this in here okay and we're going to get the time from there divided by a th000 and then finally we also need the end date we're going to say end date is the same thing with the current year put this number in here so pause the screen and type this out okay and then after that we're going to say const agency details equal to await DB do so import DB agency do find uh unique and also since this is an a we're going to use some async stuff in here just make this an async component since we're using A8 and here we're going to say where the ID is pams do pam. the agency ID okay and after this we're going to say if there's no agency details go ahead and return all right awesome and then we also need the sub account guys so I'm going to say const sub right here equal to awaits db. subac account. find many where the agency ID is equal to U this a specific agency ID and then um we're going to do a bunch of stuff here so now we're going to create this sort of uh not like a function just an if statement that's going to set all these values up here okay so just follow through with me I'm going to type this out uh from scratch so it I can also explain it to you all right so if the agency details. connected account ID exist then we're going to say const response equal await stripe we're going to import the stripe here from from lib stripe. accounts. retrieve okay for this specific stripe account so we're going to say agency details do connected account ID okay and so now we have that and then after that here we're going to say const actually we're going to set the currency sorry so currency is equal to response. default currency if this exist. to uppercase and just invoke that like that or we're going to just set our default which is a US Dollars and then we're going to say const checkout sessions okay uh let me copy this so I don't make any spelling errors okay and this is going to be equal to a wait stripe. checkout. sessions. list and we're going to list which is created between these specific dates okay so just put this in here guys so GTE and we're going to say start date okay and then we want to say LTE and this is going to be end date and then finally we want to pass in the limit uh let me think so we have this object here yeah so say limit and this is going to going to be limited to 100 entries okay and finally the second value in here is going to be an object with stripe account set to agency details. connected account ID and now after this go ahead and say sessions equal to checkout sessions. data and then the total closed sessions is equal to checkout sessions. dat. filter okay so what is this variable this is basically all the uh sessions that were actually paid right so they paid something for that we're we're going to say filter so we filter them out oops what did I do in here sorry like that and we're going to filter uh and first we're going to get the session in here and in here we're going to return where the session. status equal to complete okay so only the sessions that are completed and then for each of the each of those we want to do map and we want to return some new data okay so let's go ahead and get the session again and in here we're going to return an object so custom object with everything inside the session but we're going to set created to a new date okay just like this so created is going to be new date with session. created to local string and the amount total so whatever they paid for is going to be the following which is session. amount total if that exists then return that divided by 100 or just return zero nice and then the total pending States is pretty much the same just this will change to open so I'm going to say total pending sessions equal to the checkout sessions. dat. filter. map U for this okay and I also made a quick search in here guys to check for this that's why I have this in here basically I was checking if this is actually for 2023 or 2024 but since we're using current year that's why we have this I'm going to go back to our app just give that a set a second maybe I have to refresh the browser but if not uh we can just continue from here okay so after this we have to also get the net which is the net profit uh total sessions we're just going to say plus here it's just a trick. reduce total sessions we're going to say total plus session amount or zero or we're going to just pass in uh and this is the default value for reduce okay which is zero that's the total values default and then to fixed to zero so we're just rounding it and then what is the potential income so this is the total pending sessions do reduce to a specific number so total plus the session do amount total and we're going to uh return I mean we're going to pend it to this okay so total and then finally we want to have the closing rate so I'm just creating some you guys see I'm just creating some data in here to show right because the charts are so simple you just have to plug in and it works so the closing rate um I'm going to convert this to a number total close sessions. length divided checkout sessions. data. length * 100.2 fixed all right guys so just give me a second I'm going to go ahead and spin up the server now okay now go ahead and remove this here because right now we're returning that ID and we're going to say class name and set this to relative and we're going to set height to full okay and inside this we're going to do the following so we're going to make sure this account has the connected I mean does if it does not have the connected account ID we're just going to show this a screen on the page that kind of blocks it and makes it look blurred okay I'll show you what that looks like and I'm going to explain it of course so let me just go ahead and import these components guys just give me a second all right there you go so it's just a very simple you know card in the center of the screen that says you need to connect your stripe account to C metrics and it provides a link here so if you look at what this looks like it just is just a div Let me refresh this uh this Visual Studio code cuz typescript is not refreshing and I'm just going to say absolute so putting it negative top 10 pixel left 10 pixel right zero bottom zero Z of 30 Flex item Center justify center background blur MD and background color is set to background with 50 okay by 50 so we have a card card header card title description and the link that's it and the link has agency agency id/ Launchpad okay and the class name is padding to with fit uh background of secondary text of white rounded MD Flex item Center and GAP two and we're putting the clipboard icon and the launch pad so if I click on this it's going to take me straight uh to the Launchpad page okay so let me move here there you go it's taking me to the Launchpad page so let's go back to dashboard okay so since they don't have a connected account we're not going to show them anything that's the whole idea right and now we also want all the elements to be set up but we don't want I mean of course there's not going to be any data in here right but I've written the code in such a way that even if data does not exist the components will show but of course it's not going to break our app so first I'm going to put an H1 tag here and then I'm going to use a separator and import the separator and then I'm going to create a div okay so I'm going to say div like this and this div is going to have another div inside of that and it's going to have Flex Gap -4 Flex column Excel from Excel devices Flex row okay and then we're going to have a card inside that component so here is where we're rendering different type of you know elements for our dashboard like the circle component or what do we call that sorry pie chart and things like that basically so here I'm just going to show kind of like the net income all right the net income of the company of the agency so go ahead and create a card component and inside this we want to create the card header and the card header is going to have a card description the card title is at the bottom here and then we're going to have small so you see we're not showing that we're not showing anything because they don't have an account awesome so we're first creating this and after the card header we want to show some card content so the card content I'm just going to import this card content as well is just going to say total revenue generated as reflected in your stripe dashboard so I'm going to hide this for now guys so can actually see all our components okay let me go ahead and refresh this all right now we can see our components we'll come back to this and remove it in just a second and finally after the card content I'm going to use a dollar sign icon and import that from Lucid react and it's just going to show this kind of dollar symbol right here okay nice and then let's move on to the next card now so the next card I'm going to copy and paste very simple okay don't worry I'm going to explain it too so after this card I'm going to say card Flex one relative and it's going to have a card header which has a description and a title so this is the potential income and the potential income is simply the potential income if it exists show the currency so this is a a string little the currency so US Dollars and then we're going to say potential income. to fixed or we're just going toh show 0 here we're passing a small element saying for the year current year so 2024 and then we're going to say this is how uh this is how much you can close okay inside the card content and then finally the uh this one can be another dollar sign too actually don't know why I put this icon here so let me copy this and paste the dollar sign icon in here all right so it's just showing the potential income so how much you can make and you see when we change the size of the screen those elements wrap accordingly okay so it's perfect for mobile and for desktop devices now after this card guys hit enter here and we're going to create another card and this one is basically how many uh sub accounts we have okay so it's card description like this saying active clients all right and right now we only have one sub account right so that's why it's showing one uh right here so you see one sub account and then after this we have another card so this card is a slight bit longer but it's basically the number of sub accounts you own and manage it's with respect to the goal okay so let me go in here and I'm just going to show some data here and I'm going to change this just import this and I'm going to explain so first we're going to have the card okay which is going to have a card header which has the title in description the title is agency goal and then we're going to have a paragraph that says reflects the number of sub accounts you own uh you you want to you want to own and manage and then in here we're going to have a footer which has a div Flex Flex column with full and another div inside that which says Flex justify between item Center and then a span here that says current so what you have right now which is sub account. length and then we're going to have the goal which is agency details. goal okay and then we're going to import the progress component from shaty Nui we're going to set its value to the subs. length divided by agency goal * 100 and then here I'm I'm just going to import the goal icon from Lucid react icons and this is what it looks like so so it just literally shows some sort of progress bar that how far you're going to get and all that kind of stuff all right it's really valuable information for a company correct exactly after this I'm going to create another div and this one is kind of like a section that for another section so this is the top section then we're going to create one section right below that okay so go ahead and after this div all right not inside the card after the div create another div and we're going to set the class name to flex Gap -4 from Excel we're going to say Gap - row and set this to important and then after this we're going to say Flex D column and inside this create a card component so card like this set the class name to p-4 flex -1 and inside the card create a card header and the card header is going to have the card title and the title is going to say transaction history okay and after the title we also actually yeah just go outside the header and we're going to use the area chart okay so say area chart which comes from Tremor react guys if you remember we installed that component right so go ahead and import that and we're going to set the class name to text DSM and stroke D primary this is very important okay if you don't put this the card is going to look absolutely horrifying so so please put that in okay and then after this I'm going to say data equal to and it's going to be equal to the following it's an array with everything okay with everything inside total closed sessions or an empty array and the second one is going to be everything inside total pending sessions or an empty array just like this so we're passing some data and this is okay this needs a couple other props so we're going to say index equal to created and then categories equal to an array and the categories we want so we're only going to use amount total and then we also want the colors and this is going to be an array again with primary inside it and then y AIS is going to be set to 30 and then show animations is going to be set to True okay and let's just give that a second of course we have no data for this account and the reason is because first of all we don't have any Pages running any data for this account right so you're not going to see anything in here that's the reason then I'm going to go uh down here after this card create another card and this card is going to have the following class name from Excel it's going to say width of 400 pixel and then after this width of fullon mobile devices and then create a card header and a card title and the card title is going to say conversions okay conversions and then we're going to create the card content right below and inside this go ahead and create the circle progress guys so the circle progress actually comes from it's a it's a custom component okay and we're going to create that in just a second so first actually yeah let's just remove this here and let's go down to our components go into Global and we're going to say Circle D progress. TSX and return a component and say Circle progress okay nice and then we're going to need some props in here so say value is going to be a number and description description is going to be react. react node and then in here I'm just going to go ahead and destructure these and then finally uh I'm also going to set the value by uh by default equal to zero okay make sure you do that and now very simple I'm just going to return something here so first set the class name to flex Gap -4 items Das Center and then I'm going to go ahead and remove this and return the Progress Circle okay which is going to be an open component okay not a closed tag and then show animation is going to be set to true and then value we're going to pass in the value and then the radius not radio group radius is going to be 70 and the stroke width is going to be 20 and inside this go ahead and pass in the value along with the percentage right after that okay and then here create another div and we're going to have a bull tag and this bull tag is going to say closing rate and after this create a P tag and have a class name called text muted foreground and inside the P tag we're going to say description just like like this that's about it for this component I'm just going to go ahead okay looks like we have to import that or is this because of the stupid error all right guys give me a second Let me refresh all right now we're going to go back into our page. TSX where is that component right in here and we're going to import that Circle progress okay so inside the content go ahead and say Circle progress import this component and for now we can I think we can make it a closed component this is fine and go ahead and pass in the value which is equal to closing rate and the next one is the description so this one is a little big so just follow through with me okay create a react fragment and inside this we're going to say sessions if these exist then we're going to return a div so we're going to say div just like this and inside this div pass in the following class name and this is flex flex-all okay I made an error here so this is flex Das call and then inside this we're going to say abandoned like that and after abandoned right below this div um let me think so maybe inside this yeah inside this create another div and we're going to set its class name to flex g-2 okay and then we're going to use the shopping cart icon from Lucid react and we're going to set uh the class name to be text- row- probably 700 okay this looks good and then inside this uh div go ahead and say sessions. length nice and then after this guys so go down here we're going to say total closed I was going to write toothpaste to toal close sessions if this exists go ahead and return a div and this div is going to have a class name of flex flex-all and inside this we're going to say one carts and we're going to pass in the same shopping cart icon and this actually uh yeah let's create a div and then pass the shopping cart icon inside that and say class name of flex and GAP -2 and this shopping cart icon is going to have the class name text- emerald d700 and then we're also going to pass in the we're going to pass in the variable here we're going to say say total closed sessions. length Okay like this now let's go back in so I see this I think it's coming from Circle progress let's go in here and change this to use client I think that should fix the issue because this is using some sort of create context and that's causing a problem okay all right nice I think this is the context provider this might be the context provider that's why all right now you see we have this closing rate thing in here and if you shrink it I mean expand it it's going to look like this two different rows okay so let's go down to add after this and I think we're done yeah good job guys we're done with the agency dashboard so now let's move to the sub accounts Dashboard so shrink everything real quick go into Source app main sub account subac account ID and then go into page. TSX all right so this is also very very similar to what we did previously so first I'm going to get pams which is an object with sub ID which is a string and the search pams which is going to give us the code okay which is also going to be a string and now here I'm just simply going to go ahead and destructure these two and first I'm going to create the same variables we created in the agency component okay also let's go to sub account I'm going to go to Acme Corp let that load up all right nice we see absolutely nothing here this looks too bad and the reason is because I think the layout let's see if it's returning anything why are we not seeing anything in here okay so we have sub ID and we don't see anything in here and let's make sure this is the dashboard so I don't see anything in here guys I'm trying to think what might be causing this problem so just give me a second okay so I think it's because we're not using the blur page in this layout so I'm just going to say something in here okay I think that's a solution all right there we go okay we just needed the blur page so after this I'm going to get all the sub account details so say sub Account Details equal a weight and if we have to use a weight you guys know this has to be an Asing component and let's import DB and say db. subac account. find unique where the ID is of this type okay nice and then we're going to say we're going to get get the current year so say current year here okay and after we get the current year same thing we're going to get the start date and end date you guys know this right you can copy paste if you'd like so after we get the start date and end date now we need to make sure there is a sub there are sub details and if there's not we're just going to return let me remove this I don't like that too all right nice and now we're going to say please follow through with me okay if sub details. connected account so if this is if this exists then we're going to say cons response equal await equal await stripe and we're going to import the Stripe from Libs do stripe. account accounts. retrieve okay the following stripe account is going to be sub details like this do connected account ID so guys it's pretty much the same you can copy paste it if you'd like to but just make sure to change wherever we say agency to sub account but don't worry I'm going to type it out for you and then we're going to also get the currency so okay Cur okay currency is equal to response. default currency. two uper case and then we need the checkout sessions so checkout sessions is the same thing here checkout sessions equal wait sorry I said I wanted to type this out but I just copy pasted it sorry guys but I'll explain it so checkout sessions getting the stripe. checkout. sessions. list for this specific start and end date so pass in an object and say created GTE start date and LTE end date and the limit is only 100 for this specific sub account this is important okay so put a comma and put that there if you don't put that there you're not going to get relevant data okay you're going to get up you're going to end up getting plura stuff okay so sessions now is equal to checkout sessions sessions like this checkout sessions. data. map and we're going to get something in here so I'm simply going to say um what is this what's going on okay sorry about that so in here we're going to get access to the session and we're going to return a new object and this object is going to have everything inside the session but we're going to set created to something else create is going to created is going to be new dat. session. created. to local string okay two local date string and the amount total is going to be set to session amount total if that exist this one divided by 100 or zero and then let's go ahead and get the total closed sessions so total closed sessions equal to checkout sessions checkout sessions or here let me just copy paste this I don't want to waste your time because you already know it's the same thing right checkout sessions. data filter it by which is only completed and we're going to map over that and return a new object here with everything in session created is going to be new date session. created to local date string and the amount total is going to be this one if this exists then return that or uh return that divided by 100 or we're going to return zero and then let's get the pending sessions now so total pending sessions is equal to checkout sessions. dat. filter. map and we're filtering for where the sessions are open or if the sessions are expired so we're showing more data okay I'm just I'm just getting more data to show okay okay and then map we're just doing everything in this session and we're setting these two variables to you guys know okay the create a date and the amount total and then let's get the net total so the net total is total close sessions. reduce and we're reducing this to Total plus session amount. total or we're just putting zero here and uh this is the default value. two fixed potential income is pretty much the same thing with the total potential income. reduce it's to Total plus session. amount total and then we're going to have the Clos rate which is again the same thing that we did before and it is total closed sessions. length divided checkout sessions. data. length * 100.2 fixed okay now we also need some additional information for sub accounts so we're going to say const funnels equal awaits db. funnel. find many so find everything where sub ID has pam. subaccount ID and we're going to get the funnel Pages then we're going to create a variable here called funnel metrics so funnel performance metrics equal to funnels do map and we're going to map over these okay and we're going to get access to the funnel here and then we're going to say uh we're going to actually return a new object here with everything inside funnel okay but we're going to set the we're going to set a custom property and this custom property is called uh total funnel visits okay which is the funnel. funnel pages. reduce so we're are reducing all of its uh funnel page um you know funnel pages to one value called total which is the page. visits that's it okay so this is not dunnel this is funnel funnel performance metrics and that's it for this guys so let's go in here and now first I'm going to say div and the class name is going to say relative and height Das full and inside this I'm going to I'm going to put the following so I'm going to say subac details. connected account ID if that exist then if that does not exist then I'm going to return a div here okay and you guys know right it's just that that that um blur component right so I'm just going to copy this and I'm going to do this one more time right here so if there's no sub account details. connected account then we're going to show this thing which has that blur background with the card so import all these components so just give me a second guys I'm going to go ahead and import this okay okay now after this go ahead and hit enter and we're going to create another div in here and this div is going to have Flex Flex Das column Gap four padding bottom of six and inside this we're going to create another div and this div is going to have Flex Gap 4 Flex column Excel devices Flex row and then inside this let's go ahead and use the card component and the card component is going to have card header and card header is going to have card description oops let me do it this way actually card description and we're going to pass in income into this and then finally the card title which is the net exist and currency like that net do debt sorry net. two fixed um for two okay and then at two and then we're going to say if not we're going to return zero and then finally we're going to just put some texture for uh for the year 2024 and after this header go ahead and just create the content and we're just going to say a total revenue generated as reflected in your stripe dashboard okay and then finally I'm also going to put the dollar sign just like we did in the other one okay let's give that a second all right there you go I'm going to also so okay so since this actually has the the stripe connected account that's why we're not seeing this U you know this blur component okay just want to give you a heads up so this is what it would look like in production all right and um after this uh we need to create some more stuff so go to this card component and after this card component we're going to create the potential income okay so the potential income is this so we're going to create card here with card header which says potential income for description and the title is going to be potential income if that exists we're going to return currency and the potential income to fixed at two or we're going to return zero and we're going to return a small element here and this small element is going to have for the year 202 for and then card content which is this is how much you can close and you see we have $7,000 in value here how do we have that well if you remember we opened the stripe checkout page so many times right that's why we have this in here so if we go to production let's see if we can actually do that rep prodigies localhost 3000 uh 3000 so you see it's spinning up this page okay so was 5997 so if we come here and refresh this you see that amount was added here so this is 77,000 actually so we spun up that that brow um you know that page so many times right and that's probably because we had it open too so that's why it got added so you see that the value is adding to so that's basically what this potential income means this means people did not pay and they just abandoned the cart okay that's pretty much what it is and now I'm going to say uh now I'm also going to create the pipeline value so just give me one second all right now you want to go into your components right here scroll to the bottom go into this one this components go into Global we're going to create pipeline l- value. TSX and we're just going to go ahead and uh return something in here so just return this component and for this one we need the sub account uh sub ID so sub ID which is a string and go ahead and destructure that from here and in here we're going to do the following so first set this to a client component so use client that's why we're not building this in in the server component right and in here we're going to create a state to hold all of the pipelines so I'm going to say Pipelines equal to UST state which and I'm also going to pass in a Prisma type in here okay just give me one second get pipelines okay we need to create this guys but basically we're creating a state to keep track of all the pipelines and what are these pipelines these are basically what we what we built right if you see here let me see if I can show you these pipelines right so these pipelines are basically what we're trying to show in here this right here so we're trying to show the total pipeline value and which pipeline has the most you know amount of customers and the highest ticket and all that kind of stuff so quickly go into your queries file so scroll here Libs queries and we're going to create that get pipelines um query which is get pipeline equal async sub ID okay it's a function that takes a sub account ID which is a string and then we're going to say response equal A8 db. pipeline. find many where it's this sub account and we're going to include its Lanes along with the tickets okay and return that and if you go back here let's go ahead and import this okay nice and then I'm also going to go ahead and set the selected pipeline idid why because I want to have sort of something like this where I can change the pipeline and check what is the pipeline value okay so let's go into dashboard again okay nice and I'm going to say selected pipeline ID equal U State like this and then I'm also going to say pipeline closed value okay which is I'm also storing that in here so now when uh on default when this component spins up right when it mounts we're going to basically say use effect right here fetch data and we're going to invoke that when the subac account ID updates we're going to say get pipelines and we're going to put the sub account ID in here and then we're going to set the pipelines to this response okay and then we're also going to say set selected pipeline ID to that specific one so whichever we get the first right that's basically what we're passing in here and then after this we also need the total pipeline value right so I actually did not create this I'm going to make this on my own so total pipeline value equal to use memo import that we're going to pass and an empty dependency which and I think we're going to need these two pipelines like this and let's first think about this so it's basically all the pipelines we're going to go across all the pipelines and we need to go into all the lanes and we need to reduce all the lanes okay and we also want to make sure the pipeline value is only for this which one is selected right so I'm going to say if first pipelines do length so pipelines do length so something we have some value here what's happening happening okay that's what's happening and then in here we're going to return something so we're going to say uh pipelines doind okay find and we're going to find first the pipeline where the pipeline. ID is equal to the selected pipeline ID okay and if this is true so if we find that then we're going to say dot Lanes so we're going to get all the lanes do reduce them okay and we're going to actually reduce what is okay this is going to be the lane and then we're going to okay sorry it's the this is reduced guys so this will be total or total Lane something like this total Lanes then we get the lane itself we also get the current index so I'm going to say uh current Lane index okay let's give it some meaningful words and then the array itself okay and in here we're going to say const Lane tickets okay or Lane tickets total like this equal to lane. tickets. reduce again we're going to reduce each of these and we're going to get a function here right so we're going to get the total tickets tickets and and we're going to get the ticket itself so we're doring this right and its second parameter is going to be something in here so oh I forgot to pass in the default value so this default value is going to be zero and this default value is going to be 02 and I'm going to do something like this okay so in here we're going to say um total tickets plus we have to get the ticket. value okay like okay what is this error plus cannot be applied to types number decimal okay so this one one is type decimal I think so maybe just convert it like this let's see so number ticket. value okay or we can also pass in zero in here and I see something else okay because we're not returning anything in here right okay so after you say this reduce I think this looks good okay so after this uh okay so just after this we're going to say if the current Lane index is equal to array. length Okay array. length that'll be the last one so minus one then we want want to set the pipeline a closed value to be the lane tickets total plus uh not plus one sorry the lane tickets total or we'll just say zero in here okay and then let's go ahead and return the total Lanes like this that should fix that issue all right I need to refresh this one more time I really think this is because of our our middleware function but I don't see this happening in production guys so you should be fine okay so if you're seeing this uh this error don't worry about it so I'm going to say bun ey uh let me just give me a second guys I'll restart okay so it looks like oh my God what is this error okay I think I know what's going on so this is only if right we need to also return something by default so I'm going to return the total Lanes oh total Lanes plus the lane tickets Lane tickets total okay all right I think that should be good and what about this what if this is actually okay this one right here guys we're returning this so what if nothing exists we have to return some value right so I'm just going to return zero if everything fails so something happens wrong then we still have some value okay awesome I think we're set up with this I think also a dependency array is right so then go down here and we're going to say pipeline and rate equal to use memo import this like this and we we're going to pass in a dependency array and this is going to have the closed value and this one okay that's why we need this so the closed pipeline closed value and our total pipelines and inside here we're going to return the following so we're going to say pipeline closed value divided by total pipeline value Value Plus pipeline closed value and after this say star 100 okay okay I see something wrong here this is potentially undefined I thought we did make sure all right give me a second guys let me let me see cuz this there's no way this can be undefined so just give me one second oh I know why so here if this is true okay return zero here now this will solve that problem okay nice cool and then let's come down here remove all this stuff and return a card component with a class name relative width - full from Excel width is going to be 350 pixels okay and inside this we're going to say card header I think I imported card header from the wrong place let's see oh okay it worked nice and inside this I'm going to pass in the card description which is the pipeline value and then after this some text here that says you know pipeline progress like this and let's go ahead and import that component guys so let's see where we need to put that pipeline okay so right after this card go ahead and say pipeline uh value component import that and pass in I think we need subaccount ID right so this should be equal to the prams do subcount ID and let's go into this component and let's continue editing this component okay okay so after the small I'm going to return a div here and another div inside here and another div inside here so it's left and right would justify between that's why this is left and this is right and we're going to say closed pipeline closed and then total total pipeline Value Plus the pipeline closed value okay and now I'm going to have a progress component and this progress component uh comes from UI from chatsi and UI okay it's not from Tremor so we're going to scroll down here so after this div go ahead and say progress import that and color is going to be green the value is going to be pipeline rate I see some error here guys just give me a second okay so you see here we returned this object I mean not object return curly brackets so just remove this okay that should fix that okay nice that should fix that error and then um let's scroll down after this and we're going to say card content why is it why do you want my password bro card content okay and class name set to text- smm text- muted D foreground and inside this we're going to create a P tag and we're going to set the class name for this to margin bottom of two and inside this we're going to just paste some text I'm just going to copy something okay it just says the total value of all the tickets in the given pipeline ex uh ex except the last Lane okay and you're your last Lane is considered your closing Lane in every pipeline right that's why we're just considering it like that and now we're going to use select component from Shad C Andi very simple stuff we already did this so I'm going to import this and uh just give me a second okay so I'm using a select component and the select component has the value set to the selected pipeline ID and then we have the on value change so we're going to update this okay so now you can click on this and you can select it okay you can select different pipelines and here we're going to have the trigger set to select value with a placeholder select not a fruit a pipeline okay that's because of Shaden that it gives it by default and then the selected content here is going to have the group with pipelines inside it so if you open this you see pipelines right and then we're going to say for each pipeline render a select item with the value set to its ID and the key set to that ID with the name inside here this is important okay because that's what we're using to show this uh this value by default okay okay all right guys awesome so now we have this pipeline value set so let me extend this awesome shrink this man I can't wait for you to get a job with this project this is one of the best projects ever literally I wish someone made a project like this for me when you know YouTube used to have those you know tutorials very similar to this all right anyway so I'm glad I can do this for you guys so go back here I'm going to go back into page and I'm going to continue okay so after pipeline value go ahead and create a card component again with the class name class uh class name of excel W fit not fill guys sorry fit and inside here we're going to do the following we're just going to create the card header and since this is a little long I'll type it out for you okay card header and this card header is going to have the card description and the card description is going to say conversions and after the conversions we're going to have the circle progress now this is another custom component so go in here okay actually I'm going to type in circle progress like like this I'm going to copy this go into my components down here and say Circle Das progress and I'm just going to say TSX Circle progress already exist oh it does oh yeah it does you're right sorry guys go ahead and import Circle progress and uh let's just go ahead and pass in the props for it okay so the value ah okay yes we did create that sorry about that is going to be the closing uh rate and then the description is going to be a component okay so put a react fragment like this in and inside this we're going to say if sessions exist okay so if the sessions exist we're going to show total carts opened and show this shopping cart icon and with you know the sessions. length so all the sessions okay and then we're going to have the total Clos sessions which is if total close sessions exist return one carts which means the carts you won we're going to send another uh shopping cart here and we're going to show the total close session so see 13 times it was opened but zero was actually one okay none none of them actually went through so you see this really useful data now go to this div here after this card and hit enter we're going to create another div with a class name Flex Gap D4 like this and then we want to say flex-all Excel we're going to say Flex D row oops row like that okay and then inside this guys we're going to actually create another card so this card looks like this so card card header card description is going to be funnel performance and the card content here is going to be something called sub account funnel chart okay and I'm going to create this custom component in just a second and we're going to say total page visits across all funnels um you know hover over to get more details and stuff like that so go in here I'm going to copy this go into your components and you want to create sub account funnel chart. TSX return a component from here and just paste what you have in there okay and this is going to give us data and this data is going to be let's let's just say any let's destructure that from here and in here I'm just going to return a div a div like this actually I already had a div there and class name of height Das fit Flex transition all items start okay and let's remove this and we're going to return a dut chart dut chart and guys if you want to learn about Tremor UI just look up Tremor UI like this you already have it saved and they have some decent components I don't think it's the best but it's really good for um you know showing dashboards I think that's the only reason I would use it they do have a lot of components though don't get me wrong see they have trackers um what else switch bunch of stuff so you can learn from there okay that's how I learned and that's how I used it too so now the class name is going to have height of 40 width of 40 and then we're going to pass in the data in here and then we're going to pass in a couple other props so this like this we're going to say categories total funnel visits index is name colors is blue 400 primary blue 600 blue 700 and blue 800 show animation 2 and the Custom Tool tip which we're going to get which is all the way at the bottom okay so go down here all the way to the bottom and we're going to do the following so just follow through with me okay I'm going to explain it as I copy paste so we're going to say const okay and we're going to create custom funnel tool Custom Tool tip equal to a function here which gives us the payload and active and I'm just going to you know put assign types for it and then if it's active or there's no if there's no active and no payload return and then we're going to say cons category payload equal payload at zero and then if this does not exist again we want to return and then we're creating a div here with margin left of 100 pixel like this okay shrink all of this dark of text white text black with fit dark BG muted uh divided by 60 background blur MD BG uh background 6 60 then rounded large important in here then padding two and Shadow 2 XL and then here we're going to say Flex item Center Flex one and SpaceX 2.5 2.5 and then here we're going to create a div with width five height five rounded full and BG which is category payload docolor and then um here we're just going to say rounded and then after that here what is this okay yeah I know what this is this is the uh payload the the name and and also the value okay so basically you know this um whatever data we're passing here that's what we're showing so we're just showing some data okay nothing else crazy so with full and then inside that a div Flex item Center justify between Space X of 8 padding here I'm sorry a paragraph here with the name and a paragraph here with the value and then at the end we're going to say if this. funnel pages. map and we're going to return something for each of the funnel Pages we're going to return a div with the funnel page name and the total visits okay now go back up here okay I see an error here all right guys so this has to be any but an array of any I think all right just give me a second guys ah okay I see what we did so this is incorrect here we don't need this so it's data which is of type any okay I'm just going to remove this and say data which is going to be any all right and then here this should actually fix it okay that fixed that problem so let's go back and quickly import that component where is that um not there in page. TSX right here I'm going to go ahead and import this component now okay let's refresh okay so this can be passed directly to client components so go up into that component and say use client and I'm going to remove this okay nice so it just shows this and if you hover over it it shows the amount of um you know lead generation the landing page um you know how many people are in there and the landing uh page copy how insane is that so the more pages you have more funnels you have it's going to show all the details so this is the second page basically all right guys awesome stuff so we have a couple more so I'm going to go back here and after this card here I'm going to um also create another card okay and this card is going to have padding for Flex one the header of checkout activity and it's going to be an area chart so I'm going to go ahead and import it from uh Tremor react and let's see what that looks like okay it's just going to look like this because it's uh this is the you know some checkout activity right here and let me open this here okay nice and then after this div hit enter create another div with the class name Flex Gap -4 Excel important Flex - row Flex D column okay and inside that we're going to create another card component so we're showing one more element and this is a very this is actually a table to show all transaction action so you can stop here if you don't want to but I want this to look even better so I'm going to create this okay just give me one second all right so I just created a card I created a card with a padding for Flex one height of 450 pixel overflow scroll and relative and then we're going to create a header and this header is going to have a title here and this title is going to have transaction history with badge uh Delta okay and if you don't know what this looks like this is what it looks like okay why did I create this don't ask ask me it just look nice all right so you can put some valuable information in here for example if they made more sales you can do some math and you can put that value in here okay and then we're going to return a table right after the title and the table is going to have the uh table header okay and the table body the table header is going to have one table row because this is one row here and we're going to have the table header table head which is email table Ted status this one the created at and the value okay so these are basically customers that that are coming in and then the table body is going to have total Clos session so all the Clos sessions only we're going to go over all of that and map it and if there's no data just show no data and if so it if it does exist we're going to show a table row so create one row right for each thing is one row so table row and the first cell is going to have session. customer detail. email and or I'm just going to say nothing in here and then this is going to have a badge in here that says paid and then the second the third uh cell is going to be the date so new date session. created. 2 UTC string and then another uh table cell in here with currency set to the U you know so US dollar and then a span with the amount okay and there you go I think we are literally done with every single thing let me just cross check guys I'm going to quickly check our work and ress tags to make sure we didn't miss anything major okay okay so here is one work in progress tag that we need to complete which is to wire up the stripe product so right now we are you know we are using we're hardcoding all of them right we're just creating a card here but we want to actually fetch them from stripe so how do we do that I want you to try to guess how to do that so go ahead take a pause and just sit and think how can I wire this up and see if you can give it a shot if you can't I'm going to show you exactly how to do it so go ahead and say const prices equal to await stripe which comes from lib stripe. prices. list for this specific product ID now which product ID are we speaking about we are speaking about um the uh plura product right so now you see it says there's no such product here so let me see I think we created that inside our const files right guys let me search for it um is it in here or maybe I can search for product uh maybe not like that let me just quickly find that product ID okay okay so since I don't have it in here I'm going to go into stripe so make sure you log into stripe 2 and I'm going to get that product so I might be okay give me one second guys I'm going to log in with the other email okay so go into your you know the the email you used to to sign up plura with stripe and we're going to click on that product okay sorry I'm stuttering and in here you're going to see a product ID so copy that product ID and you want to go in here and we're going to paste this product ID in here and let's go back to Local Host all right great no more problems nice so yeah you can oh I think we saved it in ourv file ah there we did okay so we can use it from here this is actually much better okay so I'm going to do this and in here I'm going to say process. env. this variable and let's go back and refresh and see if it shows any errors okay awesome no errors now here instead of mapping over the pricing cards I'm actually going to map over our prices so I'm going to say prices. map. dat. map so dat. map like this and we're going to get the card here this is going to say nickname okay not uh that and then here we're going to say nickname again and then here we're going to change this also to nickname and let's see this also to nickname the description is actually going to be something else guys uh let me think okay so for the description we have to do pricing cards do find okay find where for C I'm just going to say C here where c. tile equal to card. nickname and if we find something we're going to get the description from it okay nice all right and then here for price I'm actually going to say something else I'm going to remove this and say card do unit amount if that exists then the unit amount divided by 100 okay and then finally we have one more span here right where is that here instead of this I'm going to use the duration the interval so I'm going to say c. recurring do interval and then here for the features I'm actually going to map over pricing cards now so remove this and we're going to say pricing cards. find where the title is this nickname and then we're going to say features we're going to get the features and map over that and we're going to return a check with the feature okay cool and then this hre here is going to change to card. ID because that's the price and in here this is going to say nickname not equal to unlimited and then get started at the bottom now one more thing you're going to notice here is we're only going to see two plans we're not going to see the free plan so we have to create that by you know uh and hardcoded so I'm just going to copy this you guys can build one more and just copy that okay just build one more all right I know you guys can do it it's just the same thing it's a card with the same properties just change the values in here so now it says get started like this so if I extend this you see it shows like that and if you close it it shows like this all right awesome guys so if you click on this by the way we didn't test one functionality if you click on this I'm just going to show you what happens so it's going to take you to that agency with the price ID and it's going to take you to the billing page and since I already already have a plan I don't think it's going to show anything uh or I think okay I think I know why it's not showing anything we have one more thing to complete uh just give me one second so you're going to go into your billing page which is inside agency right here so agency agency ID billing page. TSX and here we need to actually create a uh a subscription helper component okay so go ahead and say subscription helper like this create this component and we're going to pass in the price the prices so we're going to say prices equal prices. dat customer ID is agency subscription. customerid and the plan exist is agency subscription. subscription. active Okay copy this now and you're going to go into your uh components so actually we already have one here so I'm going to say subscription Dash helper. TSX and return a component like this and in here we're going to quick L get those props too like that and I'm going to import price list so price is going to be price list at at data okay let me quit this and refresh because we don't need it anyway and what this is it's basically like a um like a client component that shows a modal on the screen okay don't worry there's nothing in here it's just one like five lines okay so go ahead and first we're going to change this to a client component so go up and say use client and in here here I'm first going to get search pams because we need that from the uh from the Pam right let me see if I can show you if we're on that page there you go you see it says plan equal that price so we need that so let's store that in here by saying plan equals search pam.get plan and then we're going to also do use model I'm going to push this up top and then in here I'm going to create a use effect hook and this use effect Hook is going to fire whenever the plan updates okay so now we want to to basically fire this use effect when the plan updates and we want to open up a model on the screen and now we're going to return that subscription uh wrapper that we created right so I'm going to say subscription where is that subscription form wrapper so go ahead and import that component and uh the plan exist um is going to be plan exist which comes from our props so go ahead and extend uh ex you know just get all those and now we can pass them in here and now let's go back and import this component and give me one second I'm going to spin up my server as well all right and there you go it's already it already upgraded the user but um the reason why I did that is because they're already a customer so you want to make it insanely simple to convert them but if you have a new account let me just show you what it looks like it's a quick Glimpse all right so just focus so if you go here and you click on let's say the $49 plan it takes you there and it shows the form and it quickly updates you but by default it would show the form and ask you to pay okay oh my God I am so proud of you because you have done so much and you have come so far the only thing left now is to deploy this application on versel and this is a very very crucial step because it is not simple to deploy an application like this that has these subdomain paths okay so just you know follow through with me even I might F you know go through some some hurdles but if I do I will get the pro solution and I'll show you guys what to do all right so let's move on to deploying this application now all right now it's time to deploy our application the first thing we need is to switch to a production database and we're going to be using Planet scale to do that so go ahead and log in sign up whatever you got to do and then once you're done come straight back to this video all right so now I am logged into Planet scale so what I'm going to do is I already have a project in here right of course so I'm going to click on that quickly go to settings okay and if you guys already have a project in here you would have to do this as well which is delete it if you don't have a paid plan okay so they allow you to have one free plan so we're going to scroll to the bottom and delete this database now that database is gone now I'm going to be able to create another free hobby project so go in here click on create new database and as you can see for hobby projects it is completely free for you if you are just setting up this account it will ask for your credit card guys um they clearly said um that you know they need your credit card information just to prevent uh abuse of the software I actually had to put my credit card information so I have that locked in and that's how I get a free project okay you'll be fine just go ahead and proceed through so I'm going to click on this hobby project we also have to create the title so I'm going to call this plura production we're going to scroll down and hit create database now it's going to take you to this page you want to scroll here and click on Prisma and then it's going to ask you to create a password go ahead and click on create password copy this password password just in case okay because you'll never see it again and then here it's going to give you the Prisma configuration we don't actually need this but what I'm going to do is I'm going to go into the codebase and I'm going to go into EnV and I'm just going to store this somewhere here okay I'm just going to say database password just store this in here just so that we don't lose that so all you have to do is you're going to see this new URL right here right copy this entire URL like this you want to copy that you want to come back to your EnV file and and you want to search for the production database link which is in here so you see local database and then you see production database right go ahead and paste that new URL in there and you want to put the entire thing in double quotes as well and now you can copy this and you can replace your uh local database with that new link okay so I'm going to remove this and paste that right in there so now what you want to do is open your terminal quit everything and you want to say bun X Prisma generate and it's going to do something nice and then you want to say bun X Prisma DB push and if everything looks good you should not see any errors so let's give that a shot awesome there you go guys it looks like our push has been made we can also come in here and say go to database overview to actually see if anything was done and as you can see in here it went ahead and created ticket funnel add-ons everything we needed so everything worked so great job now we can move to deploying the uh application to versel versel makes it very easy to deploy apps um directly in order to make it very easy we need to actually go and log in to GitHub so you want to go into repositories create a new repo right here and we're just going to call this plura production and go in here and just go ahead and create the repo so what you want to do is that you want to use this which is push an existing repository from the command line so go ahead and copy this and it's saying paste it in here so I'm going to first quit all all of this paste that right in here and then I'm going to copy the next line paste that in here and hit enter and then same thing for the third one as well and now you can just do get add dot get commit and I'm just going to say moving to production and then get push so all your files got committed and now everything's going to be pushed to this GitHub repository so now if you refresh this you will see the new production database so now you want to go to versell go to versell and log in okay so go ahead and create an account if you haven't already and then come back all right so hopefully you logged in successfully and you are right in here make sure you connect your GitHub account okay that's how we're going to easily deploy so the first thing is you can only create one of these type of projects and the reason is because we are going to be using this sort of uh Dynamic URL structure so what I'm going to do here is I'm going to simply delete this so I'm going to come in here click on this go to settings this is harder to see so let me keep it like this yeah scroll down and you want to go ahead and delete this project now the next thing is it's going to take you to this page click on import project so from here or you can do uh from here as well so we're going to do import project from GitHub and it's going to take us in here and you see our new plura production 5 minutes ago click on import and you can keep the name as plural production we're going to keep the root directory like this and then in here we're going to change a couple things all right please follow through with me don't make any mistakes override this and our build command is going to be Bun Run build we also have to have the install command so I'm going to put the install command and this is going to be bun install or bun I and now you want to go into your project okay and go to your package.json file after this lint command we're going to create a new command called post install and this is going to be set to Prisma generate and put a comma in here and you can save that and we also have to push this so I'm going to say get add get commit okay and we're going to say new script and get push we also have to set the environment variables so I'm I'm going to go in here go Tov I'm going to copy everything from here and I'm just going to click on this key and paste and now I'm going to change a couple of things so just pay close attention Okay so the scheme here is going to be https our next public domain and the public URL we're going to get to this in just a second because I may want to change the url name so we'll keep that on hold and now you can scroll to the bottom here and you can hit deploy this might actually show some errors we don't know we'll see how it goes I see an error in here so let's see what this error is so it says fail to compile type error Carousel react has no exported member what we're going to do is we're going to copy this we're going to go in here paste this and we're going to see what's what's happening where is this being used so Carousel TSX are we even using this let me see I don't think we are so what I'm going to do is since we're not using this Carousel anywhere we can just simply delete it right and uh we have to unfortunately push one more time so you got to do get add get commit give some meaning to your to your commits and let's just go ahead and push that I'm glad this actually failed because I can show you how you how we can kind of spin that up one more time go into inspect deployment so we can actually see what's going on in here so now we just have to redo this so I'm going to click on this one and it's saying it's going to redeploy with the same source code why is it doing that so I am not sure why it is not triggering a new deployment so here's what I'm going to do I'm actually going to check out into a new brand I'm going to say good uh checkout DB and I'm just going to say removing component okay oh that's not a valid name sorry guys we have to put this Dash in here now it's going to take me to this new branch in here so what I'm going to do is I'm just going to go into this page. TSX in here and I'm just going to make some change get the user details like this and then I'm just going to Simply say get add get commit changes okay and when you do this it's going to give you a line of code copy this because you have to set up the upstream and go ahead and and paste that and it's going to do it for you I'm going to refresh this and inside our pull requests we now see the new removing component pull request I'm going to go in compare and Pull and I'm going to create a new pull request and it also shows our change there and now it's going to do the the the versel stuff for us okay so you see here it's saying pending so this uh versel is now trying to deploy so until that verifies you cannot merge so let's give that a second all right there we go so we are verified now and all I have to do is merge the pull request and confirm it and now that should make a change so anytime you have to make a change guys create a branch and then create a change okay create the change and push it it's much easier to actually bug track and all that kind of stuff so uh let this go ahead and spin up I think now if you go back in here and if you uh refresh you're going to see building okay so now that this is done it looks like we did not have any errors um it says deployment completed so what I'm going to do is I'm going to go back in here click on this project and we're going to go into settings and go into domains okay so first thing is I'm going to change the name of this project I don't like this Dash here so let's change that to plural production and let's just give that a second okay and what we're going to do do is we're going to spin up a new domain and we're going to use this structure right here star Dot and then we're going to say the rest of this so let me copy this here let me go back click on domains and now we have this so let me edit this we're going to change this to plura production uh vers cell app and set it to you know no redirect and save that click on your team all right not on the project click on the team go into settings and you're going to see this general setting in here so this is the team URL so to have a URL structure like this you have to have the team name okay so in here what I'm going to do is I'm just going to change this team uh um you know URL right here and I'm going to say plura production like this I'm going to copy this and hit save here okay and our team URL has been updated and now let's go back to plural production let's click on settings domains and now we have plural production in here if I do this and put a star dot. verel doapp there you go now I can actually add this new domain in here so just as a side note keep this in mind if you are ever building applications like this you can only have one URL per team okay so you would have to basically create a new new team in order to have this new link all right this actually took me some time to this took me some time to research but anyway I think we're good to go yeah let me just go ahead and open the website now all right so I really want you to think like a developer so here's a challenge okay if I try to access the website if I try to go in here and hit enter I am seeing page not found try to guess why is this happening why am I not able to see this page what does this 404 4 actually mean or why is this page returning a 404 see to think like a developer I don't care if you know what I need you to know the why if you know the why behind everything you are a real developer go ahead and pause for a second and just give it a shot try to think why am I seeing 404 why did we throw a 404 in here when something was not found go ahead and try to guess hopefully you got it right and if you didn't no problem so when you try to access something let's let's just quickly research so we can learn how to learn right so what is 404 so let's open this I don't like Wikipedia I'm actually going to just go through okay W3 schools Mozilla is much better so the HTTP 404 response status code right status code indicates that the server cannot find the requested resource links to that lead to 404 page and are often broken or dead or something so basically if we're trying to access this there is no page being returned but clearly we are returning a page right we saw in our local environment we were returning a page the real answer is in here in ourv file we do not update the endpoint URL so when we were trying to access that there is no page there so all you have to do right now is you're going to go into this project so go back into the project click on settings click on environment variables and you're going to scroll down here you see the next public URL L right here this is what you need to change so go ahead and hit edit and you're going to change this to the following put this and make sure you put the trailing slash and go ahead and save this let me copy this to save this and then you also have the domain so we're going to edit this and now right below this I'm going to paste this remove this stuff in here till the app okay go back on top and I'm going to paste that just like that in there and now since we changed the EnV I think we might have to redeploy okay so here's what you do click here go into the the project itself and we're going to scroll up here you see deployment click on that and then this is the deployment that's in production so click on this and hit redeploy it's going to tell you it's going to use the same thing but the newest configuration setting and we're just going to go ahead and redeploy this okay so now everything worked it said deployed so moment of truth I still see this in here but I think this is just cached stuff or it probably tried to access the this domain and it didn't find anything right so that's probably why if we click on this there we go please keep in mind everything is going to be erased okay because we're using a production database so what I'm going to do here is I'm going to click this and the reason why I want to test is I want to make sure we're not getting any cores error when we try to access a public page okay so go in here and I'm just going to you know log in with one of my accounts click login it's going to ask me to do the same thing so I'm just going to go ahead and select some information in here okay just give me a second okay so I just went ahead and uploaded all this stuff I'm going to also make it a wh labeled agency and now I can save the Agency information there we go guys it takes us into our stripe dashboard and now it tells us you need to connect stripe to view metrics how insane is this I'm just going to go ahead and quickly just you know play around with our software and and I'm going to try to build a new website and I want to show you guys so you know we can hopefully get to experience what we built all right I'll see you in a second all right guys so if you remember in the beginning of this video somewhere in between I mentioned about stripe in production okay so here's a challenge for you and I want this is actually the only real challenge which is how to get stripe to work in production and now I'll guide you but I want you to try and if you cannot get the answer all the answers are in the community only it's only available for people who signed up to the community not the Discord inside the community Community okay so this is all you have to do so in here you see we have uh this is by the way the account where I which I use to set up plural okay not the sub accounts so inside that stripe accounts you want to look for web Hooks and in here you're going to see these two things test and local or add an endpoints if you go to test and local it's going to take you in here or at an endpoint it's going to take you in here how stripe Works in production for connected accounts is different in production than in local environment I was completely surprised myself when I came across this because in the local endpoints we only have one just one web hook but in deployment we have two one for events on your account and one for events on uh you know on the connected account so here's a challenge all you would have to do is put your endpoint URL so which is the plura stuff right put that endpoint URL with the web hook so in Local Host we were using the you know the Local Host URL same thing you have to do in here you have to put this endpoint right in here where we have the web hook let me see if I can show you right in here API stripe web hook this URL you have to put in here but for the production one and then just give it a description so this will be for the accounts okay so for plura as the application not as the agency owner and now for the connected account you would actually have to create a new web hook uh that will handle all requests for that if you can remember in here what we did is we used metadata and depending on that information we decided to you know create a subscription for us or for the sub account so as you can see in here we have the subscription. metadata right this metadata is what has all that information and we want to make sure there's no metadata and only then are we creating subscriptions for the a for our uh for plura as the application so what you would have to do is you would simply create another web hook and this web hook would look for all subscriptions that have the metadata and if they have the metadata you would perform the same actions for them but you will pass in their uh you can see in here it wants their stripe account ID you would have to pass in that information and if you don't know how to pass in that information everything is already in here it's just a puzzle you have to put it together I'll show you where exactly what I'm talking about in here you're going to see that we made calls with the stripe the connected account same thing you just have to make the call with this connected account that's pretty much it one more error we need to address is when you try to access the stripe onboarding process for connecting an account right like this it's going to show this error it's actually very simple the problem is because in our plura app app the one that we used to create a stripe account you need to actually update those endpoints so you want to go into the search bar and look for connect settings and you're going to scroll down here and now you're going to see Local Host right so go back to your application and you want to copy this new domain right here okay plura production. verel doapp so go back in here we just need to use the agency and sub account so I'm going to just delete this add a new one I'm going to paste this and I'm just going to go ahead and remove everything and just keep the agency and then you want to add another one and call this slash sub account and now I'm just going to refresh to make sure all of that is saved okay awesome that is saved and now if I go back into my application I'm going to refresh this and just click on the stripe onboarding and now it should onboard your user uh and you should not see any errors instead of hitting connect I'm going to hit skip this form now it's immediately going to take me back to my application and the redirect URL should work as expected and there we go so now if I go back to dashboard my connected account should be wired up and now this agency is set right awesome okay I am ready to Showcase my website so as you can see I already connected this account this is a sub account called Biometrics they are already signed up with their stripe onboarding process so let's go into funnels I just want to show you what I built out in here so I have a funnel with the welcome page details and the payment page and also I have connected their stripe account in here and as you can see they are connected with plura and I've created two products with the following prices okay and inside our funnels page if I go into settings I've also set both these products to live okay and if I go into this uh first page now the welcome page this is the moment of truth let's take a look at what I built and there you go what an amazing Landing animation and it takes you to this beautiful page that's a fully functional website like you can literally click this button and go to the next page and check that out now it asks for uh your a quote like hey would you want to quote if if so just drop your information and I'm just going to put some you know some information in here I'm just going to say paren Joseph I'm just going to put some fake em mail@gmail.com and if I go ahead and hit get free quote it not only submits the data there you go it also sends me to the next page which is a payment form this company called purple sky is ready to accept payments on their funnel how amazing is this guys I have never found anyone on YouTube or anyone on the internet that shows these kind of projects that give you an insight into something that can actually bring value for other companies like see all you have to do is take this make a couple upgrades of course you would have to you know make it a little more cleaner and you can start accepting payments you can start making money this is a SAS application that currently exists in the market making billions of dollars per year you can create such an application and compete with them it is possible and I believe in you because I have given you all my knowledge and there is still so much more for me to give away to you so if you want to become the best developer on Earth here's all you have to do go ahead and hit that subscribe button and turn on your notifications I promise you every video I create will be something that you will never find and it's always going to impress you all right prodigies great job on getting one step closer to your goal of becoming the world's best developer okay I will see you in the community and peace out