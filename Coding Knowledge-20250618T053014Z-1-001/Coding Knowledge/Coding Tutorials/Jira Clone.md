
Title: Build a Jira Clone With Nextjs, React, Tailwind, Hono.js | Part 1/2 (2024)

() hey there my name is Antonio and in this course I'm going to show you how to build a fully functional Joc clone using modern web Technologies this project is great for developers who want to improve their skills in building complex web applications and learn about project management tools we'll be using nextjs react Tailwind hono JS and aight to create our Jura clone throughout the course you learn how to implement various features that you'd expect from a professional project management platform we'll build a my tasks page where you can view your tasks in different formats we'll Implement a table view for a quick overview and a comound board for easy drag and drop task management and finally a calendar view for better deadline tracking we'll create individual task Pages where you can view and edit task details you'll learn how to implement features like editing task descriptions and leading tasks with confirmation models on the task list We'll add filtering capabilities allowing users to quickly find tasks based on different criteria like the person assigned to that task we'll also Implement a editing system where you can change assignes move tasks between projects and update their status for user management we'll create a members page where you can view all members in a workpace you learn how to implement role-based Access Control allowing you to set members as guests promote them to admins or remove them from the workspace we'll build project pages with their own set of analytics and settings you'll learn how to create edit and manage projects within a workspace creating new tasks will be a key feature we'll Implement a task creation form where you can set all necessary details like name due date asse status and Associated project to personalize The Experience We'll add workspace settings where users can rename their workspace and upload a custom image we'll also create a workspace switcher component to easily navigate between different workspaces we'll Implement an invite system with sharable links making it easy to bring new members on board you'll see how new members are integrated into the workspace and can start creating and managing tasks right away by the end of this course you'll have built a functional jira clone that you can use for your own projects or add to your portfolio you have gained valuable experience in creating complex interactive web applications and now without further Ado let's build the project this is a quick reminder that you can also use my platform Cod withth antonio.com and you can watch this entire course in chapters and you can also Mark your progress you can also become a premium member and you can unlock special courses like canva clone as well as source code to over 20 premium projects and over 170 hours of Premium content () let's go ahead and let's set up our project in order to do that we first have to ensure specific system requirements so let's go ahead and let's head inside of our terminal and I want you to run the command node DV go ahead and read the version it says right here and double check that it is the necessary requirement on the nextjs installation page so at the time of recording this video that is at least node.js 18.18 so my version node 20 will work just fine in case you have a lower version or don't have node installed meaning you got an error here simply click on this link which will open a node.js website and you can download the latest long-term support which would be 20.7 at the time of recording this video there is an alternative runtime you can install if you want to which is something that I'm going to do in this tutorial so I'm going to quickly show you the differences between using the two runtimes as you can see it supports Linux Mac OS and windows so if you choose to use the nodejs runtime you would simply run the commands as you see in the documentation npx create next app but if you're going to use bun version you're going to have to switch it up a bit so first of all let me show you where does the npx come from so if you have node installed you also have npx installed so you can check this as well if you choose to install bun using this command then you can then run bun version as well and if you have bun installed you also have bonex installed so bonex is the same as npx and Bun is the same as node of course I'm speaking in terms of those two different run times great so now that we know the basics of our commands choose the run time you want to use and let's go ahead and set up nextjs but before you run this command I just quickly want to show you something so instead of running npx create next app since I'm using the bun runtime I will be using bunx Create next app and I quickly want to show you the version of create next app that I have this is important because I want to ensure that anyone following this tutorial can have the exact same version and doesn't have to fear that anything's been deprecated especially because there are some breaking changes coming in the upcoming versions of nextjs so let's go ahead and do the following let's run either npx or banex create next app and instead of at latest we're going to use 14.2.1 14 and then let's go ahead and give our project a name I'm going to call it jro clone let's go ahead and select yes for typescript yes for Sint yes for Tailwind yes yes for Source directory yes for the app router no for customizing the default import Alas and let's just wait a second for this to install since I'm using bun you can see that I have bun install here if you wrote npx inside of here you would probably have the message using node and then you would have npm install here so those are basically the differences just a different runtime I prefer bun I personally experienced it to be much faster Master great now that we have that we can go ahead and head inside of our new project jira clone and from here go ahead and open this directory inside of Visual Studio code or any editor that you prefer if you get a message similar to this inside of Visual Studio code you can simply press yes I trust the authors like that and there we go I am now inside of my Joc clone you can see I have the source directory inside of here I have the app folder I have the fonts I have the globals files the icon the layout the page but let's go ahead and immediately go inside of package.json and I want you to see whether you have any differences in the versions so I'm using react 18 react Dom 18 and next 14.2.1 14 and here are my Dev dependencies these don't have to match one 100% but I want to show you this in case you run into some problems or in case you chose to use the next latest version so you can always look at the most important packages which I have and which version they are so you can set them to be exactly like this but if you used bonex command like we did right here bonex create next app at 14.2.1 14 I think you will have all the exact same versions that I do great let's go ahead and let's try running the app so I'm going to go ahead and you can either do mpm run Dev or you can do Bun Run Dev so the cool thing about bun is that you can interchange it so if at any point you want to switch back to npm you can do that right so I can shut this down and I can do npm run and it's working just fine so run either one of those two commands and head to Local Host 3000 I'm going to copy the URL I'm going to go inside of my browser here uh in case you're wondering I'm using the arc browser and there we go so this is my nextjs homepage here uh my version is dark because I'm on dark mode at the moment yours might be bright great so that is the initial setup that I want us to have great great job what we are going to set up next is () shaten UI and we're going to use it to build our own component Library if you want to you can visit the documentation yourself and follow along or you can just watch the commands I run and run them yourself so I'm going to go ahead and follow the documentation for nextjs and first things first we have to run npx shat CN in it here's the cool thing about the documentation page if you click on the copy button you can choose which package manager you are using so npm yarn pnpm or in my case pun but before we run this command I want to show you exactly which version of shat ceni I'm using so I'm going to go ahead and run bun x-- bun shat cn- Das version there we go 2.1.0 so now I'm going to go ahead and run bunx D- bun Shad CN at 2.1 0 in it or if you're using node it would be npx Shad CN at 2.1.0 in it so I'm going to go ahead and repeat my one more time 2.1 point zero and just in it without any dashes or spaces here let's go ahead and select which style we would like to use so usually in my projects I use the default style but this time we're going to switch it up and use the New York style this is kind of important because regarding of which style you choose you're going to have some different packages installed specifically the icons so make sure you choose New York for the color I'm going to go ahead and select uh neutral as my color I'm going to select yes for CSS variables here and I'm just going to let it run its course there we go so success project initialization completed you may now add components we're going to explain what that means in a second but let's quickly take a look at everything that has changed inside of our project here so as you can see first of all I have some new packages here so this radx UI react icons comes from the New York style we also have a package class variance Authority CLX Lucid react and we also have Tailwind merge and Tailwind CSS animate so those are all the new packet packages which have been installed running this shaty n version so I would recommend that you go inside of your package Jason and just double check that you have all of those here as well great but besides that I think we have some more things here so we also have a modified Tailwind config dods here and this part is very very important we're going to come back to this uh later but as you can see not much we can read from here just some basic uh things set up here and let's go ahead and finish looking at everything that was added so same thing in global. CSS you can see that a bunch of new stuff was added here uh and finally we have the utils file located inside of source lib utils and inside of here we have a new CN method which we're going to use a lot in our project so CN method will we used to properly merge or conditionally show or hide Tailwind classes without any conflicts great so we have that so let's go ahead and run our app now that we have shat CN installed so Bun Run Dev again at Local Host 3000 here let's go ahead and refresh this page and there we go so the only thing that changed for me is the bright background at the moment moment nothing else has changed great so now uh let's go ahead and let's learn how to add some components inside of here so I'm going to go ahead and go quickly back inside of shatan documentation and I'm going to go ahead and click on components here and I'm going to find the button component because that's going to be the one we're going to be using a lot and inside of here I'm simply going to copy the bun version so now now let's go ahead and if you want to you can shut down your app or you can just open an alternative terminal here and I'm going to paste the command the only thing I'm going to change is I'm not going to use the at latest version I'm going to use the at 2.1.0 because I want you to be able to see exactly which versions I have to ensure that this project has some longevity to it and so that no matter when you come across this project you can follow it exactly as I am right now let's go Ahad and let's click enter and there we go we now have a new component inside of our project where can we find that component well inside of source and the new folder here components UI button. DSX the only differences is that we cannot see that component at all so let's go ahead and let's find this route right here this nextjs with these two buttons so that is located inside of source app for folder page. TSX what you can do here is you can remove everything inside of this return method and this image import and just return a div hello world like this and there we go you can see my Hello World text right here perfect now let's go ahead and let's import the button component from components UI button so this add sign is an alias which will will take us to Source right so we don't have to do the dot do SL do do do dot you know all of those things we are just using an alias here and now let's go ahead and let's render our button component here and let's go ahead and say click me there we go we now have a button component and we can go ahead and give it a variant of destructive for example or ghost like this we can also give it a different size like large or small and the coolest thing about the entire thing is that this component is ours it's not hidden away in node modules we can actually modify every single thing you can imagine from the actual variance which we just played around for example above default I can add I don't know a test here and I can go ahead and give it a background green and the text of white and I can now go back here and change the variant to test and there we go now it's green so that's the cool thing that this is what's going to allow us to create a very specific and very custom uh component library and we can do the same thing with the sizes here and we can do the same thing with the actual code great so you now learned how to add the components and you can see I'm having an error here because I'm using an unknown uh variant here perfect so besides this I also want to test out whether our Tailwind is actually working and just show you something a bit important here so I'm going to write Antonio here you can write your name and I'm going to give this a class name of text red 500 and let's go ahead and use Font semi bold so as you can see my Tailwind is working not only is it working but I also have some cool hover features here and I can even see this box right here so how do I get those effects well very simple it is an extension called Tailwind CSS so you can go ahead and install my apologies not Tailwind CSS just Tailwind there we go Tailwind CSS intellisense this is the one the one with 7 million installs so make sure you have that it's very useful uh when working with Tailwind uh and another thing that I want you to ensure and double check is that inside of your tailing config.sys [Music] here add features for example and inside of here if I were to let's say add uh I don't know component. DSX let's call it test export cons test component and let's return a div hello test component let's go inside of our app folder inside of page DSX and let's import that test component from features test there we go I have the text hello test component and right now I believe if I add a class name here text red 500 it is working right but I think that this um Tailwind config is not set up correctly right so let me just go ahead and go back inside of here as you can see this Tailwind config is only covering uh components inside of pages inside of components and inside of app folder but it is not covering components inside of features folder so why is it that Tailwind seems to be working here honestly I can't exactly tell you why but what I can tell you is that it will stop working at some point obviously this has something to do with Tailwinds you know Justus in time compiler or something like that or maybe even hot reloading uh but this technically should not work so we have to ensure that we do one important step here and that is to copy and paste the line here and add features inside of here so now we are 100% sure that all Tailwind we write will be supported inside of this features folder right now so we don't really have anything important at the moment here but we will have later on so again double check inside of your Tailwind doc config.sys inside of source right that's one way of doing it but just make sure that you have the exact same Tailwind config as I do great and now this should work without any problem I'm even going to go ahead and just remove my uh next cache here and then I'm going to go ahead and do Bun Run Dev again I'm going to refresh this and this should still work just fine I'm going to add one to three here there we go hot reloading is working I can change this to Green I think we are now safe to say that uh our features folder is definitely covered by Tailwind config what we're going to do next is () add all the necessary components from shaten for this project so let's head back inside of our terminal here and we've learned how to add individual components but here's what we can do as well using the command Buon x-- bun Shaden at 2.1.0 add instead of writing out the button you can simply press the enter after you write ad again if you're using npx you just need npx shaten 2.1.0 so if you add add it's going to ask you which ones to well add and you can use the arrow keys to go up and down and space to select or unselect specific components so let's go ahead and add everything we need we're going to have to use Avatar so make sure you select Avatar badge we already have button so no need for that select the calendar card the chart the checkbox go ahead and select the dialogue the drawer the drop- down menu the for the input the label the popover scroll area select separator sheet skeleton soner table tabs and text area and press enter and now you're going to get asked whether you want to overwrite the button that's because some of the components we selected have their own buttons so they are asking whether you want to overwrite it so just select yes here and there we go so you should have a couple of new project uh a couple of new files inside of your project here so let me just go ahead and show you inside of source inside of components there we go you should have all of these new projects here I mean components not projects great right so what I want to do next is I want to show you how we're going to customize this and turn it into our own component Library so let's go inside of the app folder inside of page. TSX we can remove this import and instead we can add a button component here and let's write primary here like this and what I want to do next is I want to go ahead and let's see can I I kind of have a gap here Flex Gap four and I want to add some more here so for example I want to add secondary here and I want to give it a variant of secondary like this then I want to have let's see what's next here basically I want them all here so destructive after destructive I want to add ghost after that I want to add link after link I'm going to add outline and I believe that's it there we go so all of my uh buttons are here so what I'm going to do now is I'm going to modify them and just make them uh a bit more original and perhaps it's better if I just let them all be next to each other like this there we go let's go ahead and let's go inside of the button component and specifically let's go inside of the button variants and what I want to do is I want to change how the primary or the default button looks like so let's go ahead and remove everything inside of this default variant here I'm just going to select everything inside and just clear it out so right now as you can see it's just empty so let's go ahead and let's write background gradient to bottom from Blue 600 to Blue 700 and then let's go ahead and give it text primary foreground like this and then let's add the hover effects so hover from blue 700 and then another hover two blue 700 so now when you hover you can see how it loses that gradient effect right so that's going to be our uh default button here now let's go ahead and let's modify the destructive in a similar manner so we're going to add background gradient to bottom as well from Amber 600 to Amber number 700 like that text can be destructive foreground so basically white and then we're going to add some hover effects so hover from Amber 700 and hover to amember 700 so when you hover there we go it gets flattened out that's the effect we're looking for there we go so we already have some pretty unique uh buttons here great and now what I want to do is I want to modify my secondary button here so I'm going to go ahead and remove everything inside of here and I'm going to add background white text black hover background neutral 100 there we go so my secondary looks like that now great uh I'm going to go ahead and modify the ghost as well here so my ghost will be border transparent Shadow none power background accent power text accent foreground there we go so my ghost looks pretty similar to my secondary but we are going to use them on different occasions let's remove the link we're not going to need Link at all and instead let's add a new one called muted which will be background neutral 200 text neutral 600 cover background neutral 200/80 so I'm going to go inside of my page here and since I removed link I'm going to change this to be muted and write muted here there we go so that's my muted button now great now I'm going to add another button here I mean another variant which we're going to call territory so this will have a background blue 100 text blue 600 border transparent cover background blue 200 and Shadow none I'm now going to go back inside of page I will copy and paste the last one and I'm going to give it the value of territory and let's see if I made uh a misspell here teritary make sure you don't misspell ter there there we go now we have three kind of important buttons which we are going to use uh great before we move forward what I want to do is I want to rename this variant from default to be called primary so I'm going to go ahead and select this and change this to primary and then one important thing I have to do is go inside of my default variance and remove this to primary and then I have to go inside of page here if I want to now for example I can no longer use default right I now have the available availability to use primary and nothing should change because that is the default button so if you don't append the variant it's going to fall back to primary great so now let's go ahead and let's change the sizes a bit so by default I want all of my buttons to be a bit larger so I'm going to give them a height of 10 my small variant will not have a text extra small inside of it instead I'm going to add an extra small variant here with a height of seven rounded MD PX of two and text extra small my large variant will be a bit larger than this having a having a height of 12 and my icons will be a bit smaller having a height and width of eight like that so if you want you can try it out if I go ahead and give this a variant I'm sorry a size of large there we go it's pretty large and if I give it an excess size it's pretty small I'm want to go back inside of my button now and now what I want to do is modify some things in this default class name right here so an important and the most visible thing here is that I'm going to be using a font semi bold instead of font medium for my buttons right and then the next thing I'm going to do is I'm going to modify uh how my disabled States look like so I'm going to go all the way to the bottom here I'm sorry to the end here and remove this default disabled field and I'm going to create my own so on disabled I'm going to add background neutral 100 then I'm going to do another disabled to be from neutral 100 another one two neutral 100 so what this is doing is it's basically flattening out any possible gradients which we might have so we are covering both cases whether our variant are using backgrounds or if they're using gradients by using this type of uh well aliases right let me just find where I was okay so after this now I'm going to add a couple of more things including a text color when we are disabled so again when disabled let's use text neutral 300 let's also add a border around each of our buttons border neutral 200 and let's add a shadow small there we go so those are going to be our buttons as you can see white unique may I say so myself great we now have these buttons and what I want to do next is just modify a few other components we're going to have so let's go inside of components UI and you should have the input component so inside of here uh looks like I have some error here I'm not exactly sure why but uh we're going to come back to this later and let's go ahead and change the input height to be 12 instead of nine so I want my inputs to be a bit larger so if you want you can go to your Source page here and add an input here if you want to so you can observe that as well even though it's not exactly uh well too visible at the moment and let's do the same thing inside of our select component right here so choose the select component here find the select trigger and simply increase from height 9 to height 12 like this great so we have now customized our components to our liking and we're now going to use them to build our authentication screens great great job so before we continue forward and build our authentication screens I () noticed we have some errors in our newly added components from shat CN UI so if I go instead of source components and for example input component I have an error here and by looking at my older project it seems like this only happen happens in the newest version of nextjs which at the time of making this video happens to be uh where is it let me just find it 14.2.1 14 and we know the shaty N version here let's go ahead and try and find which one it is the latest shaten version is 2.1.0 so looks like that combination causes these errors here so this is what I want to do I'm going to go ahead and shut down my app and go ahead and run Bun Run build or npm run build and inside of here you should see all the errors which you have inside of your project and most of them these are just simple lint errors let's go ahead and fix all of them one by one so we can continue with our project knowing that we no longer have any errors inside of our components and in an odd chance you don't have any errors well then that's perfectly fine no need to do anything then let's go ahead inside of calendar. DSX so looks like we have two errors here we are spreading the props but we are not using them anywhere so what I'm going to do is I'm just going to remove both of this here there we go so in inside of my components UI calendar that seems to be resolved now no more errors in this file so that's for the calendar we then have the chart component so let's go inside of chart. DSX looks like we have these three imported but never used so I'm going to remove them here let's scroll a bit down and inside of here it seems like this is defined but never used uh so let's see can I maybe just add a text I can usually the underscore should be fine for no unused Wars but for some reason it's not here so we have to be careful with this we cannot just remove this because it obviously needs to be the second argument here so what I'm going to do is I'm just going to go ahead and disable uh this line right here so you can hover over this quick fix and click disable unused bars for this line you can also pause the screen and spell this out exactly so that resolves the chart issues we didn't have the input and text area in errors so let's go ahead instead of UI instead of input and this can be fixed quite easily as well so I don't basically what this is erroring is that we are extending an empty interface so so the way it suggests fixing this is replacing empty interface with a type Alias like this so expert type input props you can see the difference right we just change this to be a type and instead of extends we simply assign that to be the new element so change it like this and we have to do the same thing inside of the text area right here so I'm going to go ahead and use the same thing here quick fix replace empty interface with a type Alias like this in case you don't have those options you can pause the screen and write it out exactly as I did I think text area was the last error so if I do Bun Run build or npx run or npm run build I think that now there we go so make sure that when you run Bon run build you can build your project without any errors this is important I don't want us to continue if we have any errors at all looks like we are unlucky with our versions of shaten and nextjs but not a big problem we just resolved all of them quite easily may I say so great so what I want you to do now is do RM rf. next so I want you to remove all cache and then just do b runev or npm runev and let me go ahead and refresh my browser here I just want to double check that everything is working fine I'm going to change this to primary one to3 there we go and no errors here perfect great great job let's go ahead and let's create our authentication screens for that we first () have to know the basics of how routing Works inside of nextjs so let's go inside of the source inside of the app folder and inside of here I'm going to create a new folder called sign in and then inside of that I'm going to create a page. TSX so page is a reserved file name inside of nextjs and whenever used inside of the app folder depending on what folder it is in that will become a part of the URL so let's go ahead and learn that a bit make sure that inside of your app folder you have created a sign-in folder and then a page. TSX in inside of that file what's important is that you do default exports so I'm going to call this signin page like this and a div sign in page so this expert default is very important the name of the constant doesn't matter it can be called anything the only thing that matters is that you do a default export here and now that we know that our folder is named signed-in we can visit that URL so I'm going to quickly enable something here called developer mode so that you can see my URL at all times here so I'm going to go to localhost 3000/- in and I don't have my app running so let me just go ahead and do that quickly and also reminder for you in case you don't have your app running there we go so now I after I visit SL signin you can see that I'm on the signin page so what happens if I don't do the default export here what happens if I just do export const without the export default well what will happen is that we have an error because the default expert is not a react component great so let's go ahead and roll this back and let's ensure that we have our signin page visible so that's one thing I want you to learn the other thing I want you to learn is the another reserved file just like Pages called the layout so you already have the default layout here in your project and ours is going to be similar to this but also a little bit different because this is the root layout you are most likely never going to change this file except adding some providers or changing the fonts right but other than that this will mostly stay exactly as it is but the convention it follows is well quite similar right so if I go inside of the uh app folder sign in and if I create layout. DSX inside of this file and I do the exact same thing so I'm going to call this signin layout and a div hello layout so what will happen now interestingly on the same route that I was before/ signin I'm now seeing hello layout so it looks like our layout file has overridden the page file well that's because we are not using the layout file properly so the layout files are used for reusable things so the proper way of using this is to create an interface sign in layout props and Define the children as a required prop here because every sign in layout which is a reserved file will always have children so you don't have to worry about where they come from react uh I mean nextjs will handle that for us so now that we have the children which are safely typed in this interface above instead of rendering hello layout we can render the children inside and there we go now you can see that my page is rendered instead sign in page so what is the purpose of this layout file you might ask well very simple let's go ahead and let's add a class here Flex Flex column and let's pretend to have a nvar here I'm going to go ahead and give this Novar a background red 500 and a height of 10 and I'm going to go ahead and add a paragraph navbar so this is what layouts are used for so if I for example had another route inside of signin page for example let's go ahead and call this test it really doesn't matter for now I'm going to go inside of this test and add another page. DSX file I'm going to call this test page and do a default xort and test page here so how do I access this test page well I go to slash sign in and then SL test that's how you do nested routes so follow along as I do go to/ signin SL test and there we go here's the cool thing the Novar is completely unchanged but the content of the page has changed so that is the purpose of layout files so you can add reusable layouts to your pages right so for example in our out screens I want both my login and register routes to have similar layouts so this layout file is perfect for that later on the dashboard screen I'm going to want to have a side bar and I want all of my routes to have a sidebar as well so I'm again going to use a different layout for that so that is the purpose of that uh great and now let's go ahead and do the following let's remove this test file we no longer need it let's remove the layout from the sign in as well and now I'm going to show you uh one cool thing that you can do let's just go back to SL sign in here so youve learned that every single you know you know um folder which has a page. CSX inside will create a URL well that's not always true because you can create something called a route group and I'll show you why they are powerful so let's go ahead and create an out group we do that by naming the folder inside of our parentheses so I'm going to call this out and what I'm going to do is I'm going to drag and drop sign in inside of the out folder and now I have this prompt to up dat Imports you can always say yes for this and I seem to have no unsaved files if you do you know you can just click here and save them so what happens now exactly well first of all let's check how our routes work I am at Local Host 3000 signin and if I refresh everything works just fine right so you might have expected this to be something like this maybe but no so whenever there is a folder inside of parenthesis that means that it part that part is emitted from the URL so that's the purpose of Route groups and what's cool about this is that I can now go ahead and copy the sign in paste it inside of out and call this sign up for example go inside of signup page. vsx let's change this to be sign up page and change this to be sign up page so now both of my routes here both of my you know Al routes are inside of my my out route group here so then I can go to/ sign up and on the URL side they seem to be you know independent of one another right they seem to behave like separate routes but we know that inside of our code base they are held together in this route group and here's the coolest thing about this while they are emitted from the URL they can have their own layouts so if you add layout DSX inside and follow the same thing we did earlier so this time I'm going to call this out layout out layout if I save this there we go so now both my sign up route and my signin routes have the same overridden text coming from the layout file so let's go ahead and do the thing we did earlier which is proper use of out layout so interface out layout props children react react node and inside of here out layout props with the children inside and render the children inside of the instead of the text and there we go now we have a shared layout file in two different routes and we ensured that no other routes will share that layout because of this route group so both sign in and sign up now share the same layout and again you can do the uh navbar trick to Showcase how that looks what I want you to do next is to find a logo for this project and here's a handy website you can use called logo ipsum so logo ipsum is something like a placeholder logo collection here which you can easily just click and you copy the SVG so what's important is that you don't actually use this for your business you are free to use this uh you know for demos for tutorials but don't use this for your business and just refer to the guidelines of this website but it's a very very handy website for finding quick nice looking logos for your projects so here I am I'm going to find a logo that I like for example this one and now what we have to do is we have to create this SVG file so I just clicked and that copied the SVG and now we have to actually create that so what we don't have is the public folder so let's go ahead and create a public folder in the root of our application so not in the source folder it needs to be outside inside of the public folder let's go ahead and let's add a logo.svg file inside and let's paste everything inside here there we go so I just pasted the entire thing that I copied and now I have logo. SVG here and now let's go ahead and go inside of our source inside of our app Al layout. DSX right here and let's simply go ahead and and render this logo inside of a nextjs image so import image from next image let's add a source to logo. SVG let's give it a height of 50 and a width of 100 for example and out of logo like this I'm now going to close this website so again just click on the logo and you have copied the SVG you can also directly download it by clicking here and there we go we now have our logo right here what I want to do is just change its color because we are going to be using a specific uh blue color throughout our project and I just want to stay true to that color so let's go inside of our logo.svg and if you copy the same logo as I did you can then go ahead and find the fill option right here and just change it to a new color and then when you refresh there we go now it has a blue logo and I like this way better great now let's go ahead and let's add this layout uh and let's actually give it you know some nov bars some buttons and other stuff so I'm going to go ahead and replace this D with a main element and I'm going to give it a class name of background neutral 100 and a minimum height of screen so it takes up the whole uh page and I have removed the image tag but I am going to leave the image import because we're going to use it in a second and now let's go ahead and let's add a div here with the class name m Max AO Max with screen to Excel and padding of four and make sure you put children inside of that div there we go so you can see how now this is centered and what did we achieve with Max with screen to excel well this is what we achieved uh at a certain point you can see how our page stops expanding right so when I am zoomed in you can see it's following the edge of the screen it's following but when it reaches a certain point it will stop following the screen so this means that if your screen is too large we're not going to you know resize all of our elements needlessly instead we're just going to allow you this specific box on the screen for you to work with so that's what that part achieved in case you were wondering great so we have that now and now let's go ahead and let's create our Navar element here so our Navar element will have a class name of flex justify between and items Center inside of the nov bar we're going to have a div and then we're going to have our image let's give this div a flex items Center and gap of two and the image will have a source of logo SVG make sure you put a forward slash in front of the source an out of logo a width of 152 and a height of 56 and there we go you can see that now we have our logo once again but this time it is properly positioned and inside of semantic knv bar element here and one thing that I think we actually don't need is the wrapper around the image so let's go ahead and remove this div and just keep the image directly inside of the knf bar like this now here's another thing we're going to add inside of the nov bar let's add a div and this time we are actually going to knit this so Flex item Center and gap of two and inside of here we're going to have a button and let's go ahead and give this uh my apologies let's give this button a variant of secondary and for now let's just go ahead and write sign up like this and again I've made the same mistake uh I keep planning on having two buttons but we are not going to have two buttons my apologies so you can remove this div and instead of the enough bar just have an image and the button my apologies once again there we go so now we have a Sleek looking knb bar here uh which has a sign up button and a logo right here in the uh opposite corner great and now outside of this Novar component let's go ahead and let's add a div component here and let's go ahead and give this a class name of flex Flex column items Center justify Center padding top of four and on medium devices pading top of 14 there we go so now you can see that our Tex next here is centered like this and it also has quite some spacing here and if I zoom in you can see that it kind of has well you can see that there's a jump in the padding right on a specific break point this is going to be more visible later when we have some actual elements to show before we go ahead and actually develop our sign up and sign in Pages uh I quickly want to go back inside of my source app folder and then inside of my layout. DS x file here and I actually want to remove this local fonts and I want to use the inter font so this is what I'm going to do inside of my app layout I'm going to import inter from next font Google I'm going to remove the local font we are not going to need it so I'm going to remove both of this here like that and instead what I'm going to do is I'm going to add const enter to be enter which we imported above subsets Latin and then I'm going to go ahead and do the following I'm going to import CN from atly utils if you remember when we set up Shad CN we explored this little CN util which will help us help us merge this font class so let's go ahead and do the following inside of our body element I'm going to go ahead and remove the entire thing I'm going to add CN enter class name and then I'm going to add anti alas I'm not sure how to pronounce this I'm sorry uh and let me just confirm that I didn't yes so this is the proper uh command name my apologies and after that minimum height of screen make sure you add this as well there we go so now we have a new font and here's another thing you might see me do a lot I like to order my imports in a specific way so the Imports which are coming from packages will always be at the top for me after that I'm going to go ahead and have my Alias Imports and after that I'm going to have my relative Imports so that's how I like to separate them you don't have to follow that uh it's just a habit that I have great so just make sure that inside of your root layout inside of the app folder you have changed the font name to enter and you have added a minimum height of screen this is a new class which comes default from I think shaten version I'm not exactly sure what it does uh you can explore that for yourself all right now let's go ahead and let's go back inside of our app folder inside of our uh signin page. DSX and here's how I want to do this so I don't want to directly develop this here I actually want to create my signin card like this which I currently don't have and now let's go ahead and let's actually develop the signin card and we're going to do that by creating our features folder if you remember it from uh when we you know we were discussing our Tailwind config and we ensured that our Tailwind config covers the features folder where this is where that now becomes very important so once again go inside of your Tailwind config.sys folder added here now let's go inside of features we can remove the test component and inside of here we can go ahead and we can add uh a new folder called out and very simply inside of this folder we're going to keep everything out related including components and inside of the components we're now going to create our signin card. TSX like that let me just double check inside of my app folder inside of page that I'm not using you know that deleted featured test file looks like I'm not everything seems to be working just fine now let's quickly go back instead of the signin card inside of features out components and whenever I work with components I'm going to do uh named exports so I'm not going to do export default here I only do export defaults for my pages and for my layouts because that is what nextjs requires so let's export cons signin card here and let's just return a div sign in card and now we can go back inside of our out folder sign in page. TSX and we can import this from features out components signin card and then we can go ahead and develop further right here so what I'm going to do is I'm going to go ahead and import everything we need from our card if you remember we added the card from shaten uh in a few chapters before this one when we added all components we are going to need so just double check that you have ADD components UI card inside of your project right here and make sure you add uh these four imports from that package so now let's go ahead and let's actually use that card here and let's go ahead and give it a class name full width full height andd width is going to be fixed to 486 pixels border will be none and Shadow will be none as well then let's go ahead and let's add a card header component and the card title component inside of the card title I'm going to say welcome back and let me just refresh my page and let me go to slash sign in so we can actually see that so make sure you are at slash uh sign in and not/ sign up because we are currently developing our app out signin page. DSX which has the signin card so make sure you're seeing that properly now let's go ahead and give the card title a class name of text to excel like that uh and let's go ahead and give the card header a class name of flex items Center justify Center text Center padding of seven like that below the card header let's go ahead and let's add a div here and a class name PX of 7 and now I want to create my own type of separator so we already have a separator from shat CN but the problem with that separator is that it only comes uh in flat lines right so I'm just going to go ahead and give this a mark margin bottom so you can see the separator right here it only comes in flat lines but I want to create my own dotted separator let's go ahead and learn how to create that funky little component so my own components are going to go inside of the components folder I'm not going to add them inside of the UI folder I'm going to reserve the UI for shatan related components so instead of my components I'm going to create dotted Dash separator DSX and let's go ahead and let's import our CNU let's go ahead and let's prepare the interface for dotted separator props so we're going to have all of them completely optional the class name which is a string color height dot size gap size and Direction which can be either horizontal or vertical then let's export cons dotted separator here let's assign the props and let's destructure all the props which we might need here so class name color which by default will have a specific gray color so make sure you've added this then we're going to have height which by default will be two pixels then we're going to have dot size which will also be 2 pixels then we're going to have gap size which will be six pixels and then we're going to have the direction which by default if not set will be horizontal like that let's go ahead and let's create a Boolean variable here is horizontal so that we don't have to do you know the direction check every time we can just do it once here and then we can do ifs later on let's go ahead and let's return a div here and let's create a class name with a CN if it is horizontal we're going to render full width flex and items Center otherwise we're going to render full height Flex Flex column and items Center and then we're going to add a comma at the end of here and we're going to pass in class name meaning that user can extend this however they want from the outside of the component as well so what's important is this um territory CLA right here the then we're going to go ahead and add another div inside and this will actually be a self-closing div and it's going to be the last element we add here and this one will have a bit more Styles so first of all our class name again will check uh inside of well we don't have to use CN here because we don't have to worry about merging so just is if is horizontal use flex grow otherwise Flex grow zero and now we have to do the rest in Styles because Tailwind will not exactly support Tailwinds Justus in time compiler will not exactly support this kind of dynamic variables which we need so let's go ahead and Define the width the if is horizontal 100% otherwise it's going to be the height variable which we have then for the height again if is horizontal we're going to use the height variable or a 100% for the background image we're going to go ahead and open back there X and then we're going to go ahead and write radial gradient and make sure that whenever you're writing this you uh do it exactly like this right so make sure there are no typos here it's going to be a circle we're going to add a color variable here so this is the kind of things we are not able to do dynamically in Tailwind so that's why we're using the style prop here so color uh without a comma so just a space 25% and then a comma transparent and then a space 25% again great after that let's add a background size which is going to check if is horizontal in that case we're going to open back next and we're going to parse integer dot size plus parse integer gap size and add pixels at the end here and then after that simply add a height otherwise we're going to open back this again and we're going to use the height and then parse in do size plus Barse in gap size in pixels like that after background size we're going to have background repeat option if is horizontal it's going to be repeat X otherwise repeat Y and last one background position Center so you just created your own separator component here and it's also heavily customizable let's try it out I'm now going to go back inside of my features Al components sign in card and I'm going to use the dotted separated here like this and let's go ahead and see whether we did something incorrectly here because looks like our dotted separator at the moment is not appearing so I'm just going to go ahead uh and debug what went wrong all the issues seems to be in my typo so go back inside of the dotted separator and I misspelled Circle this is ccle so Circle and there we go we now have a nice dotted separator which we can use either vertically or horizontally depending on our needs great we can now continue developing our signin card so I'm just going to leave this a px of s here like that below that I'm going to go ahead and add a card content here I'm going to give the card content a class name space y4 like this my apologies I'm going to give it a padding of seven actually and then I'm going to add a form element which will have a class name space y4 like this and now let's go ahead and let's add uh our input component from components UI input let's go ahead and make it required let's give it a type of email let's go ahead and give it a value of email let's go ahead and give it an unchange for now to just be an empty Arrow function and value here can also be empty because we don't have the email constant just yet let's give it a placeholder enter email address and let's give it a disabled prop of false now make sure you have added the input import here you can remove the separator import and one thing that I want you to add uh is use client here once you add use client you will get rid of that error so what happened with that error in nextjs every component in filed which is used inside of the app folder is considered to be a server component so in order to well it would be incorrect to say to convert a component to use client the more correct term is to open a boundary between server and client why am I using that terminology specifically well you can see that adding Ed client here fixes our issue but we can also do this we can go instead of the out folder and we can go instead of a sign in and we can mark this entire thing as use client you can see that that resolves the issue as well right so that's why the terminology convert a server component to a client component should be avoided right it's incorrect the correct version is you've opened a boundary between server and client because once again you can also resolve it by going in layout for example if I go instead of the out layout and Mark this as Ed client let's go ahead and refresh and see looks like uh it doesn't work on the layout all right I I was incorrect my apologies yes um so why does it not work here that's because we are passing our children through the children prop so you can actually combine client and server components if you're going to pass them through children but that is you know a topic we can discuss later I don't want you to confuse you too much what I want you to do now is going set the signin page and mark the page as used client instead this way you don't have the errors anymore in the signin card and you don't have to open the boundary that low you can open the boundary a bit higher because we are going to use some client stuff in this page here as well so let's focus on the signin card for now great we have added this input here let's go ahead and copy and paste this input now and I'm going to go ahead and give this a type of password and this will be enter password let's go ahead and give it the minimum value of eight and the maximum value of 256 and let's give it the uh disabled is already false great so we now have enter email and we have enter password and below that I want to add a button component from component UI button so make sure you have added this as well and our button component will simply say log in let's go ahead and give this a disabled of false let's give it a size of large and a class name of full width like this there we go you can see that we now have uh a very nice looking uh sign in component here let's go ahead and develop it a bit further so what I'm going to do now is I'm going to go outside of the card content here and I'm going to go ahead and add another div with a class name X of s and I'm going to add a dotted separator here again and then I'm going to add a new card content here with a class name of padding S Flex Flex column and GAP y of four and then inside of here I'm going to add another button which will say login with Google and I'm going to give this a variant of secondary size of large a class name of pool width and I'm also going to give it an explicit disabled FS so the reason I'm adding those are because I just want to remember later on to disable them great so we have this let's copy and paste this and let's change this to log in with GitHub for example or you know you you'll see later when we add ight uh it will be quite easy to add any other providers you might want to great so I kind of want to improve this a bit by adding a package so either bun add or mpm install depending on what you use uh react icons so that's the package we are going to need and now let's go ahead and let's add uh two of which we're going to use so that's going to be FC Google from react icons FC and we're going to need uh I think fa GitHub from react icons fa I hope I'm correct with this Imports so my login with Google will have FC Google here with a class name Mr off two and size of five there we go and my login with GitHub will have an fa GitHub with a class name Mr of Two and a size of five as well there we go so a very nice component for us to have here uh for signing in and now what I want to do is I want want to copy this entire component here uh called sign in card and let's call this one sign up card like this let's go ahead inside of the sign up card uh and let's just briefly modified so it's going to be pretty similar let's immediately rename it so we don't forget sign up card so the difference is going to be that the title will say sign up here and we are also going to have a card description which you can import right here from components UI card and before we develop anything further I just want to go inside of my source app out sign up page I want to mark this page as use client and I want to return the sign up card whoops from features out components sign up card and now we can go to localhost 3000 signup here and there we go now it says sign up now let's develop that card directly so we uh left off at the card description so let's go ahead and add you know a description which you would most likely have on your sign up form by signing up you agree to our let's go ahead and add a manual space like this and then then let's add a link component you can import link from next link like I'm going to do here and inside let's go ahead and add a span privacy policy and this can simply go to SL privacy even though we're not going to develop this page this will you know simply render your privacy policy let's go ahead and give this a class name of text blue 700 there we go you agree to our privacy policy or privacy policy and then let's go ahead and add another space here and let's go ahead and copy and paste this link like that we can remove this one at the end and this will go to slash terms and we can go ahead and do the following and and then another space here terms of service there we go so now our uh sign up form has you know by signing up you agree to our privacy policy in terms of service great now besides the inputs for email and password the sign up form will also have a type text here and enter name like that or more personally enter your name like this so when we you know when we sign up we're also going to have enter your name and enter alongside these other Fe features here before we wrap up our sign up cards let's go ahead and let's actually add the functionality to control these values now since these are very simple forms there is actually nothing stopping us from you know just adding a set State here if that's what you want but if you remember in the beginning when we set up shaten and added all the components we need we also installed uh react hook form so just double check that you have this installed inside of your package Json here if you don't go ahead and install it and same is true for Zod you need to have this as well and I think there is also one more uh maybe not all right we're going to go ahead and develop and see whether it's missing or not so let's go inside of our source inside of features let's go inside of signin card and inside of here I'm going to import use form from react hook form and then I'm going to create my form schema here from which I will use Z from Zod so let me just import Z from Zod here like that so Z doob here and I'm going to have my email which will be a z. email uh let's go ahead and z. string. email like this and we're going to have a password which will be a string as well great now inside of here let's add our form to be used form and let's go ahead and add default values here email empt and password empty like this and now we need to add our Zod resolver to connect it with the form schema so let's see whether we have this package or not so from Hook form we do hook form resolvers Zod that's the one we need and inside of here we need our Zod resolver so let's head back inside of package Json we do have hook for resolvers right here just double check you have that as well you should have all of this uh because we have added the form component from shaten which automatically installed everything for us here great and we can now add a resolver here so resolver Zod resolver and simply passing create my apologies form schema here and for the use form you can also add z. infer type of form schema like this there we go now our form is strictly typed right here great so now what I want to do is I want to import some other things from form which we're going to need so let's go ahead and prepare that so these are all the possible things you can import from form so we're going to need the form form control form field form item but we're not going to need form label we're not going to use that so just form form control form field form item and form a message here great now let's go ahead and let's wrap our form here inside of this form component from our uh UI components form and let's just indent the entire thing and inside of here you would simply spread the form like this and then let's go ahead and modify this to be our uh form field and it will use the render and get the field and then inside of here we're going to go ahead and add our input inside of that render so that's how you use react hook form now let's go ahead and add the name which this form field controls which is uh email like this and we also have to pass in the control to be form. control and let's go ahead and wrap this input inside of render instead of a form item component like this and what we're going to do now uh is we're going to remove the value we're going to remove the unchange we're going to remove the required we're just going to leave the placeholder disabled and type actually we don't even have to hold the disabled what we can just do is spread the field so that's the cool thing about react hook form this field uh will have all the controllers right so on blur on change value disabled name so we don't have to pass those manually we just spread the field and it reads the properties from these uh schemas right here that's how it knows what type is it and everything else great so I think that if I now visit my sign uh in component there we go I can already control this and if I uh go ahead and add let's go ahead and let's do this let's also add do trim and minimum here or maybe we don't need to add that minimum if we have email let's see if I click log okay I think I still do so a minimum one and let's add the message required if I submit now okay uh let's see inside of the form item I think I forgot to add uh another thing here which is form control around my input and in outside of the form control I need form message like this and still okay not exactly working as I expected but I think that's because of this field right here so I'm just going to remove it for now and okay so now I know what's going on well we have to modify this form to actually handle our onsubmit so let's do this let's do const onsubmit vales z. infer type of form schema so the same as our Zod resolver above this is a very simple arrow function which is simply going to consol log the values and now let's go ahead and modify the native form element here and override it on submit to be form handle submit and then pass in your onsubmit method here so now I think if you click log in there we go you get back an error which says required and let's see can I now maybe remove this minimum value here and can it simply use the email address there we go now it works I don't even need the trim I think there we go because it is an invalid email perfect and for the password we are going to need to Define some things so it's going to have to have a minimum of eight characters and let's add the message for that as well like that and then we can just copy this entire form field here change this one to the one we just copied to control the password give it a type of password and enter password Here There we go you can see that now we have those controls here uh but here's a tip for you whenever you're developing a signin component don't Define the minimum value of characters well you know make it at least one like this and just make it a re ired so the reason I'm telling you this is let's say you initially allow your users to create passwords with six characters right and then you have accounts in your database which have created their account with six characters and then a year later you modify it to be a minimum of eight characters and then you go to your login screen and you limit your users to a minimum of eight characters what happens with all of those accounts who a year ago created their account with six characters so that's why I want you to create a minimum requirement on the sign up screen where user is registering so there it's fine but when logging in no need for that great so we now modified our signin card to actually use uh the uh react hook form like this and if I go ahead now and open this I'm I'm going to zoom in here and I type test test this is still invalid email and and click now there we go you can now see the values and you can see my email and my password right here great so before we wrap up the chapter let's do this exact thing uh inside of our sign up card so I'm going to go ahead and I'm going to copy this Imports let's go inside of the sign up card let's add all those Imports here great and let's copy the hook form use Zod and theod like this then let's go ahead and let's define the form schema here let's paste it inside of the sign up card and in here you can add a minimum of eight characters so minimum of required like that and then let's go ahead and let's add the constant form and the onsubmit and let's copy it inside of the sign up card here and this will also have a name and let's also add a name inside of the form schema here so I'm going to go ahead and make it at least one character you never know uh how many characters other people's names can have so I don't like to restrict this as well so I will just say required for this like this and let's also ensure that you cannot just enter you know whes space here um for the password I'm not going to care if they enter Whit space or not great we have that now and now let's go ahead and modify this as well so I'm just going to copy my form here and I'm going to wrap my native form around that so now it looks exactly the same uh as my as my sign in card then let's copy the onsubmit here from the signin card and paste it in the sign up card to the native form element and let's go ahead and copy one form field here which is a self-closing tag and let's replace this email here there we go so let's go ahead and write enter your email so this is sign up so enter email address yeah that's fine okay and now I'm just going to copy this you know replace it and replace your name as well so this will control the name field type will be text enter your name like this let me just indent this and I will copy this and I will replace the password input with that as well so this will control the password the type will be the password and this will be enter your password and all of them have four messages here and I think this should now work just fine so if I go inside of my uh sign up method now and if I click login there we go and I should be able to fulfill all of this so Antonio Anton mail.com 1 2 3 4 5 6 7 8 login values right here an email name and password perfect so you've just added react hook form to both of your sign up and sign in cards so you have a more seamless control over your forms here and then you can safely submit them to where we are going to use them uh next uh great so just one more thing I want to do which is inside of the layout in our Al layout right here so inside of the app folder Al group go inside of the layout here and what I want to do now uh is I want to mark this as use client because from here I'm actually going to go ahead and I'm going to render the path name so const path name will be used path name here uh use path name like this and then uh we have to import use path name from next navigation so let me just move these Imports in the order I like them like that and then depending on where we currently are we are going to display either sign up or login so I'm going to go ahead and do this if path name is slash sign in in that case show sign up as the button otherwise show login as the button great and one more thing I want to do is I want to import link from next link let's just not do the wrong import here and we're going to go ahead and add a link inside of the button component and it's not a good practice to add anchor elements inside of button elements so what we can do is we can use the as child prop so the button becomes the anchor element and now let's go ahead and add Dynamic hre here so if path name here is currently SL sign in we are going to redirect the/ sign up otherwise slash sign in like that if you want to save some time you can go ahead and Define const uh is on sign up page or let's go ahead and just call it is sign in let's use be simple so path name here will be SL sign in uh after we Define the path name and then you can replace these two with that is sign in there we go make sure you don't misspell sign up and sign in here and I think that right now if I go ahead and click on login there we go it redirects me to login if I go ahead and click here it redirects me to sign up amazing and one last thing just to wrap it up is I also want to add these two functions right here in the bottom of these cards because that's usually where your users will expect them to appear so let's go ahead inside of my signin card right here let's go all the way to the bottom where we end our card content let's add a div let's go ahead and render a dotted separator here let's go ahead and give this a class name of px7 below that let's add add another card content with a class name of padding seven Flex items Center and justify Center and inside of the card content here we're going to add a paragraph already have an account if you do we're going to add a link which you have to import from next link I'm just going to go ahead and add it here there we go the link will simply go to hr/ sign in uh well we are in the signin card so this will go to SL sign up so uh this will be the opposite message instead this will not be uh already have an account instead this will be don't have an account so don't have an account like this and if you want you can replace this with uh and appus like this in case you're getting errors in your IDE because this apostrophes uh can sometimes you know cause errors there we go so if you don't have an account we're going to redirect you to/ signup and a span Here sign up and let's go ahead and give the span a class name text blue 700 so if I go to login now uh there we go don't have an account uh go to sign up and let's just go ahead and add a little uh space here so I'm just going to add at nbsp and a semicolon at the end and this is uni code whitespace so there we go now we have a white space here and that redirects to sign up so I'm going to copy this two so the div which holds the dotted separator and the card content and I'm going to go inside of the sign up card and I'm just going to go ahead all the way to the bottom after our card content ends and I'm going to paste that here and let's see do I have link I already have link imported here because we use it for privacy policy and terms and let's just reverse the logic so this is going to ask already have an account and it's going to redirect to sign in and this will say sign in so let's go ahead and try it now if you click on sign in there we go don't have an account sign up already have an account sign in and you can also change this up here amazing what we have to do next is set up app right so we can finally create some users great great job now let's go ahead and let's learn () how to create API routes inside of nextjs so you've learned that whenever you create a new folder inside of nextjs app folder and you put a reserved file name page. DSX inside of it that will transform into a URL route so that's exactly how you build API routes the only difference is in the reserved keyword so let's go inside of our app folder and for example let's create a new folder called test and inside instead of a page. DSX let's add a route. DS so a different type of reserved file name the only thing that's important is that you created this inside of the app folder now inside of here let's create a simple get function so export function get make sure it's all in caps like this and simply return a response Json and a simple hello world like this and then you can simply go to Local Host 3000 slash test so I'm going to go ahead and go to slash test and there we go hello world one practice that you might be used to seeing is keeping API routes inside of an API folder so if you want to and what we are going to do is we're going to have an API folder like this and then our API routes are going to be moved inside I'm just going to update the Imports looks like I have an unsaved file here this can happen some times and if you're wondering what that is if this is your first time using nextjs this is basically the next cache so you can see the file route right here it's pointing to this next folder you don't have to worry about this file but I don't like having unsaved files so what I'm going to do is just go inside of that file and save it and then I'm going to close it just like that so I've moved my test folder inste of my API folder if I now refresh here I'm going to get a404 but if I go to localhost 3000 API test there we go so this is how you build API routes inside of nextjs that's fine it's great it's built in uh but I have a few problems with it primarily I don't like that I am losing any type interference what do I mean by that well let's say you want to add uh a parameter inside of your API route which is something that you will most likely have so let's say inside of this API folder I create a users folder right and then I want to create a specific user ID folder so this is how I would do that this is how you create uh parameters inside of URL and then inside of that you would add a route. DS and then you would get this route and from this request and response inside of here you would D structure the user ID so for example inside of here we would have you know request as the first argument which can simply be a type of request and then inside of here we would have an object which holds params and we would have that params and we would manually have to define the user ID and make it a string and then I can go ahead and say user ID is for. user ID like this so inside of my API folder users user ID route. DS so now if I go to/ API users sl12 34 there we go user ID is 1 2 3 4 there are a couple of things I don't like here primarily I can already see how this will get you know too confusing to work with uh because the way routing Works inside of nextjs is using folder or file based routing what I prefer for my back end is code based routing and I have this great example if it's still not clear to you what that means this is from 10stack router we're not going to be using T stack router I just found this random Post in their documentation and I think it's a great example so this is file based routing it's basically what we're doing right instead of routes folder we have an API folder and then we have you know reserved file names inside of that so that's how you create you know API routes inside of nextjs but I prefer this for my back end you know I'd rather just simply Define what I want to uh the file of my route and then specifically Define the path how to access that route for example posts post ID edit this makes more sense to me and kind of easier to work with especially on the back end side so on the front end I'm okay with file based routing but on the back end I highly prefer this way of working so I'm going to close this for now that's the first issue that I have with this the second issue that I have is param interference so as you can see nothing is telling me that user ID will be a part of this route so I know that I'm looking for user ID here because I named this folder user ID but there is so much room for error here for example let's say I forgot to capitalize ID and I search for this now let's see what happens as you can see my user id no longer exists right so that's what I'm trying to Showcase to you um it's not strictly typed and this is a very big issue for me when creating something that's supposed to be you know a scalable uh API route and the reason that's also the reason why instead of using this native API routes from nextjs we are going to override that system using hono and if you're wondering what is hono well hono is a web application framework and the easiest way to explain what it is and what it does is Express right so if you've ever worked with Express you can imagine hono uh as Express I personally prefer hono I think it's it's definitely a new technology it's still to be you know tested by these huge uh companies Express is definitely battle tested and used by millions but hono is new and definitely growing uh it has a great uh uh althor behind it and it's also supported as at least from my understanding from the team from cloud flare so definitely something to look out for and I use hono personally in my production products so I'm pretty confident to teach you about hono so great thing about Hana is that you can use it Standalone in a bunch of different uh frame works so you can use it uh let's go ahead and zoom in a bit so you can see you can use it on cloudware fastly Doo bun AWS or node.js or versel so you can deploy it on all of those things and the coolest thing if you ask me is that you can easily uh include it inside of uh nextjs so I'm going to go ahead and search for verel here and there we go now you can see how we can and create our API routes using hono inside of nextjs so we're going to skip this part because we already have our app running so what we're going to do is we're going to visit our terminal here and I'm just going to do bun ad or in your case if you're using npm npm install not verel but hono and let's see if we need anything else uh I'm not sure if I need hono SL forell I think this comes from hono package so now we're going to create this API rout in the app folder API and then we're going to create this special kind of looking folder so let's see what that is and here's another cool thing about this this whole you know system that we're doing you can have both native routes in nextjs and API routes from hono so you don't have to choose between one or another you can have both of them if for any reason hono doesn't support some very specific thing that you need in nextjs completely fine you can create you can still create normal API routes but let's go ahead and let's do this inside of our API folder we're going to go ahead and create a catch all folder and we're going to Spread spread route inside of it so this is again a special kind of folder similar to uh this which is a constant folder and you know similar to our out which is a route group so it's important that you put double brackets inside and it's important that you spread the constant inside like this and then inside create a route. DS file and now let's go ahead and let's import hono from hono and let's import handle from hono verell and now let's go ahead and create a const app to be new hono basad will be slash API because we are in the slash API folder here and now let's simply do app.get /hello and inside of here let's let's go ahead and let's return this context hello world so pretty much the same thing we did in the beginning and what we have to do now is remember the way routes work in nextjs is by having specific exports of get post put patch so right now that's what we are missing here so what we can do what hono allows us to do is to export con get and we just use this handle wrapper around our app instance right here and that's it the get route is now overwritten and we'll redirect to hono so let's go ahead and check this out now so if I go to my API SL hello there we go hello world and the coolest thing about this is that I can now do code based routing so I can for example do let's say project SL Pro ID like this and I can return c. Json project and let's for now just write project ID like this so now I can go to SL API SL pro123 and there we go now it says project project ID and now let's actually destructure the project ID so destructuring the Pam is a simple as forams or project ID to be c. foram uh my apology is c. request. peram and this is the coolest thing it actually infer the project ID from my URL which I've written here so if I uh you remember that little problem we had let let's first just confirm this works right so I'm just going to pass this project ID here I'm going to refresh and there we go you can see that now it says project ID 1 to3 here and the cool thing is if I make a mistake for example and make this a lowercase uh and let's go ahead and see why isn't it throwing uh an error it should be throwing an error I just think I'm using a different way uh for example I think that I can do let me just find a different way I can do it which I just want to showcase that little problem that we had it can actually be fixed with hono it can be using C request peram like this and inside of here there we go so if I were to make this a capital there we go now we get the error so yeah if you use the first way which we did uh you won't exactly get the error why won't you get the error well because you are specifically looking for this right it doesn't matter that it doesn't exist but if you don't specify which program you're looking for and instead you destructure the project ID you can see that it can only be exactly what's written in the URL so that's what I wanted to Showcase to you and this is how I want to build my API routes so that's why we added hono I think it's absolutely great and it supports nextjs so let's clean this up a bit let's remove the test folder from here let's remove the users from here and let's simply continue to work inside of API route uh route. DS right here so for this chapter I want to stop here and I want you to maybe play around and explore hono a bit for yourself right uh because what we're going to do next is we're going to go ahead and add app right so I want to give you a chance to play around with hono uh go ahead through the documentation page uh learn about the motivation why it was made and learn about uh how this whole amazing you know project ID param interference actually works so you can learn a lot here so I would highly suggest you go ahead and just you know take a peek at the documentation it's very well written written I've learned a lot just by looking at the documentation here and in the next project we're going to go ahead and extend hono uh even further by adding something called RPC so you can read about this feature as well if you're interested in what that is great great job now that we have hono set up let's () add 10stack query or previously known as react query to our project and we're going to use that in combination with hono to get an endtoend type save requests you're going to see what I'm talking about uh just in a moment you already saw you know how great Pam interference work with hono and now imagine that extended all the way to the front end when you actually make that request because usually you know when you write your uh fetch requests let me go ahead you would do something like fetch SL projects and then you would add you know a project IDE something like that but none of this would actually warn you if your project ID is valid or not valid or whether this route even exists right now imagine that level of type safety from your back end to your front end so end to endend type safety that's what we are going to achieve with our setup now so for that we need 10stack react query it is simply the best in business here so this is the current highest version at the moment of me making this tutorial so 5. 59.0 so I'm going to go ahead and I'm going to do bunad at tack react query at 5. 59.0 you can use the latest if you want to I rarely see react query having any breaking changes but you know I'm giving you uh this overview just so you know the exact version I will be having great we now have this and what we have to do now is follow react query docs to install it inside of nextjs and I would highly suggest that you right now open t query uh make sure your framework is chosen as react make sure your version is chosen as uh latest right here or you know version five which right now is the latest version you know we just installed uh version five right so inside of the documentation page here I want you to go into search and I want you to search Advanced server and you should get Advanced server rendering topic right here go ahead and click on that and now you have a file that you have to copy and add in your project let's go ahead and let's copy this file and let's go inside of source inside of components and let's create a query Das provider. DSX and let's paste everything inside we have a couple of Errors we're going to resolve all of that so if you want to you can leave the comments so you understand what's going on here just make sure you don't have the errors here you won't have any errors if you have the package installed you don't have to modify these options the only thing we're going to change is the following we're going to create an interface called query provider props and it's going to have children which are a type of react react node and we are not going to export default instead we're going to do const query provider and we're going to turn this into an arrow function and we're going to assign this props right here there we go like that you don't have to modify anything further and make sure you do export cons yes that is very important so make sure you do export const query provider great and now let's go ahead and let's go inside a inside of layout. DSX and now we're going to add that right here so I'm going to go ahead here and import our query Provider from components query provider and very simply we're going to wrap our children around that so query provider like this there we go we now have our react query ready and what I would like to do is just revisit my Local Host 3000 here just ensure you know that my project is still working I'm going to visit some of the routes we have like sign in there we go everything seems to be working just fine so what I want to build next is I want to go ahead and actually add app right I want to setup app right using their console and I want to create my very first hook which will connect to hono RPC which we talked about uh just a few seconds ago so this is what I want to do next I want to go inside of source here and I want to go inside of features inside of out and inside of here I'm going to create a new folder called server like this and inside of here I'm going to create route. DS and inside of here I'm going to import hono again from hono and I'm very simply going to do const app to be new hono here like that and Export default app and inside of here what we can do is we can go ahead and create a for example slash uh login we can do things like that let's get the context and let's return c. Json success okay just a placeholder for now so we now have a post login here so that's the cool thing we don't have to write all of our API routes inside of here because that would be quite convoluted as well wouldn't it we can separate them inside of our features right here so now inside of our features out we have components and we have the actual API routes uh for our authentication now this specific login routes will also have to accept some Fields right and there's a cool package which can help us in hono to actually have typ safe values as well that's right not just the params but also values and this is again going to be end to end from front end to back end you will have full type safety knowing that what you're passing from the front end can 100% be accepted on your back end so let's go inside of our terminal here and let's do BN add oops bunad atono z-v validator and I just remembered that I didn't exactly show you my versions of this but I guess you can see the version every time I install something but let me just quickly revisit my package Json for you uh two important packages which I've added was hono Z validator here and hono itself so this is my hono version if you want to in case you're having some big problems in case hono has changed a lot since the time you know I made this tutorial you can just downgrade to this specific version and you should have relatively the same EXP experiences I do and we already have Zod installed when we developed our forms so with this hono Zod validator we're going to go ahead and create something called well uh a schema and a z validator here so every time we do a post request to slash login we're going to go ahead and add a middleware here so what's a middleware a middleware inside of well also inside of Express but also inside of hono is basically anything with which returns a next method before the final controller so you can chain as many middle Wares as you want before you do the final uh Arrow function which I like to call the controller which which is called the controller and return back a value so you can chain as many items in here that you want but next is a reserved param which all middle wordss have which you can then return execute and then that will fire the next middleware and the next middleware and finally the controller and middle Wares can be built by us and we are going to build some custom middlewares in this project but we can also use some newly installed ones like the Z validator from at hono Zod validator so that is a type of middleware and inside of this middleware we Define what to validate in our case we are validating our Json field and then in the second argument we have to create a schema so let's prepare our Zod here and then what we would do is write z doob and let me remove the extra comma which I have here and inside of here we're going to accept an email which is a d. string. email and a password which is a z. string like this and what I like to do is have my things ordered one beneath another I just think it makes more sense like this you can of course do it in whatever way you prefer or like uh great so we have this now uh should I do it like this there we go like that so now what we can do is if you want to you can also go to for example your sign in card and inside of here you have you already have a form schema so if you want to what you can do is you can go inside of your features Al and you can create a new file called schema. TS or maybe schemas because there's going to be multiple right and you can expert const login schema actually let's do you know login schema like this export const and let's import Z from Z like this and what you can do now is you can remove this from the signin card make sure you're doing this in the signin card right we're doing logging in here and instead of you know writing it here you can import login schema fromt do/ schemas because we are in the same folder we are in the out right here so you we just go one folder outside and here are our schemas right and I'm going to replace all instances of form schema with login schema there we go no more errors in my codee here and what I can do now is also go inside of my server route here and do the same thing here so I can just add login schema from do do/ schemas and now they share the exact the same scheme as here so let's go ahead uh and try this out now so what we have to do is we have to build uh a use login method so we're going to go ahead head and do that but before we can do that we have to revisit back our uh out folder right here my apologies API folder route route. DS so here's an important thing when building this thing called RPC so let me go ahead and quickly show you this so the RPC feature allows sharing of the API specifications between the server and the client this is important for us we can export the types of input types specified by the validator and output type emitted by Json and hono client will be able to import that so this is the functionality that I want and this is the important thing uh of working with hono so you can see that right here hono allows us to create routes like this we can use the app instance a new every time but when working with rpcs we can't exactly do that what we have to do is we have to chain them from one app right like this and I have to chain another one here so that's how we build rpcs because I need one constant to have the entire type specifications of everything I can have so I just want to bring that to your attention right that's why when I defined con app new hono I immediately changeed do Post right I didn't end this and then do app. poost because this doesn't transfer the types so it's important that you immediately chain it here here like that now let's go back inside of here and let's actually uh go ahead and chain our routes so I'm going to go ahead and leave the app as it is and I'm going to define the routes and that's going to be app. route slout and then I'm going to import out from at slash features slout slash server like this and let me go ahead and see what's going on here here so inside of my features out server route. DS uh I do export default app but I think I have to do slash route to actually get it so just ensure that you added an export default in your features out server route right here and then you can import that out right here there we go and you just change this to Route so every subsequent you know uh route that we have like users it will go here and we're going to import them in the future from features users like this that's how we're going to chain our routes and we're going to keep them all in this constant called routes so remove the users because we don't have them at the moment you can put the semicolon here at the end if you want to for now at least uh and now what we have to do is we have to create a type so let's export type app type to be type of routes and now we have an app type which which holds our entire API you can see the input Json email password you can see the output which is a success and string why well because right here that's what we output so if I change this to 1 2 3 4 and hover over app type now success is a number so you can see how useful this is for us because we're going to use this for endtoend type safety excellent now that we have this set up let's go ahead and let's create our AR RPC Ule so now we're going to go inside of source inside of uh our lib and we're going to create a new file called RPC dods let's go ahead and import HC from honos client and let's import app type from at SLA API the catch all route file and then route so that is this our entry point of hono and we are catching this app type right here and then let's export con client to be HC app type and inside of here we have to add HTTP Local Host 3,000 like this now obviously this is not how we should do it so let's go ahead and immediately fix this first thing I want you to confirm is that your app is actually running on Local Host 3000 if it's not that's completely fine but you have to know which Port your app is running on so I know that mine is running on Local Host 3,000 so what I'm going to do is I'm going to go inside and create a new file called environment. local make sure you add local because uh in nextjs G ignore uh only local is hidden so if you add it in your normal environment it will be pushed to GitHub which is not something you want and and now let's add a nextore appor URL and let's add HTTP localhost sl3000 what's important is that you use the proper protocol so if you know that you're using https which is rare because usually you know if I just do Bun Run Dev you can see that it uses HTTP right so this is your url which you need put right here so I'm going to remove the S and don't put a slash at the end so just like this the reason we are doing this is because in production our app is not going to be running on Local Host 3000 so we need to uh create this dynamically let's add process. environment next public app URL whenever you work with environment variables I suggest that you copy and paste them rather than write them out because you can easily make a mistake you can add a third P here and not notice so just be careful uh make sure you copy and paste this things great we now have the client and let's go ahead and let's see what the magic now so we're going to go inside of source inside of features out and we're going to create a new folder called API and inside of here a new file called use login. DS and inside of here let's go ahead and let's import mutation from T react query and let's import infer request type from hono and infer response type from hono and let's also import client from at/ Li RPC of course make sure you've added an export to this client here and since we have all the types here what we can do is we can prepare our response type from this request which will be an infer response type here type of client api. out. login so that's the Coe thing I don't have to guess if my API route exists I have type safety to tell me so if I think it's sign in I get an error because it's login and not only that but you have to open uh brackets for the next thing because it's in a special kind of syntax with a dollar sign at the front so you cannot use dot dollar sign you have to use this kind of accessing of the object so select the post request here like this and and let's also get a type request type to also be infer request type type of client API out login and again post and now inside of here if you want to you can already specify Json so now we have the request type which tells us that we need an email and password and a response type which will tell us exactly what will happen so we can export const use login here we can get our mutation here from use mutation and let's go ahead and assign it some types so let's give it a response type in the first argument a native error in the second argument and a request type in the third argument and then let's open an object here let's remove the trailing comma so we don't have the lint error let's add a mutation function and let's use asynchronous Json and let's hover over Json for a second and there we go so when we use this in our front end you can see that we have type safety for what we have to pass to our back end so that's what we just achieved a very very strict type safety here now let's get the response constant by using await client. API out login and in here you can use post right but when using it inside of type interference you cannot do it so you go if you want to you can again you can be consistent you know and you can just do uh Post in this way if if you want to be consistent and just execute this and pass in the Json instead like this and let's return await response. Json just like this there we go and what we have to do of course is we have to return the mutation there we go so let's go ahead and let's add this to our sign in card right here so I'm going to go ah ahead here and I'm going to add const from use login we can get that from do/ API use lose login and inside of here let's get our mutate method and then when we submit very simply mutate and we pass in the values or we can just add the values like this and there we go you can see that type safety matches 100% so for whatever reason we the different schema here it would warn us that something is wrong so this is what we just achieved end to end type safety so you can see from my uh sign in form I know exactly what I have to pass and I know exactly what I will get back so that's the power of hono and adding that to your next JS project that's why I like it so much and that's why I started doing this in all of my courses lately I just think it's amazing and I think it really gets you closer to you know scalable and production ready project uh great so we have that and here's another you know quick tip for you so for example if you go inside of your out here server and let's say that our login for whatever reason had a user ID here uh as well right so then how you would Target that is before you select the post request you would also have a user idid but there is one problem with our current implementation here you don't have to type this out you can just I'm just trying to demonstrate something here one problem here is that our current request type is only passing in Json so I just have to add user ID here there we go this is the problem we are passing Json but we are not passing uh our params what you can do when whenever you define a request type is just not be specific like this so now your request type has both the Json that you need and the Pam that you need and then you can inside of here immediately destructure the Json and the Pam and you can then pass the Json and a Pam here there we go and now inside of your sign in card for example you would also be specific so your Json will be the values and your Pam will simply be user ID uh 1 two 3 4 there we go so that's how you would do that I don't know if I just confused you but I just wanted to show you uh you know if you already want to drop off and try out this yourself and you play around with params that's how you can be more specific so I actually want to keep that practice so this is what I'm going to do I'm going to remove the user ID from login entirely I'm going to go back inside of my use login method and I will remove all of this in instances of user ID here I'm also going to remove that here but what I'm going to leave is my request type so previously my request type here was specifically targeting Json but I don't want to do that I want to be less specific and in the same time being more explicit about what I'm passing so instead of having you know Json as a prop here I'm going to destructure Json like this and I don't have to pass the Pam at all because we just removed that so there are no errors right now in the use login method but there will be in the signin card so just remove this and if you previously passed values like this you now have to pass them a bit more specifically like this I think by being uh less specific you are more explicit and again I think this shows in a type safe way and you will make less mistakes this way great and let's actually try this out now so I'm going to go inside of here and what I'm going to do is I'm going to show you how to actually get this param so I know that I will get my name my apologies my email and my password and while I can do that you know from c. request. Json for example uh let's me just see how can I use this C do request ad Json would be a guess body and then instead of my my body uh do I need to await this uh turn this into an asynchronous method well we pretty much always have to do that uh okay still not exactly clear never never mind because this is not how we're going to do it either way so we would have the exact email and password from c. request. valid and then our Json and you can see that I know that email is a string here and password is a string here if I go to login schema for example add I don't know some weird code which is supposed to be a number inside of my route here I will also have that code right here so again type safety is following us everywhere you will be it will be almost impossible for you to make errors in this kind of environment right so great we can use c. request. valid only when we are using the validator let me quickly revisit the documentation to see how do I actually access the body uh or Json I'm trying to find I'm going to pause and I'm going to find the exact thing so looks like it is what we tried in the beginning await c. request. Json but I think you remember we saw and we couldn't find any type safety there so it's best to use this c. request valid Json and again just a quick tip if we had a PM here and you wanted to access a Pam in a type safe way so you already know that you can do the user ID from C request Pam here you can do it like that but if for whatever reason you want to Define it you know in a z validator you can do that you can do Z validator and you can add pm and you can do do I have Z here I don't think I have Z I do okay you can do z. object here user ID and you can for example make it a number if for whatever reason you want to do that and then uh for example you can see right here this c. request. Prem still tells me that it's a string because it's reading from the the router it uses but you can also do user ID from C request valid and simply choose the Pam and this will infer user ID at as a number so if you for whatever reason want to do that you can do it as well I'm now going to remove this I'm going to remove the user ID and I'm going to remove this there we go and now let's go ahead and let's create uh well we can return back the email and the password and let's also you know console log this so it's easier for us to catch in the terminal there we go so I'm now going to go ahead and I'm going to entirely Focus just confirm you have no errors in the route no errors in the signin card no errors in the used login here let's go ahead inside of our create next app I'm going to pass in Antonio mail.com and 1 2 3 4 5 6 7 8 and I'm going to press enter and I'm going to go inside of network here and let's see uh I think we actually might get an error here let me just see yes we are getting an error 404 not found because I forgot a very important thing let's go ahead and see what I forgot inside of my source app apir rout route. TS can you guess what I forgot my out routes are post routes but I'm only overriding the native nextjs get route so I have to add expert cons post here and let it handle the app as well remember you know native nextjs apps uh API routes require explicit export of get post put patch delete options all of those routes so whenever you introduce a new route to your hono just remember to go back to your route initialization of hono and if you want you can already do all of them here right if you want to you can add all of them I'm going to go ahead and uh but I will probably forget once again and we're going to get a 404 and we're going to get reminded that we have to do it again let's try this now so I'm going to go ahead and prepare my network request again and let's click login let's refresh my okay it's it's already here let me just go ahead and click this Antonio mail.com uh 1 2 3 4 5 6 78 and there we go login 200 let's see my payload my payload is correct exactly what I wrote and let's see my response my response is exactly what I wrote and if I go inside of my terminal there we go we have that exact thing written here so what I want to do before we wrap up this chapter uh is just create the exact same thing for my sign up route and then in the next chapter we're going to finally uh connect to app right and turn that into a real user so let's start by uh extracting the schema so I want to go inside of source features out components sign up card and inside of here I believe I have my form schema so I'm going to copy this and I'm going to go inside of out schemas and I will export const register schema and I will add it here let me just remove the extra there we go like this and then let's go ahead and create our API route so inside of features out API my apologies server route. DS remember we have to chain so chain SL register right here and I'm going to go ahead and do do it the way I like so after register we add a z validator here we're going to validate Json using the register schema from do do/ schemas alongside our login schema here and then we can copy and paste this entire thing there we go but instead of having just email and password we're also going to have name so we can append this as well there we go and we can then go instead of API and we can copy use login and paste it and we can add use register here let's go ahead and change this to be use register and let's change these two to be register so both the response type and the request type should be changed to use out. register here and here and inside of here we also have to change it to register and nothing else needs changing so this is all automatically inferred from the back end from the API route what we have to do now is revisit our components sign up card remove the form schema replace all instances of form schema with register schema which we can import from do/ schemas and then we have to add our m M tap method from use M uh from use register from do/ API use register and the onsubmit we call the mutate method passing Json values right here there we go let's try out that just ensure you have no errors in any of those files I'm going to keep my network tab open here I'm going to go and click sign up here I'm going to go ahead and select my name to be Antonio my email to be Antonio mail.com and my password 1 2 3 4 5 6 78 and there we go register and you can see that my response is exactly what I have written meaning that my payload has been properly processed great we are now ready to add app right and to actually save this information coming to our backend and to finally create some sessions great great () job what we have to do now is set up app right create an API key and install the SDK inside of our project so that we can use those information from our sign in and sign up screens to finally create a user save them in our database and also create a session before we can do any of that you have to visit app.io or use the link in the description and click on the get started button go ahead and create your account once you have created your account you will probably see a screen similar to this so I'm just going to go ahead and create my organization I'm going to call this CWA short for code with Antonio and I'm going to select a completely free plan $0 a month and let's click get started and there we go now let's go ahead and let's create our project so I'm going to go ahead and call this a jira clone and let's click next here and I'm going to select Frankfurt for the region let's click create here as well and there we go we now have our uh first project right here so what we're going to have to do next is set up a database and also set up our uh API Keys which I'm not sure where we can find uh but we will we will set them up now following the documentation so let's go and click on support here and you can always click on the docs and I want you to go inside of products Al and I want you to find SSR login if you want to you can explore app right you know on your own they have a great documentation but we will specifically focus on we will specifically focus on using appes server SDK so we won't be making app requests from our browser from the client we have our own API and we're going to use it so every API request from the client will be going to our API first and then we're going to communicate with app right so make sure you are on the SSR login no big problem if you can't find this documentation page you don't have to do this but if you want to learn you know about the schematics of how this works you can do it that so let's go ahead and let's see uh what we have to do first so first things first we need a server SDK so let's go ahead and find that there we go nodejs SDK seems to be 14.0 point0 so what you can do here is you can go and add Bon add node app right and you can go ahead and append this exact version verion so 14.0 like this there we go we now have the server as decay so I'm just going to go back here the second thing we need is to initialize an admin client and for that we're going to need to generate an API key so I'm going to click here and let's see where exactly uh do we do that so create an API key Integrations let's see I'm going to click go to console in my uh uh upper right corner here and inside of my jir clone here uh there we go it says integrate with your server and I can add an API key here so I'm going to go ahead and call this jir clone and I'm not going to set the exploration date I'm going to click next here and I'm going to go ahead and I'm going to select sessions. write right here and I'm going to click create we can always go back here so let me try and find this you know uh if I go back here okay so on my overview page if I scroll down I can find my API keys and I can click on an API key and from here you know we can go ahead and added some more Scopes but I think for now this might be the only thing we need I think we also need users. right go ahead and select users. write as well and click update so make sure your new API key has sessions. right and users. right great and stay on this page for now and I'm just going to go ahead and open this in a new tab here are my documentations and I'm going to go back to out and I'm going to find the SSR login and I'm going to click on tutorials at the bottom and I'm going to select nextjs SSR so we created our project we already have this we have installed node app right and now we have to create this but we're not going to create this part just yet so what's the difference between the create session client and create admin client well create session client is part of appes SDK which will be called when a user directly creates new records for example a user creates new task so for that we're going to use a session client but there is a specific functionality in our project where user is not exactly responsible for creating something for example a new user a user that is not logged in that is getting registered for the first time cannot be responsible for creating themselves so for that we need an admin client so what I'm going to focus on is just creating this the admin client and as you can see for that we're going to need a couple of environment variables here so let's set that app first I'm going to go inside of my environment. looc first we have next public app URL I'm going to add some spaces here and here's what we have to add next so we have to add the next public app right endpoint a very important prefix here is next public this will allow us to read read that inside of client components as well now let's go ahead and let's add this and let's add this like this and then we're going to add next app right key notice how I didn't add public in front of it so why do we need public here well technically we don't need it since we're going to use node app right but in case you also in the future want to add Client app right asdc you want to make sure that you can read using these three but your API key should not be prefixed with next public uh it won't exactly be the same as leaking your key but adding next public will certainly make it easy for malicious users to grab it all right so just ensure that you have these set up make sure you don't misspell any of those and now let's go ahead and let's fill our project with that so I'm going to go ahead and do the following I'm going to go inside of my project here and I have my API key secret I'm going to copy this don't share your secret with anyone uh I created a new account for this and I'm going to delete it after this and I'm also not going to add any credit cards so uh that's why I can show you this of course but you should not show your API keys to anyone so make sure you have copied the API secret key after after that let's go ahead and let's get our end point so let me just find where can we find our end point not exactly sure but what I can see immediately is our project key so we can copy this uh I think we can also see that in the settings there we go you can go into settings and you can find Project ID and API endpoint so let's click project ID here and then we can assign the project and let's copy the API endpoint then we can add that here this doesn't necessarily have to be in your environment variable but in case you ever want to change it or you can also self-host app right using oneclick setup so for if you ever want to change that it's good to have this as an end point and we can leave the database ID empty just for now you know now let's go ahead and let's do the following let's go inside of source let's go inside of lib and let's create aight. DS like this and now inside of here let's go ahead uh and let's import from node app right the following we're going to add client account storage users and databases and then let's export asynchronous function create admin client let's create a client using new client instance and then let's set endpoint to be process. environment and as always don't write it out copy it it's going to save you some headaches and put an exclamation point at the end to overwrite type safety here let's add set project and do the same thing don't write it out copy it process. environment and there we go and set key that is the next app right key so process. environment there we go and then let's go ahead and let's return for example if we need account we're going to go ahead and return new account instance and pass in our admin client there we go so right now we pretty much created the same thing that we have inside of here right so instead of having this huge session client we now have just this admin client and we just return the account and you can already kind of see the difference between the admin client and the session client in the session client we set the endpoint and we set the project but we don't set the key which means that this session client is pretty harmless right that's why we're going to use this when user needs to create something and we're going to use this when we as an admin need to create something like a new user so I also want to show you one kind of a important thing in nextjs so nextjs is a framework that allows you you know to create your front end and your back end in the same project there is nothing stopping me from for example inside of my page. DSX here doing this for example create admin client from at lib app right so I just did this right so I can go ahead and for example console log create admin client here let's see what happens I'm going to go inside of my project here and I'm just going to go to the root of my page Local Host 3000 right here I will refresh uh can I see anything let's see uh okay I'm not sure why I can't see anything but here's the thing I don't even want to be able to do this right I want to be thrown an error when I do these kind of things and especially I think if I add oh okay I know why I'm not seeing conso logs we are seeing something we are seeing it here in the terminal there we go hello it's because this is a server component by default so if you go ahead and you add use client here inside of your app folder page. DSX when we are playing with the buttons the there we go you can see I have the entire admin client right here not only that but take a look at this conso log I can see all of my environment variables right and you can see how my set key is thankfully hidden right here right you can see how these two are filled because they have the next public prefix but my key is thankfully hidden but still you know I can now kind of access this a malicious user can definitely find their way around this and file it inside of client s side that is a very bad thing to happen so this is what I want you to do I want you to do B add server only or npm install server only this is the version I'm using 0.0.1 if you want the exact one and what I want you to do is go inside of your new lib so inside of source lib app right and at the top of your file simply add import server only once you do that you immediately get an error here you're importing a component that needs server only that only works in a server component so that's how we are protecting this little util so you don't accidentally do things like this right you need an error to happen and right now if you remove use client from here you're not getting an error why well because this is a server component this is an equivalent of the environment is equivalent of an API route so it's safe to do it this way but you never know you know especially if you're new with nextjs you might accidentally had a used client somewhere and accidentally add a very very dangerous import that's why they developed this package server only so that you can protect yourself from that this will fail the builds and obviously it will give you a big warning right here so you can remove you client and you can remove this as well for now there we go I just wanted you to do that great so now let's go ahead and let's see what does it say next instead of the SSR initialization the first one we need to handle is the register route right so we already did this we set the environment variables here we created our first project and you can see that they say that for this tutorial we are only going to need sessions sessions right so yeah if you want to you can go back to your app right settings find your uh API Keys here where where are my API Keys why are there not loading at the moment let me just find my uh Joc clone right here in the overview uh just a second it appears like I have lost my API keys right now uh let me try and find them here API key there okay it didn't load now it loaded so Joc clone inside of out I'm going to remove users. WR because you know the admin SDK is quite powerful and you want to be very specific with what it can do and what it can't do uh and since we we will not be creating users we'll be creating accounts right so you're going to see what we're doing in a second so make sure you have sessions. right and click update here you don't need anything else for this API key No Big E if you left the users read and write on let's go back inside uh our app right here let's see what does it ask us to do next so it shows you how to get the logged in user that's fine I want to do the sign up page first so we have our inputs and now this is what we have to do here so we have to initialize the create admin client and we have to destructure the account from that that's all good we have exactly that here right instead of our lib app right we have account and we can call this create admin client in an API route even though we have this server only and then we have to create a new account with ID unique which comes from node app package and we have to pass in the email password and the name from the register form and then we have to create a session and we have to store that session in a cookie let's go ahead and let's do that but just a little bit differently because they are using server actions or as they are renamed now in New react uh server functions so we're not going to do that we're going to use good old apis honestly I prefer them over server functions and I just add rpcs because server functions technically are rpcs in a way let's go ahead and let's do that inside of API inside of route. DS uh my apologies inside of features out server route so the the server out here in the out let's find the register we have name email and password make sure this is an asynchronous controller don't forget that and now what we're going to do is we're going to get the account from await create admin client from lib app so make sure you've added the lib app right import here and then what we're going to do uh is we're going to do const user to be await account. create and passing ID from node app right do unique and then an email then a password and then a name so you can hover over the create method and you can see the exact order first we need a user ID then we need an email then we need a password and then we need an name I don't like when they do this usually I like when it's an object so you know I would have the pass ID to be this I would have to pass email to be this this way you know you always have to double check your methods and check if the order is correct so ID email password and then name in that exact order and then let's create our session here to be await account create email password session add the email and the password that the user just created and now we're going to go ahead and instead of using the cookies from next headers we're going to use cookies from hono so let's go ahead and add set cookie like this whoops and we can import set cookie from hono cookie so import set cookie from hono cookie and then inside of here we're going to go ahead and pass in the context in the first argument and what I like to do is I like to create a constant for my out cookie so let's do that inside of the out folder in the features create a new file called constants dots and Export const out cookie and let's give it a name uh I like to always use a prefix for my cookies for example CWA for code with anonio dj- clone D session like that so just make sure you have the out cookie here and then you can instead of using strings every time just pass the out cookie from your dot do/ constants because it's in the same folder right uh and what we have to pass next is from this session the secret so session do Secret like that and then some additional safety options here so path will be a forward slash HTTP only will be true secure will be true same site will be strict and then we're going to do a max age 60 * 60 * 24 * 30 like that and we're going to go ahead and we can simply return success true like this and looks like I don't need uh the user here I think I don't need the user actually what we can do is we can return back the user so data user we can do that there we go great let's go ahead and let's try this out and let's see if anything important here happens so I'm going to go ahead and I'm going to go to localhost 3000 SL sign up so it's important important we are working in the register form now and I want to show you inside of my application here I think I will have some cookies because this is a local host I don't have any cookies great no cookies for me perfect so what I'm going to do is I'm going to create a new account now I'm going to call myself Antonio I'm going to give myself an email of Antonio mail.com and 1 2 3 4 5 6 actually let's do this I think app right has some uh specific password requirements so what I'm going to do I'm just going to change this type to text so you can see my password so I'm going to call my password Antonio 1 2 3 4 5 6 7 8 let me show you Antonio 1 2 3 45678 so that's going to be my password I'm going to click uh instead of login this should obviously be registered we're going to change that and let's see what happens so it appears that I got 200 let's see my response there we go so I have uh returned back an entire user here uh not exactly sure if this is the smartest thing to do but I don't think there are any secrets here so perhaps it's good yeah looks like just dates I don't see any uh Secrets here so that should be okay but nevertheless we can change what we return what I'm interested in is inside of my application there we go instead of my cookies local host I have my CWA jir clone and I have my cookie right here there we go so we are now logged in so what I want to do now is I want to develop the rest of the methods including log in and including log out so we already have login so let's just continue working with login here we're going to have the email and the password Here let's go ahead and let's do again account from await create admin client let's go ahead and do con session to be await account create email password session let's get the email and the password here so pretty much the same thing as we did here you can even copy it if you want to and then what we're going to do is well set the cookie again we can copy the exact same cookie uh make sure you're doing it in the login route we have the session here we go session. secret set to out cookie you can see how handy it is that we use the constant otherwise when you use it in many places you will probably misspell it at least once and that's quite dangerous to do and we can go back and we can return data uh we can just return Success Through and we most likely won't need the use user in the register method as well immediately so you can return success true here as well and you can not assign this you don't have to assign this in the register you don't have to assign this to the user you can just await right there we go great so we now have our login here and we can't really try it out because we already have a cookie but what we can do is this uh we can go ahead and the following go inside of your application find the cookie and remove the cookie like this but I don't think that this is enough let me just see if I refresh okay I think the cookie is definitely gone okay that's good let's just quickly visit our app right because I think I completely forgot to check do we have a user we do have a user here it is right here we have a user and in app right you can actually control it uh you can also verify the account you can go ahead and uh create different targets you can go ahead and close the user session you can see uh their activity and everything else here uh great so now that I confirmed that this user was actually created here let's try logging in this time so remember I just removed my cookie from my application here I'm now going to go ahead inside of sign in and I'm going to go ahead and log in so Antonio mail.com and I'm going to use that password Antonio 1 2 3 4 5 6 7 8 and login is 200 success is true and application new cookie is set again excellent and now we have to do the easiest route of them all uh which is the log out method so I'm going to go ahead and use PST for the log out I'm not sure if maybe this should be uh a um if this should be what exactly am I trying to say I'm not sure if this should be uh a delete method but I think post can work pretty well so for now I'm just going to go ahead and do this I'm going to add a context here and inside of here I'm going to do delete cookie from hono cookie and I'm going to pass in the context and out cookie here and I'm going to return c. Json success true like this so for now I'm just deleting the cook but there is one more thing I have to do here but before we can do that we need to create a session middleware uh so let's go ahead and do the following well we can't really try it out in any way now so so what we're going to have to do next is we are actually going to have to create uh our session middleware and we're going to have to create another route which we're going to use to get the currently logged in user and depending on the result of that route we're going to redirect the user away from this screen or if they try to go you know to dashboard we're going to direct them back to the login screen but I want to end this chapter for now so what would did is we set up app right we handled the login and the register routes to set our cookies and to create users in the aite database we learned about the server only import which is currently protecting our create admin client and you've kind of understood what the admin client does so it's used for things that users themselves cannot create right uh so what we're going to do later is of course we're going to use the storage the users and databases here but what we have to do next is we have to create the session client and we're going to use it as a middleware so we're not going to use it like this instead we're going to use it let's say this logout route should only be accessible to logged in users so we're going to use a custom middleware called session middleware here and session middleware will redirect the user away if they are not logged in but if they are logged in they're going to provide the controller with the currently logged in user as DEC so then we're going to create like a little client but without the key and with just the uh right read uh access that the currently logged in user has so that's how we're going to handle that great great job now let's go ahead and let's create () the session middleware which we're going to use to authenticate requests which should only be accepted accessible to log in users so I'm going to go inside of source lib and inside of here I'm going to create a session middleware do DS we can also Mark this as server only and then let's go ahead and let's import get cookie from hono cookie let's go ahead and import create middleware from hono Factory let's import the constant out cookie from features constants and let's import account client databases models storage type account as account type type databases as databases type and a lowercase as types storage as storage type and then we're going to have users as users type from node app right and now let's go ahead and let's export HST session middleware let's use the create middleware from hono Factory and inside of here an asynchronous method which G gives us the context and the next method which I briefly demonstrated in a first few chapters of our hono exploration now inside of here I'm going to create a new client and I'm going to give it an endpoint using process. environment and as always I will copy it from my environment. Lo and I will add an exclamation point at the end I'm then going to set the project as well process. environment and again I'm going to copy it from here like this there we go after I have set my client I'm going to go ahead and obtain the cookie using get cookie context and out cookie so in register and login we set the cookie in our session middleware we read that cookie and in case that cookie is missing we are simply going to return context. Json error unauthorized and an error code of 401 otherwise if we have the session we're simply going to append the session to the client so client set session and pass in our session here so this set session will serve as set key which we have inside our admin client but our session client here does not need an admin key it's not supposed to be that powerful it's only supposed to be as powerful as the currently logged in user that's why we are using session based SDK inside of this middleware and then I can initialize an account to be new account and passing the client and I can do the same thing for a couple of other things for examp example databases new databases and storage new storage and I can also immediately obtain the currently logged in user using await account. getet the reason I'm doing this is because we will never as as as a as a as a as a logged in user we are never going to use use the account in a way that we are using it from the admin client so in here uh we use the account right and if you're wondering why do I use get account here and I just do this here it's the same thing you can do you can do this if you want to const account and then just return account I'm just following the documentation in case you're confused you don't have to do it in this way uh so as a logged in user the only reason I will be using the account as DEC is is to get the current user so that's why I just want to do that immediately in the middleware so I don't have to repeat this piece of code everywhere right so we set the user here and then what I can do now thanks to the hono factory middleware is append all of this to the context so c. set account will be account just in case I need it C do set databases will be databases c. set storage will be storage c. set user will be user so what did I do by that well let's check it out what's important to end this middleware is await next like this so now let's go inside of our features server features out server route. DS and for example let's find our logout route this post logout route and let's add the session middleware here make sure you add a comma after the session middleware once you've added the session middleware what will happen is that if an unauthorized user tries to log out they will be stopped right here because we cannot find a cookie for the user that's trying to log out meaning that they shouldn't even attempt to do this and we're going to throw back a 401 otherwise if they pass this we're going to append all of these sdks and their session and pass them to the context which means that for example in if I want to log out I also need to clear my account session so how can I get my current account well since we used c. set account we can now access it right here so const account will be C doget account like this but as you can see there is an issue this is not type save this Con context right here has no idea what the account is and since we were already that careful with type safety using the RPC using react query using Zod validator and all of those things let's continue with that tape safety and thankfully hono allows us to do that as well so go back inside of your session middleware here and what we have to do now is create the type which this middleware will return so type additional context or whatever you want to call it I think this is an appropriate name and you have to have a variables here and then inside of here you have account to be account type then you have databases to be databases type after that Storage storage type users users type and user is going to be model do models. user models. preferences and let me just see uh okay we imported models right here I wasn't sure if we have the models so yes this is obviously different from the ones above because these are sdks but user is a result from this method this is an a fetch request right so that's why we have a very specific uh uh type for that models user with models preferences how do I know this is the type these are fairly obvious right well I know because I hovered over here and saw that so I just appended it to be here and then we are simply going to use the additional context again make sure you have variables here don't misspell it and use the capital V Here and Now use the additional context and simply add it in here let's see if there are any errors looks like there are some errors here so let's see did they do something wrong databases type type databases as databases type uh I'm not exactly sure what is incorrect here databases maybe I misspelled it yes datab bases I have a typo inside of my additional context now there are no errors here and if I go back to my route guess what my account is now typ safe no more errors so we successfully inferred from this middleware exactly what is extended in this context right here so you just learned how to create a custom middleware for app right so even even if there was no third- party Library we created our own why am I emphasizing on that well if you go to hono if you go inside of their middlewares here you can see they have a bunch of built-in middlewares but they also have third party middlewares for next out for clerk for Firebase right for all of these things which you know you might want to use but they don't have one for app right and the reason I want to tell you this is you don't have to be afraid of building your own middlewares you are not stuck if there is a thirdparty middleware or Library that's missing you can always create your own and that's what we just did right if there was an app right middleware listed here I would definitely use it you know it's probably made from the app authors themselves and it's probably the best practice right but no biggie we can create our own and now we're going to see whether it works or not so we just obtained the session middleware here we have the account and what we have to do for a proper log out is after we delete the cookie await account delete session and delete the current session and since we use O8 this needs to be asynchronous there we go we can't test this out yet because we don't have any screen for the currently logged in user and if we want to have a screen for the currently logged in user we also need to have a route which will fetch the currently logged in user so in the top of this uh server route I'm going to add a get current and we're going to use the session middle so I get the currently log in user I'm going to add uh well just a context here and uh session middleware what exactly happens to be the error here I think it's because I'm missing a return here so let's just get the user using C doget user and let's return c. Json data and user whoops there we go once I added the return the error was gone uh and what I'm going to do is I'm just going to order this how I like it like this and I'm going to show you just one Quirk here let me just indent this and this so I think that for some reason if you add a comma here you will get an error right I don't know why but if you add comma at the end of your uh controller here you get an error like it's missing inference from session middleware and I think I technically know why if you add a comma this get route probably thinks that this is a middleware because this is supposed to be the last controller which returns something and it's not supposed to have anything after it so if you add a comma the type safety of hono probably thinks that this is still a middleware and it did not infer the types to the last controller at least that's my theory so I just want to give that to your attention in case you had a a comma and you're wondering why does the why does Antonio have types and I don't maybe it's just a comma uh you can see the same thing in the log out if I add a comma here I think there we go same thing happens right so just remove the comma because this is supposed to be the last function uh in this array of right middlewares and routes and everything all right so we now have the current route here and we have to now create create a react query hook to fetch the current user so let's do that inside of features Al API and let's add use current. DS so creating queries is even easier than creating mutations let's get used query from 10stack react query let's import our client from our RPC library and we don't have to define the request or respon on sty so we just have to write one use current Define the query to be used query query key here is going to be always written inside of an array and this will just be current and let's add a query function here to be an asynchronous method and inside of here let's get the response from a weight client API out current and we simply f the getap method like this if response is not okay we're going to return back now we are not going to throw an error because we will always attempt to fetch this and if you're wondering why do I have to explicitly check for response okay why can't I just wrap it in a try and catch block that is because this is using fetch it's not using axas axus is uh a library which when you wrap try and catch a around it you will receive errors in the catch method fetch does not work that way so for fetch regardless if you wrap this in try and catch it will not throw the errors in the catch method you have to handle errors like this otherwise if we are okay we're going to go ahead and get this from await response Json like this and we can simply return the data and remember to return back the query there we go so what I want to do now is I want to check if I can actually you know load my currently logged in user so I'm going to go instead of App instead of page. DSX and I'm going to clear all of my buttons and inputs here I'm going to mark this as use client and inside of here what I'm going to do is I'm going to get data from use current like this and I'm going to do something here inside of my use effect not the previous solution I know but if I don't have data and if we are not loading I'm going to go ahead and redirect the user so const router from use router here let's go ahead and do the following I want to do router. push SL sign in and I'm going to call this only visible to authorized users and we can remove this as well make sure you have marked this component as use client because you're using hooks here so let's see if this works or not let's see what happens I'm going to go instead of create next app here I'm going to refresh this and I'm going to go and open my network Tab and I'm going to go to Local Host 3000 and it says only visible to authorized users and if I click on current here you can see the currently authorized user that is great uh you might get redirected and I think that I might get redirected if I actually remove this cookie so if I do this and I refresh there we go I'm redirected to sign in screen so if I go back to Local Host there we go you can see that I briefly saw the screen which we can easily hide with you know if is loading just show the loader instead and you can see I'm getting 401 in my network tab the moment I removed that cookie so now what I want to do is I want to add a log out button in case I am uh logged in so let's go ahead and create uh a mutation for that so I'm going to go inside of my features Al API and I'm going to copy use login and I'm going to rename it to use log out like this and I'm going to change these two to be log out and log out is also using a post method so we don't have to change that I'm going to rename this mutation to use log out and I don't have to pass any Json at all and I will change this to log out there we go I just have to executed that's it and now let's go inside of our page. CSX where we call the use current and let's add the mutate use log out here from features out API use log out and I'm going to go ahead and add a button here from components UI button log out and on click we'll simply call mutate and looks like it's expecting some arguments here uh uh use log out mutation function request type uh I think what we can do here is just add undefined or nothing we can just do nothing here and we can remove the request type from here and yeah then you can just call mutate directly I think you can even do mutate no okay it needs to be because this is an onclick Handler right let's try this now let's see what happens now and what I want to do instead of the use log out is one more thing so once I log out I'm going to go ahead and I want to get const query client use Query client from 10stack react query here and I'm going to call on success here and I'm going to call query client inv validate queries and I'm going to invalidate uh I think maybe this is an object where key yes current so when I log out I'm going to invalidate the query current which we use in use current right here so make sure you didn't misspell the query key right here so once the user log outs we are going to force a refetch of the current user and then it will be undefined meaning this data will be deleted and then we're going to redirect the user to sign in let's see if our logic is working I'm going to go ahead now and I will log in using Antonio mail.com Antonio 1 2 3 4 5 6 7 8 I will log in um nothing has happened yet because we didn't create redirects from this screen but I will manually go to Local Host 3000 there we go I'm not redirected and it says only visible to authorized users I'm going to open my network tab here and I will confirm so my application has cookies there we go I'm going to keep the network Tab and I will click log out and there we go I was redirected and uh my cookie here is deleted and you already saw the network tab I got the log out success true and then I refetch the current user and I got back the error unauthorized and since we catch the error inside of our use current so if we get the error we simply set the current user to be null which triggers a final redirect in this use effect right here amazing amazing job so what I want to do in this chapter is the following so I'm going to leave () it at this for our login options so I'm not going to implement the Google and GitHub login right now I'm going to do that later if for any reason you IM immediately want to explore this you absolutely can uh and in this documentation that we were looking at which is basically out and then uh we choose SSR login we go to the bottom we choose the tutorial for nextjs inside of here you have step number seven which says all out authentication with SSR so it's definitely possible and we will do it later but if for any reason you want to explore it right now we can go ahead and do it otherwise you can go ahead and follow what I want to do next so I want to implement a user button and besides user button I want to implement a different solution for redirecting my user from an unauthorized page because I just don't like using use effects so let's go ahead and do the user button thing first I'm going to go ahead and login so Antonio mail.com and I'm going to go ahead and enter my Antonio 1 2 3 4 5 678 password and I'm going to go back to Local Host 3000 and there we go only visible to authorized users meaning I am logged in and I don't want to show a button like this instead I want to create a component called user button so let's go inside of source let's go inside of features inside of out components and let's create a user button. DSX let's go ahead and mark the user Button as a use client component and inside of here let's go ahead and let's import everything we need from the Avatar component so that's Avatar Avatar fullback and Avatar image after that let's import everything we need from the dropdown menu component so that's drop down menu drop down menu content drop down menu item and drop down menu trigger while we are here in the Imports let's also import the dotted separator and finally let's also import our use logout and a and use well not use get user uh use current like this from use current like this so that is our API which we've just created recently which fetches the current user from out end point there we go now let's export const user button here and inside of the user button we're going to go ahead and do the following we are first going to fetch the user using Ed current and then we're going to do if is loading we're going to go ahead and return a specific view so inside of here I'm going to go ahead and return a div with a class name size 10 rounded full Flex items Center justify center background neutral 200 border and Border neutral 300 so basically I am creating a placeholder for what we will have here below the loader now let's add loader which you can import from Lucid react we have lucid react installed when we set up shat CN so just double check that you have lucid react installed now that you have the loader here go ahead and give it a class name size 4 animate Spin and text muted foreground like this and then inside of here let's go ahead and let's actually uh return our Avatar component which will have an avatar fullback inside and inside of here we are very simply going to destructure the name and email from the user which we have loaded above and let's just see so I have the user here and I have name uh property name does not exist but it's pretty obvious that it does exist here uh is that because I have to let's see okay not sure why let's go and leave it like this for now con avatar for back here will be name name character at zero to uppercase otherwise we're going to use the email character as zero to uppercase Cas if we can't do either of those we're just going to default to letter U for you know user uh all right and I think I know why this is happening so in case we cannot load the user at all we're not going to load anything there we go now my linter is fixed excellent now let's go ahead and let's put the AAR fullback the inside of the aat for right here and now we're going to go ahead and style this so first of all the Avatar itself will have a class name of size 10 on Hover it's going to have an opacity of 75 it's going to have some transition properties a border and Border neutral 300 the Avatar fullback will have a class name of background neutral 200 font medium text neutral 500 Plex item Center and justify Center like this and now let's go ahead and let's go inside of our page. DSX instead of the app folder and instead of rendering any of those let's just render the user button component from features out components user button like this and there we go now we have a nice us user button here because we are logged in so make sure that you are logged in while doing this let's go back inside of our user button and let's now turn this into a drop down menu so I'm going to wrap the entire thing instead of a drop down menu like this I'm going to give this a property of model pulse in case we want to use it inside of some drop down other drop- down menu components sometimes this property can cause uh the body to freeze with uh an overflow hidden now let's go ahead and let's wrap the Avatar instead of a drop down menu trigger component so the entire Avatar like this and let's give this a class name of outline none and relative now let's go ahead and let's add a drop down menu content with align end side bottom class name width of 60 and the side offset of of 10 so that's our drop- down menu content inside of the drop- down menu content we're going to create a div with a class name Flex Flex column items Center justify Center Gap to PX 2.5 and py 4 inside of this div right here we're going to go ahead and just copy our avatar from here let's just copy it and let's put it here like this and I think that already we should be able to click here and get our Avatar right here there we go let's go ahead and expand this and let's code this further the only thing I want to change in this Avatar inside of the drop down menu is hover and opacity so we don't need this here and we can change this size to be 52 pixels like that and we can go ahead and add a text Excel here like this now let's go ahead and let's go outside of the Avatar and let's add a div here with a paragraph which will either render the name of the user or simply user now let's go ahead and let's give this a class name of text small font medium and text neutral 900 and let's give this one a class name of flex Flex column items Center and justify Center because below this paragraph we're going to have another one which will render the email and I misspelled Center here there we go now both of them are centered and let's give this give a class name of text extra small and text neutral 500 just like that now outside of this div still inside of the drop down menu content we're going to have a dotted separator here and we're going to give it a class name of margin bottom of one I will just zoom out briefly so we can see this better I will then add a drop down menu item here and I will very simply add a log out from Lucid react so make sure you've added this and I'm going to give it a class name of size 4 and Mr of two it's going to be a self closing tab and add a log out method here as well now let's style the drop down menu item to have a class name height of 10 Flex items Center justify Center text Amber 700 font medium and cursor pointer like this and now I'm going to go ahead and I'm going to add mutate log out use log out which we've added an import for right here and now let's use this log out method here as well so I'm going to collapse this drop down menu class name here and I'm going to add on click here to call the log out method like this there we go we've created a very nice and re usable uh user button and we don't need the a image here there we go now we have the functionality to log out from here so I can now log out and I should be redirected back so I can log in again and the problem is still here that we don't get redirected to uh the dashboard page once I log in right so let's go ahead and fix those things now and here's the thing so I told you that I really don't like the solution where I have to use use effect to redirect the user so I really really don't like this so let's start by kind of removing stuff here first of all we are no longer using use logout here let's remove that the second thing we're going to remove is well everything we don't need any of this inside let's remove this let's remove this and this and this and let's remove use client so make sure that inside of your user button you have use client otherwise you're going to get some errors here and now let's go ahead and re rethink how we can work with this so by default every page and component inside of app folder is considered a server component this gives us an advantage because technically what we can do now is we can create a special util we can call only in server components which can be served as authorization check X I'm going to show you exactly what I mean so instead of calling hook which will get the current user we could for example check for a cookie and redirect the user if they don't have a cookie but that's not the safest thing to do let's actually do this let's go ahead and visit our session middleware here so our session middleware has this client it has the session where it gets the cookie and basically this session middleware is optimized for hono right if uses get cookie from hono cookie so we're going to do a similar thing but we're not going to treat it like an API endpoint let's go ahead and see what I mean so we're going to go inside of features inside of Al and I'm going to go ahead and I'm going to create a new file called actions. DS inside of here I'm going to mark this as use server and I'm going to export const get current this is going to be an asynchron method and inside of here I'm going to go ahead and do the following I'm going to set up my client again like this from node app right and then I'm going to go ahead and get the session not using hono cookies but by using cookies from next headers like this now depending on which version of no next you are using because in next 15 you're going to have to a weight cookies so I can write a weight cookies and I have a little note here a weight has no effect on this type of expression but if you're using nextjs 15 I'm pretty sure uh that you're going to have to await the cookies to get them to work so just hover over cookies and see what you get if you get a promise around here you most likely have to await cookies but I think that I can await them as well so you can just write it like this this will have no effect if you're using U next version that I am but in case you're using a newer version you have to await a lot of stuff which you usually didn't have towait in next 14 so let's go ahead and get our out cookie here like this and then we're going to go ahead and do if there is no session we're going to go ahead and return null and then let's go ahead and let's define our account right here and we have to import account from node app right so account and client from node app right and then we're finally going to do account await account. getet just like this and if you want to you can also wrap the entire thing inside of try and catch and simply return null in case any error happens all right and now let's go ahead and let's do the following let's go inside of our page. vsx in the homepage right here make sure there is no used client at the top and we're going to now turn this into an asynchronous Method Keep in mind that you can only do this in server components if you were to mark this as a client component uh you will most likely get an error there we go I briefly got an error here I don't know why it's not appear in right now but you cannot use uh asynchronous and use client at the same time so just make sure you remove that so now that you have a synchronous here what you can do is you can get the current user or you can just mark it as user and you can now call the get current method from features out actions and if there is no user you can redirect using next navigation which can be used in server components and simply redirect the user to slash sign in just like this so now I'm going to go ahead and log out and I'm going to refresh and let's see what happens it looks like I'm still getting a user let's see if that is true so I'm going to go ahead and scroll all the way down and debug what's going on so I have get current right here so I'm going to go ahead and see inside of my page. vsx what happens uh with my user here perhaps I'm still getting something but I should not be getting that uh looks like I still have something here and I think that's because I didn't await get current my apologies let's try this now there we go I immediately get redirected yes so we have to await redirect here there we go so I'm going to go ahead and try this again if I go back to Local Host 3000 I am in immediately returned here there we go so that's how we handled that if you want to you know you can rename this to protect for example and then inside of here you can do redirect to something if you want to depending on but if you're using redirects keep in mind you cannot use them inside of try and catch that's one kvat with using a redirect from nextjs so I'm going to be explicit in my uh oops I think I modified something so yeah get current so I'm going to be explicit in my tutorial here I'm just going to call the user and then I will manually redirect here it's two lines not too much code if you ask me and now let's do the same thing instead of our sign in and sign up Pages here so I'm going to remove use client actually here which means that I have to go instead of the signin card and mark the signin card as use client instead there we go now I no longer have the error here I'm going to mark this as an asynchronous uh function and I'm going to get the user using get current from features out actions if I have the user this time uh my apologies await don't forget towait if I have the user I'm going to redirect using next navigation to the root page which will be the dashboard just like that there we go and now I'm going to copy this and I'm going to go inside of my sign up page right here I'm going to remove use client here I will go inside of sign up card and I will Mark sign up card as use client as well so first of all confirm that that is fixed go inside of sign up there we go no errors on the sign up page so now I'm going to go ahead and do the same thing here I will mark this as an asynchronous function and I will get current from features out options and redirect whoops redirect from next navigation like this there we go and let's briefly go inside of signup card here and let me just change the button which I have here which says login to register there we go let's go ahead and try this out now I'm going to go and sign in now and I will do Antonio mail.com Antonio 1 2 3 4 5 6 78 let's log in and looks like I am still not getting redirected if I refresh still okay let's see what I did wrong maybe I entered a wrong password so we also have to have handle those States as well but I first want to debug whether I did something wrong or not uh so this is my sign in page if I have the user I will redirect to the root page so I will console log the user here and let's see do I have the user or not I will refresh this page I will scroll down looks like user is null so perhaps I have entered a wrong password let me try one more time here nope looks like it's still not working I will go ahead and try this so my login seems to be success true and inside of my application here I seem to be having a cookie but it looks like I'm just not getting uh redirected so I'm just going to go ahead and pause and debug this and tell you how to fix it and how I debugged it well I think I know what is the issue so let's go back inside of our uh features out actions here and we've wrote this incorrectly because if you take a look inside of the session middleware here uh we forgot to add client set session right we don't do that here at all we immediately get the account here so let's do session Set uh which one is it a client set session and pass in the session. value here like this and there we go now I am immediately redirected let's go ahead and try this again so if I go to slash sign in I immediately redirected back same thing for SL sign up but if I log out from here let's see if this works okay so this works after refresh so let's see how can we uh improve that from happening well here's a solution that I like to do here because I I did this in my original source code we're going to go inside of my uh use log out method and this is what I'm going to do I'm just going to do window location reload like this this will invalidate all queries without me having to do them it will ensure that user doesn't have any you know Global States set and it will simply clear any you know Global States right and it's kind of a Brute Force way of doing it but honestly it saves so much time and you don't have to worry about whether you refreshed or done anything wrong so let's try this again I will log in uh okay looks like we have the same issue for logging in all right my apologies looks like I didn't exactly calculate this as well as I thought looks like they work after you refresh so I think they log out now there we go log out now is working because of this so we could do this but I think there is a proper uh react uh nextjs way of doing it so there is a method called router. refresh which is supposed to uh refresh all server components which would technically uh refetch this so let's try with that solution first if not we're going to go ahead and trigger a window location reload instead of use login as well but first let's try this let's get the router from use router from next navigation here and and inside of here I'm going to do router refresh let's do that first and we no longer need the query uh actually let's keep the query client yes and then let's do query client invalidate queries again query key and let's give it current value let's go ahead and copy this let's go instead of use login and let's do the same thing make sure you import the router from next nav ation don't import the router from next router and inside of here on success I'm going to go ahead and call router refresh just like this and we can also copy the invalidation for this and for that we also need a query client so con query client use Query client from T stack uh react query let's try both of this again now make sure you are testing the login route right now let's hope this works if not we'll just fall back to window reload and there we go so router refresh seems to uh have its magic on perfect thanks uh I'm I'm thankful we don't have to use the window location reload because it's kind of an ugly solution it works it's great I used it initially in my source code but I just remember that we have a proper way of refreshing our server components great and now I have to do the exact same thing for my use register so let's do that let's add use Query client let's add use router from next navigation I will move both of these here and let me just copy one from on success here there we go perfect so what I want to do now is I want to go back inside of my sign uh sign in cards here and I want to see if it's possible for me to uh oh I can actually extract is pending here and I want to disable all of my Fields if it's pending like this actually we don't have to disable all fields we just have to disable the button so disabled is pending and the same thing for the login with Google and login with GitHub because they are a single click you know so let's try this again maybe we're we're going to have some better experience now so now if I click login there we go it's disabled and then it redirects so this is at least telling the user that something is happening and I now want to do the same thing to the sign up card here so let's this structure from use register is pending like this and let's go ahead and let's assign it to not the inputs but just the button here and these two buttons here as well uh great so I now think this will work even without testing here perfect and we have very nice uh redirects from the homepage and from the out screens now at this point you might be wondering why did I not add a middleware well I've been you know using middle words in some of my tutorials but lately I've been trying to avoid them and there's a reason for that maybe avoid them is not the correct term I'm not avoiding them but I'm definitely not relying on them and this blog post by pilcro who is the author of Lucia Al is honestly a perfect explanation and and basically my way of protecting pages from now on is simply being explicit so you're going to see me write authentication inside of each page and if you personally find it too tedious to do that in in each page just keep in mind you can always create an abstraction right if if those two lines are too much you can always go ahead and add the read irect to be done directly inside of the actions right here so you can redirect the user here but I am no longer going to rely on the middleware the reason being quite simple I don't want to assume my middleware is protecting all of my routes I want to explicitly protect my routes I want to see them being protected right uh at the end of the day it doesn't really matter it sounds funny when I say that but our most important layer is protected that is the server now I'm also handling the protection on the client side as well and I'm going to do that explicitly I'm not going to do it through the middleware does that mean that you should not be using the middleware no using the middleware is great if you want to enhance user experience right so if you want to have three layers of security so individual page layer a middleware layer and API layer great the more the merrier but don't rely on the middleware I personally regret that my website personally uh runs entirely on middleware protection because honestly I'm unsure if everything that I want covered is covered this would not happen if I just explicitly added just like I do in my API routes you know with the keep in mind that when I say middleware I mean on the middleware in nextjs I I don't mean on the middleware concept in Express or in uh hono right so those are different types of middle wor also nextest middleware lives in a different runtime than the rest of your app that's also important thing to know there have been reported security issues because of the middleware itself and here's the most important thing of all you might got a brilliant idea well I could just put it in layout right do not do that at all that is the worst of all three Ops options and the least safe uh way of doing it I highly suggest that you read on authentication in nextjs and as always I think you can go wrong with just being explicit you know if you want to protect the sign-in page protect it if you want to protect the dashboard page protect it that's why we you know learned how to uh how to work with server components and how to Simply fetch the current user using a server action right if even though I think this is technically not a server action this is just you know we could we could have written this entire thing you know directly here if we want to do it's just a lot of code to repeat so that's why we're not doing it uh and I think we don't need use server here use server is used when writing server actions these are not server actions so we don't need that it's still going to work just fine so that's the reason why I'm not using the middleware so again we're going to be using explicit authentication for each page in this tutorial if you want to you can create an abstraction around these two lines like something like I don't know server protect and then have props to be pass as to where to redirect if authentication is missing or if it's not missing you can do that if you want to uh great so we have that working uh I'm going to link this or you can you can Google this exact title if you want to read this very interesting article and now what we're going to do next is now that we are finally logged in is we're going to start developing the sidebar great great job the first thing I want to do in () order to build my dashboard layout including the sidebar and the navigation bar is to move this page. TSX file in its own route group just as we have the out route group so I'm going to do that by creating a new folder dashboard and let's just not misspell dashboard and I'm simply going to drag and drop page. TSX inside just like this and now I have this weird unsaved file let me just remind you that is from Cache right so you can just save this file and close it no biggy and now if you if you refresh nothing much should change everything should still work as expected and now inside of this dashboard I want to go ahead and I want to create a layout. TSX file and inside of here I'm going to create a dashboard layout and inside of here I'm going to get my children let's quickly create an interface dashboard layout props with the children here which are react react node let's go ahead and assign these props here and let's add a div and children inside and nothing much should change you should still see your user button right here great and now let's go ahead uh and let's actually create our sidebar and our knf bar so I'm going to go ahead and give my entire layout a minimum height of screen meaning 100 uh VH as you can see here and then inside I'm going to go ahead and create a div here another one with a class name Flex full width and full height I'm going to move children inside and then I'm going to wrap children inside of a div here and this div will have a class name on large devices it will will have a padding left of 264 pixels now in order to try this out make sure you are zoomed out and you should see a big padding next to your user button here so make sure you are zoomed out if you are zoomed in you looking at the mobile view so make sure you always have enough space left I'm now just going to collapse this so you can see the code now what I'm going to do here is I'm going to prepare my to-do Navar like this and I'm going to add a main element here around my children and I will encapsulate my Novar and my main element in another div which will handle how far these two can expand so we're going to use MX AO and Max with screen to Excel and height pull and if you remember we already used this trick inside of out layout uh right here MX AO Max withth screen so let me remind you what that does so you can see how this is following my screen expansion the user button right and you can see how how I zoom out it's also following to the to the left but at one point uh it will stop expanding right so that's basically what we are achieving right here excellent so Max screen to excel MX AO and height full great and let's go inside of the main element here and let's give it a class name height full py of 8 PX of six flex and flex column just like that great and now let's go ahead and let's actually create our little uh nov bar here so we're going to do that outside of this div which pushes our uh content so we're going to create a div here with a class name fixed uh fixed left zero top zero hidden large block large width of 264 pixels which is the same amount that we push our content for height full and overflow y Auto so we can scroll inside if it overflows and then we're going to add a sidebar component inside now let's go ahead and let's actually develop the sidebar component so I'm going to go ahead and I'm going to go inside of features and I will create a new feature called uh actually we can go and do this in components yes perhaps this is a better solution so let's go ahead and create a sidebar uh. TSX component here and inside of here I'm going to go ahead and Export con sidebar I'm going to Simply uh return an element uh called a side not div and let's go ahead and spell sidebar inside I'm now going to go back inside of my app folder dashboard layout and I will import the sidebar from components sidebar so there we go now on large devices I see a text sidebar right here great let's go inside of the sidebar and let's actually develop it so I'm going to give this a class name height full background neutral 100 padding four and with full and then I'm going to add a link from next link here with an hre to the root of the page and I'm going to add an image from next image here and I'm going to add our logo.svg with an ALT of logo and a width of 164 and a height of 48 like this so now there we go we have a nice logo here and it's the same one that we had if you remember on our out screens great so we have that and now outside of this link let's add a dotted separator here let's go ahead and give it a class name my4 and then in here let's add navigation component so I'm going to go ahead and create that in components as well navigation. DSX like this let's go inside of the navigation here and let's go ahead and just just create a constant called routes like this inside of here we're going to have a label home oops this is supposed to be an object so the first object will have a label of home as in homepage and hre will just be an empty slash you're going to see why later and then we're going to have two types of icons one will be uh the outline icon and then we're going to have an active icon so for the first first icon I'm going to use go home and then I'm going to use go home fill we can get both of this from our react icons so go home and go home fill from react icons go and I think we installed react icons I don't know where but just make sure you have react icons installed great uh so we have that perfect and now let's go ahead and let's copy and paste this let's add an h/ tasks here to be my tasks like this and let's go ahead and change this to be go check Circle and this one will be go check Circle fill make sure you you're adding these Imports here after that we're going to have settings which will go to/ settings and they can use use the settings icon from Lucid react and it can be the same for the active icon because we're going to redirect to a different type of layout you're going to see that later and lastly we're going to have members and for this we're going to have the users icon also from Lucid react and you can repeat the same one for the active icon make sure you have added all of this Imports and now let's export con navigation and let's actually uh render this so we're going to create a div with a class name Flex Flex call or actually we could maybe use an unordered list let's do that and then inside of here let's use routes. map and let's get the individual item here and we're going to go ahead and do this we're going to open like this and then we're going to return the reason is because later I'm going to create some constants here like uh is active right so for example let's just set this to false and inside of here I'm going to use the link from next link so make sure you've added an import for that as well there we go inside of here we're going to go ahead and give it a key of item hre and an hre will for now be item H we're going to change that later let's add a div here which will very simp simply have our icon which will be defined here so make sure you use icon with a capital I so it can be used as an jsx element and this will simply be item. icon or we can already do it so if is active it will use item icon active icon otherwise item icon and then inside of here we can render that icon like this and below that item. Lael let's give this icon a class name of size 5 and text neutral 500 and let's go ahead and give uh the div here class name using CN Library so make sure you import CN from utils first let's add the default classes which will be Flex items Center Gap 2.5 padding 2.5 around it medium font medium hover text primary let's add a transition and text neutral 500 so these are our class names for the first div and then let's add a comma at the end of the first class and let's simply do if is active background white shadow small cover opacity 100 text primary like this uh great so let's add that now let's go inside of sidebar and let's import the navigation from do/ navigation like this and I'm going to expand and there we go we now have a nice sidebar here on our hands of course if you click on any of these you will most likely get a 404 error so make sure uh that uh I mean don't be surprised if you get an error we're going to create those pages uh later uh great so we have that uh let's see is there anything else we can do uh I think we can leave it as as this we're going to come back to this later now I want to go back inside of my dashboard layout and I want to build uh this Novar component now so let's go ahead and let's remove this to-do comment with an actual nvar component like that and let's go inside of our components and let's create a navb bar. DSX I'm going to export con Novar like this and instead of using div I will be using the nov element and before we start styling this I want to go back to my layout just save this file go back to the layout and and import the Navar from components Navar so you can actually see what you're developing now I'm going to go ahead and give this na a class name padding top 4 BX of six Flex items Center justify between I'm then going to go ahead and create a div with a class name Flex Flex column hidden Buton large Flex so we just need Flex go my apologies like this after that add an H1 element which will render for example home and a class name text of 22 pixels or we can simply use extra large let's see how much is that that's 20 pixels uh 2 Excel is 24 let's use that and let's also give it a font semi bold and below that a paragraph for example monitor all of your projects and tasks here and let's give this paragraph a class name of text muted foreground if you want to see this just make sure you are zoomed out right so I'm in Mobile mode so I can't see it but there we go home monitor all of your projects and the tasks here great and now what I want to do is I want to add a user button here and let's import the user button like this and then let's go ahead and let's go inside of our page. DSX where our dashboard is and instead of here rendering the user button we were just going to say this is a homepage and let's remove the import for the user button so there we go now we have uh a better experience here but this is supposed to be all the way here why is it not let's go ahead and fix that I'm going to go inside of my navbar here and I want to see whether we are missing something so we have Flex we have justify between here let's see if our layout uh seems to be missing something and I think that we have to add uh with p did this LG right here inside of our dashboard layout so just add with full here and let's see if that fixes it there we go so now as you can see in this corner I have my user button and here I kind of have my title and description for the current page of course we're going to make this Dynamic later and if I expand you know uh at a certain point you can see that it stops expanding as close to the sidebar as possible so you know on certain break points it follows but then when it gets you know too wide it will no longer uh expand unreasonably much because design simply can't look good except you know if you have a designer who can of course create widescreen uh Solutions and while we are here I want to create a solution for the mobile sidebar because in Mobile the user button is moved here but we can fix this quite easily so let's go ahead and create the uh mobile sidebar so let's go inside of our source components and let's create a mobile Das sidebar. TSX component and let's export const mobile sidebar like this and I'm going to mark this as use client let's go ahead and let's add a sheet component from /ui sheet and we're also going to need two more components from here so content and Trigger and inside of here let's go ahead and give it a model pulse here because this can cause some overflow issues and let's go ahead and add the trigger component here and let's add it around a button component from /ui button let's go ahead and add as child here so this trigger becomes the button because the trigger component is already a button so you would have a button inside of a button and this will cause a hydration error so just add as child prop there let's go ahead and give the button a variant secondary and let's give it a class name LG hidden so it's only visible on mobile and let's add a menu icon from Lucid react here I'm going to separate this content there we go and while we are here let's go quickly back to the nav bar and above the user button let's add mobile sidebar from do/ mobile sidebar there we go you can now see this button right here uh and let's go ahead and let's give this button an a size icon while we're here there we go and this menu icon will have a class name of si uh of size four and text neutral 500 there we go like this and I'm going to do this I'm going to give this button a class name size 10 or maybe size eight oh it already has a class name let's see so can I do size eight here okay I'm going to do this I'm just going to roll back and give it the size of Icon here like this and now let's add a sheet content and let's simply render the sidebar from do/ sidebar inside just like this and I'm going to go ahead and give the sheet content a side of left and a class name of padding zero like this so now on a mobile when you click here there we go it opens a nice uh sidebar here great so let let's go ahead and let's just uh see if I go into actual mobile mode I think this button might be a bit small so I'm going to go ahead and do this I'm going to just going to remove size icon I think it looks okay and let's give this a size five okay that just enlarges the button so let's keep it a size four okay uh great so now I think yeah now it's it's much easier to click on mobile uh great we have some errors here we can resolve those later they're just semantic issues I believe great and now that we have that uh I think we are ready to close this chapter and I just want to add one more thing here so const is open and set is open use State react and let's give it false by default let me just move this here and I'm going to add path name from use path name so every time that we actually change our route I will want to close this side bar and this is like a Brute Force way of doing it so every time we detect a change in the path name we're just going to call set is open to false so we're going to go ahead and extend the sheet to be open when is open is true and on open change will simply control the set is open method so this sheet trigger will uh call set is open and set it to true and when we click close somewhere it will set it to false or when use effect happens it will set it to false so you can see that this still works just fine great so you just handled the mobile view and the desktop view of the sidebar and the nbar you can go ahead and log out and you can see all of this things are working just great again don't worry about um Google and GitHub login we'll do later we are right now focusing you know on adding as many functionalities to this project as possible uh great so we have the uh dashboard layout ready and we are now ready to build our first workspace and create some onboarding screens great great job now let's go ahead and let's create () our workspace entity and our workspace creation form in order to do that you first have to go back inside a of your app right console go ahead and select your project here and head into the databases section go ahead and create your first database I'm going to go ahead and give this a name of jira Clone and I'm going to leave the custom ID field as empty and click create after that I have my jro clone database right here so once you click on databases again you should now see your database ID right here let's call Cy our database ID immediately and let's go inside of environment. Lo here and let's assign it to next public app database ID like this now let's go inside of here and let's go ahead and create a new collection we're going to call this collection workspaces and let's click create let's go ahead and uh go back just so so we can see that we now have a new collection so we now have a database inside of the database we have a collection right here and we can already use this collection ID for the workspaces so let's copy The Collection ID here and I'm going to go ahead and just separate these things so let's go ahead and add next public app workspaces ID and let's add it right here like that so we now have the workspaces collection ID here and now we're not going to create any documents but what we are going to create are some attributes so let's go ahead and click create an attribute and let's go ahead and call this a string so we're going to give our workspace entity an attribute called name and I'm going to limit it to a 256 characters at most if you want to you can limit it at 10 so I'm going to go ahead and make this a required uh attribute so make sure you have added uh you have checked this as well and make sure you've named it name let's go ahead and click create after that let's go ahead and let's add a user ID property so that we can keep track which workspace belongs to what user and user IDs in workspace are limited to 50 so we can safely put 50 here and set it as required as well in case you're watching this into the future and this has changed you will get an appropriate error in your terminal here when you try to create a workspace and you try to assign a user ID but I think 50 should be just enough in case it's not you can go back here and increase it to whatever you need I'm not going to do that now great so we now have the name and the user ID for our workspaces collection what I want to do now is I want to use these database ID and workspaces ID and I want to create them into reusable constants so that we don't have to write that all the time so let's go instead of source and inside of here create a config dots and let's write export cons databases ID and let's go ahead and give it a my apologies database ID because we working with one individual database and let's give it the process. environment and let's revisit our environment. loal and copy the app database ID here and you can put the exclamation point at the end to avoid uh so when you hover over here it must be a string and then let's go ahead and Export con workspace ID like this actually it's the collection workspaces ID so this will be process. environment and then copy next public app right workspaces ID and put the exclamation point at the end so this way we can easily uh just use these instead of having to write this every time great now let's go ahead and let's create our API endpoint for this so we're going to go inside of features and we're going to create a new feature called workspaces here and inside of here let's go inside of features and let's create our schemas dots file let's go ahead and let's import Z from Zod here and let's go ahead and Export con create workspace schema to be a z. object let's give it a name of Z string let's stream it and let's give it a minimum value of one and make sure it's required besides that uh we're also going to have a user ID but we are not going to pass that through any forms or through any API payloads so we can just leave it at name for now great we now have the schema and now let's go ahead and let's create a server folder here and let's create a route. DS let's import hono from hono and let's go ahead and create a const app new hono and let's export default app here now that we have our workspaces server route we can go inside of the app folder API rout route. TS and inside of here we can now import workspaces from at/ features workspaces server route and then we can chain it just below out with a prefix of workspaces so just be careful you know don't misspell these things even though it won't really matter because we are using types saave rpcs now we can go back inside of our workspaces server and let's go ahead and let's create uh a very simple post route so you can just put an empty forward slash because this will be slash workspaces because our base endpoint is slash workspaces here so you don't have to Define workspaces again let's go ahead and let's add a z validator here for our Json and let's go ahead and add our create form create workspace schema and then finally we're going to have an asynchronous context here and now we are also uh we also need to add our session middleware here so let's not forget that let me just reorder my imports here there we go and now let's go ahead and do step bystep uh creation of the workspace so the first thing I need to do is I need to get my databases so I can get my databases thanks to the session middleware here because we create the databases with a new client here so let's go ahead and do const databases to be C.G databases like this and let's go ahead and get the user from C.G user since we have type safety you can see that we have all the necessary information about that here then let's go ahead and let's destructure the name from C request valid Json like this and then let's go ahead and actually create the document so const workspace will be await databases do create document in the first argument we're going to pass in which database to create a document in so let's add our database uncore ID from our config file the second argument is which collection which is our workspace id workspaces id again from the config file and then finally we assign the ID of this document and we can use randomly generated IDs using the ID import from node app like this so let's just add id. unique and execute that method and then finally we can open the body object and we can assign the name and since it's the same name as the key we don't have to write name name we can just write name like this there we go uh great so now we have our document created and we can just do return c. Json data workspace just like that remember if you put a comma here you're going to lose your type inference from the middleware so just don't put commas at the end of your middle Wares great we have this ready now so what we have to do now is we have to create our API uh by API I mean my react query mutation so let's go inside of features and let's copy from the API folder in out let's copy the use login one let's go inside of workspaces let's create a new folder called API and let's paste use login and let's rename it to use create workspace let's name the content inside use create workspace always double check that you have the proper file opened so just close use login so you don't accidentally modify it now we have to create the response type and the request type here so we are not going to go inside of api. out but we're going to go inside of api. workspaces and then we are directly going to go uh to the post method here so the response type there we go as you can see is is our uh created workspace and request type is Json requesting a name in the mutation function here we also have to modify the same thing so workspaces like this and what we're going to do here when we uh create workspace I'm going to go ahead and add workspaces here basically this doesn't yet exist but we are going to have uh a different use get work workspaces which will use the query key workspaces so when we create a new one we're going to make sure to refetch our workspaces so for now this will not do anything but later when we add a use get query with this key it will refresh and we don't need router refresh to happen here so you can remove that and remove the use router from next navigation great so we now have this and now let's go ahead and let's actually build our form so we're going to do that instead of source inside of features inside of workspaces let's create a new folder components and inside of here we have to create uh a new form so create workspace form. TSX let's go ahead and let's create our interface here so interface create workspace form props are going to have a prop called on cancel why am I adding an oncancel prop to a component which is supposedly just a form to create a workspace well I want to reuse this form in many different ways one including being opened in a model if it's opened in a model we have to give it some proper instructions on how to close that model from the submitting or cancelling inside of the form right so that's the only reason why I am adding that and I don't want to forget it later so that's why I immediately added it let's go ahead and add create workspace form here and let's destructure our own cancel create workspace form great now let's go ahead and let's define the form to be use form from react hook form inside of here we're going to get go ahead and create a resolver to be Zod resolver from Hook form resolvers Zod and we're simply going to use create workspace schema fromt do/ schemas the default values will be a name with an empty value here just like that I'm now going to go ahead and give it a type so Z from Zod make sure you've added an import for Zod do infer type of create workspace schema uh did I do this correctly no not here my apologies not in the Zod resolver in use form there we go now let's go ahead and let's create an onsubmit method with the values which have the exact same Z infer here if you want to you can set that aside in a reusable type if you don't want to type it two times and we're just going to do a console log of the values inside of this onsubmit method here now let's go ahead and let's create our layout for this so we're going to return a card element from components UI card so make sure you add Imports for this and while we are here let's also add the rest of the Imports which we will need card content card header and card title like this and we are also going to need all the items from our form so import form form control form field form item form label and form message from at/ compon components SL ui/ form like that and do I have a mistake here I do create workspace form props my apologies for that let's go back inside of our card here let's give the card a class name full width full height border none and Shadow none inside let's create a card header let's give it a class name flex and padding of seven let's create a card title inside let's give the card title a class name text extra large and font bold and let's write create a new workspace like this below this let's add a div which is going to encapsulate our dotted separator alongside with a vertical or horizontal padding s dotted separator let me just move it the along side here there we go doted separator and then card content with a class name padding 7 just like this and I want to stop here because I want to see what I am developing so we're going to go inside of app folder inside of dashboard inside of page. DSX and let's go ahead and add our create workspace form here let's give it an unan cancel to just be an empty Arrow function like this so let's go ahead and go inside of our Local Host 3000 let's refresh and let's see what's going on so I believe the issue is that my create workspace form uh is a client component and this is a server component so what we have to do is go inside of our create workspace form and Mark it as use client and now the error should go away uh oh but we are passing this on cancel all right this is what we're going to do for now we're just going to go ahead and make this an optional prop like this so put a question mark here then we don't have to pass this and then there we go we can now just see create a new workspace here and if you want to you can give this entire Diva class name of background uh muted or maybe background neutral 500 and just give it a bit of a padding padding four and a height full Maybe maybe there we go just something so you can see you know our actual card obviously it's not going to look like that but I just want to give you an idea of how it's going to look great so we now have our card content and now inside of here we are going to establish our form let's go ahead and spread the form element inside let's define the native form inside with a class name my apologies with an onsubmit form handle submit and pass in our onsubmit which we have the find right here basically the same thing we did in the sign up and sign in cards now let's add a form field which is a self closing tag which will have a control or form. control it will have a name of name and a render which is going to immediately destructure field in its method here and return a form item the form item will include a form label this time with a text workspace name and Below form label we're going to have form control which will include an input from components UI input so just make sure you have included this in your inputs as well like this and let's go ahead now and give the input a placeholder enter workspace name and make sure that you are doing the spread of field like right here and outside form control don't forget form message so we can display the errors right here so now let's go ahead and let's add our uh submit button here so this is how we're actually uh going to do that we're going to go ahead inside of this form and let's add a div here encapsulating this single form field and let's give it a class name Flex Flex call and GAP y of four and inside of this div at the bottom we're going to add uh well let's do it like this we're first going to add a dotted separator like this and let's go ahead and add it outside of this div which is encapsulating this form field so you might be wondering why did I even add this div well because later we're going to have some more fields for the workspace so make sure you have encapsulated your form field in this div and then you've added a dotted separ here with a class name of py7 and then add a div with a class name Flex items Center and justify between now let's go ahead and let's add two buttons here again confirm you have the button import ready uh do I have my button where is my button imported it's not okay make sure you've imported button from components UI button I'm going to go ahead and move it here alongside with the input and the first one in this list will be the cancel button which will be our type button this is very important because by default it will submit the form if you don't explicitly give it a type of button and we're going to go ahead and give it a size of large we're going to give it a variant of secondary like this and on click will be our on cancel method like this and then you can copy and paste the button here and you can go ahead and remove the type for this one or you can give it an explicit type submit if you prefer it that way and the variant here will be primary which you don't have to explicitly uh right and we won't have an on click because it will serve as a submit for the form and let's go ahead and give it a label of create workpace like this there we go and now let's go ahead and actually try this out so right now if I click create workspace there we go I get an error that the workspace name is required thanks to our schema now let's go ahead here and let's add our mutation so const mutate will come from use create workspace from do/ API use create workspace so basically it's this API which we've created recently which invalidates the non-existing workspaces query key for now in here we have mutate and let's also get is pending from here and very simply we're going to go ahead and call the mutate method here and pass the values as the Json prop and now let's go ahead and disabled our buttons here if we are pending like this and same thing for this one let's go ahead and try this out I'm going to go ahead and prepare my databases my collections workspaces which currently has no documents inside and I'm also going to prepare my network tab here so I can see if any errors arrive let's go ahead and create a test workspace and click create workspace and looks like I do get a 500 error and it looks like my user is unauthorized to create this so why is that happening and how can we resolve it well that is the security that I was talking about how we should be careful which client of aight we are using H and we should give uh and which CL which ight client should we give our user access to so inside of our lib we have the admin client which is the allmighty all powerful client which can do anything even though we have restricted the API key to only be able to create sessions but inside of our session middleware we create a different type of client which is only as powerful as its user so for example we never gave this user permission to write to our database so we have to do that let's go inside of workspace right here let's go inside uh of our settings make sure you are of course in the workspace collection so go inside of your databases find your new workspace collection go inside of settings here and inside of here you have permissions you can click the big plus and go ahead and select all users so all users can create read update and delete this like this and go ahead and click update there we go now go back to documents here let's go ahead one more time I'm going to open my network Tab and I think this time it's going to work I don't even have to refresh I believe and again looks like I'm having a 500 uh yes invalid document structure missing requiring attribute user ID yes my apologies I forgot the user ID let's go ahead and do that and then let's quickly add some you know error feedback here to the user because user has no idea what's going on here and I think we also forgot to do that for login screens so I'm going to go inside of my uh server for my workspaces so inside of features workspaces server route. TS and inside of here I prepared the user but I'm not using it so I'm going to go ahead and add a user ID to be user Dot and here's a quick tip inside uh app right we don't use do ID we use dollar sign ID like this of course if you're watching this far into the future and this changes you know just look at what you have autoc completion for if you have ID you can use ID and I think that now we should finally be able to create this third times the charm let's go ahead and click create workspace there we go 200 and we have a new workspace right here so now if I go inside of my workspaces here and refresh there we go we have a name test workspace and my user ID right here in case you got any additional errors go ahead and look in the terminal and simply see what is the message just say if it says that the user ID is too short or too long perhaps you have to go inside of the attributes and confirm that your user ID has the proper size maybe you have to increase it and update it depending on when you're watching this video uh great so we have that resolved and now what I want to do is I want to add some uh error messages and some success messages so let's go ahead and do the following we already have uh something called toaster I believe instead of my package Json I already have soner installed because I installed that with shaten so if you by any chance don't have that you would go ahead and use uh banex shaten uh I have no idea what is my version so let me just see 2.1.0 so bux D- bun chaten at 2.1.0 add soner that's what you have to add in case soner is missing from your components here you should also have uh a toaster I believe uh but let's go ahead and let's just see how we have to implement this so we're going to go ahead inside of the app folder inside of layout. DSX right here so make sure you're in your root layout for now and let's go ahead and let's import toaster from components UI soner so if you have components you are soner you have definitely installed soner right so you can command click or control click inside or simply find it in the component UI here you now that you have the toaster go inside of the query provider and simply add the toaster inside and self close it that's it nothing else you have to do and now let's go ahead inside of source inside of features inside of workspaces API use create workspace and let's go ahead and let's import tost from sonor and in the on success let's add toast. success workspace created and on error let's go ahead and add a toast. error failed to create workspace just like this so let's go ahead and try this now you can see nothing happens but if I write test I should get uh a nice toaster let's see there we go I had to refresh and now it says workspace created here and you can go ahead and try with an error so if you go inside of your server not Al but inside of your uh well we can try it like this yes let's while we are here let's also do this let's go inside of our out API let's go to our mutations so use login uh use log out and use register let's start with use login and let's import toaster from soner my apologies toast from soner and on success post success logged in on error post error fail to log in and let's go ahead and do the same thing inside of our use log out and we can remove this infer request type from here we are not using it so import toast from soner on success toast success logged out on error post error fail to log out and inside of the use register as well let's go ahead and let's import toast from soner and on success toast success registered on error post error fail to register there we go now let's go ahead and let's log out and if you try and type in something that doesn't exist uh let's see I should be getting back an error but perhaps so it says 500 internal server error and I think yes I think I'm not handling this error properly here I think I have to do if not response. okay throw new error something went or failed to register so I'm doing this inside of the use register let's copy this let's go instead of use log out and let's do the same thing here we have to handle errors so failed to log out let's go inside of use login failed to log in let's also go inside of my workspace API use create workspace and do the same thing here so this will be failed to create workspace like this and now we should be getting proper errors I think I have to refresh there we go failed to log in great so if I go ahead and write my proper email here and my proper password Here I get logged in and if I create new works space workspace created great so we just handled that what we have to do next is we have to create another entity called members because each workspace will have a member and we also have to implement uploading images to the workspace and then we're going to be able to easily reuse this form inside of our models great great job now that we have finished our workspace form let's go ahead and let's () extended with one more important field and let's start the same way we started initially from the schema so we're going to go inside of source we're going to go inside of our features inside of work spaces schemas dots and inside of here alongside name we're going to add image URL like this and image URL will be the following Z do Union and open an array inside it will either be an instance of file or a string but we're going to add a special transform method here to accept the value and if value is equal and I actually should have used the term identical because this is equal this is identical to an empty string in that case we are going to consider this as undefined otherwise as the value itself like this and let's also chain. optional here like this and now we have to implement actual image upload inside of our routes and just to clarify why am I doing a union here well when I was building this image URL one thing that was actually problematic was how to pass that through the API body form and we need to use a specific form data in order to pass file uploads uh and form data will parse undefined strings um I'm sorry undefined Fields as strings so we need to additionally tell our parser if you accept an empty string you should consider that as not past and you shouldn't consider it as a field value you're going to kind of see what I mean once we actually add our form to this and it also helps with uh the proper types of this and perhaps we should not have named this image URL but it depends because later when we create our edit or update workspace schema we are going to be working with an actual URL so yeah maybe we can just name this image so we're not exactly you know too specific so let's just go ahead and specify this as an image for now so rename it from image URL to image and now let's go back inside of workspaces server rou.ds right here and now you should be able to extract image from here and we are going to have to change this to actually use the form but we're going to do that in a moment for now what we have to do is well actually upload the image so as you can see right here image will potentially be a file and if it is we have to handle the upload so let's go ahead and prepare our app Right storage for that so go back to the console where you have your uh Collections and your uh databases and this time go to storage and go ahead and create a bucket we're going to call this bucket images and click create and there we go you now have the ID here you can copy it from here or go into settings I believe and well I believe you can find an image here somewhere but while we are in the settings here you can also go ahead and play around with the the uh configuration here such as maximum files size or even simply allowed file extensions uh and this actually will kind of be important because of this so we don't have images so let's just copy this bucket ID and let's quickly go back inside of do environment. local here and let's go ahead and add next public app right and we're going to call this images ID and I just want to add a bucket ID so it's clear distinction that this is not you know an images collection this is a bucket and then let's go ahead and let's go inside of our config file where we have exported the database and workspace ID it's in the root of our source folder and let's go ahead and Export con images bucket ID process environment next public app right images bucket ID like this all right we have this ready and now we have to go back inside of our databases inside of our workspaces and we have to go inside of the attributes and we have to add a new attribute which will be a string image URL like this and this is where our maximum allowed file size comes into play there are you know different ways we can store this another way we can do this is by storing image key for example and then we would simply store the the ID of that uh object in the bucket that would mean that every time we load this workspace we would have to populate that image now that is obviously you know the preferred way of doing it that would be the correct way of doing it but since we are working with uh a type of image that we know what it will be used for it will be used for mostly static avatars and we can safely assume that this will be very small images in that case I say it's okay to use base 64 to store in a database so for that reason and for Simplicity sake we're going to have an image whoops uh a new string attribute called image URL and now inside of here we're going to go ahead and Define a size maximum possible size for that dat datase for that data or base 64 URL now they can go to very very big lengths if you know a file is too big but since our files will barely go over a megabyte I used you know Chad GPT to calculate me what should be appropriately the size for a base 64 and that number ended up being 1,400,000 like this and we're not going to make this required and it's not going to be on array and let's go ahead and click create and you know just double check that you entered the correct number so 400,000 and a million 400,000 great and let's go ahead and click create and make sure it doesn't say required because image URL is optional and I would also suggest that while you're here you also go back to your storage and click on images bucket and click on settings and let's just modify uh the maximum file size here and the allowed extensions so I'm going to change the maximum file size to be 1 Megabyte here really no need for a avatar image to go above that and the allowed extensions will be jpeg PNG SVG and let's also add jpeg with an E here right because just adding this usually I've seen you know some some um buckets handle this as the same thing but you have to explicitly add jpeg here so just make sure you add this and I think this will cover you know the most popular ones and click update here like that and while we are here let's also set up the proper permissions so we're going to go ahead inside of permissions here let's click plus and let's first select any so we're going to allow anyone to read them and let's go ahead and select all users here and let's make sure that users can create read update and delete them and well you know what actually most of this will never be public facing so no need for any role at all we can just work with all users role and make sure they have all the options and click update there we go so I have set one megabyte here for my maximum file size I have set jpeg PNG SVG and jpeg with an E here not sure how to how to disting between these two pronunciations uh and that's it so make sure you have saved that and now we can go back inside of the code and we can do the actual upload so we're going to go back inside of features workspace server route. DS and now that we have the image here let's prepare a constant called uploaded image URL and let's make that either a string or undefined and now if our image is instance of file in that case we're going to go ahead and handle the upload so const file will be a type of well not a type of but we now have to create the file using storage so let's prepare that con storage comes from cat storage so remember we have that instead of our session middleware we set up the storage here so just make sure you do that as well now that we have the storage we can go ahead and do const file to be await storage create file like this let's add our images bucket ID from our config file so just make sure you have added this import after that let's go ahead and give it an id. unique we have the ID from node app right and lastly we are passing the actual image we plan to upload like this so just double check you have ID from node app right here and now that you have the file this by itself will not give you any preview URL we have to create one now if you're using if you ever used app right before you might have explored file upload already and you might know that there is uh a method which usually generates a URL but when working with node app right the server SDK it works a little bit differently and we don't have that option so we need to create an array buffer and transform this to base 64 so let's create an array buffer here using await storage get file preview pass in the images bucket ID and file. ID with the the dollar sign here so now when I hover over this you can see it's a type of array buffer this same method in the client SDK which is usually called just app right usually Returns the direct URL but the server one works differently so now we have the array buffer double check that this is your type here uh in case you know in the future get file preview gets changed to return a promise and the string perhaps you already have the URL so you know check that but you will most likely have the array buffer here as I do and now we have to assign the generated base 64 URL to our const here so let's go ahead and open backck and we have to go ahead and add data column image/png semicolon base 64 comma and then open the template literals here buffer. from and go ahead and pass the array buffer which we have above here and then chain to string base 64 like this and and now you have the uploaded image URL and then you can go ahead inside of here and add image URL to be uploaded image URL and this size of the buffer will vary you know from the from the size of the file which we just passed right and since we have limited the size inside of our storage we ensure that it most likely will never go above that if it does it will simply throw an error to the user but since we made it not required it won't really break any workflows uh great so we have this ready but we are not you know finished just yet what we have to do next is we have to create an interface for this on the actual frontend side so let's go ahead and do that let's head inside of source features workspaces components create workspace form right here let's start by importing use ref from react here and we're going to call use ref by attaching it on an input field which is going to open our file explorer but we're not going to you know literally click on that input we're just going to use it so let's go ahead and assign that here so const input ref will be use ref with the default value of null but let's go ahead and give it HTML input element inside and now we're going to go ahead and create another form field below this one let's go ahead and give it control form. control and the name will be image so that's what is going to be resolved using this form field let's go ahead and destructure the Field property inside and now we're going to go ahead and create our form item inside of here uh and then well actually we don't have to open up form item right now instead actually we won't have to uh we won't have to you know follow the usual semantics as we do because this is a very you know customade input that I will do now since it won't really follow it won't use any of the normal HTML you know input Fields so let's scratch this and let's just return a normal div and we're going to give this div a class name Flex Flex column and GAP y off two inside I'm going to go ahead and create another div with a class name Flex item Center and GAP X of five and now depending on whether we have uploaded an image or not meaning do we have field do value if we have field do value we're going to go ahead and render that image here otherwise we're going to go ahead and render an avatar so let's import the things we need first of all we need to import image from next image and then we need to import avatar from components UI Avatar and we need Avatar fallback and Avatar image like that now let's go all the way down down here and let's go ahead and give this image some properties here so Source will check if fi. value is an instance of file with lowercase o in that case uh instance of file in that case we're going to go ahead and do url. createobject URL field. value otherwise you can just use the field. value and let's fix the instance off here there we go and let's see URL uh create object url url like this so this part needs to be Capital great so if we receive field. value as a file which will happen if we are on this form for the first time and we click you know on this uh uh add a file and we literally select one from the file explorer at that point fill. value will be an instance of file and in order to display that to the user we have to convert it to an object URL in an odd chance that we actually receive uh the full URL in field. value well then we can just use that and this will happen in the edit form so this actually makes more sense in the edit form perhaps we don't even have to check for this but since with the find that field. value can be a string or file uh I think type safety will definitely complain if I just assign field. value here as you can see so let's go ahead and do this instead let's go ahead and give it an ALT of logo like that let's give it a fill and a class name of object cover great so that's if we added an image and if we did not add an image let's go ahead and give this a class name of size 72 pixels and let's go ahead and add an Avatar full back here and let's add an image icon here from Lucid react so make sure you have imported image uh icon from Lucid react here and I'm going to remove the Avatar image from components UI Avatar since we are not going to be using it let's give the uh the image icon a class name of size 36 pixels and text neutral 400 like this and then let's go ahead and give this div which encapsulates our image here which will be you know the attached image from the file explorer a size of 72 pixels as well relative rounded medium and overflow hidden just like that great and this relative is very important otherwise the fill will not work properly for this this next image here great and now that we have that I think we can already revisit our Local Host here and let's refresh and there we go so I'm going to refresh once again and you can see I have a placeholder of my image icon here meaning I don't have any image set at the moment here so let's go ahead now and Below all of this let's add a new div with a class name flex and flex column and let's add a paragraph work space icon let's give this a class name of text small let's copy and paste this and this one will also have a text muted foreground as well and it will simply say either jpeg BNG SVG or JPEG and Max 1 Megabyte now let's also go ahead and add that hidden input so a native input here let's give it a class name of w fit my no hidden and let's go ahead and give it an accept here of jpeg pg. JPEG and SVG let's give it a type of file and and let's go ahead and give it a ref of input ref and let's give it a disabled of is pending and now we also have to create an onchange method here so let's give it a unchange to be handle image change so we're going to go ahead and do the following we're going to create a new method here con handle image change we're going to have an event which is a typee of react change event HTML input element and then we're going to get the file from event. target. files and then we're going to optionally get the first in the array and if we manage to get that file we're going to use form set value image file just like that there we go and I think that already this should be working let's go ahead and oh well we we didn't actually add a button which will call this hidden input here so let's just quickly uh go do that as well so just below this input here we're going to have a button which will say upload image this button here will have a type of button which is important it will have a disabled if is pending it will have a variant of territory it will have a size of extra small a class name of w fit and margin top of two and on click is going to be interesting so on click we're going to call the input ref. current question mark click like this so that's how we're going to trigger that hidden input so now I'm going to go ahead and select an image here and there we go you can now see my image was selected right here excellent so just you know double check that you didn't accidentally uh write the incorrect accept here if you want to you know you can remove the entire accept because we do have validation on back end which will throw errors but you know for user experience it's also a good practice to Simply allow specific images as well so this query right here is is working for me to add the images I want to add great and what we have to do now is well handle the upload so let's see if that will be working or not and I'll give you a little hint it's not going to work so if I now go right here and write test and click create workspace there we go we get 400 here and here's an interesting thing our image is just a plain object that's because we cannot send an image through Json we have to use form data so that's the last thing we have to do to enable file upload from this form so let's go ahead back inside of our route for workspaces our post method here and we are simply going to change our Z validator here to not validate Json but instead to validate the form and then valid form here then we also have to revisit our workspaces API using create workspace and instead of sending Json we will now be sending form and that should get rid of all the errors inside of here and now we have to go back inside of the create workspace form specifically in the onsubmit method and we just have to do some modifications here so let's go ahead and Define a constant final values to be a spread of existing values and then get the image if values. image exists and it is an instance of file in that case we're going to submit that otherwise we're just going to send an empty string and this will be okay for our uh Zod schema here so if I send final values you can see no errors at all because of this but we know that our create workspace schema will treat an empty string as undefined so that's why we have to add that and I think that now already this should work just fine I will add test let's try and there we go workspace created let's go ahead and revisit my bucket here I'm going to refresh my images and there we go you can see my image from unsplash right here 10 kilobytes and it is a JPEG image there we go and if I go inside of my databases inside of workspaces I should find I think this is the newest one and you can see the image URL and there we go you can see the exact uh where is my data image and I'm going to go ahead and paste that here and there we go so the actual uploaded image is definitely here and it fit in our F field with a, 400,000 values uh great that works just fine what I want to do to wrap this up is just add an on success field here and let's do form reset so if we create a new form like this I just want to clear the entire thing the next time there we go that's it and I'm going to go ahead and just add to do redirect to new workspace once we have that available as well great you've just implemented file upload in your create a new workspace form uh and now now what we're going to be able to do is actually use the created workspaces to create our workspace switcher component to modify you know how some specific logic is going to work and we're going to go ahead and find a way to move this form to its proper place and also to enable it in models and then we're going to create an almost exact form for our projects and then we can create our first tasks great great job now let's go ahead and let's create () the get workspaces endpoint so we can fetch all those new workspaces which we just created so let's go inside of source features workspaces server route. DS and I'm going to go ahead and add a as a very first route here above the post a get route and right now I'm only going to add the session middleware here and an asynchronous controller just like this and inside of here I'm just going to get my databases from C.G get databases and then I'm very simply going to go ahead and do const workspaces to be await databases list documents database ID which I think we already have imported and then workspace workspaces ID just like like this and then we're just going to return c. Json data workspaces let me scroll for you so you can see this is the entire controller for now and now let's go ahead ins set of API and let's do use getet workspaces do DS and let's copy from out API we have used current so let's just copy you know the contents in side and paste them instead of the new use get workspaces I'm going to rename this to use get workspaces and I will refetch this query key to be workspaces and then I'm going to change this to Simply Be API workspaces doget and inside of here I'm going to go ahead and remove this but perhaps we can just go ahead well we can return null as well here or maybe we can just do this let's see um just a second let's see what's the best way of handling this well we can throw an error in this case so throw new error failed to fetch workspaces and then we can safely return data afterwards great now that we have used get workspaces let's do the following let's go ahead and simply try this out uh inside inside of our sidebar here so I'm going to go inside of my components and I'm going to go inside of my side bar right here and what I'm going to do is I'm going to create a new component called workspace switcher so I'm going to copy this doted separator and I'm going to add a workspace switcher component like this and then I'm going to go ahead inside of my components and create the new workspace Das switcher do DSX and I'm going to mark this entire thing as use client and I will do export con workspace switcher here and return a div workspace switcher let's quickly go back inside of the sidebar component and let's import the workspace switcher from workspace switcher and now in your workspace you should see a place which says workspace Switcher and what we're going to do now since we marked this as use client is go ahead and fetch use get workspaces and we're going to destructure the data here and what I'm going to do is very simply Json stringify the data like this and there we go a bunch of documents appearing right here and if you want to you can also do this data. total and this will tell you the number and let's go ahead and put an exclamation point question mark here there we go so you can do this so you can it will just tell you the number of workspaces that currently exist and let's try something out so remember in our use create workspace hook I told you to add the query client invalidate queries with a query key of workspaces at the time this query key did not exist but now inside of our used get workspaces it exists right here so technically if everything is set up correctly right now it says six but if I go ahead and write test one to three and create a new workspace without refreshing now it says seven exactly what we wanted great so we now have that inside of our workspace switcher so let's go ahead and we'll develop this further I'm going to go ahead and give this div a class name of flex Flex column Gap y of two like that I'm going to remove everything inside for now and I will add a new div here with a class named Flex items Center and justify between and this will be position for our label workspaces and on the other side we're going to have an R add Circle fill icon and you can import this icon from react icons are R I like this now let's go ahead and style this two so I'm going to give this paragraph a class name of text extra small uppercase text neutral 500 like this and I'm going to give the r i Circle fill a class name of size five text neutral 400 my apologies let's add 500 here cursor pointer hover opacity 75 and transition and I think that already we should have this visible on our sidebar here there we go it says workspace workspaces right here and we have a little plus icon here so now let's go ahead and just change this uh just a bit I kind of don't like how this uh looks at the moment perhaps I to add a bold text here um but let's leave it like this for now we're going to you know come back to this a bit later so let's go ahead now and go outside of this div and let's import everything we need from our select component so select select content select item trigger and value from add components UI select we've added this component in the beginning from shaten UI quick reminder you can use bonex chaty in I think the version is 2 I don't know 1.0 add select right so that's how you would do that just you know go back and at least look at uh what's the latest version so let's see it's 2.1.0 okay so that's how you add components just a quick reminder even though you should definitely have this right and then let's go ahead and add the select here and let's go ahead and add a select trigger let's go ahead and give the select trigger a class name of full width background neutral 200 font medium and padding one and inside of the select trigger we're going to add a select value here with a place holder of no workspace selected and then we're going to go ahead and create a select content here inside of the select content we're going to query over our data right here which we can remap the workspaces for clarity so let's add workspaces question mark documents. map so we are not directly working you know with data we have to access it through documents because that's what app uh list documents returns so this list documents here as you can see Returns the model document list which consists of documents which is an array of items but also stuff like total which will tell you how many total uh items are there so let's get this individual workspace here and let's return a select item inside and inside of here we can simply add a workspace do name and let's give the select item a key of workspace ID individual workspace ID and oops this should be workspace workspace like this so workspace and workspace and let's also give it a value of the same workspace do ID with a dollar sign like that so I think that now we should be able to click here and I should be able to look at all the available workspaces to click on right right here great so now I want to make this a bit prettier and I want to display avatars of each of those workspaces let's go inside of our workspaces features inside of components and let's create a new file called workspace avatar. DSX let's create an interface workspace Avatar props and inside let's add an image to be an optional string a name to be a string and class name to be an optional string as well while we are here let's go ahead and import a couple of packages starting with CN utils image from next image and Avatar and Avatar fullback from at SL components UI Avatar then let's go ahead and Export const workspace Avatar inside of here let's go ahead and let's D structure the image name and the class name and let's assign them to be infered inferred from the workspace Avatar props and then inside of here if we have an image we're going to Simply return a div with an image which uses that image as a source we're going to give this image an ALT of name of the workspace Bill property and class name object cover we're going to give the wrapping div of that image element a class name which will be used inside of CN U so the default classes will be size 10 relative rounded medium overflow hidden and then we're going to pass class name as an optional second argument if the user wants to extend this look otherwise if we don't have this we're going to go ahead and add an avatar component with an avatar fallback and in case you're wondering why just not add Avatar image here we have that as well and it accepts The Source because inside of Select component which we are using right here here it causes a very bad flickering effect it just it's too noticeable for me to left it inside so that's why I chose uh that's why I opted for this option so let's go ahead and go inside of the Avatar fullback it's not going to be a self closing tag so Avatar fullback and inside simply render the first letter of the name and let's go ahead and give this a class name of text white background blue 600 font semi bold text large and uppercase and then let's go ahead and give our avator here a class name CN size 10 and class name there we go and now let's go ahead back inside of our workspace switcher and now let's utilize our new workspace Avatar component so instead of our select item we're going to go ahead and create a diff with a class name Flex justify start items Center Gap three and font medium inside of that div we're going to add our workspace Avatar component which you can import from features workspaces components workspace Avatar and we're going to go ahead and give the workspace Avatar here a name of workspace do name we're going to give it an image of workspace image URL and here's like an important uh thing to tell you so yeah this workspace which we have here instead of these workspaces you can see that one problem with it is that it doesn't have you can see that it has this property X is a string and a type of any basically what they've done is alongside the basic elements which app documents need to have they also allowed for any custom field because it's not strictly typed so you have to be a bit careful with this make sure you don't misspell name and make sure you don't misspell image URL but there is a fix we can do to improve type safety on that end and make sure when using IDs you're using ones with the dollar sign great so we now have the workspace Avatar here set up up and below that let's add a span element workspace do name and let's go ahead and give the span a class name of truncate in case it's too long and there we go you can already see how better this looks right now we can now handle our uh workspace switcher components in a nicer way the only problem is some are rounded some are not rounded so I'm going to go ahead inside of my workspace Avatar and and I'm going to go ahead and give the Avatar here a rounded MD and looks like that doesn't fix it so let's also add it to the Avatar fullback here and there we go great so we have that what I want to resolve now is this outline which happens inside of this select component so let's go inside of workspace switcher here and let's go inside of the select component here and let's go ahead and explore which one causes that outline right here so we have the content I don't think it's that one uh I think it might be the trigger component right here I'm going to go ahead and explore so let's try by giving this select trigger a focus outline none let's see will that do something and oh do we already have that property okay so we already have this property so okay no need to write it twice but one of these causes this really ugly uh outline here it might be let's see is it ring perhaps so what if I say offset transparent here it still appears right here uh ring one ring transparent maybe this one there we go so change the focus ring to transparent let me just find where it is focus ring and change it to transparent if you want to and then that will as you can see remove that uh I have to call it ugly outline uh great we now have an amazing workpace switcher here and what we have to do next is fix a little problem that we have and that problem is the following so right now I have this user right which is my Antonio user and in here I can see all of this amazing workspaces but here's the problem if I log out and if I go ahead and create a new account here John and John mail.com and john2 3 4 5 6 78 and log in I can see the exact same workspaces well that's not exactly ideal isn't it so what we have to do in the next chapter is implement the members functionality so we're going to have to invent something called an invite code for each of our workspace and we're going to have to create a members collection so that we only load workspaces that we are a member of great great () job now let's go ahead and let's create the members collection inside of app so I'm going to go back inside of my database here so outside of my workspaces collection right here where we have database ID and in here I have my workspaces collection so I'm going to find the button create collection and I'm going to call this members I'm going to go ahead and create this and I'm going to give it some attributes the first attribute is going to be the user ID which will have a size of 50 and it's going to be required the second attribute is going to be workspace ID which will also have a size of 50 and it will also be required there we go now let's go inside of settings here let's go inside of permissions all users create read update and delete and save that great now let's go ahead and let's go back inside of our app here my apologies let's first copy the new collection ID for our members so you can copy it from here you can go inside of settings and I'm pretty sure you can find it somewhere else but just copy it here for now go inside of your environment. loc and go ahead and create an environment key similar to workspaces ID but this will be members ID and paste it here and then go inside of your config and just as you've added workspaces ID we now have the members ID and I'm going to go ahead and paste my next public app right members ID just like that and now we have to go ahead and do the following so every time that we create a new workspace we're going to go ahead and create a new member as well and I forgot one thing so instead of the members collection go inside of attributes and go ahead and create a new attribute which will be a type of enum right here let's go ahead and give it a key of rooll and let's go ahead and give it some elements so by default you can either be an admin or you can be a member so those two and make it required and let's go ahead and click create there we go so now let's go ahead back inside of our features workspace spes API my apologies server so workspaces server route. DS and when we create a new workspace we're automatically going to create a new member so let's go ahead and do await databases. create document and inside of here I'm going to pass my database ID which I already have imported and then I'm going to add my members ID which is the new uh constant I have added in my config file here so now I have my members ID I'm going to sign a unique ID and the body will be as follows user ID will come from the current user which we have extracted here from the session middleware so that's the current user and then we're going to combine that with our newly created workspace do ID like that there we go and we also have to pass in a required role admin but let's go ahead and improve this a bit so I'm going to go ahead and create a new feature folder called members and inside of here I'm going to go ahead and create types. DS and I'm going to export enum member role it will be admin and map that to admin member and map that to member and now let's go back inside of the route and let's add Our member role which you can import from features members types and go ahead and assign a member role admin so the person that creates this is an admin we could also use you know the user ID in the workspace field but it's easier to control it from a separate collection like this great so we now have uh the actual member to be joined every time that we create a new workspace so this is what I'm going to do for now I'm going to go ahead inside of my uh Collections workspaces and I'm going to select all documents here and I'm going to delete them like this be careful don't select workspaces like this and delete it because then you're going to have to create a new collection and you're going to have to set up all the attributes again you're going to have to set up all permissions again in case you're wondering can the collections and you know the storage and the databases can they be programmatically created yes yes they can if you want to you can go ahead and go inside of the docs here I'm not entirely sure how to where it's located so I'm just going to pause the video and show you that part of the documentation so basically you have to go to API reference here and for example click on databases here to see all apis and you can here in the upper right corner select your platform under server nodejs and in here you can for example create a database programmatically giving it the database ID and the database name so if you want to use this for your seed file you can do that you can also update it you can delete it you can also create new collections you can give your collection a name you can give them permissions and you can also create some attributes here so if you are if you were wondering can we do those things programmatically yes you can but again be careful you know don't select this for databases don't select this for collections you know it's just going to be a problem because you're going to have to create a new collection and then you're going to have to assign all the new permissions and all the attributes here and you have to remember you know the size and everything so just be careful with that great so right now I have no workspaces and I have no members so let's see that now I'm going to refresh here there we go no workspace selected because nothing here works so I'm going to go ahead and write test and create a workspace and it says workspace created so there we go now I have my workspace immediately here because of our reinv validated queries and let's see do I have a new member I do with my current user ID and my workspace ID and my role is admin right here perfect and this matches exactly great so what we can do now is create a couple of this so I'm going to create test two and test three here so I have test test two and test three here and what I want to do now is modify inside of my workpace workspaces server the GU method right here right now it just loads every single document that exists so now let's modify that to only load workspaces which we are a member of so for that we're going to have to extract the current user from the extended context here and let's go ahead and do cons members await databases list documents database ID members ID and let's go ahead and add a query from node app right so alongside ID we now have a query do equal the user ID property matches the currently logged in user do dollar sign ID like this and now we have all members that this user is a part of and then we can immediately uh make our lives Easier by checking if members if not members. documents. length or you can for example do if members. total is zero you can also do that you can immediately break this method and early return data documents empty array with total zero so we are simulating app right response here we already know if you cannot find any memberships no point in loading any workspaces for this person otherwise we can go ahead and create workspace IDs array which are member members. documents so for each member that we find we are going to map over that member and simply return member workspace ID again make sure you don't misspell this because none of these are strictly type at the moment so just make sure you didn't misspell workspace ID here and you should have an array of workspace IDs and then we can expand our workspaces here with a query contains dollar sign ID and workspace IDs like this and we can also do query order descending dollar sign created at and now if I go ahead and refresh this let's see I'm still getting test three test two and test because I created all of those but if I now log out and if I log in with my other account here if I've done everything correctly I should not be seeing this but looks like I am still oh after I refreshed uh I cannot see them so why is this happen happening well it looks like that inside of my use logout I don't reinv validate those so let's do query client invalidate queries query key and let's just do workspaces here so now when person logs out we are going to clear all existing workspaces for that person so there we go now it works as expected as you can see my Antonio us us has no workspaces here but I'm going to create Antonio's workspace and now it appears here but if I log out now and if I go into my John I believe and enter my account there we go I don't have Antonio's workspace I only have these three excellent so you've just created the member the members functionality here let me just move this where it belongs all right so a couple of more things I want to do before we wrap up this uh chapter here so I want to go back inside of my app right Cloud here and I want to go inside of my workspaces there we go let's go inside of attributes and let's add a new attribute which is a string and let's call and let's call it invite code I'm going to give it a size of 10 you can choose whatever size you want for your invite codes and we're going to make this a required field so let's create that and now we can go ahead and go inside of documents and we can remove all workspaces so be careful make sure you didn't accidentally select Collections and let's do the same thing instead of members so I'm going to remove all members and now let's go ahead and let's create a little util for creating a 10 digigit uh invite codes here so we're going to go ahead inside of our lib utils right here and let's export function generate invite code which will accept the length which can be a number and first of all let's define the characters which we accept for our code so this is what I'm going to do I'm going to do the entire alphabet here like this then I'm going to repeat the entire alphabet but in lower case and then I'm simply going to add all single digit numbers like this so you don't have to do it exactly like this you can you know just type in the alphabet or just type in any random set of characters here or just numbers if that's what you prefer and now what we're going to do is we are going to go ahead and prepare the result here and do a very simple for Loop so for let I being zero I is lower than uh the length we're going to go ahead and simply do an increase of the I and very simply from characters do character at math floor math random times characters do length like this and and return the result just like that and now now that we have the generate invite code we can specify the length here let's go ahead and let's go back inside of features workspaces server route in the post method here and let's simply generate a new invite code here we don't even have to do it in a variable we can just add invite code and let's go ahead and make it gener at invite code 10 or you know four five six it doesn't matter but the maximum is 10 so if you want to you can add just six here you can of course use any other library for generating invite codes if you prefer you know you don't have to build your own but you know it's very simple to build one just give it a set of characters to work with and iterate over the length you've specified and use some math utils to create a unique code great let's try it out now so I'm going to go inside of here I will refresh and I will create a test workspace there we go no errors if I refresh I should have a new member and if I go inside of my workspaces there we go image URL is null but my invite code is right here and I believe it has 1 two 3 four five six characters exactly as we have specified right here great so we have all of that finished finished and what I want to build next is the actual functionality to click on a workspace and change the actual URL and basically enable it so that we always have a specific workspace selected so that then when we click on tasks or settings or members we are always uh having the context of the current workpace and then we will be able to wrap up our workspaces by adding the proper onboarding by adding a model when you click here and settings and members great great () job now let's go ahead and let's create the individual workspace ID page so I'm going to go ahead and go inside of my source folder here inside of my app folder and inside of the dashboard route group and then I'm going to create a new folder called workspaces and then inside of that a constant throughoute workspace ID like this and I'm going to create a new page. TSX file inside and let's go ahead and create a simple workspace ID page here with a div workspace ID like that and then let's go ahead and try it out immediately so I'm go to Local Host 3000 SL workspaces SL1 23 like this and there we go we have workspace ID here so now I want to go inside of my workspace switcher component and I want it so that every time I click on a specific item here we get redirected to that uh to that workspace so let's go ahead and add on this select item here let's go ahead not on select item my apologies on the select we're going to do an on value change on select and let's define on select here to give us an ID which the user clicked on and then we'll have to add our router from use router coming from next navigation and we're simply going to redirect the user to slash workspaces slash ID that the user just selected like this and I also uh want to do one more thing which we're going to do in a second here so right now when I click on test there we go inside of my URL I am redirected uh to that workspace as you can see the problem is my workspace switcher component is not controlled at the moment so let's see how we can improve that I'm going to go inside of my source features workspaces and let's create a new folder called Hooks and inside of here I'm going to create use workspace id. DS let's go ahead and let's import use parms from next navigation and let's export const use workspace ID here let's define the params from use params and let's return Rams workspace ID as string like this and then you can go back inside of your workspace switcher and you can get the current workspace ID using the used workspace ID method here I'm going to move this alongside here and the reason this will work work is because uh well it won't work because we have to search for pam. workpace ID it needs to be exactly the same as your app folder dashboard workspaces workspace ID it needs to match the capitalization so be careful and then we're going to go ahead and do the following we're simply going to give this a value of workspace ID which is controlled from the params so there we go now you can see this says test right here so I'm going to go back to my root page just so I have this form I'm going to create a couple of this test one two three something one two three and just a random name here so now you can see when I click on one they stay selected because they are controlled by the URL inside uh by the PM called workspace ID inside of the urls so they stay selected great so now what we have to do is create a redirect every time user visits the root page so I don't want the user to be able to visit this kind of page this should almost never exist what should happen is that the user gets immediately redirected to the first IND the array or we can store the last one the user used in local storage or you can store it in the database so let's go ahead and see how we can do that so I'm going to go inside of app folder inside of dashboard inside of page. TSX and for now uh just go ahead and have a couple of workspaces created because we're going to remove this form we're going to bring it back later but for now we don't really need it right so we are trying to finish this you know homepage here so remove this remove this you can even remove you know the div let's just write homepage and just use this user redirect here so what I want to do is I want to leverage the fact that this is a server component and the same way I've created this get current action well it's not an action I should I really should not be calling it that it's just a database query in a server component that's what it is so yeah this actions is kind of misleading but I also like the name but you should know these are not server actions right you can rename these two queries if you want to so this is what I'm going to do I'm going to abstract this client right here uh or maybe we can copy let's see let's go ahead and do this let's copy the entire actions from here and let's put it inside of workspaces so workspaces should now have its own actions here and this is what we're going to do we're going to go ahead and get the out cookie from its actual place so out features out constants from here and we're going to call this get workspaces and we're going to initialize the client in exactly the same way we are going to get the cookie because we need the cookie but we are going to go ahead and do just some things differently so if there's no session we're going to return back total uh actually no we can return back zero now yes let's do that and we're not going to go and use the account but we're going to do databases so new databases and then inside of here what we're going to do uh oh I didn't import databases so instead of account I'm now importing databases here and instead of running this query instead of our get workspaces action we're going to go ahead and copy the one from here from our API this one so we get the members and again we get the workspace IDs so let's copy from the members this members total check this iteration of workspace IDs and finally the workspaces copy all of that and put it inside now let's fix the errors so first of all I'm going to go ahead and REM and import the database ID from the config here and then I'm going to ahead and import the members ID from the config as well and I will then import query from node app right uh we have it right here we need to get the user so we're going to have to use our account after all so new account from node app right and pass the client make sure you have brought back the account here and then we would simply get the user from uh await account doget and then this is the tricky part so instead of returning c. Json we would just return this object we don't even have to do it inside of data we can just immediately return what usually app right would return now let's also add the workspaces ID from the config here and let's go ahead now and let's finally return workspaces here like this one thing that's worrying me are this the return nulls I think that we can safely just return you know these empty States instead of no so this and in in case we get any errors you know just return the exact same thing empty doc documents and empty count because we are going to use this after our get current so we don't have to handle any you know missing session errors inside of here we're just going to go ahead and you know return empty lists if we notice this is a logged out user and now let's go ahead and let's go ahead and can I do this after this so can I keep these together and then get my workspaces here a wait get workspaces I think I can and what I want to do here is if my workspaces do total is zero in that case we should redirect to whoops to slash workspaces slash create else we should redirect to open back deex slw workspaces SL workspaces do documents first in the array and get the ID of that item like this and then let's go ahead and give this uh so let's see it looks like this return will always be unreachable yes this return will always be unreachable it seems so perhaps I don't have to return anything here and there we go you can see that now if I try and manually go to Local Host 3000 I am immediately redirected to one of the IDS here but if I happen to not have any workspaces I will be redirected to workspaces create so let's see how can we handle this in the best way so I think that there is one thing I can do to improve this and it's to add a loading file because as you just saw if I I want I planned on doing like a little spinner here in the return the problem is this is unreachable code so let's go ahead and add a loading. DSX file which is a reserved file name you can already see the error here and this loading will fire during these awaits so let's go inside of loading here and let's go ahead and Export uh dashboard loading and inside of here I'm going to go ahead and create a div with a class name well let's do minimum height of screen Flex item Center justify Center and inside of here let's add a loader from locid react and let's give it the class name size six animate Spin and text muted foreground like this so now I don't know if you will be able to see this especially if you have you know any cache but I think you just saw for a brief second before I redirected I have a little spinner here so that's what I wanted to achieve and I think that we can also use height full instead of minimum height screen I think this will take actually take up the correct space that puts it here okay that's that's also fine uh great so we now have that resolved so what I want to do next is when I click on this button I want to have my model opened so just before we go there I still just can't stop thinking about my implementation of these actions here I kept thinking that this is just not the correct way of doing it and even you know doing the try catch okay let's just leave it like this for now when I say not correct I don't mean like a security issue I just mean I kind of don't like it but okay let's not dwell too much into this we are using this purely to improve user experience right we are just using this to redirect the user from the homepage to a randomly assigned well uh the the latest workspace they've created so let's go ahead and do the following we now have to create uh a model which will be opened every time we click on this handy little plus icon here so let's go ahead and do that and here's the cool thing we're going to do something called a responsive model so let's go ahead and do that first so we're going to go inside of components and create a new file called responsive model. TSX and let's go ahead and import use media from react use which is a package we are going to have to install so let me go ahead and check what version I have so bun add react use you're going to see the version in a second so bun add react use at 17.5 point1 so if you want to you can run it like this Bon add and then use this specific version great so we now have react use here and now let's go ahead and import everything we need from components UI dialogue which comes from shat CN UI so that is the dialogue and the dialogue content and then let's also import everything we need from the drawer this is actually the first time I'm doing uh something like this in my tutorials so you are probably uh not used to seeing this component but it's really cool I promise let's create an interface responsive model props children react react node and I have to use brackets here so children open which is a Boolean and onopen change which accepts the open value which is a Boolean and it returns a void and let's export const responsive model here whoops okay let's assign responsive model props right here and let's destructure the children the open and unopen change and I forgot to put the equals sign here and then let's go ahead and Define our we on desktop so if is desktop use media we'll go ahead and in Brackets do minimum width of 1,24 pixels and by default we're going to consider this to be true if we are on desktop we're going to go ahead and we are going to use a model or a dialogue right and we're going to pass in the open props and the onopen change props like this inside we're going to use a dialogue content we're going to give it a class name of full width SM maximum width of large padding of zero border of none overflow y AO hide scroll bar which is something we have to implement ourselves this does not exist in tailwind and maximum height of 85 uh VH so let's go ahead and quickly Implement our hide scroll Bar Method here so let's go inside of our global. CSS located inside of the app folder and I want to do this all the way at the bottom here so hide scroll bar will'll have- ms- overflow D style to be none so this is for uh Internet Explorer and Edge then we're going to have normal scroll bar with to be none this is for Firefox and then hide scroll bar again this time with a pseudo webkit D- scroll bar my apologies just a single Dash here display none like that so now we have a working a hide scroll hide the scroll bar class here and inside of the dialogue uh inside of the dialogue content we're going to render our children like that and now let's do a very similar thing outside of the is desktop but instead of using the dialogue it's going to be using the drawer component which handily accept the exact same props so no need to change much here and now we're going to add drawer content here and we're going to go ahead and replace this with a div so don't put these class names on the drawer content and we're just going to modify it a bit so I'm just going to leave the uh overflow y AO the height scroll bar and the maximum height and then I'm going to render the children inside there we go so we now have a very useful responsive model which on desktop is going to display a dialogue but on mobile it's going to display a nice native looking drawer you're going to see it in a second I promise it's a really nice implementation and I'm probably going to start doing this in every tutorial from now on uh great so now let's go ahead let's go inside of our source features workspaces components and since we already have the create workspace form we can reuse it so let's create a new create workspace model TSX let's import responsive model from components responsive model let's import create workspace form from /c create workspace form like this and let's export const create workspace model and let's go ahead and return responsive model and passing the create workspace form inside and I'm just going to hard code open to be true and onop change is just going to be an empty Arrow function for now so I want to hardcode this to be opened so that we can see how this looks so let's add this create workspace model to our dashboard layout because it's only going to be used inside of that layout and nowhere else so inside of dashboard inside of layout here we're going to go ahead and inside of this first div simply add the create workspace model and self close it so make sure you've added the import create workspace model here like that and now we have a problem here because this is this layout by default is a server component so let's go ahead and go inside of the create workspace model and let's turn this into use client like this and there we go you can see how cool this looks on my mobile so on mobile this is a drawer but when I expand on desktop or zoom out it becomes a dialogue so that's what I wanted to show you I think this is a really really cool feature and now we have to create the actual controls which will open or close this dialogue usually in my tutorials I use global State Management like tand or any Yi you know context any any Global Management and recently I've come across the idea to create a tutorial and H have all of my Global states which hold not so so crucial things so like opening models inside of my URL and this is actually cool because I can there I can then share a URL and open a model for someone so I found the perfect package for that uh which is called Nu so let's go ahead and add that again I'm going to show you exact version that I'm using and I highly recommend actually I'm not even going to show you any other version this is exactly how you have to install KN so because a new version of KN is coming out and it's going to be a breaking change so if you want to use the code exactly as I do make sure you are using this version so KN at 1.19 .1 and this is very very important because KNX will be updated to work with next 15 and next 15 includes a handful of breaking changes and same is true for n that being said if you want to explore you can explore the new no version so simply Google it and visit the documentation and I believe the new major version will be well two and you can see all the changes from there but in this tutorial this is the version I will be using I highly recommend that you do the exact same things or mpm install iox with that exact version great now let's go ahead and let's go inside of our workspaces feature folder and what I want to do is I want to go inside of my Hooks and I want to create use create workspace model. ts. TS so basically a hook that will control whether this model is opened or not and let's go ahead and go import from KN use Query State and parse as Boolean let's expert cons to use create workpace model let's go ahead and Define is open and set is open to come from use Query State whoops use Query state in the first argument we're going to Define what query parameter in the URL is going to control this and I'm going to call it create Das workspace and then I'm going to go ahead and added some options so parse as Boolean with default option of false and with some other options clear on default to be true this clear on default will basically mean that once I close the model or once this set is open is changed back to false I don't want my URL to be Local Host 3000 create workspace false I don't want that so I only want this to appear if it's true so in case set is open gets uh with a false value it will simply clear it like this that's what this option does that's why we are assigning that and this is I also now explained how this works so you can see you get a syntax very similar to your usual is open set is open from react use state right you give it a default value the only extension here is is that it will be completely synchronized with the URL so a very powerful package and now let's simply return a couple of things here so if you want you know we could have returned just this directly it can also work with that but I kind of want to make it more convenient for us so let's return is open which will simply be our is open here and since we do pars as Boolean and with default false uh this is actually parsed as a Boolean as you can see usually you know technically all of these queries are strings but we are parsing them as a Boolean right so if you run into any errors here what you can do what I did ini was this I turned it manually into a Boolean but in case you hover and it says Boolean you're safe to do this and then let's go ahead and let's create two handle little utils con open is simply going to be set is open to true con close will be set is open to false so just a few hand little utilus here so we don't you know just return this exactly let's at least make it easier for us but I also want to return set is open just in case we need it in this format right we are most likely going to work with these two handlers helpers here but just in case we need the direct access to this it's good to have it great so we now have this and now let's go inside of our create workspace model and let's go ahead and add it here so use uh is it use create workspace model yes use create workspace model from do/ hooks use create workspace model execute the hook we're going to get the open is open and let's go ahead and get set is open here so I'm just going to go ahead and pass set is open inside and this will be controlled with this there we go so now we're going to do this we're going to go inside of our workspace switcher component so make sure you inside of here it's located inside of our Global components for now and inside of here I'm going to add that so use create workpace model from features workspaces I'm just going to move it as side with all these other Imports for workspaces and I'm just going to call our helper open like this and very simply I'm going to add to this R I add Circle fill on on click open just like this let's go ahead and try it out now so I want you to pay attention to my URL right now nothing happens but when I click plus there we go you can see that I have appended a new create workspace to be true right here and it opens right here and if I change this to false you can see that it's not open if I manually change it to true it's opened and this is really cool because I can share this state in a form of URL with someone else so if you're new employee needs help you can just copy this URL and give it to them and it will open a model on creating a new workspace right here uh great so we now have that and I can you know let's go ahead and try out this it works just well one thing is missing though so inside of my uh where is my create workspace model I'm going to go ahead and also get the close Helper and I'm simply going to pass the on cancel here to be close just like this so now if you click cancel it actually closes the model isn't that a cool feature and I think we can do the same thing uh on mutate here so on success you can also kind of do on cancel if you want to but since we will be handling the redirect that will in itself clear the URL of any queries so you know however you want to do it let's let's do it you know let's let's add on cancel here as well so every time oh cannot invoke an object which is possibly undefined yes so we cannot invoke it directly we have to chain the execution with an optional parameter like this so let's try it again I'm going to go ahead and do this la la and once we created it actually closes and we can actually now do this redirect I completely forgot about that so let's go ahead and instead of create workspace form go ahead and add a router use router from next navigation in case you're lost where we are this is create workspace form inside of features workspaces components so the very first form besides out forms which we've created and now inside of here on success I'm going to destructure the data how do I know that I have to destructure it well because I am using the hook called use create workspace which uses the workspaces post so if I go s a workspaces server and find my post method here you can see that I know that I will return a newly created workspace inside of my data object right here and thanks to hono we have end to end type safety here so when I hover over data I know that I have the ID of the new workspace here so what I can do now is router. push open backck SL workspaces and then data and get the ID just like that let's go ahead and try this out let's see if this oncancel will maybe mess some things up I'm going to go ahead and do new workspace and let's see looks like I was not redirected and I think that that actually might be because of this on cancel so I'm going to go ahead and comment it out and see whether uh it will be resolved now so let's try another try here and there we go now it works with another try it works so I'm going to remove the unan looks like by the time this changes the URL this gets overridden so I'm not going to call on cancel here because the router will clear up the URL and since we are using URL as our uh Model Management this is a good enough solution great so we have finished that so what I want to do in the next chapter is build the individual create page so what am I talking about I'm talking about this random page which I've only wrote the URL of and haven't really spoken of more than that so inside of my dashboard workspaces page if we have workspaces we redirect to the first in the array but if we don't we have to handle this route right here that's what we're going to do next great great job now let's go ahead and let's create () the individual Standalone create route for a missing workspace so we're going to go ahead and do the following so far I've thought you that you can create route groups and put specific routes inside but I bet you didn't know that you can create an additional route group and put almost the same type of routes inside and I kind of butchered that explanation let me show you what I mean so let's create a new route group called Stand Alone stand alone purely referring to the type of layout that this is going to be uh I'm talking about the design right so let's go ahead inside of here and let's create a new folder called workspaces again and this time specifically create and then inside a page. DSX let's go ahead and create the workspace create page and a div workspace create a page like this so now at the moment you can see that my workspace ID page is in this layout with a sidebar but if I remove the ID from my URL and replace it with Slash create I am redirected to a page which definitely exists but it uses a completely different layout so you can do that as well and that's exactly what we are going to do so now let's go inside of the Standalone route group and let's create a new file called layout. bsx make sure to put the layout file inside of the Standalone route group and not inside of workspaces and let's go ahead and do the Standalone layout here let's create the interface stand alone layout props let's get the children which are react react node let's go ahead and extract the children from the props and now let's go ahead and let's style this so I'm going to go ahead and give this a main element and put the children inside I'm then going to go ahead and wrap my children around a div with a class name Flex Flex column items Center justify Center and py4 I'm then going to go ahead and give this main div a background neutral 100 and a minimum height of screen then I'm going to go ahead and create another div element here which will encapsulate my children and the div currently encapsulating my children and I'm simply going to give it a width restriction here so MX is going to be Auto MX is going to be with screen to Excel and the padding of four like this and I just had to refresh my page to finally see those changes uh great and now Above This div which is encapsulating my children I'm going to create a nov bar with a class name Flex justify between items Center and the height of 73 pixels and inside I'm going to add a link from next SL link with an HRA to the root of our app which will automatically uh redirect the user to the first workspace in the array or back to this page if no workspace exists and then let's add a next image where we are simply again going to render our logo. SVG let's give it an Al of logo a height of 56 and a width of 152 and besides that a user button from features out components user button like this and there we go you can see that now we have kind of a standalone layout uh the only issue I seem to be having uh is that it expands too much I want it to stop expanding at some point and I think that I made a mistake here instead of MX this is supposed to be Max screen so now let's try this again there we go you can see that it stops expanding at a certain point and the rest is actually pretty easy so now that we have the Standalone layout we can go inside of workspaces create page. DSX right here and what we can do is give this Diva class name of full width and on large uh Max with Excel and simply render the create workspace form inside just like this and there we go we now have our individual Standalone workspace here so now let's see how this will work so you can go ahead and you know create something from here and you will get redirected to that new page but the real purpose of this is onboarding because user will probably never visit this again unless they delete or leave all of their workspaces so right now this is how we create new workspaces but let's say you know we have a completely new account here looks like I'm logged out but I seem to not be redirected away from here and I know why because we forgot to add the uh redirection controls in this page so let's just manually go to Local Host 3000 here and now I'm redir Ed so I'm going to go ahead and click on sign up and I will create a new uh a new account here so let me go ahead and call myself I don't know do do mail.com do 1 2 3 4 5 6 7 8 and now since you can see that since I had no available workspace that I'm a member of I get redirected to this page so that is the purpose of this page so let's go Ahad ahead and add a couple of improvements so first things first once we click cancel I do want to uh do something I kind of want to go back uh to my uh route but we can actually fix this in a different way so I'm going to go ahead instead of create workspace form and if we don't have cancel I can actually hide the cancel button so I'm going to go ahead and do this I'm going to give this a class name using the CN Li library from lib utils so just make sure you have added this so I'm doing this in create workpace form in workspaces feature folder components and I'm going to find the cancel button again and very simply I'm going to do this if we have on cancel this will be block otherwise it will be hidden or maybe I'm looking for invisible there we go and this will be visible or we can just do this we can do this safely if we use CN because CN will not you know turn this into uh turn this into all Z it it will not like usually if you do this in a Turner if you open the inspect element you would see a class name called false or true right and I think that maybe I have to turn this into a Boolean let's see uh visibility hidden if on cancel exist if on cancel does not exist there we go so if not on cancel in that case this is invisible like this so right now if I click here uh okay let's go ahead and just create our first workspace here but here cancel exists right because we are passing on cancel in that uh model right and it's just to close the model like this so if we are manually stumbl on create the cancel does not exist because this is supposed to serve as an onboarding screen either way great now that we are already here let's go ahead and let's kind of see where where are all the places where we forgot to put our uh authentication right so let's go inside of dashboard inside of this page we are handling this so I will just copy this and prepare it let's go inside of workspaces workspace ID here and let's do the same thing so this will be an asynchronous uh server server component here and I will simply do get current from features out actions and redirect from next navigation like this so if user logs out from the workspace ID page they will get redirected away and let's do the same thing inside of Standalone workspace as create so again asynchronous and let's import get current and let's import redirect from next navigation there we go so now all of our routes that exist at the moment are protected great so if I were to log out from here I am redirected exactly as we expected great so you have now developed the individual workspace create page so what I want to develop next is the setting space page for my workspace so I'm going to go ahead and go inside of my Antonio account here uh looks like I don't have any uh workspaces to Antonio and I think that's because we cleared up the workspaces a while ago so I'm going to go ahead and create my first workspace in my Antonio account there we go and now when I click on the settings I want to see settings in my Standalone layout so that's why I want to do the settings next and then I'm going to do the members because they both use the new Standalone layout which we have just created and once we finish up everything regarding the workspaces we can go ahead and create our first project great great () job now let's go ahead and let's create the functionality to update our workspaces we're going to start with the schema so let's head inside of the source features workspaces schema schas and we can copy the create workspace schema like this and this time let's go ahead and let's make the update workspace schema the only difference being that the name can be optional meaning that it makes sense to change this message to genuinely be must be one or more characters because that's the correct message if you are about to change the workspace name we require you to add at least one character but if you don't submit a name we're going to consider that you want to skip updating the name so the image can stay exactly the same nothing needs changing here and it's optional great so now let's go inside of server inside of route. DS and let's go ahead and let's create create a patch method so at the bottom I'm going to add a patch to slash workpace ID here's a quick tip don't do this be explicit with your ID parameters is going to help you and save you some headaches trust me let's add a session middleware let's add a z validator here for the form and let's add the update workspace schema so make sure you have added an import for your new update workspace schema here and then add an asynchronous controller here let's get the databases here from C get databases let's get the storage from C.G storage let's get the current user from C.G user just like this and let's go ahead and let's destructure the param so C request foram will be workspace ID and let's go ahead and let's destructure the name and image URL from C request valid form and not image URL it's just going to be image what we have to do now is check whether the person who is trying to access uh this patch route even though they are logged in can they should they be allowed to do this so we have to see whether this person is a member of this workspace so let's go ahead and do const member and let's go ahead and create a little helper called get member so let's go ahead and do that I'm going to go ahead and do you know for now just null and let's go inside of our feature members feature folder create a new file called .ts go ahead and import query from node app right and type databases from node app right import the database ID and the members ID from the config and Export con get member to be an asynchronous method let's go ahead and create an interface get member props to have databases a type of databases workspace ID to be a type of string and user ID to be a type of string so we now have to assign this props right here databases workspace ID and user ID so we are getting the three minimum values we need to fetch the the current member and then let's do const members await databases list documents passing the database ID passing the members ID and finally add a query confirm that the workspace ID equals the past prop workspace ID and we can collapse these two in an array the second query should match the user ID like this and return members documents first and only in the array well nothing is really you know nothing on the orm wise is protecting this to be the only member but we know thanks to our implementation and how we are working with the members collection that with our with our implementation how how these are created only one of this exact combination should exist if two of them exist we have a problem all right and now let's go and by the way yes you can create indexes in app right so we can come back to this later and explore if we can perhaps have this be an index and also give it a unique property so maybe perhaps that can throw an error and if you want to protect it in another way you can do it instead of workspaces server route. vs when you create one you can check for this new member which you've created and you can then query and if if you can find another member with the same user ID and the same workspace ID you have a problem and you would have to do the same thing in the upcoming uh join route I'm going to you know repeat that once we get to that for now let's just focus on this so now we have the get member method which will be our helper whenever we need to quickly access a member so now let's go ahead and let's see can this member actually update this workspace so a wait get member passing the databases passing the workspace ID and passing the user ID which is user. ID and we have to import get member and we have to await get member make sure you have imported this from features members utils and then if there is no member to be found or if member. roll is not member roll. admin in that case we're going to return c. Json error unauthorized like this and let's go ahead and also assign a 401 great and to answer your question yes you could explore and see can you do this in the session middleware I've attempted to do it a few times but it just became too big of an abstraction to keep care of right now it seems very easy to do the problem is we are not always going to have the workspace ID inside of our API URL that's the biggest issue so if you were to rework when you finish the entire project if you were to rework everything to have nested API routes so every single API route will have the workspace ID in the context then yes you could probably extend the session middleware to accept some options like uh admin true and then you would not have to do this every time but for now I think this is just fine and now let's go ahead and basically what we have to do is well repeat everything that we did initially right here so let's prepare the uploaded image URL and this if Clause deciding whether the file should be uploaded or not so I'm going to copy this exact block from my post method and I'm going to paste it in my new patch method after my authorization here there we go and then what I'm going to do is const the workspace to be await databases. update document I'm going to pass in database uncore id workspaces id workspace ID since I have it it's inside of my uh request Pam right here and then I'm going to go ahead and pass in the name and the image which will be my uploaded image URL and be careful it's image URL when storing it into the database that is the very important part we can confirm that by going inside of our post method you can see it's image URL that is being accepted so to repeat we are calling it image inside of our form data or our request body because technically especially in this case of patch it can be a string it can already be a base 64 URL so if I were to call this image URL it wouldn't make sense when user sends a file and if I were to just call it a file it wouldn't make sense when user sends a URL so that's why I've just named it image and that's why we are doing the instance of check here to see what do we have to do with this because if we just receive an image uh we can just go ahead you know and leave it as it is so no point in even updating it but here's the thing uh one thing that is kind of bothering me is that this uploaded image URL should by default uh be it should be exactly what uh we have passed right I think I'm kind of seeing a potential bug here else if image is a type of string or I can do just else if uploaded image URL to be my image can I just do that else whoops just else and then uploaded image is passed here okay I think that we can do that to kind of preserve our uploaded image and then what we're going to do in the end here is just return c. Json data workspace so the updated workspace great so we have created our update method now so let me close everything and let's go inside of our API let's copy use create workspace and let's do use update workspace here let's go ahead and change the constant name to use update workspace again and be careful you're in the correct file and we are now going to change both of the response and request types to first get the colum workspace ID and then get the patch method so these are the inferences which we need and then we have to change that here as well so we are now getting the workspace ID patch and we also need to destructure the parameter this time and we also have to pass the param this time and this will be failed to update workspace and this will be workspace updated and inside of here on success we can destructure the updated data I believe uh data does not exist on response type okay let's see what that is about so if I go back inside of my patch method server route my patch here return c. Json data workspace so this definitely should exist so I'm not entirely sure uh why it's throwing an error here response type oh yes so we have to be explicit with our response types perhaps this is something that we should revisit our response types can by default will give us an error or the data so I want to give this a 200 meaning that I only want the success version of the response type because I'm handling the error here so now you can see that it works here now I can safely use the UN success method here and then what I can do is I can invalidate queries individual workspace and data ID this does not exist yet but it will exist in the future and we technically don't have well yes it's better that we update this as well in case you know we rename one from our list we need to get that updated in workpace switcher as well so yes inside of your API inside of your mutations if you want to do something in the on success like data here uh looks like here it's working okay I think it depends on the type of API route that we use right so I guess that here somewhere we are throwing errors yes in this one we are throwing errors so that's why we have to specify that instead of our request response type here we only want to focus on the positive uh optimistic route right because we are going to handle the error here all right now that we have this ready we have to go ahead and create our uh edit workspace form so let's go ahead and do that I'm going to go ahead and do go inside of my Source instead of my features workspaces components I'm going to copy create workspace form and I'm going to paste it and I'm going to turn it into edit workspace form double check that you are inside of the newly copied edit workspace form and let's go ahead and create and remove these three instances to edit workspace form like this besides on cancel this will also have the initial values the problem is we don't have the type so let's go ahead and let's create the workspace type I'm going to go ahead inside of my workspaces feature folder and I will create a new file called types. DS inside of here I'm going to import models from node app right and I will export type workspace and I'm going to make it be models. document which means this will hold all the ID collection ID database is and also this ambiguous any but this time we're going to extend it with the fields we know are there like name image URL invite code and user ID so we know that these things are what exist in the workspace so I'm going to go inside of my edit workspace form and I'm going to go ahead and pass my workspace from dot do/ types to be here like that now we have the initial values inside of here alongside on cancel great so now let's go ahead and let's modify our hook form here to no longer use the create workspace schema so we can remove one two three four instances of create workspace schema with edit workspace schema did I call it edit workspace schema uh I didn't I called it update workspace SEMA okay so let me just fix this so all these four instances in the onsubmit method in the Zod resolver in the infer of the form constant and in the import change all of them to update workspace schema all right and now let's go ahead and do the following I'm going to go ahead and change the default values to spread initial values here and then image will be initial values image URL or just an empty string that's how we're going to initialize our values and we need some special uh care for the image here great and now inside of the onsubmit we have to modify it uh just a bit here so we are passing the form but we also have to pass in the Pam which will be workspace ID and it has to be the initial values do ID like this there we go and inside of here let's change this to be undefined and that did not fix this issue so let me see uh the property name are incompatible okay so I'm going to have to uh improve this but okay let's leave it like this for now let's for now just change the text here so I'm going to go ahead and change this card title to Simply say initial values. name here for now okay let's leave it as this as this yeah and now I'm going to close everything and I'm going to go inside of my source instead of my features my apologies in my app folder Standalone workspaces and I'm going to create a new folder workspace ID so exactly the same as they have in my dashboard but then I'm going to do an additional folder called called settings so if you access the settings you will have a standalone layout rather than the dashboard one because uh well it just suits more now let's go ahead and give this a page. DSX let's go ahead and turn this into a workspace ID settings page I like to be explicit with my page names here ID settings page like this and let's turn this into an a synchronous method let's get the user using a wait get current if there is no user we are going to redirect the user to slash sign in so let's immediately take care of that so we don't forget and now what we have to do is we have to extract the workspace ID from our uh from our uh uh server component because we can do that if you have the workspace ID from here the same way we used the hook use workspace ID to uh infert the pams we can actually get some default props that every server component has to D structure the ID inside of a server component so let's go ahead and create an interface workspace ID settings page props and let's go ahead and give it Rams SL SL string not slug my apologies uh workspace ID string so now you can go ahead and assign those here and you can D structure the params and you should now be able to get rams. workspace ID inside of them so let's go ahead and let's I am now on my test workspace here so if I were to pend after my workspace id/ settings I should get redirected to the Standalone layout and I can read my workspace ID from my URL inside of a server component because remember instead of server components I cannot use hooks like this that's only for client components great so now that we have this ready uh one thing that I want to do before we even go here is enable the actual settings button here because right now clicking on it leads us to nowhere so let's first fix that and then we're going to go ahead and finish the settings form so in order to fix that we have to go back inside of our source components navigation component where we have our settings actually defined and inside of here I want to import use workspace ID from features workspaces hooks use workspace ID uh and I also want to import use path name from next navigation so inside of here I think that the nav the nav bar my apologies the sidebar is is it a client component I'm not sure the workspace switcher okay so the workspace switcher needed its own news client so the navigation will also need its own use client so make sure that inside of the navigation. DSX where you have the routes constant you have added use client at the top great now inside of the navigation here we're going to Define our workpace ID to be used workspace ID and then our path name will be our used path name here and then we're going to go ahead and inside of uh routes. map we're going to Define the full hre to where we are going to have to redirect because we can't just redirect the SL settings we have to redirect the current route and then slash settings so I want to go ahead and do this I want to go ahead and create the full hre to be slash workspaces and then slash workspace ID and then item. hre we don't have to add a slash here because each of these has a slash except the homepage which basically is just this that's why it's okay to put an empty string in this case and let's go ahead and check if path name is equal to full hre so only then is is active actually going to be true and let's change the HRA here to be our full HRA and now there we go the home is now selected and if I click on settings I am redirected to the standalone settings page and if I go back you can see how home gets selected perfect so now we can work on the settings page here so the first thing that we need to do is make a way for This Server component inside of our features workspaces here where is our uh my apologies inside of our app folder Standalone workspaces workspace ID settings page we somehow need to pass our edit uh workspace form which we just edited and copied you know from the create workspace form the problem is it is missing initial values right you can see that a lot of issues here are appearing so we need to find a way inside of our server component here to get those values of course we don't have to do that you know we could just create a wrapper and just use uh use get workspace if that's what we prefer but you know let's explore our options uh let's see if maybe this would be uh simpler to do so I'm going to go ahead and I'm going to go inside of my app folder my apologies have of my features workspaces actions and I'm going to go ahead and copy get workspaces and I will paste it here and at this point I don't like how many times we have repeated this client so I'm going to look into ways to abstract this somewhere so I'm going to call this get workspace and I will accept a workspace ID which will be a string and I just want to be consistent so I'm going to separate this into an interface get workspace props workspace ID which is a string like this so let me just assign this here there we go workspace ID so everything here can stay the same except this this can be null because this time we are not going to list anything so the members are not something we need here at all uh we're just going to need we're just going to need the current workspace so let me go ahead and do this the individual workspace get uh yes we can do get document here and we can simply pass in the workspace ID and in the case of catch we can just return null and we can let's leave the user here for now because I think there is one thing that we can already do here is check should this user be able to access this workspace so yeah we can do that member will be a way to get member from do/ uh members utils like this or you can change it to slash you know features I think this makes more sense I want to see where it comes from like this so wait to get member pass in the databases pass in the user ID which is my user. ID and passing the workspace ID which I'm getting from my props here and then inside of here if I'm not a member of this work base I can just return back no I don't even have to throw any errors here so let's return null like this and then let's go inside of page and let's go ahead and after this redirect let's get the initial values to be await uh get workspace and I've imported that from workspace actions here and I'm going to pass in the workspace ID to be par Ram's workspace ID if there are no initial values I'm just going to go return now or I can return or I can redirect here to forward slash or maybe just forward slash workspace ID arams workspace ID in case I cannot load the initial values I will just redirect the user away from the set page and if I do have them I think I will be able to send them now all right so document is not assignable uh to workspace okay and we can actually fix that so let's go setad of get workspace and inside of here when we get the document let's go ahead and give it a specific type here of workspace from dot SL types and I can already see the error in my other tab is gone so that's how you you can you know modify these queries from app right to actually give you uh the proper types and there we go now you can see it's gone and you can also see my settings right here excellent so what we have to do now uh is we have to uh well first change the text here and we also have to change the methods we are calling so you can see that now if I go ahead and I create a new workspace here workspace to to edit and create it let me zoom out and then click on the settings there we go it says workspace to edit and let's try can we load the image so I'm going to go ahead and call this test image and I will upload an image so let me just find the one uh that I use all the time let's go ahead and click create workspace there we go this is working and if I click on settings it works as well well great so we can definitely load this now let's go ahead and let's see inside of our edit workspace form what are all the changes we need to do uh to make this actually work let's start with changing the design a bit so I'm going to go back inside of my edit workspace form I have loaded the initial values and let me now modify the card header a bit so I'm going to go ahead inside of the card header and I'm going to give it a flex Flex row items Center Gap X4 padding of seven and space y zero so I override the existing space Y and then what I'm going to do is I'm going to add a button before the card title and this button will simply say back this button will also have a size of small it will have a variant of secondary and it will have an onclick to be on cancel and then let's also go ahead and give it an arrow left icon from Lucid react like this oops there we go uh well where did I move my arrow left icon let's keep it inside of the button and let's give it a class name of size four and it should be before the text like this uh and the this is two uh joined together so let's give it an MR of two as well so it looks a bit better great uh and now in the card Title Here we have our test image okay so that looks fine great and now let's go ahead and modify the text here from create workspace to to become uh save changes like this and one more thing we're going to do is we we have our router here so for this button here we're going to do if we have on cancel we're going to call on cancel otherwise we're going to go ahead and do the an narrow function router. push and simply go back to workspaces and then initial value Val use do ID let me expand this so you can see what I did so in this new button which we have added in our card header I have added an if we have an uncan call the uncan otherwise go ahead and create an arrow function which will simply redirect the user back to the workspace where they come from because in a server component we're not going to pass the UN cancel this on cancel is only you know for models and stuff so right and when I click back there we go I am redirected back to the workspace where I come from now I'm noticing that this just looks a little small so let's see why is that happening I assume it's something inside of the uh app folder Standalone lay out here uh let's see did I forget uh to do something here so I think this is just fine mxw screen 2 Excel that's okay let's take a look in the workspaces workspace ID page I think I know uh what I have uh done so let's go ahead and give this div a class name of full width and on large maximum width of excel so I think that now there we go now we get some serious space here great and let's go ahead and now and actually call the proper function in the edit workspace form because so so far I think we've been working with use create workspace so now let's do use update workspace and remove use create workspace here and you can see that the moment I replaced with that this new mutate no longer gives us any errors so let's see if this actually works uh so my current workspace name is test image I'm going to click settings and call this test rename and click save change es and okay I get an error let's see what's going on and I get a 405 can you guess why did I get a 405 so that means method not found uh let's go ahead and go inside of source app folder API rout route. DS I forgot we have a new patch so let's go ahead and handle that with hono as well let's save it let's try again test rename and all right something happened but looks like I have made a mistake uh in regards of my uh image URL here so it looks like I have somehow accidentally updated one of my workspaces here in this case it's this one called test rename I have updated the image URL to literally be a string undefined and I think that's because of my recent change I did in the edit workspace form inside of my onsubmit method I have changed this from an empty string to undefined I will now convert it back to an empty string so now it is exactly the same as the create workspace form so if I go inside of my own submit here there we go it's exactly the same now so this is what I'm going to do if you cannot find if this happened to you and you cannot find which one it is what you can do is you know just go inside of your workspaces be careful that you're not selecting collections select all workspaces and just delete all workspaces sometimes you might have two pages I'm now going to go inside of my members and I'm going to delete all members here let's try this thing again I'm going to go ahead and I'm going to go inside of Local Host 3000 here and I will create a new you know test with image and I'm going to go ahead and select uh a random image that I have uh from unsplash okay let's create a workspace here there we go this works just fine I'm going to go inside of settings and I will change this to test rename and click save changes and there we go I successfully renamed this workspace great and I'm now going to go ahead and try and upload a new image so let's go ahead and try this out another image from unsplash here let's see if this time a new image will be appended and there we go a new image was added great before I wrap up the chapter there's just one more thing I want to do and it's in regards to well both the create and the update form but let's do it in the create form first so have your create form opened and go inside of the create workspace form right here one thing that we forgot to do is that when I add image I have no way of removing that image right so let's go ahead and just create a quick uh function for that so this is what we're going to do we're going to go ahead and find our button for upload image here inside of the create workspace form and I'm going to wrap it inside of a ternary conditional if we have field. value in that case I'm going to render one button otherwise I'm going to render another button so I will just copy this button and put it here like this and now I'm going to change uh what these buttons actually do so if we have a image then the button will say remove image its variant will be destructive and it's on click will do the following it will first do field on change to be null and then it will do if input ref. current it will do input ref. current. value is an empty string and there we go you can see that now uh if I do test here and if I upload an image I can click remove image and the image gets removed great and now we can do the exact same thing so I'm going to copy this stary and I'm going to add it inside of my edit workspace form right here so let me go ahead and find my upload image button I will select it and I will replace it with the these taries to either remove an image or to upload an image so now if I go inside of my settings page you can see that I have the option to remove the image here as well great so you've just created the settings page uh you've handled out redirects you have loaded the initial settings you've learned how to mix server components with client components you've learned how server components can be served as server environments one thing that's bugging me that's probably bugging you as well is this inside of my actions here in the workspaces I am repeating a lot of code especially you know this client it's mostly because you know of this I kind of want to handle this in a different way every time but I think what I can do is I can just throw error if there's no session and then I can just decide how my catch will react right so I think that's what we can focus on in the next chapter abstracting this client right here and then we're going to go ahead and do the settings uh do the members for a workspace great great job now let's go ahead and let's refactor our server side queries () especially that repeating uh client initialization code so let's find the first one I want to fix the first one I want to fix is inside of the in is the basically get current so here here's what I want to change first instead of calling this actions I want to call this queries because they're not actions so now we have to find all files which have used get current so let's go ahead and do that and let's refactor them I'm going to go ahead and expand this as much as I can so first one is insource app folder out route group signin file and it looks for action so we're going to go ahead and change this to queries or we can do this in a faster way perhaps if you're using visual studio code you can search for all instances of actions and then you can select all of them and replace them with queries just make sure you don't misspell them and replace and I think that now there we go I have eight refactored files and all of them have the same change simply changing features out queries uh features out actions to queries so you can do that great that's the first thing I wanted to do because they're not actions so let's now go back inside of features Al queries and now uh let's resolve this so we're going to go ahead inside of our lib app right and we're actually going to do uh what was here in the first place so export asynchronous function create session client which I so proudly told you that we're not going to do because we're going to use the middleware well we are still going to use it in the middle work separately so this will be for Server components and let's copy the client from get current for example like this and then let's go ahead and let's get the session so we need to import cookies from next headers and we need to import Al cookie from features Al constants like this and make sure to also have server only here at the Top If there is no session or if there is no session. value we're going to throw new error unauthorized here otherwise we're going to go ahead and do this well first we're going to do client set session session. value and then we're going to go ahead and do this so get account get databases let's go ahead and do return new databases client and I think for now we only need account and that I don't think I've used anything else and I just want to bring something to your attention so you can see how here I'm using session and session. value but you probably notice that inside of my session middleware I only do if not session that's because inside inside of the session middleware we're using get cookie from hono cookie so inside of here session is directly the value but inside of the next cookie inste of here it's a object which has the value so that's why I'm doing that and since we are not going to use this inside of any routes honor routes we're going to use them inside of server components directly so this is why I have to handle using next headers all right so now I have uh this create session client set up so let me go back and set of my out queries. DS and let me remove this entire thing now so I'm just going to do const create session client here and can I the structure account from here oh wait and I have to import create SE client from Li app right can I destruct your account I can yes this is exactly what I do and I'm going to wrap it inside of try and catch because I'm going to get an error thrown here if I'm unauthorized there we go I just reduced a bunch of code here let's just see if it's working so I'm in a random workspace ID here if I log out this should still read irect me and it does and if I go to local close 3000 it redirects me back if I go to local 3000 workspaces one through three settings it redirects me back immediately excellent now I'm going to go back inside of my uh user here and I'm going to try the opposite I'm now logged in and I'm going to try and go to slash sign in and I get r directed to here excellent I think we have we established that this is working just fine so now we resolved the out queries let's go ahead and go inside of the workspaces again we have workspaces actions here let's go ahead and first do the refactoring of renaming the actions to queries because they're not actions queries like this so now I'm going to go ahead and find everywhere where we use featur features workspaces actions okay lucky for us it's only two places in the dashboard uh page right here let me show you where it's located so instead of source app dashboard rout group page. TSX change this to queries that's the first thing we're going to do and one more place is here let me show you again instead of source app folder uh this time in Stand Alone workspaces workspace ID settings page. DSX so change these to queries basically find all instances of features workspaces actions and they now must be queries there we go first part of refactoring done now let's go inside of features workspaces here inside of the queries and let's go ahead and remove this now so we no longer need any of this here the only thing we're going to need now are the databases and the account so I'm going to do const databases and account from async create session client not async a wait create session client from lib app right and I think this will work just fine it's inside of try cat and inside of cat we decide that this is what we return so so in case we get an error here it will fall back to this which was exactly what it was before great so we have resolved this and now let's do the exact same thing instead of get workspace so we remove the entire client thing here and all of these I just add this and there we go so what are we supposed to test now well first let's remove the unused out cookie let's remove the unused Imports so we are supposed to test these things we're supposed to test whether we get redirected the to the first available workspace ID when we hit Local Host 3000 let's see if that works it works we get redirected to the first ID great the second thing we have to check is the settings page so let's see if that works if it does we have successfully refactored there we go amazing amazing job you've just done a refactor so you don't write as many code and you can now safely you know uh use this inside of your server components every time you need uh great so does this mean that uh We've wrote some API routes which are useless no it's just that if we have a server component it's a shame not to use it right uh but don't worry we're later going to have some models which are impossible uh to you know prefill as a server component so we are going to have to use those API routes we have which we have just created but you know uh if possible I like to use server components uh to fetch the data and especially to redirect and protect because it's just more convenient than to use use effect great so you've handled that refactor and what we're going to do next is create the members page great great () job before we can move on onto the members list there is a couple of things I forgot to do in the settings page so we're going to go back to our edit workspace form but before we can even do that we have to create some new API routes so let's go inside of features workspaces server route. TS and inside of here at the bottom I'm going to add a delete workspace ID so we're going to create the delete method now I'm going to add the session middleware and I'm going to add uh an asynchronous controller right here let's go ahead and let's get the databases from CET databases let's get the user from CET user and let's get the current member from await get member and let's also destructure the workspace ID from C request parm like this now we can pass in the databases we can pass in the workspace ID and the user ID coming from user. dollar sign ID if there is no member found or if that member. roll is not member ro. admin in any of those cases we're going to go ahead and break this method by returning back an error unauthorized and the 401 code otherwise let's go ahead and let's delete the database document so await databases. delete document database underscore ID workspaces underscore ID and passing the workspace ID right here and we're going to return back the ID which we deleted so I'm going to do c. Json data and I'm going to simulate as this was coming from app right since since we've learned that our data will almost always have dollar sign ID I don't want to change that now by adding my ID so I'm going to keep the dollar sign ID and I'm going to add uh the workspace ID which I had from my param like this there we go so that is my delete document and I'm going to add a to-do list here to-do delete members projects and tasks because we have to delete them manually if we are deleting a workspace all right now let's go ahead instead of API and let's copy use create workspace and let's rename it to use delete workspace let's go inside of the newly created use delete workspace and let's go ahead and rename some things so use delete workspace and let's go ahead and change this to be workspaces workspace ID and change the method to be delete there we go response type and request type let's go ahead and do the same thing inside of the mutation function itself so workspace ID and then the delete method and besides this time we're not going to have form we're actually only going to have Pam there we go no errors and we're going to change the error here to be failed to delete workspace this will be workspace deleted and this will be failed to delete workspace once again we're going to invalidate the queries workspaces and the individual workspace with our data uh let's see also we have to change the response type here to only be the positive one because we are protecting that API route so it can have an error coming back so inside of here we're going to also get data ID this does not exist yet same thing as our update workspace method great so we now have our used delete workspace here so let's go ahead and let's revisit our workspaces feature for and go inside of components edit form inside of the edit uh workspace form here let's go ahead and let's wrap this entire thing uh inside of a div so before the first card even appears let's add a div because we're going to have multiple cards inside like this so I'm going to go ahead and indent this entire card here and I'm going to give this div a class name of flex Flex column and Gap y of four so now I'm going to go ahead and go to the end here and add a new card and I'm going to go ahead and give this card a class name full width full height border none and Shadow none basically exactly as we had above then inside of here I'm going to go ahead and add oops card content in which I'm going to give a class name name padding seven and I'm going to add a div here with a class name Flex Flex column and then inside of here I'm going to add an H3 element danger zone I'm going to go ahead and give the danger zone a class name of font bold and then below that a paragraph explaining what's happening so I'm going to give this a text small and text muted for ground inside of here we're going to say deleting a workspace is a irreversible and will remove all Associated data uh so is irreversible let's just fix the grammar deleting a workspace is irreversible and will remove all uh Associated data okay I I hope I wrote that correctly great and outside of this paragraph we're going to go ahead and add a button and this button will say delete workspace let's go ahead and let's give this button a class name of margin top six with fit ml Auto like this and let's go ahead and let's give it a size small let's give it a variant of destructive and let's go ahead and give it a type of button and now let's give it a disabled of is pending and let's go ahead and give it an on click for now to just be an empty Arrow function so there we go uh we now have uh a danger zone right here where we can delete our workspace but before we can do that uh I want to create something called a confirmation model so I don't want to be able to just click here and get my workspace immediately removed I first want to create a use confirm hook let's go inside of source and let's create the reusable hooks folder inside of here I'm going to create the use confirm. TSX so it's important that it is a TSX file let's go ahead and let's import use state from react let's import button not from react today picker but from s/ components UI button from here and alongside button I also want to import the type button props here and then let's also import a responsive model from components responsive model and let's go ahead and let's import everything from our card so card card content description header and title and then let's export con use conf confirm so this will be a handy little hook which will trigger a model for us every time we need one so let's go ahead and let's give it a required title a required message and then a variant which will be button props variant and it will have a default value of primary so it's optional then let's define the promise and set promise to be US state and by default it will be null but let's give it some proper types here so it can be a type of object which has resolve inside of itself with a value Boolean like this and it returns back a void or it can be null like this then we're going to go ahead and create const confirm which will call new promise so we can aade this whenever we need it we're going to see how handy the functionality is in a moment once we wrap it up so let's call set promise and resolve then let's do const handle close to very simply return the promise as a null which will later control the dialogue which will close thanks to this action so that's handle close then let's do con handle confirm so this handle confirm will simply call the promise and resolve it to tr and then wherever we use this we're going to consider this as something that user pressed to confirm and we also have to do handle close after this and then we also have to handle cancel which is basically deny so handle cancel promise resolve false and then close and finally then we can go ahead and create our const confirmation dialogue let's use the responsive model let's give it an open to be if promise is not null and on open change can simply be handled close inside let's add a card with a class name full height B width border none and Shadow none and let's add card content here with a class name adding top of eight inside of the card content let's add a card header which will hold the card title which will have the title prop which we are going to pass and let's give the card header an override padding to padding zero let's let's add card description to Simply have our message prop here outside of the card header we're going to add a div with a class name padding top of four full with flex Flex column Gap Y 2 large Flex row Gap X2 items Center and justify end and then we're going to go inside and add two buttons both of these buttons are coming from type component UI button so the first button will have an onclick of handle cancel variant of outline and a class name full width but on large devices outo with and inside this button will say cancel we're then going to copy this this one will say and I'll confirm the variant will be a prop variant and the class name can stay the same and this one will say confirm like this and then we just have to return confirmation dialogue and confirm like this and let's just modify our expected return props here because otherwise uh typescript is going to give us an error so inside of the use confirm here go ahead and give it the expected return types to be an array the first element is our confirm model which is a jsx do element like this and the second one is a promise of unknown there we go and looks like I'm getting uh an error here uh so let me just confirm oh yes the confirmation dialogue here is supposed to be returning not inside of curly brackets inside of normal brackets my apologies okay that works uh but looks like uh my promise here is set incorrectly so let me just see uh what mistake did I make here oh I think I know why it's because I have to return the promise inside of my confirm method I was looking at this sorry so return new promise instead of the confirm method and there we go now this is resolve great so now let's go back inside of my features workspaces inside of components edit workspace form and what we can do now is a very cool thing I can go ahead and add const uh Delete confirm delete dialogue let's call it like that delete dialogue and confirm delete from use confirm which is my you know globally reusable hook I'm just going to move it here and I can go ahead and say exactly uh what I want to warn my user about so for example when they're deleting I'm going to give them a title of delete workspace and I'm simply going to tell them this action cannot be undone and I'm going to give them a destructive variant so they know that this is a destructive action I'm then going to go ahead and create a method const handle delete which is going to be an asynchronous method and I will then get an okay from await confirm delete if not okay I will break the method otherwise I can cons the log deleting like this let's go ahead and use dis handle delete and let's assign it to our new button delete workspace let's see what happens I'm going to go ahead and open my console here and when I click delete workspace let's refresh uh first when I click delete workspace uh looks like nothing is happening and I think I know why because I forgot an important thing I never used the delete dialogue we have to render that inside of our code so I'm going to put it just after my first div here and it's a self closing tag let's try this again now I'm going to refresh this I'm going to expand my inspect element I'm going to click delete workspace and there we go you can see how it asks me to confirm or deny and this is mobile mode I believe uh is it mobile no okay so this is on mobile on desktop mode I would expect it uh to be next to one another so let's go ahead and see can I quickly resolve that in of use confirm here uh so it says Flex Flex column but in large it is flex row and I think that this should be justified between maybe no this still is not working uh okay let's leave this back ad justify end let's just leave it like this for now okay and when I click confirm here you can see I get the deleting console inside so now I have a confirmation which will fire every time that I need to delete something dangerous uh great now let's go ahead and let's add another mutation here so const mutate delete workspace is pending will be is deleting workspace and let me just fix the capitalization here from use delete workspace so this is a new hook which we we've recently created API use delete workspace I'm just going to collapse these two so it's more readable for us and now I'm going to go ahead and go here and simply pass in the delete workspace and I'm going to pass the PM to be workspace ID initial values. ID that's it and after the on success here we should go to router. push to the root page there we go uh but I do want to fix uh this because it is bothering me uh so let's see what exactly uh is going wrong here so I should be able to expand this let me zoom out as much as I can I'm trying to keep it inside of uh desktop mode so let's see what if I remove the flex column completely here so now it works so this LG Flex row seems to not be working that's interesting the position does not matter but I am definitely on LG value if I move it to a lower breakpoint medium still the same thing uh okay H I'm going to pause the video and I'm going to see how I can debug this I think I know why it's happening uh and it's one of those things which I warned you about in the beginning so it it's it's bothering me because the Tailwind for this is correct it should be working let's go inside of our Tailwind config and let's see something our Tailwind is covered inside of pages inside of components inside of app and inside of features which we have added and where is our source hooks use confirm inside of hooks which means Tailwind is not active there you can see what kind of bugs appear and they're so so hard to debug because you have no idea what's going on so let's add hooks here as well this is why I warned you in the beginning to add this to your features because you would be losing your mind as to why it's happening and there we go the moment I have added that you can see that now I have a nice mobile and desktop delete workspace and let's see if this is finally working so inside of here I have one workspace let me create uh two workspaces here I'm going to go to the old one click settings delete workspace and confirm it says failed to delete workspace and it says 40 5 you already know what that means it's because I consistently refuse to write all the uh methods inside of my initial hono here but I think this will be the last one we will use so there we go delete finally all right please work now confirm there we go workspace deleted and only the other one is available amazing so if I deleted this one now I should get a rid directed uh to my create method so this is kind of a bug okay good thing that we have tested this uh so yeah H that's interesting yeah so it redirected to this and then I got redirected I guess to some cache I guess this is cash so here's what you can do in order to avoid that kind of thing uh we can go inside of features workspaces API use delete workspace and instead of uh okay my apologies uh use delete where do I use use delete inside of edit workspace form okay so it's what I was just had opened here let me find the delete workspace here and instead of doing router. push I'm going to do window.location.href right here this will do a hard refresh and I think it will clear any cache which is there at that moment which uh you know tells you that the route still exists so if I now create a test workspace here and if I go inside of settings let me just refresh just in case and click delete workspace there we go I'm redirected back to the create method great so that now works amazing and let me just use this is deleting workspace uh all the way down to this button so I'm going to disable it if it's spending in meaning like we are saving the form above but also if we are deleting it uh great so this is now working we now have extended our settings form here and there is one more thing we have to extend the settings form with and that is the reset of the invite code but we're going to stop the chapter uh so you can wrap up the deletion process great great () job so to wrap up the settings form of the individual workspace let's create the last method and action which will be here which is the action to reset the invite code which is a 10 six 58 digit code whatever you decide so let's go ahead inside of our features workspaces server route. DS and I'm going to go ahead and I will copy the delete method and just chain it below I'm going to change this to be a post method and it's going to be called slw workspace ID SL reset invite code and we're going to do the exact same logic here so only admins can reset invite codes here we don't have to delete anything here instead the only thing we're going to do is update the doent with a new invite code using the generate invite code which we already have here and just pass you know how many numbers you want let's see I used six numbers when I created the workspace in my post method so okay I'm going to use six numbers and letters again and since I have the entire thing I can just return the workspace I think const workspace like this there we go and just return back to workspace there we go uh we have that ready and now I want to go ahead and go inside of my API and I'm going to go inside of use update workspace actually let's do use delete workspace it's more similar and let's call this use reset invite code so it's very descriptive hook let's go ahead and change the constant name use reset invite code and now let's change the response and the request type here so it's going to be workspace ID but after that it's going to be reset invite code and after that it's going to be a post method the 200 will stay here because we are throwing an error in case we are not the admin and after that we have to do the same change here so this is a post method but in between these two we are passing in reset invite code we are not passing any form data or any Json but simply the Pam which is the workspace ID which we need this will be failed to reset invite code and inside of here the only thing we are going to reset is the workspace and data ID right here and I think that what we could also do okay we're not going to do that here never mind uh I'm going to tell you what I was thinking about when we get to this and I'm just going to write here uh invite code reset and failed to reset invite code there we go okay and now let's go ahead and let's go back inside of our features workspaces API my apologies components edit workspace form and now I'm going to copy this card which I have created for the danger zone and I'm going to paste it in between my first card which was my form and my danger zone like this so now if I save I have two danger zones so now I'm going to go ahead and uh modify this so this is the reset invite Zone first let's go ahead and let's create a constant which will hold the full invite link because this is something that users will be able to copy from here as well so open backx and go ahead and give it a window location origin slash workspaces whoops outside of this slash workspaces and then slash initial values dollar sign ID and then slash jooin and then initial values dot invite code just like that there we go we now have the full invite link here and now let's focus on this second card which is a copy of our uh danger zone here so I'm going to change this to be invite members I'm going to go ahead and change the paragraph here to be use the invite link to add members to your workspace and then I'm going to go ahead and do the following so I'm going to add a div here with a class name margin top of four inside of this div I'm going to add a new div Flex item Center and GAP X of two then I'm going to go ahead and add an input which will be disabled and have a value of full link inside uh full invite link yes it's full invite link and below that we're going to have a button well below that but actually next to that we're going to have a button uh with an onclick for now just an empty function and then a variant of secondary and the size let's actually use class name size 12 like this and inside let's add a copy icon from loose react so make sure you've added the copy icon from Lucy react here and there we go you can see that now you have the full invite link and when you click this it is supposed to copy it uh to your clipboard so let's Implement that but let's just give the copy icon a class name of size five and now let's go ahead and let's call this handle copy invite link like this and let's develop it right here const handle copy invite link we'll do Navigator do clipboard. write text full invite link from the constant we have above and then let's use a then and call the toast which you can import from soner I'm just going to move it to the top with these packages here so toast. success invite link copied to the clipboard or no need for D just like that there we go so now when you click this there we go invite L link copied and when I paste there we go so obviously this exact route does not exist yet but I already know that this is the correct invite code it has six digits and I think I saw I saw it when we were looking at our databases so we're later going to create this join uh route right now it does not exist so this is what users will enter and then they will be able to become members of the workspace but now we have to create a functionality to reset the invite code so let's go ahead and finish the UI here uh at the bottom so we have prepared this delete workspace which we just copied so we're going to go ahead and call this reset invite link like that and let's go ahead and just add a doted separator here with the class name of P D y-7 and I think that I forgot to add the dotted separator for my danger zone so let's just do that I want to be consistent so inside of here I have this button delete workspace and just above it I will add a dotted separator with a class name py7 there we go now all of my forms here have nice dotted separators here uh let's go ahead and let's actually add the mutation I'm going to go ahead and just cop this one and I will now rename this to use reset invite code mutate will be reset invite code is spending will be is resetting invite code there we go so now let's go ahead and let's also copy the use confirm because this is also destructive action so this will be instead of delete dialogue this will be reset dialogue and this will be confirm reset and this will be set invite link and we're going to go ahead and give it uh this will invalidate the current invite link just so the user knows if they have shared this with anyone uh they're going to have to share it again great let's go ahead and add the reset dialogue first so we don't forget it so I'm just going to add it below the delete dialogue and then well we can go ahead and copy the handle delete method they're both very similar and we're going to call this handle reset invite code [Music] confirm reset and instead of delete workspace we're going to do reset invite code and the params are exactly the same but the on success does not need any redirection but it will need something so now let's append the handle reset invite code to our new card in the middle of the two cards the one with the invite members the one with the reset invite link here so on click handle reset invite code and is pending or is resetting invite code let's go ahead and try it out now so right now my invite link is am d621 if I click reset invite link and confirm my invite code is reset but this one seems to be exactly the same except if I refresh then it's a different code why does that happen well because remember how do we get the initial data for the edit workspace form well if you go inside of your Standalone here so app Standalone workspaces workspace ID settings we get it through a server component this is where we get our initial values so what we have to do is we have to call our router refresh so let's go inside of the edit workspace form and let's find our not the unsubmit where is my uh handle reset invite code in here we're going to call router. refresh this will refetch server components and let's try this again so this is my uh this is my uh uh invite code eh2 nt2 if I click reset there we go this is the new code amazing amazing job so you just finished that so what we're going to do next is we're going to wrap up this invite functionality because it's not that difficult and once we've finally finished with everything that workspace can do we can go ahead and do the members which will display a list of our members and we're going to be able to change their role like admin or member or kick them or leave ourselves from a workspace and then we can work with projects and tasks amazing amazing () job now let's go ahead and let's build the invite system so first let's build the actual join API post route which will be called by the user attempting to join a workspace so let's go inside of source features workspaces server route. DS right here and I'm going to go ahead and I'm going to to join a post slw workpace id/ jooin and then I'm going to go ahead and just collapse this route here and then I'm going to add a session middleware so only logged in users can do this and then let's add a z validator to look for Json and no need to Define this in a schema we can just go ahead and write a code to be a string that's all we need and we also need to add add the Zod import here so Z from Zod now let's go ahead all the way down and let's go ahead and add our asynchronous controller now inside of here I'm going to go ahead and destructure the workspace ID from C request perm and I'm going to destructure the code from oops C request valid Json then we're going to go ahead head and get the databases from the middleware context let me just fix the constant typo here so that's going to be c. get databases and we're also going to need the user C.G user then let's go ahead and let's get uh the member so I'm going to do a wait get member and I'm going to pass in the workspace ID which comes from the Pam the user ID which comes from the current user do dollar sign ID and we also need to pass in the databases I like to pass that first if we have a member that means no point in calling this API route so we're going to return back a cjson error already a member and not 500 but 400 like this then let's go ahead and let's get the workspace using the workspace ID from the param here so we're going to go ahead and fetch await databases get document and we're going to pass in the database ID the workspaces ID and then the workspace ID here and I want to give it some strict types here so I'm going to go ahead and give the get document the workspace type fromt do/ types let me show you this import right here so this is our type which expands the model document oops it's located inside of features workspaces types so now we're using it inside of this route here and we are assigning it down here and the reason we are assigning it is so that now I can safely do a comparison here if workspace do invite code is not equal to the code entered from the body we're going to go ahead and return c. Json here error in valid invite code and then 400 error like this otherwise if all of this is okay we're going to go ahead and create a new member so databases. create document database ID members collection ID I mean just members ID id. unique because we creating a new member here and go ahead and give it a workspace ID a user ID of user. dollar sign ID and the role of member ro. member because this user is joining not creating the workspace and then we can go ahead and return back data workspace all right we now have that ready so let's go inside of workspaces API uh and let's see which one we can copy the used reset in code and paste it and let's rename this to use join workspace let's rename the constant to use join workspace here and let's go ahead and modify these ones so uh the request and response here should be join I believe there we go and remember to have 200 here and now let's go ahead and fix that here as well so just replace this with join and alongside Pam we also need Json here so go ahead and pass Json there we go and this will be failed to join workspace on success here we're going to say joined workspace and in here we can invalidate our workspaces query and we can also invalidate the individual workspace data I query and again failed to join workspace here like this and while we are here I just want to take a look at all of my response types here and I kind of don't like that in some of them we are not doing the whole you can see the 200 thing but we can refactor that later but because I'm not having any errors but if you are you might need that 200 but we're going to count to later no worry so now that we have the API for that let's go ahead and let's create uh the actual page for that so we're going to go ahead and go inside of source let's go inside of the uh app folder my app folder instead of Standalone workspaces workspace ID and let's create a new folder called join and inside of here let's create a page. TSX like this let's go ahead and Mark this workspace id id join page and workspace ID join page like this so now I should be able to go inside of my settings I should be able to copy this invite link and I should be able to paste it here uh and looks like I am getting uh an error here oh yes because this is not the way I wanted my apologies so we have workspaces workspace ID join on the same level as settings and then another one invite code like this and then drag and drop page inside like this and let's refresh now and there we go now our invite link works so let me show you the new new structure so workspaces works space ID join and then the invite code and that is equivalent to this workspaces workspace ID join invite code right so just double check inside of your settings here when you work with full invite link where is my P invite link it's inside of the edit workspace form so window location origin workspaces workspace ID join invite code make sure you don't misspell any of those great so we now have this page right here let's go ahead and let's protect it so I'm going to turn this into an asynchronous method and I'm going to go ahead and do user a way to get current if there is no user we can redirect from next navigation to sign in like that so now let's go ahead and let me just quickly peek at my settings page here because I just want to copy this interface so let's go back inside of the invite code here like this and in the params now we can structure the workspace ID and let me just rename this so workspace ID join page props let's D structure that here so params and now what we can do is we can load the workspace that we are trying to join so we can display to the user some information but there is one problem uh if you take a look at our features workspaces queries here which we use in server components for the get workspace we ensure that the user is a member here right so this is what we're going to do we're going to copy this get workspace and we can copy the interface as well so the entire thing and let's paste it down here and we're going to call this get workspace info and get workspace info here so get workspace info props it will be exactly the same the only difference here uh will be the following and that is that you don't have to be a member to visit this page so I'm going to go ahead and remove this part but we're going to be careful we're not going to return back everything we're just going to return the name so workspace do name because that is uh the only thing we need here so get workspace info and no need for account here there we go so now we have our server component ready to give the user some useful information let's get this get workspace info and let's see if it works so const workspace here will be get await get workspace info and passing the workspace ID as pams workspace ID uh and I have to import get workspace info from features works spes queries and then workspace ID actually let's go ahead and add workspace ID here well we can just Json stringify workspace let's see the entire thing which we fetch here and there we go as you can see we fetch name test and here's an even more important thing to try out I'm going to copy my invite link and I'm going to go ahead and log out and I will now uh log in with another account that I have have that is not a part of this workspace right so this user has no workspace as you can see so I'm going to paste that invite link here and there we go that user can still see the information about the workspace they are trying to join so I suggest you also log out and go into another user and confirm that you can see the information about this workspace and what I want to do now is the following I want to build inside of my Fe features inside of workspaces let's go inside of components and let's create join workspace form. DSX and this one is going to be uh quite simple so first of all we're going to mark this as use client we're going to export con join workspace form here and let's go ahead and let's add everything we need from the card so card card content description header and title here and we're going to go ahead and give this entire thing a div uh no need for a div actually we can immediately do card give the card full width full height border none and Shadow none then create a card header which will have a class name of padding 7 and then we're going to have a card Title Here with a class name text extra large font Bold and the text join workspace below that we're going to have a card description here which will have you apostrophe have been which you can replace with appos if you're getting IDE errors so you've been invited to join and then we're just going to go ahead and create an interface here join workspace form props initial values will simply accept the name which is a string because that's the only thing we are allowing this user to see so from here assign the props the structure the name and then uh is it not oh initial values okay so initial values so you've been invited to join initial values. name and we're going to wrap that inside of strong so it's a bit Bolder than the other than the rest of the text and then work space like this and let's go ahead and immediately add this component inside of our Standalone workspaces workspace ID uh join invite code page. TSX so I'm going to go ahead and create the join workspace form here and the initial values will be our workspace we can rename this to uh let's go ahead and do this we can rename these to initial values and we can also do a redirect if this doesn't work so if there is no initial values we can redirect the user whoops redirect the user to well just to the root page because we can't redirect them to the ID because we don't even have the ID here uh great so redirect from next navigation and there we go you can see how now this says you've been invited to join the test workspace and I'm just going to give div a class name of full width and on large devices maximum width of excel so now it should look a bit better there we go now let's head back inside of the join workspace form here and we're not going to have too much uh thing to build here there aren't going to be any inputs so don't worry about that let's go ahead and do px7 here then let's add a dotted separator here which we can uh import from components dotted separator then let's add a card content with a class name uh padding of seven and inside of here we're can add a div with a class name Flex items Center and justify between and inside of here let's add a button from component UI button so this is another component that I have added an import for above and let's go ahead and write cancel in the first one one and let's go ahead and write join workspace in the second one uh I think that we can maybe improve this so let's go ahead and give it a flex column by default but let's go ahead and give it uh a LG Flex row here and let's go ahead and give this a class name of w full button LG W fit and the same same thing for this one so on mobile it will look like this but on desktop it will look like this there we go so now let's go ahead and give them some proper variants so this will be a variant of secondary it will be a type of button uh and we're going to give it an as child prop because inside of it we're going to use a next link so make sure you've added an import for next link I'm going move it here and this will simply redirect to the root page so that root page will then uh you know move the user away if needed uh and let me also just add a gap Y 2 here like this or Gap X2 as well well we can just do Gap two in that case great and now this one here will have a size of large and this one here will also have a size of large I forgot to add that that and we're going to give this one a type of uh well no need for submit it can also be a button because it's going to have its own on click here so now let's go ahead and ensure this is used client so that you can now go ahead and add the mutate to use join workspace here so import this from API use join workspace and now what we have to do is another thing so going inside of workspaces inside of hooks and copy use workspace ID paste it and call this one use invite code rename this to use invite code and search for param invite code like this so you have this little reusable hook whenever you need it the you could have also done this in a different way so you could have added the invite code here and then you can just pass that to the Joint workspace form if you want to uh you decide how you want to do it you also you know could have completely avoided the server component Fetch and you simply could have marked everything as use client and you could have done the use get workspace but you know let's leverage server components since we have them and since they are so handy to redirect the user away like this let's go inside of the joint workspace form here and let's get our invite code so now no matter where this join workspace form is uh we will be able to fetch this from our URL using the use invite code and then let's go ahead and let's actually create the onsubmit here so const onsubmit we'll call the mutate method which will have the Pam which will be uh the workspace ID which we also need here on workspace use workspace ID again you could have passed this as a prop from the parent server component if that's what you prefer uh at this point I'm almost experimenting with all the things we can do here uh and alongside PM we also need a Json for the code to be invite code there we go and then on success here we're going to go ahead and D structure the data and inside of here we need the router so let's add the router from next navigation I'm just going to move it here to the top uh and then this router here will have a router. push slash workspaces data. dollar sign ID which is uh returned from our API so let's go ahead and assign the onsubmit here to the join workspace so on click here onsubmit and let's go ahead and give it a disabled is spending which we did not destructure so let's destructure this from here and let's do the same thing to the cancel button let's try it out now so this user is not a part of this workspace and if I click join workspace joined workspace and there we go I am in the test workspace and let's go ahead and confirm that by going inside of of source app folder dashboard workspaces workspace ID and let me just go ahead and I think I can just do this params params workspace ID so it's completely type unsafe but you can see it appears because we know it's here right so I just want to confirm so it starts with 670 0 and ends with 535 so I'm now logged in uh as John 670 okay let's log out and let's log in with Antonio and let's select test and there we go as you can see this is the exact same workspace so we officially have two members inside of this test workspace right here great so we can now remove these params from the workspace ID page and let me just show you the quick refactor you can do if you want to so you can go inside of your app folder Standalone workspaces workspace ID join invite code and if you want to uh here's what uh we can do well when we get workspace info we can also you know well let's not return the ID no need for that because we have the workspace ID here and we also have the invite code here so we can do this this and then we can go ahead and pass the following so initial values can stay the initial values and then we can pass in the code to be pams invite code and the workspace ID can be pams workspace ID so this way you would not have to use those uh you know you don't have to do this I'm just demonstrating so then inside of here you would have the code and the workspace ID and then you would not have to use these two right so a tip for you if you want to do that but I mean this works just fine so however you prefer of whatever way you prefer doing it uh great so I'm going to remove invite code from here because I'm not using it uh and great that's it you've implemented the invite system and now we are ready uh to finally go ahead and implement the members page in which we will now hopefully uh see both of these members Antonio and join and John in this test workspace right here great great job in order to build our members list () first let's build the members API let's go inside of features members and let's create a new folder called server inside let's create a route. DS let's go ahead and create a const app new hono from hono and let's export default app now let's go back inside of our app folder API route route. DS let's go ahead and chain slash members to our members and while we have to import that so import members from features members server route like that so make sure you have chained your new members here it doesn't really matter before or after works spaces just be mindful of semicolons like this let's go inside and first let's go ahead and let's build uh the get query so this is an API endpoint which will be used to obtain all members in a workspace so let's go ahead and add a session middleware here from lib session middleware and then let's go ahead and let's add a z validator here for our our query so we have to import the Z validator from hono Zod validator and this will be a z doob workpace ID z. string and then an asynchronous controller here let's go ahead and let's move the Zod validator here and let's import Z from Zod like this now let's go ahead and let's obtain the users from our await cre create admin client so this is something we have not done before we have to use the admin client for this one let's go quickly back inside of the admin client so that's located inside of your Source lib folder app. TS inside of the create admin client we don't have the users so let's add get users return new users client and we should have the user users import here so not user users like this node app right great so we now have that here so we can go back here and there we go we now have the users from our admin client let's get the databases from our C doget databases here let's get the current user from C.G user and let's go ahead and let's obtain the workspace ID from C request valid the query here like that and now let's get the current member using a wait get member here you can do that from do/ utils because we are in the members feature folder and inside of here we have the get member we're going to pass in the databases we're going to pass in the workspace ID and the user ID to be the current user. dooll sign ID if there is no member we're going to go ahead and return back c. Json error unauthorized with a 401 and now let's go ahead and let's get all members so const members will be await databases list documents passing the database ID from the config passing the members ID from the config so make sure you have added these two here database ID and the members ID and then we're going to add a query from node app right so I'm going to move that here with the other Global Imports query. equal workspace ID to the current workspace ID from our query so we are going to load all members from the workspace but keep in mind Our member collection only has has the user ID and the workspace ID it has no information about the name for example of that user only the ID of the user so what we have to do now is we have to populate those users and for that we're going to use this users from the admin client that's why we need that so let's write cons populated members like that await promise all so we're using promise all so that we can do a weight inside of map right so let's write members documents map we're going to mark this as an asynchronous method get the individual member in each iteration here get the user from that member here so that's going to be await users. getet member user ID and then go ahead and return the existing member but extend it by giving it a name and by giving it an email and there we go now you created a list of populated members and then go ahead and return c. Json data spread the members why are we spreading the members you might ask because the members is a document list collection right but populated members is just an array of objects so we have to preserve uh those other attributes which the list document from app right has like total so we are are preserving that here and then we are simply appending documents to be populated members there we go but we're not done yet while we are here let's also implement the delete individual member here so using the member ID ensuring we have the session middleware let's go ahead and add a uh asynchronous controller here so we're going to go ahead and first obtain the member ID from C request uh Pam then we're going to get the user from C get user from the middleware then we're going to get databases from c. getet databases and then inside of here let's go ahead and add const member to delete will be await databases. getet document databas is ID members collection members ID and then the member ID so this is how we load the individual member that we want to delete but now let's also load all members in the workspace so const all members in workspace will be await databases list documents database ID members ID and then query equal workspace ID member to delete workspace ID like this so we are loading all other members which are in the same workspace as the member we are attempting to delete because we don't have the workspace ID inside of the URL here so now we're going to go ahead and obtain ourselves so this member is us right so a wait get member we are passing in the databases we are passing in the workspace ID to be the member to delete workspace ID and finally we are passing the user ID to be user. ID since the member to delete doesn't have strict typings be careful with this don't misspell it don't add double s or maybe missing a letter be careful andure that you're using the proper workspace ID in all places now we have ourselves here so now we can check are we allowed to delete this member first of all if there is no member meaning we are not a part of this workspace immediately let's break the method here with an error unauthorized like this then if our member. ID is not equal to member to delete. ID and I'm using the invalid IDs here so we are using the dollar signs right so if we are not trying to remove ourselves we are attempting to remove someone else and if our current role is not member roll. admin you can import member Ro from types here so if we are trying to remove someone else and we are not an admin we are also going to return back this and I'm forgotting to I forgot to add four ones here that's important so h knows it's an error did I forgot to do that anywhere else I did not okay like this and then let's go ahead and finally do await databases. delete document database ID members ID member ID here and we are finally just going to return c. Json data dollar sign ID member ID which was the initial we wanted to delete or we can use member to delete. ID like this there we go so that's our delete method and now let's add the last one which is the patch method which will be used to modify the role of the member so member ID right here again session middle again and this time we're going to have a z validator Json Z doob A rooll will be be a z. native enum and we're going to pass in the member role so only either member or admin will be available to pass inside of this validation here let's go ahead and add our asynchronous controller here and now we're going to go ahead and do uh pretty much the same thing as we did here so we can copy it uh also looks like we're not using the all members in the workspace here so let me just check whether I forgot to do this or did is this just an extra it seems like I forgot to use this so before we allow the user to delete let's also do if all members in the workspace do total is equal to one we are also going to throw back an error meaning that you cannot delete the last member in the workspace so cannot delete the only member and we're going to throw back a 400 in that case so if you want to remove that you going to have to delete the workspace in itself great so I want to go ahead and I'm going to actually copy the entire delete method uh actually let's copy the controller that's maybe a smarter thing to do so let's copy the controller of the delete and then let's paste it here in the patch method and then now we're going to modify it here so inside of here let's go ahead and let's extract the member ID from Pam that's here we have have the user we have the databases but this time this is not a member to delete this is a member to update I want to you know have the proper terminology here and we are still fetching all members in the workspace here but using the member to update this time then we get ourselves using member to update here and then we can follow the same logic if we are not a member of this workspace we are unauthorized to do this and then the second thing we're going to do is if our just this if we are not an admin we have no right to remove anyone's role it doesn't matter if we are trying to change ourselves right if we are not an admin we cannot do this and then last thing we're going to do is if all members in the workspace do total are equal to one we're going to go ahead and do this as well so cannot uh downgrade the only member and 400 and then inside of here instead of having the leete document we're going to have update document with database ID members ID member ID and then simply we're going to pass a roll and we have to destructure the role uh from the body here so let's do that const roll C request valid Json and now we have the role here let's see uh we are also missing the member to update here there we go so we just finished our members API so so now let's go ahead and let's create our uh API folder here inside of the members feature folder and let's create the hooks for each of those so I'm going to close this and I'm going to go ahead and copy uh let's see workspaces I think is the most similar one so we're going to copy the use delete workspace let's start with that I'm going to paste that inside of members and I'm going to rename this to use delete member let's go inside of use delete member let's rename it to use delete member let's go ahead and change the response and the request types here to be members and member ID pointing for the lead leave the 200 here same thing here members and member ID and then inside of here fail to delete member this will be member deleted this will reset the member query and this will reset the individual member data ID but actually no need for that we will not have this at all we will not we will never have a query for the individual member so we can remove this and this will again be failed to the lead member and no need for the data destructuring inside of the UN success then at all great now let's copy this and paste it and let's go ahead and add use update member like this let's go ahead and replace this member ID with patch here then let's rename this to use update member and let's go ahead and alongside PM also the structure the Json which we are going to have and let's change this to patch we now have an error because it's missing the Json which holds the new role for the user as you can see role member rooll the error is going to be failed to update member member updated it's going to reinv validate members and this will be failed to update member as well and let's go ahead now and copy the workspaces use get workspaces and let's paste it inside of our members API so let's rename this to use get members like this and let's rename this to use get members as well the query key will be members right here and let's go ahead and simply call members. getet but we are missing the query here so let's go ahead and add that interface use get members props will require a workspace ID which will be a string so inside of here let's add use get members props require the workspace ID and then inside of here we can pass in the Pam workspace ID will it work like that uh it's not PM it's query I believe there we go so this will be failed to fetch members there we go make sure this is called members and also make sure you it'ss only for this workspace ID so we have to do a combination of these two so it can only uh so that it can refresh if we change a workspace otherwise it will not fetch new members so now when we change the workspace ID it will fetch it a new every time great so we have all of that ready and now we are ready to create our screen so let's go inside of source app folder Standalone let's go inside of workspaces workspace ID and and then let's create a new folder called members and inside a new file page. TSX let's go ahead and name it workspace ID members page like this and I immediately want to protect this page when it's a server component so I'm going to mark this as an asynchronous component and I will import get current from features Al queries and I will import redirect from next navigation inside of here I will query the user using a weit get current and if there is no user I will redirect Away From Here to/ sign in and then usually we would leverage This Server component you know to fetch uh members as well but since uh in all the previous Pages where we used the server side fetching here it was for you know initial data for forms right like name title status things like that but this will be a list of members so I think it's better to fetch this client side so that we can Implement you know infinite loading if needed in the future so that's why I'm going to handle the server component only for this very convenient redirect without use effect here and then what I'm going to do is I'm going to go inside of my features inside of my workspaces and let's create a component called members form uh members list. DSX like this so let's export const members list here now will you put this you know inside of members or workspaces it's really your choice perhaps perhaps maybe it's better to keep it in the members uh feature folder you know we'll see let's implement it first so I'm just going to write you know members list here first I'm going to go to this page and I will simply give this one uh a class name of full width and on large maximum width of Excel and then inside of here I'm going to add a members list like this from features workspaces components members list and I think that now if I click on members here there we go I have the members list in a standalone file perfect so just like on settings for example right here excellent let's go back inside of our members list now and let's go ahead and style this so I think we should start by marking this entire thing as use client and importing the card card content card header and card title from components UI card besides that we're also going to need our handy use workspace ID from features workspaces hooks use workspace ID so that we can obtain it from the URL so let's go ahead uh and do that I'm going to go ahead and get the workspace ID from use workspace ID here and let's go ahead and style our card here so this will be a card with a class name pool width pool height border none and Shadow none inside of here I'm going to add a card header component with a class name Flex Flex row item Center Gap X of four padding of seven and space y off zero then inside of here I'm going to add a button component so let's make sure that you import the button component from components UI button inside of this button I'm going to write back so the user can go back to uh the dashboard and I'm going to add an arrow left icon I'm going to give this a class name of size 4 and then m R of two and this button will have a variant of secondary and it will have a size of small this button will also be a link in itself which will have an HRA to redirect the user to go back to slash workspaces and then slash back to the workspace ID and let's go ahead and assign the as child here so the button becomes the link there we go now outside of this button we're going to add a card title here and we are simply going to add uh members list here and let's add a class name here text extra large and font bold there we go outside of the card header we're going to add a div with a class name px7 and we're going to go ahead and add a dotted separator here now this dotted separator comes from the components doted separator import I'm just going to go ahead and align my imports here there we go and below this we are adding a card content and let's give this a class name of padding seven like this inside of here let's go ahead and let's get our used get members and let's pass in the workspace ID which we have and we have imported use get members from our newly created features members API use get members inside of here we can now destructure the data like this and then we can go ahead inside and we can do data dot documents and make sure you put the question mark here so data question mark documents do map get individual member and index here and let's add a fragment around each of our uh from react around each of our members here so I'm going to go ahead and just add the fragment here like this and inside let's add a div with a class name Flex item Center and GAP two and give the fragment a key of member dollar sign ID inside of this div we're going to add a member Avatar which is a component we don't yet have but luckily for us it's going to be very simple to the one that exists called project uh called workspace Avatar so let's go inside of source features workspaces components workspace Avatar and we can copy this and then we can go inside of the members inside of the new folder we're going to create inside components and simply paste in uh well you can just copy it like this and uh this will be called members avatar. DSX and paste it inside let's go ahead and rename the three instances to members Avatar here so it will have uh no it will not have an image actually so only a name class name and let's add a fullback class name here to be a string as well and we're going to remove this and we're going to add a fullback class name uh it will not have an image so no need for this case we are just working with this one uh it will have a size five by default uh it will be transition it will be border border neutral 300 and it will be around did full like this uh oh I've removed the return there we go and our Avatar fullback here uh will do the following so this one let's go ahead and do this let's remove the entire thing and let's reuse our CN so the default classes will be background neutral 200 font medium text neutral 500 100 Flex items Center and justify Center and then inside of each of them uh also besides this we're going to pass in the fullback class name like this and we can go ahead and do this it's a name do character at zero and then to uppercase like this and we can remove the image import so now we have the members uh the members aat here uh I just want to call this member Avatar not members so member Avatar and I'm going to rename it here as well member Avatar great we can now go back inside of workspaces components members list which the more I look at it the more I think it should belong to the members feature folder uh now let's import the member avatar from features members components member Avatar right here and we're going to go ahead and pass in the f in the class name size 10 all back class name text large and name member. name there we go uh and Let me refresh this to see uh is anything loading here looks like it's not loading uh we're going to go ahead and debug I think I maybe know why uh let's see yeah so we don't have the scope to load the users so let's go ahead and fix that so I'm going to go ins set my members here my apologies of my app right console and first let's check our members collection specifically the settings okay we have all the right permissions set so what the issue is instead of our admin client attempting to list the users so let's go ahead and go inside of our settings let's find our uh in the overview here maybe API Keys here they are click on your API key here and then go ahead inside of the Scopes and now in the out click on users. read like this and click update and I think that now if I refresh there we go now I have to users Antonio and uh John right here great so our member Avatar now works no more errors inside of our API end points and now below the member Avatar let's go ahead and let's add a div with a class name Flex Flex column and let's add a paragraph which will render the member name which we have populated there we go here's the name and a class name text small and font medium like this below this we're going to add uh a text extra small and text muted foreground and this will render the member email like this there we go uh so I have Flex items Center here uh but something here I don't like uh okay uh so what we're going to do next is outside of this div here we're going to go ahead and we're going to add a button component which will have a more vertical icon from Lucid react so make sure you have imported the more vertical icon here now we're going to go ahead and give this button a class name of ml AO so it's on the other side a variant of secondary and the size of Icon so it's small and let's now give the more vertical icon a class name here of size 4 and text muted foreground like this uh great so we have this and then outside of this div still inside of the fragment let's do if index is smaller than uh our data documents length minus one in that case we're going to go ahead and render a separator component not a dotted separator just our separator component from shaten again if you don't have that you can do BU x-- bun chaten 2.1.0 add separator in case you don't have the separator component but you should because we added it in the beginning of our tutorial there we go we now have the separator and let's give it a class name myy 2.5 and there we go now as you can see each of our members here has a nice little separator here great so now what we have to do is when we click on these uh to show some options but I just don't like how this separator looks can I change this color to neutral 300 maybe or maybe a background make it a bit darker okay I'm not going to uh play around with this too much uh let's go ahead and let's actually uh create this button uh into a drop- down menu so for that we need to import everything uh used for the drop- down menu so let's import the following drop down menu drop down menu content drop- down menu item and drop down menu trigger from components UI drop down menu and then we're going to wrap this entire button here inside of that so let's grab the button inside of the drop down menu like this let's give the uh drop down menu itself well nothing let's just continue by with wrapping and composing so the button will go inside of the drop down menu trigger and to avoid a hydration error we're going to give this as child so the trigger becomes the button because the drop- down menu trigger is a button element and then we would have button inside of a button that causes hydration errors so as child we'll fix that and then inside of here we're going to go ahead and have a drop- down menu content with the side of bottom and an line of end like this and then inside of here we're going to have our uh dropdown menu items so drop down menu item here the first one will be set as administrator and we're going to go ahead and give this a class name of font medium and let me just fix the capitalization here class name then we're going to go ahead and have an on click here which for now will be empty and disabled which will be false and then let's go ahead and let's copy and paste this one this one will be set as member and then the last one uh will have a class name of text Amber 700 and it will have a remove member. name here so now when you click here there we go set as administrator set as member and remove John or remove Antonio now let's go ahead and let's add our hooks for this so we are working with use update member and use delete member let me separate them so we're going to add const use delete member from features member use delete member we're going to add mutate to be delete member is spending will be is deleting member and then we can copy and paste this and call use update member this will be update member and this will be is updating member just make sure you have imported your both use delete member and your use update member I'm just going to move them with the features here above there we go now that we have those uh let's go ahead and let's actually uh handle the delete member and handle the update member so const handle update member will be an asynchronous method actually no need for asynchronous it will just accept the member we are trying to delete so member ID which is a string and it will accept a role which is a type of member role so in import that so make sure you have added the member Ro import from features members types I'm just going to move it here there we go so now inside of here we're going to call the update member and we're going to pass in the Json to be rooll and we're going to pass in the Pam to be member ID there we go no errors great now let's go ahead and let's add the confirmation for our uh Delete here so for that we're going to have to go here and import use confirm from hooks use confirm and let's go ahead and set that up here so this is an array like this let's go ahead and ask remove member this member will be removed from the workspace and destructive we're going to have a confirm let's just call this a dialogue and confirm actually let's call it a confirm dialogue just in case we import the actual dialogue anytime we can render the confirm dialogue here like this and then let's go ahead and let's implement the const handle delete member and this will be an asynchronous method which will accept the member ID to delete and then we're going to get the okay using await confirm here if not okay we are going to break the method immediately otherwise we're going to go ahead and call the delete member member ID and in case we deleted ourselves uh we're going to go ahead and pass in the unsuccess here window location reload like this so this is kind of a Brute Force way of ensuring everything is up to date after this action and it looks like I'm getting an error here I think I need to pass the per Ram there we go now let's assign the handle the update member and handle delete member to our drop- down menu items here so the set as administrator will call the handle update member and it will pass in the member do ID with the dollar sign and then member roll. admin and it will be disabled if is updating member so I'm going to copy these two and I'm going to replace them for this one this one will set the member Ro to member and we can copy this two as well and replace them for the remove one here this will be handle delete member and no need for the second argument here and this will be is deleting member like this let's go ahead and try it out so I'm logged in as Antonio and I'm pretty sure I created the test uh uh workspace here so I can go inside of my members and I should be able to remove John after confirmation and there we go John has been removed from the list and if I now go ahead and log out here and go inside of John mail.com John 1 2 3 4 5 6 78 log in uh there we go John has no idea about this workspace perfect so now I'm going to go ahead and go back inside of my Antonio here let's invite John back again so I'm going to go inside of my settings for the test workspace and I will copy the invite link I will log out I will log in as John let's go ahead and accept the invite here join workspace and now if I go inside of settings here and if I my apologies if I go inside of members and if I attempt to remove Antonio here there we go fail to delete member and if I attempt to set myself as administrator or member it does not allow me to do any of those things as you can see uh so let's go ahead and quickly try one thing if I am Antonio and I go inside of members here let's wait a second for this to load oh I think it did not load yeah I I think I pressed on the my apologies so what happened here is that before my workspace loaded I pressed on members and then that led to undefined so perhaps why workspace is loading while we are getting redirected we can disable that so that doesn't happen so now you can see it works what I want to know now is can I set John as administrator here member updated amazing and now if I go back inside of John I really should have set up multiple browsers for this now John should be able to downgrade Antonio there we go member updated and that would also mean now that Antonio should no longer be able to remove John let's hope this is the last time I do this so now JN if I remove JN I get an error but I should be able to remove myself from the workspace and that works because I am a member uh great but it looks like my window reload uh did not trigger here on success that's odd uh but I think that after refreshing this uh yeah okay what we have to do is we have to handle some error States right but if the user tries to go back here uh they won't be able to load anything here because we will cause an error if they try to load a workspace they're not a part of so you didn't have to worry about that but the important thing is this user now has no workspace our role base access control works perfectly amazing amazing job















Summarize the following transcript in a clear and concise way. Capture all the key insights, arguments, and takeaways while removing filler. Break the summary into well-structured bullet points or sections by theme/topic. The goal is to help me understand everything important without reading the whole transcript. Think like a researcher or note-taker summarizing for someone smart but busy. Keep the summary accurate, complete, and easy to scan.

Title: Build a Jira Clone With Nextjs, React, Tailwind, Hono.js | Part 2/2 (2024)

() you watching part two of jir Clone you can find part one in the description this is a quick reminder that you can also use my platform code withth antonio.com and you can watch this entire course in chapters and you can also Mark your progress you can also become a premium member and you can unlock special courses like canva clone as well as source code to over 20 premium projects and 170 hours of Premium content now let's go ahead and let's () implement the projects entity so make sure you have at least one workspace so I'm going to go ahead and create my code with Antonio workspace here in a random account that I have and what we're going to do now is create Associated projects inside of this workspace and we will be able to reuse or at least copy a lot of things uh that we did for our workspaces so let's go inside of databases let's go inside of Joc clone and let's create a new collection called projects ins inside of projects let's create an attribute uh which we're going to call workspace ID and inside a size of 50 and let's make it required and click create after that we're going to have an image URL which will be 1,400,000 like this so let's just did I write this correctly I did and it's not going to be required all right let's go inside of settings and let's go inside of permissions and add a permission for all users to create read update and delete projects and let's click update there we go and one attribute that I forgot about the name of the project there we go and it's required and I put a size of 256 great let's copy the project collection ID now let's go inside of environment. local and let's go ahead and add the projects ID here there we go let's go inside of our config where we have all the short hands and let's now add our projects ID and I'm going to copy it from here there we go so now that we have have that let's go ahead and let's create an API endpoint for that inside of features we're going to create a new feature folder for projects and inside of that uh another folder called server and inside of that a route. DS file let's go ahead and create a const app to be new hono from hono and Export default app here then let's go back inside of our app folder API route and let's go ahead and import projects from at features workspaces server route and then just go ahead and chain route SL projects to projects there we go now let's go ahead and let's build the first route which will be uh well to get all the projects which we need so we're going to use a GU method here like this and it will use a session middleware and then it's going to have a z validator here for the query and it's going to use Zod doob to uh validate workspace ID which is a string so we're not going to pass it as a PRM but as a query let's go ahead and let's add our controller here let's get the user from the middleware let's get databases from the middleware let's destructure the workspace ID from C request valid query let me just fix the extra space here like this let's go ahead and see whether we are allowed to load these projects for this workspace so a wait to get get member which we can obtain from features members utils right here inside of here I'm going to pass the databases the workspace ID and the user ID which is our user. dollar sign ID like this if there is no member to be found we are going to return c. Json with an error unauthorized and a 401 otherwise let's go ahead and let's actually load the projects using using await databases. list documents let me just fix the await typo here inside of here we're going to pass in the database ID the new projects ID and then we're going to create a query from node app right starting with equal workspace ID workspace ID and then another query order descending dollar sign created at because this is a built-in attribute from App collection make sure you have included the database ID here let's go ahead and move these Global Imports here and let me just separate these things there we go now that we have this ready let's of course return c. Json data projects here like this great and now I want to load these projects somewhere so we're going to go ahead and we're going to revisit our source components uh sidebar here so after our navigation we're going to add projects so let's go inside of the components here and let's create projects. TSX let's export const projects here and I will just return a div projects and then I'm going to go inside of the sidebar and I will import projects from do/ projects like this so now you should be able to see them in the sidebar so I'm going to go inside of my local host and there we go after my navigation bar I have an empty text projects so what I want to do now is quickly revisit my workspace switcher here and I want to add this import for RI add Circle fill and put it inside of my new projects here and let me Mark the projects as use client this is also important and then I want to copy the initial part here so let me just copy this exact thing and paste it here and let me just close the div and I'm going to go ahead and add an empty uh on click here so I just copied the exact header here from the workspace switcher and instead of workspaces this will Mouse save projects and it's going to be having its own little plus icon here so we can add new projects easily the first thing I want to do is load the projects here so one thing that we didn't do is after we created our features project server route is create our projects API folder and inside we need to use get projects. TS the easiest way to fill this is by going inside of workspaces API use get workspaces let's go ahead and copy the entire thing here let's go back inside of the Project's API folder and paste this inside I will rename this to use get projects and we are immediately going to have to create an interface here use get projects props and let's define workspace ID to be a string here then let's go ahead and assign use get projects prop use get projects like this and inside of here we will get the workspace ID our query key will be projects combined with the workspace ID so that it reloads every time we change a workspace and then we are calling client API projects. getet and we are uh definitely missing the workspace ID so I'm not sure why I'm not getting an error here so let me quickly go back inside of my projects server here so the only route that I have is this one Z validator so okay we can do it like this if there is no workspace ID we are simply going to go ahead and throw uh cjson error missing workspace ID 4 100 like this let's go inside of use get projects and now we will just manually add a query here workspace ID and this will be failed to fetch projects there we go and now that we have used get projects here we can go back inside of our components projects which is used in the sidebar and we can go ahead and get them so data use get projects from our features projects API use get projects and what we're missing here is the workspace ID which we can get from use workspace ID which comes from features workspaces hooks use workspace ID and then we simply pass in the workspace ID inside just like this and now what we are going to do is below this div encapsulating the title is iterate over our data question mark documents. map we are going to get the individual project and then inside of here we're going to Define is active to be if path name is identical to open backck SL workspaces slash workspace ID and then slash projects project ID so we're going to have a project ID later I mean a project ID uh page later and then inside of here we can go ahead and we can return a link from next link we can go ahead and give this is an H open vtic slash workspaces uh Slash uh well what we can do is we can just you know copy this let's assign it to a prop const hre mark it inside of template literals like this and then we can compare the path name with an hre we are missing the path name so we're going to add it and let's just assign the hre here make sure you have added the link for from next link and make sure you add use path name from next navigation and then we can go ahead and add the path name here from use path name there we go the errors are now gone uh we are missing the project ID though so for now I'm going to add con project ID to be null and I'm going to add to do use the use project ID hook which we will create later great so we have the link ready here let's give this a key of project. dollar sign ID inside of here let's open a div with a class name which will utilize the CN util here we're going to go ahead and first Define a set of default classes which will be Flex items Center Gap 2.5 padding 2.5 rounded medium hover opacity 75 transition csor pointer text neutral 500 and then we're going to have is active background white shadow small hover opacity 100 and text primary inside of here we're going to add a span rendering our project name name and this span here will have a class name of truncate like this so now I think we can stop here because we cannot really see any projects you can see this right now is for some reason loading my uh workspaces it seems so it seems like we have a mistake somewhere so I'm calling use get projects here did I forget to do something use get projects client API projects. getet seems like I am not so why am I getting projects here let's go ahead and let's revisit our source folder our features projects API use get projects that's here let's check out the server here so I'm querying the projects ID but for some reason it seems like I'm getting back my workspaces so conso log projects let's see what's going on here can I expand this maybe then [Music] H let's see why this is happening uh I will just zoom out so I am always on my desktop here what's worrying me is that I'm not seeing this console log here so let me go inside of API use get projects and let me go ahead and see the data here maybe data is here okay and I do have documents called code with Antonio uh but this is definitely the workspace so how come my workspaces are are getting loaded here okay let's go ahead and see how to debug this one thing that comes to mind is that we have somehow put the invalid environment variable for our collection IDs so let's see my Project's ID is unique it's different from this okay that's good how about my config file Source uh let's go ahead and go inside of config here my project ID is looking at projects ID okay that's good and now let's go inside of here the projects are definitely empty I will just copy the project ID one more time and this time I'm going to go directly inside of my features projects server route. vs I'm pretty sure that I'm having a hilarious bu somewhere perhaps you already noticed what it is I don't know what it is yet so let's see let's put this like this will that then give me anything different no it still loads the exact same thing it's loading workspaces here H so then the project ID is definitely correct all right so I have just realized where my mistake was I have to be more careful uh I don't think you any of you made the same mistake maybe you did if you followed really closely and did exactly what I did so this is the mistake inside of my source app folder inside of my API route route. DS look at my project import it is exactly the same as my workspaces and since we're using export default it doesn't matter I can call this workspaces to right I will not get an error if I do that so I have to fix my import to go to projects like this and then there we go if I refresh now hopefully no projects great okay and now I can see uh I should be seeing some conso logs here I'm still not seeing them okay but at least we fixed that weird error so be careful make sure you import your projects correctly don't be like me don't do it fast uh great so now we are inside of the projects here but I don't want to do anything further because we can't see them right so how about we go ahead and we create our form for that and in order to do that we have to start with the schema so let's go inside of features projects and let's create schemas dots let's go ahead and let's prepare Z from Zod let's export con create project schema here and z. object here can be pretty much exactly the same if not literally the same as the workspace schema so copy the create workspace schema and simply add it inside the only difference is that this will also have to accept a workspace ID in which to generate this project like this so now let's go ahead and let's go inside of projects server route. THS and this time we will be creating a post route so it's going to be pretty similar to our post for creating a workspace so let's go ahead and let's add a session middleware here and then we're going to add a z validator for the Json actually for form because we'll be uploading a file and let's add create project schema here and then an asynchronous controller right here we can now go inside of our previously created workspaces server route. DS and let's find our post method here and I want you to copy the entire controller here so the entire controller of the creation of the workspaces server route and then go inside of projects server route and simply paste the controller here and now we're going to slightly modify it so we need the images bucket let's import that we need the ID from node app right so make sure you have added images bucket and ID from node app right and now first of all we can remove the creation of the member so no need for that let's remove that and the image stuff will stay the same but inside of here we will be creating a project so instead of workspaces ID projects ID and we are not going to have any invite code but what we will have is a workspace ID and we're going to destructure this so we can just leave it like this for now and we will be returning back a project like this so let's go ahead and fix some things so first things first from the form we will also be able to D structure the workspace ID uh let's confirm that we did not name it image URL we did not so it's just image inside inside of create project schema that's great so we now work have workspace ID image and name and before we do anything here let's go ahead and see are we allowed to actually create anything inside of here so we're going to go ahead and pass in the databases the workspace ID and the user which is user dollar sign ID uh user ID so if there is no member we are not going to allow this user to create a new project inside of this workspace but we are not going to be so strict so that we only allow admins anyone can uh create new projects you can of course change that logic if you want to there we go that's it that is our entire API endpoint for creating projects and now let's go ahead and let's copy the word workspaces API use create workspace and let's put it inside of projects API make sure you inside of the copied one and rename it to project use create project rename this to use create project and fix the response and the request type to go to projects then go ahead and fix this as well projects and everything else can stay the same this will be failed to create project this will be project created and this will invalidate projects and this will be failed to create project there we go so now what we have to do is we have to create uh a model and a form which will open up when we click plus here so let's go ahead and do that so we're going to go ahead inside of source features and instead of workspaces here we can copy the use create workspace model and put it inside of projects so instead of projects we're going to create a new hook here which we are going to call use create project model like this let's rename it to use create project model the key here will be project whoops create project and everything else can stay exactly the same now let's go ahead and let's copy the workspace creation form so I'm going to well let's copy both the create workspace form and create workspace model so both of them and go ahead inside of projects and create the new folder called components and paste them inside so create workspace form and create workspace model let's first rename the create workspace form to be create project form and you can you can click yes to uh update Imports and that will update them right here so create project model uh whoops let me just see use create uh project model yes this is supposed to uh be here use create project model use create project model oh I see use create project model is that the issue cannot find the module okay so we are working in how inside of this copied create workspace model here inside of the project and it looks like it cannot find this hook which we've definitely have hook oh I see why because we call the folder hook inside of projects I should have named it hooks there we go so now it will work okay and I will just replace use create project model here and use create project model here here inside of the create project form I'm going to do a couple of things so I'm going to rename the entire form here to create project form so all of these three instances and I will use the API use create project and in here I will use use create project inside of the schema I will use I will replace all uh four instances so this one this one this one and this one with create project schema and again looks like I named it schema when I should have name it schemas inside of uh the project so just double check that you have updated the Imports in here in your route for projects so now let's go back inside of the create project form we should now have schemas there we go let's replace use create workspace with use create project Here and Now inside of here uh we're going to have to do some updates here that's okay and let's change this to create a new project like this uh and instead of workspace name this will be project name so enter project name the first input and this will be a logo but instead of workspace icon this will be a pro project icon like this and inside of here it will be create project like that there we go so now there is one more thing that we're going to have to add here and that is const workspace ID use create workspace ID we use workspace ID from features workspaces hooks workspace ID let me just move it here with my features like this now we have workspace ID here and then when we submit here we can also add workspace ID here like that and now inside of here once we create I'm just going to go ahead and close this and instead I will add to do uh redirect to Project screen we don't have it yet now we have to resolve why is this error happening here it's happening because of our use create project so go inside of use create project and in the response type make sure you are only looking at the successful result here so add 200 in the response type here and then you will no longer have that error right here you can see data exists but we don't even need it for now because we're not redirecting anywhere at the moment uh great so we wrapped up create project form now let's wrap up the create workspace model and start by renaming it into create project model then let's go ahead and import create project form let's add create project form here and let's change this to create project model now let's use the create project model by adding it inside of source app dashboard layout and let's add it just below create workspace model so I will import this from features projects components create project model so we copied those two components from workspace because they're pretty similar so now we have to revisit our uh workspace switcher component so we can simply uh get the use create works okay we don't have to Let's directly go inside of projects inside of our uh Source components so this projects which is used inside of navigation right and inside of here we are simply going to go ahead and the structure open from use create project model like this and then we can simply add open here and what that should do I'm going to refresh and click here and there we go create a new project and if I did this correctly let's see once we click create project it looks like nothing is happening and I think that that is because we right now what's happening is that we can't submit the form because we have some errors uh and what errors well if you go ahead and go inside of your features projects schemas we the find workspace ID to be required but we are it's not something that we're going to type in right we're just going to infer it from the URL so let's go inside of components create project form and inside of here when we uh do the Zod resolver create project schema let's go ahead and see can we do omit workspace ID true can I do that and I think that then if I do test okay it says failed to create project but it allowed us to submit so that's a good thing uh looks like we are doing invalid document structure un no attribute user ID all right so what's happening is that since we copied the controller from creating the workspace inside of our app fold my apologies inside of the features projects server route we are assigning the user. ID I believe inside of the new project there we go but that doesn't exist so not something we're going to pass only name image URL and workspace ID exist third time the charm test project and let's click create project project created there we go and immediately shown here in my project because once we do uh instead of API use create project we invalidate queries projects and those are the used get projects here so no matter because if we don't pass workspace ID here uh it doesn't matter because this will reinv validate all projects you can pass additional options like exact to be true and then uh you would have to pass the uh uh workspace ID but this is just simpler for us oh I have a typo here so failed okay what I want to do now is the following so I want to go inside of source uh inside of my features projects components uh let's see create project model here we are doing on cancel close here okay that's good okay I know I know what was bothering me that's fine uh but what we need to do is we need to go back inside of our components especially inside of pro projects here and what I want to do is wrap up how this looks here so I also want to show the project Avatar so that we can test out image upload and confirm that it works here so let's go ahead and let's use our workspace Avatar because this one will be the most similar so let's copy the workspace Avatar and let's add it inside of our projects feature component so instead of workspace Avatar this will be projects project Avatar like this let's rename the instances of workspace Avatar instead of project Avatar like this and everything else can stay the same and then let's go back inside of projects here and alongside our span above it we're going to add project Avatar we're going to give it an image of project. image URL we're going to give it name project. name make sure you have imported the project Avatar from here and now let's try it out there we go now it says test project here the problem is it's a little bit big so we're going to change the defaults for the project Avatar let's go inside of the project Avatar here and let's also introduce a fullback class name here just as we did for our uh member Avatar so it's optional let's add fullback class name here this is fine but let's just change the size here to be five by default and let's change the outar size to be five by default and inside of the aat fallback here let's go ahead and wrap this entire thing inside whoops inside of CN as we have above and then this will be the first argument let me just scroll this and then we're going to pass in our fallback class name as the second argument like this there we go so now project Avatar should have a smaller text like this and let's also just change the default text in the outer fullback to the text small there we go so now we have a text test project here so I can now create another one and let me go ahead and upload uh an image that I have here so let me just find uh the image that I use there we go let's click create project and let's hope this is still working there we go we have a project with our new image here so the only thing that's not happening right now uh is the model closing and that's okay because we're going to add on submit to redirect to the project ID so the cool thing is that now if I go ahead and create a new workspace so another workspace uh you can see that in here I have no project so this is a special project right you can see that I can add that here but if I go back to this one it doesn't exist right so only uh projects inside of this workspace exist great so what we're going to do next is build the individual project ID page uh and then we're going to go ahead and create the settings for the project and then we can finally create the tasks great great job now that we have the projects let's () go ahead and let's build the individual project ID page so right now in my sidebar when I click on a specific project my URL is localhost 3000 SL workspaces workspace id/ projects and then null so first thing let's fix that null let's see where did I go wrong in doing that so I'm going to go inside of my source components and inside of my projects here and first of all let's go ahead and see so my link here hre leads to SL project ID it should go to SL project. dollar sign ID that's the first thing I have to fix about my HRA here so now I think the page will still be 404 but I expect there we go now in my URL I have the actual ID of my project great now let's build that page so we're going to go inside of source app folder dashboard inside of the workspace ID we're going to create a new folder called projects and inside of that another folder which we're going to call Project ID like this inside of br brackets and then a page. DSX inside so this will be a project ID page and let's go ahead and let's define import use uh sorry get current from Al queries and import redirect from next navigation so we protect this route so let's turn this into an asynchronous method H user will be await get current if there is no user we will just redirect to slash sign in great uh and now what I want to do is I want to create an interface here project ID page props and we're going to go ahead and have perms project ID string so let's go ahead and let's assign project ID page props here and let's destructure our params here and I think that now I will have my project ID here uh as params project ID there we go so now depending on which one I click my project ID changes uh and looks like the is active works I'm just not sure how it works let's just go back to my uh Source components projects why does it work so is active oh if path name is hre okay so what did they need the project ID for I am not sure let's remove this then uh we are not going to need it so looks like our current solution checking for path name and the H works just fine so now what we have to do in this project ID page is load the project information so we can do that by creating use get project or since we are in a server component and since we are loading just information right so I don't like to use server component to load data when it needs something that will be you know in an infinite load or some kind of pagination uh so for example our tasks will be loaded in a special component purely from the client side using the API but for the project information let's go ahead and let's create a database query for that so we're going to go ahead and go inside of source and inside of features workspaces we have this queries here specifically we have the get workspace so let's copy the interface get workspace props and the expert cons get workspace so I want to copy that and then I'm going to go inside of projects and create my own queries. TS which are used for Server components and let's go ahead and change this to be get project and we're going to have uh ID let's call this project ID actually let's be specific so this will be get project project ID and get project PRS so we are creating the session client like we usually do we are obtaining the member from do/ Member utils here uh what I like to do is go to Features member utils and now before I can check whether we have the member or not I actually want to load the project first so this is how I'm going to do that I'm going to go ahead and Define this to be const project await databases get document and we are missing this type so we're going to create it so first let's add the database ID let's replace this with projects ID and let's replace this with the project ID like this so make sure you have added this config here now let's go ahead and let's copy from workspaces types. TS copy this and paste it inside of your project so inside of here let's call this a project which will have name image URL and it will not have the invite code and instead of user ID it will have workspace ID there we go so now we can go back inside of the get project query and instead of uh assigning workspace type to this get document we can call the project from dot slash types because we've created it right here right great and now what we have to do is use the newly uh loaded project here to get project. workspace ID so then can we are first going to load the project and once we get which workspace ID is this project related to we're going to decide whether to show that to the user or not so if there is no member we return null otherwise we return back the project there we go so now we can go ahead inside of our app folder inside of dashboard workspaces workspace ID projects project ID here and we're simply going to set H initial values to be a wait get project which you can import from features project queries and simply pass in the project ID to be PMS project ID and then let's go ahead and do the following let's just do json. stringify initial values here and there we go now you can see uh that we have the exact project and all the information about the project here so now we're going to start building uh our UI from this so I want to go ahead and give this div a class name Flex Flex column and GAP y of four I'm going to remove this and then inside of here I'm going to go ahead and give this a class name Flex items Center and justify between then inside of here I'm going to create a div with a class name Flex item Center and GAP X of two and then I'm going to add a project Avatar inside so just import project avator here and now we're going to give our project outter a name of initial values. name and of course yeah let's just do if there is no initial values well what we can actually do is we can throw a new error here project not found that's what we can do so we can handle errors properly instead of just returning null so I will go back to where we usually return null and I will fix that so we're going to pass in the name here otherwise let's go ahead and also pass image to be project. image URL I apologize initial values. image URL here and class name will be size eight like that and then after that we're going to add project. name again initial values. name and a class name text large and font semi bold so there we go now once you are on the individual project page you will see a nice header here telling you on which project you currently are great so now let's go outside of this div here and let's go actually let's outside of this div and let's create a new one which will encapsulate our button which we can import from components UI button like this and this one will simply say uh edit project and we're going to go ahead and give it a pencil icon from Lucid react so I'm going to move this to the top here and I'm going to go ahead and give the button here a variant of secondary I'm going to give it a size of small and I'm going to give it as child because it's going to become yeah so let's immediately fix this by adding a link from next link because this button will simply redirect to hre slash workpace spes slash initial values. workspace ID slprs SL initial values. project ID uh well that's actually ID right and then slash settings that's where it's going to go like this and let's give the pencil icon a class name size 4 and Mr of two uh there we go so we now have the edit project button right here here great so now we're going to go ahead and do that we're going to create the edit functionality so what I quickly want to do before we proceed is kind of standardize my decisions about this so I want to throw an error if initial values here cannot be found right so here's how we can handle that inside of our app we can create a global error. DSX I believe and inside of here we can create an error page a div class name minimum let's just do height screen and inside of here let's add an alert triangle from Lucid react and then a paragraph something went wrong and like this with a class name text small and let's go ahead and give it text muted foreground and let's give this a flex items Center and justify Center and let's also give this a flex column and the error page also needs to be a client component so let's fix that and let's also give this a gap y of two and then below this let's add a button from components UI button with a variant secondary back to home and this will also be a link from next link which will simply allow the user to go back to the homepage like this so let's try and demonstrate this page now so I'm going to go ahead inside of my project page here and inside of my get project I will attempt uh to throw an error so instead of catching this and returning null I will not do try catch at all inside of the get project so I will just do this and if there's no member I'm going to throw an error throw new error here unauthorized so handling it the same way that I would actual API route so this time I'm going to do this before I even try anything I will throw new error test and let's see whether that will get caught and there we go so we get redirected to this page something went wrong so let's go ahead inside of error and let's just fix it a bit so perhaps we don't need text muted foreground here like this maybe we can increase the Gap y here and maybe we can give this a class name of size five or size six make it a bit larger uh okay let's refresh again there we go so something went went wrong and let's give this button a size of small okay so now something went wrong back to home and we will get redirected to here uh great and these are you know the logs of those errors uh okay that looks fine what we can also do I believe is copy this error so this will catch you know all errors inside of the entire app but I think we can kind of do it just inside of the dashboard or specifically inside of the workspace ID if you want to so if you want to I think you can you can put it like here I think and then if you get an error so let me go back to the project there we go you can see that now this is how the error looks like it's kind of in a lower uh level so if you prefer that you can do that so go ahead and put your error inside of the dashboard a layout here like this so we're just playing around you know with server components so you learn uh better of how they work uh but I have a feeling that I will forget to do that so I'm going to remove it from the dashboard if you want to you can I'm not going to uh waste too much time now on doing those things because I want just want to have one Global error Handler here and I also want to have one Global loader so I will copy this with also loading do DSX and this will be loading page and this will be very similar but it will not have any text instead it will just use a loader from Lucid react size six and animate Spin and no need for any Gap y4 here no need for this at all no need for this no need for this like that uh and then I'm going to go ahead and try and go inside of let's see do I have any existing loading ones looks like I don't maybe in the dashboard I do have loading here so I'm going to remove the loading from here because I just want to see something trigger that initial loading let's see let's go back to home there we go so that was that initial loading right uh okay so that's how you can handle you know those error States and things like that there we go okay maybe that's a bit too much loading uh too high level of loading so okay let's make it look properly so first thing I want to do is give this a text muted foreground like this because I don't like how uh dark it looks and then I'm just going to go ahead and copy this exact loading and this exact error but I'm also going to give this error the text muted foreground here and this one text muted foreground so I'm going to copy both the error and the loading those two and I'm going to put them inside of each of my route groups so out is going to have its own error and loading dashboard is going to have its own error and loading and stand alone will also have its own error and loading so I think that now all of this will look just a bit nicer there we go the loading is now here as you can see and if any errors happen for whatever reason they will also uh be handled here but I think that most of our queries at the moment are not handling those errors so let's fix that I'm going to go ahead and find all queries that we have starting with my out quer is here so uh okay actually this is fine this one is fine because we always follow it with a redirect so okay this is good now let's go inside of some other queries like workspaces here so let's use the get workspaces one and let's simply remove the TR and catch so we are just going to throw errors so in case members total is zero here uh what we will do let's see uh get workspaces okay maybe this is this is not a case for an error so that's fine yeah this is okay but no need for try and catch either if an error happens I want to catch it instead of the individual get workspace let's remove the try and catch here let's indent it if we are not a member we will throw back new error unauthorized like this and then let's do the same thing in to get workspace info props so we remove the try and catch here as well and well I won't throw any explicit errors but if they happen they will be caught as well and I think I have queries so I think only one more in the project and we are handling that well here uh great okay so now we are explicitly handling all of our loading States uh and we are also handling our error States great there we go so let's go back inside of our project here and now let's go ahead and let's build the settings screen so we will also be able to copy and paste a lot of things from our workspace but let's start as usual let's start with the schema so I'm going to go inside of my features inside of my project and I'm going to go inside of schemas dods and now I'm just going to copy and paste this like that and I'm going to call this update project schema like that and the only thing I'm going to change is workspace ID I'm going to remove it and I'm just going to change that optional here for the name and let's change this to minimum one character required uh this is fine and now let's go ahead and let's go and create the patch route so we can copy from features workspaces API my apologies server route. DS we can go ahead and copy the patch route here because it's quite similar so let's go ahead and copy this and let's go inside of projects server route and after our post and after our get let's go ahead and let's change this copied one so this is now of course for uh workspace but we're going to modify it to work for uh patching the project so let's start by changing the patch to go to Project ID PM let's change the Z validator to use the update project schema which we can import from do/ schemas like this now let's go ahead and let's first attempt to destructure the project ID here and before we can do the whole member thing we first have to get the existing project by using await databases. getet document we are defining that we are getting the project which you can do by adding dot do/ types which we've recently created uh let me go back to my patch here I am and then we're going to pass in the database ID then the projects ID and then the project ID so we are basically get getting the project first and then we're going to go ahead and use the existing project here for the workspace so existing project. workspace ID there we go and then if we don't have uh the member like this so we're going to allow any member to you know uh change projects it's only workspaces that we are uh uh restricting to admins so the only check we're doing here is whether you are a part of this workspace or not and the rest can pretty much stay the same what we have to change is the last thing so we are updating projects collection here and we are using the project ID like this and let's go ahead and return the project back uh great so we have that now let's go ahead inside of API let's copy use create project let's rename it to use update project let's go ahead and rename the hook use project use update project let's modify the response type and the request type so api. projects and I'm going to add additional project ID and then we have to modify the method to be patch keep the 200 here so we are only working with the correct response type and then we have to extend this with the correct project ID as well change this to patch and we are also going to have to extend this by alongside form also passing a peram and let's go ahead and add it here let's change the failed to create to failed to update project created will be project updated and this will be failed to update project in the UN success we can D structure the data and alongside invalidating the projects we can invalidate individual project and then data. dollar sign ID so this exact page will get updated and also what we can do since we are fetching uh using server components is we can add our router here from next navigation and we can also on success do router refresh so server components get updated as well and there is uh one inconsistency that I just uh got reminded of here so let me see I use router. refresh somewhere else in my code uh let's see use login use okay inside of my edit workspace form so this is what's uh bugging me what I want to do is I want to go inside of my reset invite code here uh is it this the only place let me just double check rather refresh okay looks like this is the only place so let's go inside of reset invite code use reset invite code and we can simply go ahead and add it here router. refresh in that case and we have to add our router of course so const router is use router from next navigation always double check that you didn't import for from next router accidentally there we go and then you don't have to do it here so no need for anything special in the unsuccess foram here uh great the only thing that's kind of bugging me here uh is that in my edit workspace okay so this is edit workspace form um on submit okay so we redirect the user back okay so what I want to do is I also want to do go instead of use edit workspace form or use update workspace hook and I want to do the same thing here so the server component is updated so use router from next navigation so this is use update workspace right and I'm going to do the same thing here so router. refresh like this and instead of my edit workspace form there really is no reason for us to redirect to the individual workspace ID we just have to you know reset the form like this and let's see do I need the router then looks like I'm still using the router for something else okay um but yeah after we submit the edit workspace form no need to redirect anywhere right we can still stay there and do more changes if we want to okay so now we have the hook to update the project we have the API to update the the project but we don't have the page so let's go ahead and do the following let's go inside of our app folder inside of dashboard my apologies inside of Standalone workspaces workspace ID and then in here we're going to create projects and then in here we're going to create individual project ID and then in here the settings page so pretty much the same thing that we did uh for the workspace ID settings so once the user clicks on edit project here they will get redirected to the settings page which will be in this kind of layout this one right so this will be the kind of layout that we are going to load so let's go ahead and do that we're going to go ahead inside of the settings let's go and add a page. DSX inside let's add a project ID settings page div like this settings page and then I think that already this should work if I click on a project and I click on edit project it should no longer be 404 so my URL is Local Host 3000 workspaces workspace ID projects project ID settings so double check that you have the same structure in your Standalone folder here Standalone workspaces workspace ID projects project ID settings page and also double checked that in your dashboard workspaces workspace ID projects projects ID page you have created the correct redirect here so workspaces workspace ID projects project ID settings that way it cannot not work okay so what we have to do inside of here is the same thing that we keep doing so first of all we have to get the user using a way to get print if there is no user we are not throwing any errors but we are redirecting to sign in then we are getting the initial values here using a we get workspace from my apologies get project from feature projects queries and we have to create an interface project ID settings page props which hold the PMS project ID which is a string inside of here we're going to the structure project ID settings page props you can see how this is throwing an error for example because we forgot to pass in the project ID here so let's get the parms and then let's go ahead and passing the project ID here to be params project ID and there we go no errors now great so let's go ahead now let me just see uh oh yeah so the cool thing now is that initial values can almost never be null that's cool okay so now let's go ahead and actually uh build the settings page here so the first thing we have to do is we have to give it a proper width like we always do so for example in my workspace settings page I have this so let's go ahead and do that there we go and because I just went here let's go ahead and just fix this so go inside of Standalone workspaces workspace ID inside of settings so inside of workspace settings here and this time since we are throwing errors directly here right we don't allow the workspace to be null because I think this will also throw an error if it doesn't exist so you this will never happen you don't need it at and this at this point and this is just a random typescript uh restart typescript server there we go now it goes away okay so now we will pretty much have to do this right so we have prepared inside of projects project ID settings page right here we have the initial values and now we have to create a edit project form which you guessed it we can copy from the existing uh edit workspace form so let's go ahead and let's close everything let's go inside of source features workspaces components and edit workspace form I'm going to copy that and I'm going to go inside of projects components and I'm going to paste that here so this will become edit project form there we go and now I'm going to go ahead and well we have to resolve all of this but let's start with renaming the props and the con constant name so this will be edit project form like that it will have on cancel and initial values so that stays as it is now let's go ahead and modify the schemas to use the update project schema instead of use update workspace it will be well use update project import you calling the use update project method we don't have the delete one we don't have the reset one and instead of the type workspace the type project is here so let's go ahead and simply prepare the use update project here and I want to just comment out the delete one but we can entirely remove the reset invite one and we can also entirely remove the use confirm for the reset invite link because there will be no invite link here let's change the instance of use of update workspace schema here here and I believe in the submit method here with update project schema so this is resolved this is resolved and this is resolved the handle delete for now will be commented out so it will just open the confirmation model nothing more the handle reset invite code can be deleted entirely here uh the onsubmit here will pass the project ID like this everything else can I believe stay the same the handle image change can also stay the same we will not be using full invite link we don't need handle copy invite link we don't need the reset dialogue anymore and inside of here initial value that name is just fine and let's change this to be project name and the placeholder enter project name and this will be project icon and then and let's go ahead and let's simply go in this second card in between the danger zone and the first one and remove this and the danger zone can stay here we're just going to remove this what we don't have and this will say delete project and the danger zone will say deleting a project is irreversible and will remove all Associated data and let's see what uh else is there to fix the initial values will be a type of project there we go now we have edit project form props here and then what we can do is we can go inside of our Standalone right here inside of workspaces workspace ID projects project ID settings page and inside of here we can render our edited edit project form now we can go ahead and give it the initial values to the initial values now and no errors great so if I refresh this there we go I can go ahead and modify my project let's see if this now fully works so I have this project here uh let's see is this still loading Let me refresh oh that's weird so I'm getting 401 here okay we will de buug What's Happening Here let me go to logo host 3000 okay now everything seems to be working just fine so I will create a new project called test and I will go inside of this project and I will click edit project there we go it's called test and I will click on here test two and click save changes and there we go test two updated great and every time I click back uh I'm seem to be having this issue uh that's weird yeah I'm not sure why I'm getting redirected here so let's go back and set of the edit project form and I think that my back button here is incorrect yes my back button here goes to slw workspaces and then it loads the initial values. ID which is the project ID so it gets confused so inside of here we have to go to slw workspaces slw workspace ID and then we have to go to slash initial values whoops do ID with the dollar sign there we go so now we will not be having those thing happen again because this ID that's currently in the URL is the project ID so it's confused uh okay now it I accidentally entered something let's go back to Local Host I get redirected to workspace ID I click on a project I click on edit project and I if I click back here again oh I forgot one more thing so again back in the edit project form in the router push we are missing slash projects like this there we go so let's try third times the charm on the project settings if I click back there we go I am onto that project perfect so now let me try again save changes there we go I'm not a big fan of this refreshing thing which happens but I think that happens because of if I go to use update project it happens because of router. refresh and currently that's the only way we can get the newest data I believe so let's leave it at this okay now let's go ahead and let's implement the delete project so we can wrap up the chapter so we can pretty much copy the the same thing we have inside of our workspaces server as always so let's simply copy the entire delete workspace ID here like this and let's go inside of projects server route. DS and after our patch to update let's now chain a delete method instead of workspace ID we will be looking for a project ID so project ID and the only difference is that we are first going to have the existing project so I'm going to copy this from the route above and I'm going to paste it in my new delete here so I'm going to first attempt to get the existing project and then I will use the existing project here so existing project. workspace ID and let's go ahead and remove this because anyone will be able to remove a project again I don't want to be strict with my projects and then I will simply uh call this delete tasks right because in each project they will be tasks so let's do await databases delete a document and let's go ahead and pass in the projects ID here and let's use the project ID and let's go ahead and pass in the project ID here or we can use existing project. ID to be more specific the there we go we now have this and now let's go inside of API let's copy use create project and actually let's copy use update project let's paste it and let's rename it to use delete project instead of use delete project let's rename this to use delete project and now let's fix the response type and the request type to use the delete methods let's fix this here as well so delete method and we are not passing any form here so remove form we are completely relying on the Pam and this will be failed to delete project project deleted and let's also do projects here uh and project here is fine and failed to delete project great so now let's go ahead back inside of our projects components edit project form and I believe I have commented out one cook so let's go ahead and add use delete project which we now have so let's just wait for this to resolve and then I'm going to uncomment this and simply change this to use delete project I will change the mutate to be delete project and this will be is deleting project let's go ahead and change the dialogue to be delete project Let's uh fix the handle delete here I'm going to uncomment it and I'm going to call the new delete project here and I'm going to call the project ID here and and where I'm going to go is well yeah we can go back here that's fine or we can go back to let's see um do I have access to I don't have access oh I do inside of initial values so we can go inside of Slash workspaces and then initial values workspace ID we can go there okay let's try it out now so if I click delete project and confirm and there we go and if I go here again click here first let's re let's rename and let's upload an image for example so I'm going to use the unsplash image here click save changes let's see if that is working there we go uh let's rename let's rename perfect and let's click delete project and confirm and there we go our project has been deleted uh great so one thing that I want to do now to wrap it up is that when I create new project from the form from the model I want to get redirected there so let's go inside of the create new project create project form and inside of here we have the router here and I added a comment to do redirect to the project screen so let's add in the onsuccess mutation in the onsubmit in the create project form router. push and we're going to go to slw workspaces and then I'm going to go ahead and go to uh we have workspace ID great so workspace id/ projects and then I will D structure the data from the on success here and I will use the new data. dollar sign ID like this there we go let's try it out now so new project I will press enter and I'm redirected to that new project project amazing we now have full control over our projects here and now we are ready to go ahead and create some first tasks great great () job now that we have the individual project ID page we can go ahead and create a component called task view switcher this component will serve as accuration of all the tasks that we have and we can switch by looking at them through a table a Comon board or a calendar and that component will also have its own new task button and we're going to reuse that component here in the individual project page and also later in the my tasks page so let's go ahead and handle that we're going to go ahead inside of the source inside of features and inside of here I'm going to go ahead and create a new folder called tasks and inside of here I'm going to create a components folder and inside a task view switcher TSX let's go ahead and let's export tons task view switcher and inside of here let's return a div tasks now let's go back inside of our app folder dashboard workspaces workspace ID projects project ID and then what we're going to do is after we render this we're going to render the task view switcher like this and there we go now you should see the text which says tasks right here below this new project header let's go back inside of the task view switcher and go ahead and confirm that inside of your let's see inside of your components UI you have tabs so we need tabs right here if you don't you can go ahead and go bu x-- bun shaten 2.1.0 add tabs great so I have tabs right here so I'm going to go ahead and add tabs here and let me import them from components UI tabs and while we are here let me add everything else we need here so we need tabs tabs content tabs list and tabs trigger components so we're going to go ahead and just give this a class name Flex one full withd border rounded large then inside of here I'm going to create a div with a class name height full Flex Flex column overflow Auto and padding of four and then inside of here I'm going to create another div with a class name Flex Flex column Gap Y 2 on large Flex row justify que and items Center inside of here we're going to create tabs list component with a class name full width on LG with auto inside of here let's add a tabs trigger component which will say table the class name here will be height e with full LG with AO and value will be table now let's go ahead and copy this two times the second one will be value Conan and the text Conan and the third one will be calendar like this so now we have table kban and calendar and this is how it looks like uh on desktop now let's go ahead and let's style our tabs component so it suits our design as required so we're going to go directly inside of the tabs component here so that's located inside of source components UI tabs here and first things first we're going to we're going to go directly in the tabs list and what we are going to do is go ahead and ensure that we have background muted here and let's change it to background transparent like this so background is now transparent and we're going to add Gap X2 so these are spaced out between one one another like that great then we're going to go ahead inside of the tabs trigger component here and we're going to go ahead and find the text small here and after that add BG neutral 100 that's what we're going to do uh and after BG neutral 100 uh we're going to go all the way to the end where we can find the states and by States I mean this ones they data state state active so change this from background uh from BG background to BG neutral 200 like this and state active here will be text black like this and let's go ahead and let's remove the shadow we don't need the shadow like this there we go so I've just slightly modified our table if you don't want to modify it you don't have to uh but this just suits my idea a bit better great so we now have that now let's go ahead and continue developing here so besides the tab list here we're going to have a button component from components UI button so make sure you have added that import here which will simply give you an option to create a new task so we're going to write new here and we're going to go ahead and do plus icon from Lucid react here we're going to give this button a size of small we're going to give it a class name of with full LG with auto like this and we're going to give the plus icon a class name size four and Mr of two like this there we go so this is how it looks like on desktop a nice little button here uh great and what we have to do next is go below here and add dotted separator here so make sure you have imported dotted separator let me just move this in its correct position after the dotted separator I'm going to add uh a comment add filters and then inside of here we're going to have another dotted separator here and let's ensure that both of these dotted separators have a class name of my4 so let me just remove some extra space here and add a space here instead like this and then what we're going to do here is we're going to go ahead and add a fragment uh because we're later going to uh add this in a conditional Turner so it's easier to add a fragment already so add tabs content here and give this tabs content a value of table and give it a class name of margin top zero so in here I'm going to go ahead and write uh data table then I'm going to copy and paste this this value will will be a conon so I'm going to write data conon and in here I'm going to give you a value of calendar so this will be data calendar there we go and you can go ahead and write data filters here so you can see our skeleton now we're going to go ahead and have the conand and the calendar and we're going to develop this components individually and inside of here we're going to have some static filters which will apply for each of these uh States here so what we have to do now is actually create our task in order to do that let's go inside of console let's go inside of our uh Joc clone database and let's create a new collection alongside projects members and workspaces so I'm going to call this tasks I'm going to go ahead and create this and I'm going to create some attributes let's start with the workspace ID which will have a size of 50 and it will be required make sure you don't misspell workspace ID here after workspace ID we're going to add a name I'm going to limit this to 256 and make it required as well after this we're going to have a project ID with a size of 50 and it's also going to be required after project ID I'm going to add an assign me id which will again be a size of 50 and required after that I'm going to add a description which will have uh well let's say 248 characters Max and it will not be required after description let's add uh well we're no longer adding any strings here now let's go ahead and let's add a date time which we are going to call due date and it will be required then let's add an Anum which will be called status and the possible elements inside of here will be backlog make sure all of these are in uppercase letters so backlog to do inore progress inore review and done and it will be required and click create all right and then uh we're going to have not a string but an integer called position and inside of here we're going to go ahead and create a minimum position of a, and let's go ahead and create a maximum position of uh a million or yeah let's go ahead and do a million like this and this will be required as well and let's click create so why does it start at Thousand so the position uh will be using instead of increasing each task by a plus one in the position will be increasing by a plus thousand so we have a lot of room to fix things in case uh something goes wrong all right so let's go ahead and confirm it like this this is the position so you should have the workspace ID name project ID assign ID description due date status and position out of those only description is not required let's go ahead and copy the tasks project the tasks ID let's go inside of environment. loal and let's go ahead and create our next app tasks ID now let's go inside of the config file let's go ahead and Define our tasks ID let me copy it from here and add it here there we go now that we have that let's go ahead and let's start creating uh our endpoint for creating tasks so in order to do that let's first prepare by creating the task schema so let's go our existing tasks feure folder where for now we only have the components task view switcher and let's create schemas dots inside of here let's export const create task schema let's import Zod and let's go ahead and Define the name to be Z string with a minimum value of one and required let's go go ahead and give it a status of z. native enum and inside of here we'll have to add a task status so let's go ahead and do that by going inside of tasks and creating a new types. TS let's export a new task status to be backlog so this has to match 100% what we wrote on the what we wrote in the app right right so make sure you don't misspell and you can you can go ahead and do this you know just have your status opened click on update here and you just double check that you're doing it correctly so it should have backlog to do it should have inore progress inore progress it should have inore review it should have done like this so let me just double check all of these are the same great then we can add the task status from types to the native Anum right here great and let's go ahead and extend this can I just pass in required here as well I can't okay so I have to add required error required after status we're going to have a workspace ID which will be a z string and trim Also let's add trim here minimum one required same thing for project ID due date will be z. course date without executing course so just date and optional actually not optional it's required and assign ID will be z. string trim minimum one and required and then we're going to have description z. string. optional and we're not going to add position because we will not be passing that through the form so we're going to calculate that ourselves great we now have the create task schema so we can go ahead inside of the tasks feature folder and create server and inside server we can create a route. DS let's go ahead and create const app to be new hono from hono and Export default app let's go ahead inside of our source app folder apir route. DS let's carefully import tasks from features tasks server route and then let's go ahead and chain route tasks to tasks now let's go back inside of our tasks server here and let's Implement a post method for creating new tasks so we're going to have a session middleware here and then a z validator which will look for Json and create task schema after that we're going to have an asynchronous controller here let's go ahead and let's extract user from C.G user let's extract databases from C.G databases let's go ahead and let's destructure everything we need from C request valid Json so that will be name status workspace ID project ID due date and assign me id we're then going to get the member by using a way to get member from features members utils let me go ahead and align everything the way it need to be aligned okay so we're going to get the member here by passing in the databases the workspace ID and the user which is my user. ID and I mean user ID here if there is no member we are not allowed to create tasks inside of this workspace so return c. Json error unauthorized with a 401 now let's go ahead and get the highest position task so const highest position task at the moment will be await databases. list documents passing the database ID and then passing the tasks ID which we haven't used yet so we have imported it from the config tasks ID and now we're going to go ahead and do a query here so query. equal we have to query from node app right so just ensure that you have added this as well so query equal status will be status query equal workspace ID will be workspace ID query order ascending will be by position and query limit will be just one so we are just looking for the highest task so calculating that that by that highest task we can get the new position so cons new position will be highest position task do documents. length is larger than zero in that case highest position task. documents first in the array. position plus a th000 otherwise we start with the Thousand because if there is no highest task at the moment that means under that status we are the highest or the first task so the position will be exclusively used for the combon board now let's create a new task using await databases. create document database ID tasks id id from node app. unique and then go ahead and add the name status workspace ID project ID due date assign ID position new position ensure that you have imported ID from node app right alongside query here and once you have created the task you can go ahead and return c. Json data task great while we are here let's also go ahead and let's create the get route let's go ahead and let's write a doget method here let's add a session middleware let's add a z validator which is going to validate the query and it will be a z. object and we have to import Zod so just ensure you have added this let me move it at the top here inside of this we're going to have workspace ID which will be z. string we're going to have project ID which will be string and nullish and we can go ahead and also do the same for assign ID then we're going to have status which will be z. native enum of task status from do do/ types nullish and we're going to have search which will be z. string nullish and we will have due dat z. string nullish and then let's go ahead and let's add an asynchronous controller and inside of here let's go ahead and get the users from await create admin client because we're going to have to populate the users similar to how we handled Our member list all right we have prepared this now let's get databases from C doget databases now let's get user from C.G user now let's go ahead and let's extract everything we need from C request valid query so that will be workspace ID project ID status ser search assign ID and due date now let's go ahead and see whether our member has the necessary rights to do this using the get member make sure to await this method we are passing in the databases the workpace ID from the query and the user ID from the user. dollar sign ID coming from the session middleware if there is no member as always we can go ahead and simply throw an unauthorized error here otherwise let's go ahead and let's prepare our query so the query will start very simply by adding an equal workspace ID and workspace ID here then query order descending dollar sign created at and then if we have a project ID we're going to conso log project ID and project ID so it's easier for you to debug what's going on and let's add a comma here and let's do query. push query. equal so the query here is a constant but no you have to distinct between this query and this query so query. equal project ID project ID let's copy and paste this and let's change this for the status so status let's copy and paste this again this time let's change it for the assign ID let's go ahead and copy and paste this again this time for due date so due date and and this will be same thing du date and let's copy and paste it for search and this one will use query. search by name and the query here search and then we're going to go ahead and actually call the query so const tasks will be await databases. list documents database ID task ID and our query and then we're going to go ahead and extract all project IDs and all assign IDs so const project IDs will be tasks documents map get the individual task and get the task. project ID then we're going to have assign IDs to be tasks documents map get the individual task and get task as I ID and then let's populate all projects so projects will be await databases. list documents go ahead and give them a type of project here from feature project types so I'm just going to move this here I accidentally imported this no need for that so list documents project let's go ahead and give it a database ID projects ID here and we're going to do if project IDs length is larger than zero we're going to add a query contains dollar sign ID project IDs otherwise an empty array and you can copy and paste this and do the same thing for the members and you can remove the type here so we're going to use member IDs members ID from config here make sure you have added all of these database members project and tasks and instead of iterating over project IDs here we're going to be working over assign IDs here so this way we are going to populate all of those user uh let's go ahead and see what's wrong with as okay so this is as IDs the array so we are now populating uh all projects and all members with all the the IDS we have gathered from all the tasks matching our query so now what we can do is we can populate our tasks so let's create con populated tasks to be tasks documents. map get the individual task and inside of here first find the project using projects documents find Project project. dollar sign ID is equal to task. project ID and now we populated the project for this task we can now copy and paste this with the ass and we are iterating over asses like this uh it cannot find the name as I okay oh I called it members so as I like this as I kn uh and we are looking at an individual assign here so assign dollar sign ID is equal to task as ID uh let me just go ahead and find the proper as ID make sure you don't misspell the S ID here there we go so now that we found those two we're going to go ahead and return the existing values in the task alongside a popular populated project and a populated ass great so uh now let's go ahead and just return c. Json data tasks documents populated tasks there we go so we now have our get route which is queriable and which can populate uh oh we didn't use the users let's see if that is my mistake here uh okay yes it is my mistake we have to use the users from create admin client so let's go ahead inside of our we have the populated tasks here okay so we have to go here inside of the assignes here uh so these will actually be members I was corrected the first time and then we are going to create assign here by using await promise.all so we can use async and await inside of map so I'm going to do members. documents. map asynchronous function holding the member let's go ahead and assign users. getet member. user ID and then inside return member alongside a populated name from the user and a populated email from the user whoops there we go now we have the assay knes here and now you don't have to do dot documents here you can just directly go to assay now we are ready great so we finished two very important uh routes uh for our tasks and what we're going to do in the next chapter is we're going to go ahead and turn them into Hooks and we are going to query that data here in the table for example and we are going to create the new task model and form great great () job let's continue by building our create task model let's start by going inside of features tasks and let's create hooks folder and inside we can drag and drop or copy and paste the one from projects called us create project model looks like I have just pasted it here so let me just uh take that copy from here and add it inside of my tasks here so I'm going to rename this to use create task model let's go inside ensure that it's inside of the tasks feature folder and we're going to rename this to use create task model let's change this to create task and everything else can stay the same now let's go inside of components and let's create our create tag ask model. TSX component so inside of here we have to import responsive model we have to import create task form which well we don't have yet so let's just export const create task model here let's the structure is open and closed to use create task model let's go ahead and let's return here a responsive model with an open of is open and on open change to be our set is open uh I just need to import this and let's go ahead and pass it here set is open and inside we're just going to go ahead and create a div to do task for great now let's go ahead and let's play around and find a way to trigger this model but just before we do that ensure that instead of your app Bolder dashboard layout. TSX you add the create task model from features task uh components create task model uh looks like I have an error here but I think that's just a cache if I refresh uh let's see create task so there is something going on here create task model here create task I'm just not sure what exactly is causing the problem here can I go back to my local host 3000 or will the error still appear okay so the error seems to be persistent here uh let's see what's happening here uh use router use create task so something here is causing an issue create task oh yes it's because create task model needs to be used client okay can I refresh now there we go now it works so let's go to the new project Here and Now on the click on this new button we're going to open that so let's go ahead and already copied this let's go inside of our task view switcher here and let's go ahead and add that so use create task model from do/ Cooks use create task model and I'm just going to open I'm just going to extract the open here let's find the button on click open there we go uh and we also have to turn the task view switcher into use client and then you can refresh this and the error should go away when you click new there we go we have our form here great so let's continue working inside of the create task model and let's start by creating the create task model wrapper so what exactly is the create task uh not the create task model wrapper but the form wrapper so the form will have to allow user to select a member and to select projects in order to do that we're going to have to prepare those arrays of options for the main form so we're going to do that in a component one abstraction above the actual form so let's create an interface create task form wrapper props on cancel just an empty void here export con create task form wrapper will'll have to destructure the on cancel from here on cancel and let's assign the create task form wrapper props and then inside of here we're going to go ahead and we're going to call the use get projects from features projects API use get projects like this and let's go ahead and also prepare the workspace ID here from use workspace ID so workspace ID like this and then we're going to get the projects from data projects and is loading will be is loading projects let's copy and paste this and let's get our use get members from features API use get members and then this will be members and this will be is loading members so let me just double check inste of my use get members here uh okay I have a bug here I mean a typo failed okay let's get inside members server just quickly so inside of my get okay I populated the users I kind of forgot do I do that or not but yes we do that thanks to the model list that we had to do now let's go ahead and let's create the project options here by doing projects questionmark documents. map get the individual project and inside iMed medely return an object with an ID of project. ID name of project. name image URL of project. image URL go ahead and copy this and now you're going to create member options like this which will go over members and it's not going to have image URL and let's fix this type of image URL if you have it then let's define it is loading which will be either is loading members or is loading projects now let's go ahead and uh if is loading we're going to go ahead and create the following so a card from components UI card then card content from components UI card and a loader from Lucid react inside so make sure you have added these two here we're going to go ahead and give the loader a class name size five animate Spin and text muted foreground we're going to give the card content a flex uh I have a typo here so class name items Center justify Center and full height and we're going to give the hard pull WI a height of 740 pixels border none and Shadow none uh and of course we have to return that not just put it in if Clause otherwise it will not render great other than that uh we're going to go ahead and we're going to render the task form which we don't yet have so let's just write uh Json stringify and let's add our projects here and below that members actually member options and project options like this so now we're going to go inside of the create task model here and we're going to render create task form wrapper from dot dot from do/ create task form wrapper and we're going to pass an on cancel here to be our close method from use create task model so close so there we go you can see how this loader will be looking like and then you can see we're going to load the options so this here is my new project which I have right here and inside of here is another one I believe there we go called the test which is my other project and these are my options for members so only one member in this workspace great so that is working and now we are finally uh ready to create our create task form so let's copy one of the forms that we have so we save some time I'm going to go inside of features projects components create project form and I'm going to paste it inside of tasks components and I'm going to rename it to create task for inside of here I'm going to go ahead and get the create task schema and use create task which we don't yet have so let's quickly do that first so okay you can save this leave it broken that's fine I want to do the priority thing first so let's create an API folder here and let's go inside of projects API and let's copy use create project and let's copy use get projects so one mutation and one query and let's add them here I'm going to go ahead and rename this one to use create task and I'm going to go ahead and change this to use create task and I will change the response in the request type to go to tasks and I will do the same thing here and it's not going to accept form but Json this will be failed to create task this will be task created and this will refetch tasks and this one again an error message now let's go inside of the use get project and let's rename that to use get tasks let's rename this to use get tasks props and this will be use get tasks let's go ahead and add this and let's call this tasks and let's go ahead and call this tasks as well but we will have some more options here if you remember we have all the other where is to add we can remove the conso log here okay so so now let's go inside of components create task form and now we can import use create task from do/ use create task let's rename the create project form here to create task form so all three instances here here and here let's rename this to use create task which we have just added and imported here let's go ahead and change these uh three instances or yes three instances to create task schema like this uh and now we're going to go ahead and slowly resolve everything we need here first of all in the create task form props we're going to have a uncel but also project options which will be an array of objects inside of those objects we're going to have an ID which is a string uh let me just see inside of my task for wrapper okay so we store it under ID like that okay let's be consistent we we've used dollar sign everywhere so let's use it here as well or actually no let's not do it okay because this is our custom you know mapper it's fine so just you know inside of the create task form wrapper we are using normal IDs here so make sure that instead of your uh create task form you use normal IDs here as well ID name String and image URL string string below that we're going to have member options with just these two like that great so we are going to have that project options and member options now inside of the default values we're just going to prepare the workspace ID and nothing more inside of the onsubmit here we don't need to do any of these things we're just going to pass in Json we're going to spread the existing values and append the workspace ID here and on success we are just going to do form reset and on cancel or we can do too redirect to new task instead so no need for okay we're going to use the data here later that's our onsubmit we are not going to use the handle image change method and inside of here we're going to have create a new task like this oops create a new task inside of this we will have a task name and this will be enter task name it will control the name property so that's completely fine but after that we will not have the image so you can remove this entire form field here like this and I think that we can already change this to create task and we should be good to adding this here so let's go instead of create task form wrapper and let's simply return create task form here which we just edited let's pass in the oncancel to be oncancel let's pass in the project options to be project options and member options to be member options all right uh let's see exact L uh what is not right here all right type undefined is not designable to type uh okay so member options oh so it's possible that this is undefined okay let's just do this there we go and there we go you can already see you know you can now click new here and there we go create a new task so now we're going to go ahead and actually Implement all the fields we need here so let's go inside of the create task form and we can remove the input ref no need for that you no need for use ref for image for image icon or for any of the Avatar stuff like this uh and let's go ahead and now continue developing here so so far we have the input for the task name so let's copy this form fi and below that we're going to have a due date here so due date uh you should also have this you know under these options so form label will be do date like this uh and now we have to create a date picker component uh but date picker component does not uh come from shn so we're going to have to create it using a couple of components that we already have so let's go ahead and remove the input here let's add it to date picker and now let's go ahead and let's create the date picker component so quickly do bun add date FNS and wait till you see my version so 4.1.0 so bun add uh date FNS add 4.1.0 or npm install I highly recommend that you use the exact same versions that I do great we now have that FNS let's go inside of components and let's create a date- picker. TSX component here let's mark it as use client uh let's add all the Imports we need here so we're going to need everything from react format from our new date FNS calendar as calendar icon from Lucid react we are then going to need CN from lib utils button and calendar and we are going to need popover so all of these are shat CN components if you are missing any of those uh I've already demonstrated a couple of times in the tutorial how to add them so just run the command bonx d-b shaten add 2.1.0 add popover or calendar if you're missing one now let's go ahead and let's create an interface date picker props so the date picker props will have a value of date or undefined on on change which accepts the value date and an optional class name and an optional placeholder now let's go ahead and let's create an export con date picker and let's go ahead and let's assign the props here so date picker props like this and inside of here we can D structure all of those values that we need so let's add value on change class name and the placeholder and let's give it select date as default placeholder inside of the date Pier let's go ahead and let's return uh our pop component a popover trigger component let's go ahead and give it an as child property inside let's go ahead and let's add a button element inside let's add our calendar icon let's go ahead and give the calendar icon a class name MR2 height four and width four and below that let's go ahead and use the format from date FNS if we have the value format the value in PPP format otherwise simply use the placeholder inside of a span regarding our button let's go ahead and let's give it a variant outline and size large and then let's go ahead and give it some Dynamic classes so we start by default classes full width justify start text left font normal and PX3 if there is no value we are going to mute the text and then we add a class name as the third argument here for some additional styling then let's add a popover content here and inside of the popover content we are finally going to add our calendar with mode single selected prop will be our value which comes from the props on select we'll get the date and call the onchange date as date and initial focus and let's give the popover content a class name of with Auto and padding zero like this now this component is ready to be used in the form let's go inside of the task form and let's now add our date picker component from components date picker and let's spread the field inside Ure that you have imported the date picker here from components date picker I will just move it here there we go and now if you go ahead and expand here you should have a date picker component and I can select there we go 17th of October excellent now that we have that let's continue uh developing the rest of our form so after due date let's go ahead and let's add the assign ID so I'm going to copy this form field and this will be ass ID and the text here will be assign so the person assigned to this task and in here we now have to import everything from the select component so let's go ahead and quickly add that I'm going to do that after the form select select content select item select trigger and select value let's go back to our copied assign ID here and let's go ahead and use this so we're going to start by adding the form item as usual and the form label assign and then we are not going to have form control immediately we're first going to have select we're going to go ahead and give it a default value of field. value whoops inside of brackets fi. value and on value change to be filled on change then inside of here we're going to add form control and we're going to go ahead and add a select trigger component here a select value component with a placeholder select assign and the self closing tag outside of the select trigger we're going to have uh outside of the form control actually we're going to have a form message here and then we're going to have a select content here like this and then inside of here we're going to go ahead and iterate over our member options. map get the individual member here whoops and inside of here we're going to render our select item let's go ahead and let's give this a key and the value of member. ID and we can safely use normal do IDs here because this is our options right it's not coming directly from app right inside of the select item we're going to go ahead and create a div with a class name Flex item Center Gap X2 and we're going to add Our member Avatar we have to import it so let's give it a class name size six a name of member name and member. name option here and let's import the member Avatar here from features members components member Avatar I'm just going to move it along with the other features there we go that should be it uh parameter member imp implicitly has any type I don't think it does I think this is a mistake let me restart the S server looks like it was a mistake yeah so now you can just assign Antonio as an option or if someone else joins your workspace you will be able to select that person uh great so now let's copy and paste this form field and now we're going to create the select option so we're going to copy and paste this and we will now working with the status here so this will be status uh it will still use select so that's fine the placeholder will be select status instead of member options we're not going to have member options at all here here so let's remove the member options uh we're going to have individual select item here with the value task status from /type backlog and then we're going to Simply render out backlog so import task status from dot do/ types like this and now what we're going to do is just copy uh uh all of them right so we have in progress in progress in review in review and we have two more to-do and done so task status to-do to-do task status done done there we go so now inside of here your status you should have in review in progress too done backlog great and you can decide on the order of this now let's go ahead and let's copy our uh member select here Our member form field and let's place it after the status here and this one will be for the project ID so this will be the project assigned and this will be select project and instead of member options we're going to use project options and instead of using member we're going to use project and project and instead of member Avatar I will be using project Avatar and we're going to pass in image URL here from Project image URL uh I think this is image actually yes it's the image Pro that we have make sure you have imported the project aat from features I'm just going to move it along with the other features here there we go and now I think this should be enough for you to select a project if needed great and that is it those are all the options so now well let's go ahead and try and build this but I think that we have forgotten to uh instead of my tasks collection to add permissions so let's go inside of permissions add users create read update and delete and click update here there we go now let's go ahead and refresh this and at the moment I have no tasks I'm going to create a new task I'm going to select date to be tomorrow I'm going to select myself as an assign I'm going to select to-do status and a new project let's see task created let's go ahead and refresh this there we go workspace ID name project ID S ID description is null due date is tomorrow status is Todo and position is 1,000 our API officially works great so what we're going to do next is we're going to go ahead uh and render these out inside of the data filters here so uh we're going to start creating the table the Conan and the calendar board so for now what you can do here is actually uh call the on cancel instead of this so just on cancel question mark and execute it there we go so once you create a new task I'm going to try again here everything should still work just fine once it's created it will close great so we're going to end the chapter here and now we're going to learn how to render those tasks great great () job now that we've created a form for creating tasks we can utilize our us get task hook to actually render them on our task view switcher component so let's revisit our features tasks API and confirm that you have the use get tasks hook right here what we're missing here is adding all the necessary props like status project ID ass ID but we're going to add them in a second what I want to do now is just load all the tasks in our database so what we're going to do is we're going to revisit our tasks components task view switcher component and inside of here we're going to add use get tasks from do/ API use get tasks and inside of here we're going to go ahead and load them so use get tasks and right now uh we're not going to pass any props inside but I'm not sure if typescript Will allows us to do that so yes it's requiring at least workspace ID and okay we can pass that so const workspace ID use workspace ID from features workspaces hooks use workspace ID and I'm going to separate it here between these two Imports now go ahead and pass in the workspace ID inside and this should simply load all tasks in this workspace so let's go ahead and get our data which will be tasks and is loading will be is loading tasks and I will just collapse that like this so it's a bit more readable and now inside of here what I want to do is go inside of each of the tabs content and for now all we're going to do is replace the strings with Json stringify and our tasks inside so let's copy this inside of the table inside of the conun and inside of the calendar so right now if you save you should be getting when you click on table let's see there we go you can see that now we have this huge stringified Json which is basically the same data which we recently saw in our database so what we have to do now is the following first of all uh let's go ahead and let's give our tabs a default value because that seems to be missing here and I want to find a way to control this tabs which we have so kban calendar and table via URL so that we can easily share that view with someone else and for that we can use uh no Library so let's go ahead and let's import use Query state from KN and inside of the task view switcher let's add view set View and let's assign that to use Query State and and we're going to call it task Dash View and we're going to set the default value to table and then we can use the view here inside of the tabs so let's assign the default value to be View and on value change will be set a view like that so let's go ahead and refresh this time there we go now you can see the table is selected but if I click on Conan my URL now has a task D view Conan so if I refresh on this page you can see that kban now stays selected great so what I want to do now uh is go ahead and build the filters right so I want to get that out of the way so that we can already start filtering uh our tasks because the hard part which was the back end is easy is a finished for that right so we don't have to work on that anymore we just have to create the UR y components for it so in order to do that let's go inside of our use get tasks and let's extend the use get tasks props so we're going to go ahead and add project ID which will be a string and optional status which will be a string which will be a type of task status so our enum from do/ types and let's go ahead and do this let's add string or or null explicitly and same thing here so task status or null and then we're going to have a ID optional string or null and due date optional string or null and now let's go ahead and extract all of those values so the only one required is the workspace ID the rest are all for optional filtering project ID status search assign me ID due date and I forgot to add a search so let's add search optional string or null great and now when we generate our query key we want to include all of these optional values here so if they change we want to re-trigger this so let's go ahead and do that our query key will be tasks with workspace ID project ID status search ass ID and due date and then we're going to go ahead and modify our query so workspace ID will be the standard and then project ID if we have project ID or undefine and we're going to do the same for the rest of our filters so status assign ID search and due date and I think that's all of them so we have the project ID we have the status search assign ID due date and we have workspace ID here there we go and you can see that my filters uh my use get tasks are still working here normally so before we go into implementing UI for the filters let's go ahead and let's first add a loading State here because it just looks weird that nothing's happening for a few seconds here so we're going to go ahead and and we already extracted the is loading tasks here so now let's use it let's go ahead and let's find our doted separator here after the data filters and we have already prepared the tabs content inside of the fragment so what we can do is we can check if is loading tasks in that case we can simply go ahead and create a loader otherwise go ahead and render this fragment it has to be in a fragment because it needs to have one parent component now inside of here let's give the div a class name of P width border rounded large height of 200 pixels Flex Flex column items Center and justify Center and then inside of this div we're going to add a loader from Lucid react and give it a class name of size five animate Spin and text muted foreground so make sure you have added loader from Lucid react so now when you refresh here you should have a nice loader here first like this and then it will showcase the data great now let's go ahead and let's create the data filters so let's go and inside of tasks components let's create a data- filters. TSX let's export cons data filters and let's create an interface data filters props and the only prop it's going to accept is hide project filter so we're going to use this because we're going to reuse the filters on the project page and it makes no sense that on an individual project ID page we give the user an option to load other projects they can use the my tasks tab for that so we can go ahead and destructure the data filters props here so hide project filter and now inside of here let's go ahead and let's prepare our projects using use get projects let's also prepare the workspace ID from use workspace ID so both of this come from features that's fine and we simply add the workspace ID inside below that we're going to go ahead and extract the members from use get members and again workspace ID inside let's make sure that both of this have their is loading State and let's remap them to his loading projects and the bottom one can be is loading members let's create a unified is loading constant based on those two values so is loading projects or is loading members both of them are going to change this value to true now let's go ahead and let's use let's do what we previously did which is convert these members and projects into options right so project options where we map over documents get the individual project and we accept the value which is dollar sign ID and the label which is name and then we do the exact same thing for our members here like that and now uh let's go ahead and do the following so if is loading for now let's just return null otherwise we can go ahead and create a div here with a class name Flex Flex column on large Flex row and GAP two right here and now inside of here let's also import our components which we are going to need so most of this will be select components so import select select content select item select separator select trigger and select value from components UI select but we are also going to use our newly created component called date picker so let's go ahead and add all of that but before we do that I want to go back to task view switcher and I want to find this text Data filters and replace it with the actual data filters component so make sure you have imported data filters from do/ data filters and now you can go ahead and take a look here in this space uh and see what you are developing inside of the data filters we're going to start with the first item which is going to be a select component it's going to have a default value here which for now can be undefined we're going to change this later and let's go ahead and also prepare the on value change which will just be an arrow function for now and then let's add a select trigger component here with a class name W full LG with Auto and height of eight and inside we're going to add a div with a class name Flex items Center and padding right off two we're then going to add list checks icon from Lucid react and let's give it the class name size four and Mr of two and let's add a select value with a placeholder all statuses make sure you have added the list checks icon here from Lucid react I'm just going to go ahead and move it to the top here uh I'm pretty sure that this is oh placeholder okay like this so if you're wondering about this size of four this is the equivalent of writing H4 and W4 so it's a shorthand operator you you can just write size four okay and now outside of the select trigger let's add a select content and inside we're going to add first a select item with the value all and it will say all statuses and then we're going to add a select separator here and a select item again but this time with proper values so we're going to have backlog with the value that task status. backlog so I'm just import task status from do/ types and now we have to do the same thing for the rest of the options so those are the following in progress in review too and done and there we go now you should have a select here backlog in progress in review too and done and you can reset back to all statuses now let's go ahead and let's create a hook called use task filters so all of these filters like status project ID as ID I want them to be preserved in the URL so someone can share this View and share it with other members and see exactly what they have queried so inside of tasks inside of hooks let's go ahead and let's create use task filters. TS like this let's import everything we need from kn parse as string parse as string Anum and use Query States so multiple not use Query state but use Query States let's also prepare our task status Anum here and now let's go ahead and let's export our use task filters so you can just immediately return use Query States and open an object inside and then for each filter you're going to give them equivalent instructions project ID should be pared as string status should be parsed as a string Anum and then call object values over task status which we have imported above and for the rest such as assign ID search and due date you can simply use parse as string once you've completed this let's go back inside of our data filters here and now we're going to use uh this inside so just after our member options we're going to go ahead and use the use T task filters which you can import from do/ hooks use task filters and open an array and then open an object and inside you can get the status ass ID project ID due date and after so go ahead and add a comma so the other part of the array is set filters like this now let's go ahead and also Define a constant on status change to accept a value which is a string if that value is explicitly all we are going to set filters status and reset it to null else we're going to set filters here status value as task status like this if you prefer avoiding if else you can use the Turner so if so go ahead and set filters status if value is all use null otherwise value as task status like this so now we have on status change and we have the status value here so you can now go ahead and give the first value here a default value of status or undefined and you can go ahead and select the value here and call the on status change value like this so let's try out I'm going to go ahead and select backlog and you can see that I now have a status backlog inside of my URL so if I refresh this you can see the backlog stays selected same as in review right here so what we have to to do now is we have to ensure that this actually re-triggers and gives us new data inside so for that we can copy and paste this use task filters here and we can go back inside of task view switcher where we load our tasks so here I'm going to add them use task filters from / hooks use task filters I'm going to remove set filters no need for them and then we can assign the status assign ID project ID and due date and we can pass them all inside so workspace ID project ID S ID status and due date all of them can go inside so now there we go zero documents because none of them are in review so let's go ahead inside of my database here I have one task here it seems two tasks let's see they their statuses are in progress and one is in to-do so if I change the status for in progress I should load one document and I do if I change it to in review I should have zero documents and if I change to too I should have one document again great so now our filters are ready to be wrapped up so the same way we have created this select component for the status we're going to do it again for the S ID so let's copy the entire select component here and let's paste it here and this time we're going to be using the ass ID or undefined let's go ahead and let's develop an on a change like this passing the value and it's going to be similar so if value is all it will be null otherwise it will be value as string and while we are here let's also prepare the other ones and this will not be status this will be assign me id like this so this one will be on Project change project ID and pretty much the exact same logic here great so we have these two now so inside of this new one you're Now using on asign change like this uh and now instead of having this list checks icon we're going to be using user icon from Lucid react and the placeholder will be all ases so make sure you've imported user icon from Lucid react great and now instead of the select content uh we're going to leave the select it item here with the value all and we're going to write all s knes and after the select separator we're going to remove this and instead we're going to iterate over our member options like this map member make sure you put a question mark here so map member select item give them a key of value a value of value and a member label inside save the file so we are iterating over this member options here so we are using value and we store dollar sign ID inside so now if I go ahead and select Antonio nothing should change because that is the only ass now let's use the exact same method to to create our project ID filter so I'm going to go ahead and just copy the last thing we've created so this entire select here paste it here and we're going to use project ID or undefined on Project change and inside of here we're going to use a folder icon from Lucid react so make sure you have added that import here select value placeholder will be all projects and then we are just going to replace the member options question mark. map with project options question mark. map select item use the project value as key and value and use the project label inside and let's go ahead and try it out so if I select new project here let's see if I'm going to get anyone there we go it says one document right here if I select test here zero documents but if I go ahead and create test task give it a r random due date select myself as an assign and if I select the test project and click create task uh I actually expect this to refresh but it didn't so let's see why inside of my use create task so I do invalidate the query tasks but looks like it was not refreshed okay let's see if I manually refresh here is it then loaded or maybe maybe it's not working as intended so let's just see what's going on when I select the project and I select test H okay so we have one project here oh I think this is still working for SES maybe let's see let's go set up data filters here so we have project options uh okay so we missed this this is supposed to be all projects it's definitely using the project value okay let's see so if I go inside of my databases here I should have okay so these two have different project IDs but these two so this new task test task has this project ID let me go ahead and copy it and let me go ahead and find it inside of project so none of them are here that's interesting okay so let's revisit our uh which one is it our create task form and inside of here we have project options so we are using the value as project ID here let's revisit our create task form wrapper let's see if we are doing anything wrong here so project options projects documents map we get the project and we assign project dollar sign ID to the ID here so this definitely should work so what I'm going to do now is I'm going to remove all projects that I have but you know just the records I'm not going to delete any collections I'm going to go ahead inside of tasks and I'm going to remove all tasks that I have so let's start from scratch and let's see if maybe something else is here at play so I'm going to go ahead and you know just go inside of my homepage here I'm going to create a new project which I'm going to call Project one like this I'm going to create a new task called task in Project one I will select a random date and project one let's click create task there we go so this is now refreshed this is task in Project one and my project ID here is exactly the same as my URL okay and if I select project one here it works great I'm now going to create a project two here and I'm going to create a new task task in Project two whoops task in Project two and I'm going to go ahead and select not task uh project two click create a task now we have two of them if I select project two one should be inside there we go and while I have some filters I should also be able to update so this is Project two so I'm going to do another task in Project 2 I'm going to give it a random due date and I'm going to select project two again click create task and there we go this gets updated as well all right I don't know what that was maybe I just had to refresh maybe I just had to clear my data but this is working correctly okay one more filter to add here which is the exact due date if we want to filter by the exact due date for that we're going to be go we're going to go back inside of our data filters component and we're going to go ahead uh and create uh a date picker here so let's go ahead and do that after our select let's add date picker component let's go ahead and give it a placeholder of due date let's give it a class name of height 8 full width and LG with AO then let's give it a value due date new date do date or undefined and let's give it an on change to get the date and set filters do date if we have a date it will convert date to ISO string otherwise it will be null there we go so now I'm not sure when did I um let's see I I should have a task here let's see a random due date so 10th uh okay let's try if I select 10th maybe zero okay let's try manually so task in o 10 October 10 no doesn't matter which project it is uh and there we go immediately refreshes great so our filters are working and what we're going to do now is we're finally going to render this tasks in a nice way so we have the table component the Canon component and the calendar component great great () job in order to display our newly created tasks we first have to implement the data table component so I would highly suggest that you go to shaten UI and you go into the components Tab and you find the data table component and now you're going to have to set it up so we already have data we already have the normal table component if you don't to go ahead and select here and add it inside of your terminal so you can see inside of my source components UI I already have a table right here what I don't have is 10 stack react table so let's go ahead and let's install that so bun add 10stack SL react-table and my version is 8.2.5 once you've installed that let's go ahead and let's do the following so you can follow the prerequisites yourself if you want to get familiar with this yourself but this is what I'm going to do I'm going to go back inside of my features task components and inside I'm going to create columns. DS uh let's actually make that DSX like this I'm going to Mark these as use client and I'm going to export con columns column definition and we can import column def from add 10 stack react table and and what's going to be inside is Task and it's going to be an array the issue is we didn't create the task type I believe so let's go ahead and quickly create it so inside of the tasks folder we already have types but only for enum task status so now let's export type task to be models. document and we can import models from node app right and document comes with a capital D like that and let's go ahead and let's assign all the properties name status which is the task status from above assign which is a string project ID which is a string position which is a number and due date which is a string as well now we can go back to our components columns and you can import the task type from dot dot SL types like that and now in here we Define what types of columns we want so let's go ahead and let's create our first column here using accessor key and let's map that to read the name property of our task so let's go ahead now and I think we can just leave it like this I don't think we even have to do anything uh else I mean for the simplest example let me see uh by creating this columns here yeah so accessor key and we need header so let's add header name like that uh actually let's make it task name okay so I think this should be enough just for us to start rendering the task names and now what you have to do is you have to create a new component called Data d-t. TSX inside of tasks components and you have to go to this chaten documentation page and then you're going to have to uh scroll down and go to step two data table component and you can go ahead and copy the entire thing from here in case this changes drastically in the future you can always visit the source code and copy mine there we go so you should have no errors here because we have installed 10 stack react table and we have components UI table so now if you go inside of your uh tasks components task view switcher here you should be able to go and find the tab content for value table and remove the Json stringify here and add the actual data table component from do/ datat table and while you are here you can also import the columns from do/ columns and then simply go ahead and add uh columns here and add a data to be data question mark documents or an empty array and the data is actually our remap to tasks so let's add tasks. documents like this uh okay and the reason we have an error here is because we have to go inside of our use get tasks more specifically we have to go inside of tasks server go inside of our doget method here and in here when we run our query uh where exactly is our query there we go tasks list documents here add the task from the types so I imported the task from do/ types alongside the task status so now inside of here as you can see when I go and save this and I go to task view switcher down here I no longer have the incompatible data and now if I visit there we go task in October 10th so if I go ahead and clear this now there we go you can see all of my tasks right here great so what we can do now is we can go ahead uh and expand our data table as needed so let's go back ins set of the data table here and let's see what else can we add to it so I highly suggest that you follow along here as well because we're going to be copying and pasting some content so we will be doing this but we can do that later uh let's go ahead and let's add this row actually no let's skip that as well because we need to First create you know a reusable component for that uh but what we can do is pagination here so let's go ahead and do this prepare your data table and import get pagination rle model from 10stack react table like this and then uh whoops go ahead and assign the get pagination rle model to get pagination Ro model inside of the used react table here so just below get core row model uh and then go ahead and import button wrap the entire thing inside of a div one more time so the entire thing inside of a div like this you can indent the entire thing if you want to and then you're going to go to the end here and you're going to copy this highlighted code and just remove one extra div if you have one and that's it that is the pagination built in now so you can see that we have previous and next Pages here now and if you want to you can go ahead and change their variant for example if they use outline we can do secondary maybe okay that is looks like nothing much has changed okay we can leave it like that uh so now what we can also do here is we can Implement sorting so we're going to uh Implement first import everything as react from react inside of our data table here then import sorting State then get sorted row model after our pagination one then Set uh the Sorting State here about of the uh use react table and then copy and paste these lines here after get pagination r model so on sorting change set sorting and get get sorted row model get sorted row model State sorting and I think that that's it for the data table because now we have to make the header cell sortable so let's go ahead now inside of our columns and now we have to do well basically this oops let me just scroll up a bit so Arrow up down from Lucid react let me add this and then we will modify our header as this let me copy this there we go and let's import the button component from components UI button and let's write TK name inside and I think now by default this will be sortable so I can click here and there we go we can go in reverse or alphabetical order there we go great let's see what else can we add uh filtering that's something that we are definitely going to use so prepare that data table again and go ahead and import the column filters State go ahead and add get filtered row model go ahead and import the input component copy the highlighted filtering state and put it below our existing sorting State here this is how it looks like the default value is an empty array and then go ahead and add these two highlighted lines on column filers change and get filtered row model so we're going to do that just above the state and then we're going to add column filters here and then we have to copy the highlighted HTML here and put it in here like this and let's go ahead and simply do filter tasks and let's search by name not by email there we go and we can already try this out now here so if you want to you can do task in uh let's see is this working or not uh name this should be working let me just fresh maybe there we go so another project to there we go so you can now quickly search for your tasks that being said I really don't like how this filtering here looks and I would rather we you know take our time later and uh Implement filtering from server side because this is only filtering what's available here so if you find that useful you can leave it here but I'd rather we have like a search inside of here later so for now what I'm going to do is I'm just going to remove this div here right we can leave the whole filtering logic you don't have to remove it you can just leave it as it is right here uh great so let's go ahead and let's see is there anything interesting here that we can add besides that so we have the visibility here well I'm going to leave it at this let's go ahead and do the following let's actually modify our tasks so they look like something so what I'm going to do is I'm going to go back inside of the columns here and let's go ahead and give all of this a prettier look so starting with the accessor key name let's also add a cell here let's extract the row let's get the name from row original. name and let's return a paragraph rendering the name but let's ensure that it is truncated or truncate like this actually let's use line clamp one okay uh now let's go ahead and add another property here accessor key project let's go ahead and add a header here let's extract the column now we can go ahead and copy this one just change this to project you don't have to change anything else uh and now we have to add a cell here so row let's add a comma here so we don't have any errors and now we have to destructure the project from the row like this and then we have to return a with a class name Plex items Center Gap X2 text small and font medium like this and inside we can use our project Avatar component make sure you have added an import for features project Avatar okay and now we have some errors here because we have we haven't passed uh any images here so class name here will be size six name will be project. name here and this already fixed our issue but let's also add an image to be project. image URL so if any project has an image we're going to load that image and after that a paragraph project. name let's add a class name line clamp one here as well great so now we are loading our projects Here and Now I want to copy this entire thing so both the accessor key header and the cell so all of it here and let's paste it below and now we're going to change it to our assign here so we're going to go ahead and change this to be ass we're going to get the S so usually this isn't the property inside of project but remember inside of our uh tasks server we populate them right so our populated task has the project n the S as an object which has a name image and all of those things that's why we can access them like this so instead of using project Avatar we're using member Avatar component and let's also change the fallback class name to S to text extra small and let's use the S here let's use the S here and no image here there we go now we have the S as well and now let's go ahead and let's just copy the first part that okay we can just copy the entire thing it doesn't matter let's paste it let's change the accessor key to be due date here and this will be due date as well now we're going to go ahead and get the original due date here and we are going to return something else so we're going to return task date with the value of due date here and our task date will be cool component which will warn the user by color how close they are to the due date so let's go ahead inside of our components and let's create a task DD dat. TSX component here let's import difference in days from date FNS and format then let's go ahead and let's import our CN library then let's let's go ahead and let's create an interface task date props with a value and an optional class name let's go ahead and let's prepare our task date the structure the value and the class name props here inside of here let's go ahead and let's define three variables today being new date and date being new date and the value past and difference in days being difference in days and date and today like that let's go ahead and let's define the default text color which will be text muted foreground and then we're going to create a a little bit of a logic here if difference in days is less or equal to three we're going to change the text color to Red if the difference in days is less or equal to seven we're going to change the text color to Orange and if it is less or equal to 14 it will be yellow like this and then we can go ahead and return a div let's see why this is not working so I did with a class name of text color here and inside a span with format value PPP and let's give the span a class name CN truncate and class name like this in case we need to pass some additional properties here and just remove this and now go back to columns and you can import task date from do slash task date like this let me move the features here above and you can already see how cool this looks so depending on how close we are to the due date this is very close so it's red this is overdue so it's red uh and this one is far away so it is yellow great so uh I think one more field that we have to add here is the status so let's copy our due date field here let's paste it here and let's add the status here and now we're going to go ahead and change this to be status and inside of here we will be getting the status from row original and now we will be using our uh badge component from components u i badge so this is from shaten so I have this component right you can see it right here but but it's missing something so right now I can go ahead and render St status inside and this is how that will look like right so backlog in review in progress in progress that's okay first things first I want a method which will transform this text into normal readable text so again confirm that you have badge from components UI badge we've installed this in the beginning of our project when we set up shaten and now what I want to do is I want to go inside of my uh lib utils where we have the generate invite code and the CN method and I will export function snake case to title case which accepts a string and it returns a string to lowercase and then it's going to use Rex to replace forward slore SLG for Global and add white space inside so it's going to replace all uh underscores with spaces and then let's replace forward slash let me just find backwards slash B backwards slash again W forward SLG get the character character to upper case there we go now now let's go ahead back inside of columns and instead of just rendering status let's use our snake case to title case so make sure you have imported this from lib utils I'm going to move it here let me just separate these two so now it should be more readable there we go backlog in review in progress and in progress and now what we have to do is we have to go inside of our badge component and what what I want to do is I want to import task status from features tasks types and alongside this variance here I'm going to add my own so I'm going to open an array like this so I can modular add some key to an object so task status. too will be the following oops task stat is. too will be border transparent BG red 400 text primary hover background red 400 slash 80 like that and then we have to handle the rest of our uh States here so go ahead and create an in progress one which will have a background yellow and background yellow 400 sl80 after that we're going to have our in review which will be blue 400 after that we have to create the done status which will use Emerald 400 and finally the backload status which will use pink 400 so all of these are using the same classes the only difference is the color now that you've added that let's go ahead and let's go inside of our columns and what we can do now safely is give our variant to the status like this because the status is a type of task status and that matches exactly all of this here because we have used up all of them so now there we go you can see how cool our statuses are looking now great so one more thing we have to add here and that is the actions so that we can delete from here so that we can open the edit model so that we can open the individual project page or open the individual uh task page let's go ahead and let's go inside of our features task components here and we're going to create a new file called task dasac do DSX like this and what's important here is to import the drop- down menu drop down menu content item and Trigger and now let's create an interface task action props which accepts the ID project ID and the children let's export cons task actions let's go ahead and assign task actions props here let's go ahead and let's destructure everything inside so ID project ID and children now what we're going to do here is we're going to return a div with a class name flex and justify end and then inside of here we're going to open a drop- down menu we're going to give it a model pulse property and let's give it a closing tag right here let's add a drop- down menu trigger here and let's give it an as child property and let's put children inside now let's go ahead and let's add our drop down menu content with a line end and class name w48 let's close the drop down menu content now let's go ahead and let's add our first drop- down menu item here which will have the external link icon from Lucid react so make sure you have added this let me just move it here at the top external icon link like this let's give it a class name of size 4 margin right of two and stroke two and let's write task details here and let's go ahead and give the drop down menu item on click for now to be an empty Arrow function let's give it a disabled of false and let's give it a class name of font medium and padding 10 pixels now let's go ahead and actually put this inside of our columns so let's go inside of columns here and now we're going to use it so I'm going to go ahead and add a last ID which is actions and a cell here will be D structuring the row immediately we're going to get the ID from row. original and then dollar sign ID on Project ID will be project ID like this and we are going to return task actions like this from slask actions and now we're going to pass in the ID to be ID project ID to be project ID oops and inside we're going to render a button component with a span actually no need for span just more vertical from Lucid react and let's give it a class name size four and let's give the button a variant of ghost and let's give it a class name of size 8 and padding zero make sure you have imported more vertical from Lucid react and now when you click here there we go you can see how we now have options here so now let's go back inside of task actions and let's wrap up all the actions which we are going to have here so we can copy this drop down menu new item and duplicate it uh this one will have an icon of pencil icon and it will be called edit task let's go ahead and copy it again this one will have an again an external link icon and it will say open project and the last one here will be a little bit different having a class name of text amember 700 like this and also Focus text amember 700 it's going to have a trash icon from Lucid react delete task and I just want to move the this drop on menu item for open project just here after task details make sure you have imported external icon pencil icon and trash icon from Lucid react here so now as you can see we have task details open project edit task and delete task we have all of these options right here great so what we're going to do in the uh next chapter is actually uh handle this task actions so that they are functional and once we finish that we can go ahead and wrap up the conon and the calendar and all I'm seeing here is that these two buttons are technically disabled but their text seems to be very visible let's quickly go inside of our button component and let's see if that's something I've done wrong here so we have this disabled background neutral 100 disabled disabled okay so disabled let's give it a text muted progr uh okay it did not fix it so no need to change anything okay we're going to stop here great great job what we're going to do next is well enable the drop down () actions let's go ahead and let's implement the delete method from the task actions here we have to start by going inside of our source features tasks server route. DS and inside of here let's go ahead and let's append a new route. delete we're going to use a task ID pram and add a session middleware let's add an asynchronous controller here and let's extract the user using C.G user let's extract databases from C.G databases and let's extract the task ID from C do request Pam then let's load the task using await databases get document task so I have imported the task type here passing the database ID passing the tasks ID and simply the task ID Pro and then we're going to do const member await get member pass in the databases workspace ID which will be task. workpace ID here and user ID user. doll sign ID if there is no member we are unauthorized to delete this task so let's return c. Json error unauthorized 401 and then let's await databases delete document database ID tasks ID collection task ID prop and let's return the ID of the deleted task inside of data dollar sign ID task. dollar sign ID just like that and now it looks like inside of this task type I forgot to add workspace ID string so you can have this typed as well great now that we have that let's go inside of API let's copy use create task and let's rename it to use delete task let's change the constant to use delete task let's change the response type here to be tasks Pam task ID and then change the method to delete and keep the 200 status code here now we have to change this to be just Pam change this to be delete and append the task ID pram here this will be failed to delete task this will be task deleted and this will be failed to delete the task and inside of here we're going to destructure the data and we're going to invalidate the query individual task and data dollar sign ID and what we can also prepare already in case we are using a server component to load the individual task page which we most likely will do we can already do a router Refresh on this okay great so we have that now let's go inside of our task actions here now let's go ahead and let's import uh use delete task fromt do/ API use delete task like this and let's also import use confirm from hooks use confirm so we have a confirmation that we want to do that so let's go ahead and let's just prepare the use confirm here so get the confirm dialogue and confirm method the title is delete task this action cannot be undone and the variant is destructive like that then let's go ahead and let's the structure mutate and spending from use delete task right here and then let's go ahead and let's develop our on delete constant here asynchronous I wait confirm for the okay and if not okay return and looks like I'm missing something here uh oh yeah so we have to pass the pram here my apologies there we go so using the ID prop here so we now have on delete so we can find the on delete and add it here and we can do the is bending here to disable it and no need for uh disable here or here or here great so let's try this out now I'm going to go ahead and select a random task here click delete task let's try refreshing first delete task and looks like it's still not working okay so let's see uh what exactly is going going on so on click on delete what's happening is that I forgot to add the confirm dialogue so let's just add it here and there we go let's try again so I will delete this task confirm task has been deleted great so if you want to you can avoid the router refresh because it seems to ref it seems to you know cause jumpiness right so if you comment it out in that case when you do delete task it will just smoothly update it like that so yeah if you want to you can comment it out I'm going to leave it for now uh so now that we have this let's go ahead and let's finish a couple of other things here so let me go back to my task actions and inside of here I'm just going to prepare my router const Router use a router from next navigation so make sure you have added this like that and then what we're going to do is create two methods on open task and on open project and we need to add a workspace ID Pam so let's go ahead and do the following let's extract workspace ID from use workspace ID cook make sure you have added this import here so these two methods on open task we'll go to workspaces workspace ID tasks and then the ID of the task on open project we'll go to workspaces workspace ID projects project ID all from our props here let's go ahead and let's assign the onopen task here and let's sign the unopen project here like this so now if I click on open project it should lead me well to the I am already here but let's say this project one if I click open project there we go I'm redirected to project one now and if I click on task details this will not work just yet so we can do that uh later all right so we have this finished uh what I want to build next is the editing functionality that's the only one that's left here let's start by going back inside of our tasks server so Source features tasks server route. TS and inside of here I'm simply going to copy the existing post method which we have like this and I'm going to append it here I will then modify this post to be a patch and I will make it go to slash task ID like this I will add the session middle ver here and the Json here will be create task schema and we can simply append do partial to it actually since the since it's going to be exactly the same we don't have to worry right uh now let's go ahead and let's see what do we have have to do here so the first thing we have to do is load the existing task using await databases. getet document task database ID tasks ID and task ID here also we have to destructure the task ID so let's do that const task ID from C request peram there we go and now we can go ahead and assign the workspace ID to be existing task. workspace ID there we go so if we are not a part of the workspace that the task we want to delete is we will be redirected as unauthorized and what we have to do now is actually easier we don't have to do the highest position task uh we don't have to do the new position all we have to do is instead of create document is use update document and we are simply passing a in the existing task ID here and we are passing the name status we are never changing the workspace ID uh we can change the project ID the due date the assign e ID and we can change the description like this let's also destructure the description from here instead of workspace ID there we go and we just return back data task perfect so now let's go instead of API let's copy use create task and let's rename it to use update task let's rename this to use update task here let's go ahead and get inside of the response type here and change this to be task ID and let's change this to be patch leave this at 200 and now inside of here we're going to get Jason and the Pam so let's add the Pam as well we're going to change this to be the task ID and this will be the patch method the error will be failed to update task this will be task updated and this will be failed to update task let's go ahead and let's destructure the data from the unsuccess so we can invalidate the individual task with data dot ID here and since we are current ly using server components let's also prepare router use router so I am aware of that flashing that happens every time we do router. refresh so perhaps later uh we can go ahead and refactor this so it has a smoother effect perhaps even completely removing server components if we don't like them because we are not using them for anything crucial it's just for you know for loading mostly static things okay so that's our use update task ready that's great what we have to do next is we have to create use update uh task we have to create use update task form wrapper use update task uh model and the controls for the model let's go inside of tasks Hooks and let's copy use create task model and let's rename it to use edit task model let's rename this to use edit task model let's change this to edit task and leave everything else as it is now let's go ahead and let's create the edit task model so we're going to do this uh actually the way I want to use use edit task model is a bit differently so I want to Simply append the ID of the task inside of my URL that's how I want to keep the bullan state on or off so I'm going to do this task ID set task idid and I will change all of this to be parse as string instead like this and then inside of here I'm going to go ahead and do this on open we have to select the ID so set is open ID meaning set task ID here and close will be set task ID to null then we would have set task ID here and we would simply have task ID here instead of open so set task ID set task ID great and now let's go inside of our components let me close everything and let's copy create task model and let's name it edit task model inside of here let's rename this to edit task model like that and then we're going to change this to use edit task model we're going to remove the use credit task model and we're going to replace these two with task ID then I'm going to go ahead and create a Boolean from the task ID and on open change will simply be close then let's go ahead and render this under if task ID exists only then are you going to go ahead and do this what you're about to do like that so what we have to do now is we have to create an edit task form of wrapper so let's find our existing create task form wrapper let's copy it and let's rename it to edit task form wrapper let's rename the props edit task form wrapper like that the one thing that we're going to have here is also the ID like this okay and now let's go back inside of the edit task model and let's use the new edit task form wrapper from do/ edit task form wer and we will have to pass the ID to the task ID here like this there we go now inside of this edit task form wrapper besides loading the projects and the numbers we also need to load the initial values so let's see did I add an API for that here or do we need to implement it we only have use get multiple tasks so we have to go back to our server route and we have to chain doget slask ID PM let's go ahead and let's add a session middleware here and an asynchronous controller here and now let's go ahead and let's extract task ID from C request perm like that let's go ahead and let's get the user from CET user databases m c get databases like that and let's also go ahead and do this let's extract users from await create admin client like this so what we're going to do now is is the following first of all let's rename ourselves to current user like this then let's go ahead and get the task using await databases get document as in the task database ID tasks ID and then task ID then we're going to get the current member using those values so current member uses the databases workspace from this task workspace ID and the user ID right here as always if there is no current member we are throwing an error 4 One unauthorized and now what we have to do is we have to get the project that this task has assigned so project and we have to add Project's ID here like that and besides project we also need to load the member or the S that is attached to this task so what we're doing now is we are preparing to populate those documents so make sure you have set the project and the member here uh using the task project ID and task assign ID so now that we have those populated let's go ahead and let's actually load the user behind this member so user await user get member user ID in case uh we don't have the user I think the error will be thrown so that's okay now let's just create an here to be the existing member like that and then name usern name and email user email and then let's return c. Json here data spread the existing task but populate the project and the S there we go now let's go inside of our API folder let's copy use get tasks let's paste it use get task go ahead and change this to be task ID string so just use get task props use get task props change this to be task ID this will be used get task and simply add task and task ID next to it so this is our query key that we are uh already invalidating when we delete and when we update the task and then inside of here we can simplify all of this here so client API tasks task ID get and we're just going to pass in parm task ID like this fail to fetch individual task will be the error and that's it and we don't need this great now let's go back inside of the edit task form wrapper here and alongside this we're now going to be loading data initial values is loading is loading task from use get task and pass in task ID to be ID like that and import use get task from sluse get task just make sure you didn't import uh tasks right so we are just importing the single use get task which we have just created it only accepts this okay and now let's go ahead and let's change this is loading to also do is loading task we have remapped this to initial values that's okay uh and what we're going to do here is if there is no initial values return null we cannot even show this model and now we have to create the edit task form so let's go ahead and copy the existing create task form and let's change this to edit task form like this let's go inside of here let's first just rename the props and the instances here so this this and this edit task form like that besides having on cancel project options and member options is going to have the initial values which is a type of task from dot do/ types which we have already imported right here great uh and then what we're going to do here is we're going to use the form like this and let's just omit workpace ID true and let's omit description true here as well and let's go ahead and simply spread the initial values and let's do do date initial values value do du date will be new date initial values due date otherwise undefined like this and we have to destructure the initial values from here so we have them in the props okay uh initial values there we go so that's our form here and now instead of using use create task we will be doing use update task so you can remove use create task and Ty irely like this and now instead of the unsubmit we're going to have to do the following so the Json can simply accept the values but the Pam will have to be task ID initial values. dollar sign ID like this there we go let's modify this to be edit a task like that and I think that everything else can stay exactly the same except the last button instead of create it will be save changes let's go back inside of our edit task form wrapper and change this to the edit task form and we have to pass in the initial values here and make them initial values there we go we can now remove create task form here now let's go ahead and go inside of our t ask actions and what we're going to do here is we are going to add our task ID actually where will will just D structure this so use edit task model this is what I'm trying to do and let's go ahead and let's the structure open here make sure you have use edit task model here so it's that hook we've just created which now accepts the direct task ID so since we have the ID here in the task action what we can do here when you ask me to edit a task is I can just call open with ID and let's see if this will work now I will refresh this and I will go task in Project two I'm going to go ahead and select edit task and looks like I have it in my URL but I forgot to render it so let's go ahead and find edit task model and let's put it inside of app folder dashboard layout. TSX and let's add the uh edit task model from features task components edit task model there we go and I think now there we go already it opened up let's try again so I'm going to go ahead and select task in Project two edit task let's try changing it task in Project three and click save changes and there we go addited to task in Project three let's try changing this from in progress to backlog and to project one and let's change the date to 1st of October click save changes there we go everything works as expected amazing so we've wrapped up the actions here and what we can do now is we can create the Conan and the calendar view of our tasks amazing amazing job () now let's go ahead and let's build the Conan preview of our tasks in order to do that we're going to have to install a drag and drop Library so let's go ahead and let's add bnad hello- Pangia SL the n d and if you want to know the specific version it's 17.0.0 so I would recommend that you uh install this under this version like that so what is this package this is a fork of react beautiful drag and drop which is no longer maintained so this is the upto-date version and they fixed all the leftover bugs from the uh react beautiful drag and drop which is currently unmaintained so now let's go ahead and do this let's go inside of our features folder let's go inside of tasks inside of components and let's create a data Conan do DSX like this and let's go ahead and Mark this as well actually no need to mark this as use client because it will be used inside of the task view switcher which is already a used client so instead what we're going to do here uh is simply create an interface data Conan props let's do that which will accept the data which will be a type of task and let's export const data Conan and let's return a div data Conan and let's go ahead and destructure these so data Conan oops pan props and D structure the data now we can go back inside of our task view switcher component and inside of the tab content for the value kban we're going to render data Conan from do/ data Conan and passing the data as data uh that will be tasks do documents or an empty array like that so the same thing we passed data here in the data table so now when you click on conon you should see the text Data Conan here now let's go ahead and let's actually develop the data Conan so we're going to need to import the following things from Hello penia DND drag drop content next droppable draggable and drop result besides that let's also import all of these things from react so react use call back use effect and use State like this and now let's go ahead and let's define our initial boards so we're going to have boards which match the possible statuses of a task so from the task task types you can also import task status here and now we're going to create boards for backlog to do in progress in review and done so let's go ahead and do the following let's define const boards to be a type of task status and an array the first board will be task status. backlog and then we're going to go ahead and simply add the rest in the uh well available statuses so that's the do in progress in review and done the order matters because that's how they're going to be displayed in uh in here right in the combon board now let's define a type tasks State key in task status to be an array of tasks like that so this is an important type which we're going to need to have great and now that we have that let's go ahead and let's Define the initial tasks so I'm going to go ahead and set tasks set tasks to be use State and I'm going to give it a default of tasks State and then inside of here I'm not just going to pass the data instead I'm going to open a method here we're going to Define our initial tasks to be a type of tasks State and then for each of our task status we're going to Define an empty list and then we just just have to do the same thing for to-do or in progress or in review and for done there we go like that and then what we're going to do is we're going to iterate over our data here so data for each task that we have initial tasks task. status. push task so we are going to push each task into their appropriate column based on their status like that and then let's go ahead and sort them by position so object Keys initial tasks for each status initial tasks status as task status sort we have a and b values and we are very simply going to sort by a. position minus B do position like that so this will now sort them and finally return initial tasks there we go great so we now have this done and what I want to do now is I want to start building our drag and drop here so let's replace this with a drag drop context let's go ahead and give it an on drag end property which for now will just be an empty Arrow function inside of here we're going to add a div with a class name Flex overflow X outo so it's scrollable vertically if we need to inside let's go ahead and let's do board boards. map get the individual board and inside go ahead and return a div for each board that we have and we are going to give a key of board and we can already add a class name here FX one MX of2 background muted padding 1.5 rounded medium and a minimum width of 200 pixels like this and inside of here we can simply render out the board like that and there we go you can see how now we have our backlog to do in progress in review and done boards ready so what we're going to do now is we're going to create a component called kban column header which is going to in a nicely way in a nice way render the board so let's go ahead and do that I'm going to render this as kban board U my apologies kban column header like that uh and let's go ahead and prepare the following we're going to pass in the board to be the current board and the task count will be tasks in that board. length now let's go ahead and let's create kban column header in the components here so kban Das column dashe header. TSX like this and inside of here we're going to create an interface kbon column header props with a board task status from types and a task count which is a number and now let's go ahead and let's export const kban column header here let's go ahead and let's assign these props now we can extract the board and the task count and in here what we can do is we can return a div with a class name px2 py 1.5 Flex items Center and justify between like this and inside of here we can add a class name Flex item Center and GAP X of two and inside of here we can for example add an H2 element with snake case to snake case to title case of our board so import snake case to title case which we've created recently uh for this exact purpose but in the data task table uh and outside of the H2 element we can add a div which will hold our task count so this won't look too good at the moment but let's just go back instead of the data conun and let's import the conun column header from colum header there we go you can see that now uh it's a bit more readable as you can see backlog zero tasks to do zero tasks in progress one task because I have one task in progress here so you can see it's already starting to look like something great so now what I want to do is I want want to import all the icons we're going to need from Lucid react for our Canan column header so let's go ahead and import the following Circle check icon Circle dashed icon Circle dot dashed icon Circle dot icon Circle icon and plus icon from Lucid react and now what we're going to do is we're going to create a status map uh more appropriately status icon map which will have a typee of an object which is uh called Rec right and the key will have to be a type of task status and then the value will be react. react node so let's see how that looks so for example for task status backlog we're going to have a circle dashed icon with a class name size 18 pixels which we have to wrap like this and I have to fix the typo in the class name and we're going to have textt pink 400 so we are matching the colors which we have in our badge component right so backlog has pink 400 done has emerald in review has blue in progress has yellow and to-do has red so what we can do now is we can go ahead and copy this one and make this to-do this one will use the circle icon and it's going to use uh text Red then let's copy it again this time for in progress and this one we'll use yellow let's go ahead and do the next one which is in review which uses text blue and finally we're going to have done which uses text Emerald like this and you should have no errors because we used up all of the task statuses Here and Now what we can do here is just above our H2 element render an icon and we can get the icon using const icon to be status icon map and simply the matching board inside because the board uh is a type of task status and that's what it accepts here and then you can see that each of our boards here have a nice appropriate icon here uh great I just forgot to use all the different icons so I'm using Circle icon for all of these so my to-do will use a circle icon my in progress will use a circle do Dash icon my in review will use Circle do icon and by done we use Circle check icon there we go so now all of these are used and there we go you can see how now all of them have their unique Styles great now let's go ahead and let's wrap up the conon column header here so we're going to go ahead and give our H2 element a class name text small font medium like this and we're going to give this div a class name size five Flex item Center justify Center rounded MD background neutral 200 text extra small text neutral 700 and font medium so now each of this counts will have its own little box like that great so now now inside of the here outside of this div let's add a button component from components UI button I'm going to move it here we're going to add a plus icon which we have imported already from Lucid react and we're going to give the plus icon a class name of size four and we're going to give it text neutral 500 and let's give this button an on click of for now an empty Arrow function a variant of ghost size of Icon and a class name size five and there we go we now have a plus icon uh next to each of our uh combon column headers so now let's wrap this up by also importing the use create task model Hook from do/ hooks use create task model and we can simply the structure open from here because we are returning it here right and then we can simply replace this with open let's go ahead and finish this up and now if I click here there we go I have my created task opened if you want to play around you can also you know modify the URL a bit more so that it predefines the status so that if you click Plus in in review it will select in review here that could be a challenge for you if you want to develop it so how I would approach that is I would extend the open method to be able to accept you know initial status to be a type of task status from types and then you would have to extend this into an object probably uh and modify it here as well and then uh inside of our uh where is it our uh task wrapper create task form wrapper inside of here uh we would probably read that right or you can do it inside of the model while you're here actually so task model create task model inside of here you could probably extract the initial task status and simply pass it through the wrapper and then pass it through the form so that could be a challenge you can do for yourself and I advise you do those things it's always better you know to customize my projects rather than have them exactly uh like mine great so that wraps up our uh Conan col header what we're going to do next is we're going to create uh the rest meaning the actual drag and drop () items now let's go ahead and let's wrap up our data Conan so we resolved the Conan column header component and now we have to render the tasks inside of their columns so let's go back inside of our data Conan it's located inside of the features tasks component and let's let's go ahead and inside of this div where we uh render our Conan column header just below that let's render a dropable which we have imported uh from penia D and D like this let's go ahead and let's give it a droppable ID and let's make that be individual board which we have which is a task status and now inside of here what we're going to do is we're going to open a method like this and get the provided prop here and then we're going to go ahead and return a div now for this div it's important that you spread to give it the appropriate attributes so let's spread provided. droppable props and let's give it a ref of provided do inner ref and now we can give it some class names so I'm going to give this a class name of minimum height of 200 pixels and padding uh y of 1.5 and then inside of here I'm going to render my tasks by board so tasks inside of this board do map and then I'm going to get the task and the index of that task and we're going to render that inside of a dragable another component which we have imported from the hello Pangia right here now let's give the draggable a key to be task. dollar sign id dragable id which can be exactly the same and let's give it an index of index so it needs to be this uh numeric Index right here and inside of here we are again going to have a method and provided like this and then we can go ahead and finally render the div here and it's important inside of here that we also do provide provided. draggable props provided do drag handle props and also a ref to be provided do inner ref so make sure that in inside of this one you have these three and inside of this one you have these two okay and now inside of here what we can do is we can render a task name for example so let's see if this will show something and there we go so I think that already there we go I can drag and drop in other columns but it doesn't stay there we're going to develop that in a moment but you should be able to see your tasks in their appropriate columns initially so now let's go ahead and let's create a component called kban card instead of just rendering a task name so I'm going to create a Conan card and I'm going to pass in the task as task so now in the same place where we've created created our Conan column header we're now going to create a Conan card so that's inside of the features tasks components let's create a conon uh card. TSX let's go ahead and let's create an interface kban card props to accept a task which is a type of task from dot do types and let's export con conon card let's go ahead and just assign the props here let's go ahead and let's destructure the individual task and we can go ahead and return a div with a class name background white padding 2.5 margin bottom of 1.5 rounded Shadow small space Y3 inside of this another div with a class name Flex items Center my apologies items start justify between and capap X of two and then in here we're going to render one paragraph rendering the task name and below that or more appropriately next to that we're going to have task actions from slask actions so we're going to reuse the ones where we which we used in the data table here and task actions need to accept a children so let's give it a more horizontal icon from Lucid react let's give this a class name of size 18 pixels and let's give it a stroke one shrink Z text neutral 700 and on Hover opacity 75 and trans position so some effects when we hover on this so these are the entire class names for more horizontal make sure you have added an import for that and now we're going to have to give task actions a prop ID of task. ID and a project ID task. project ID there we go now let's go ahead and let's style this paragraph here to have a text small and line clamp two so we're going to allow uh two lines before we add three dots as in this text is too long uh and now let's go ahead and let's actually import the Conan card from doonan card and we can add it here next to the kban column header and there we go now I have my task in a nice little card and I have these options right here which as you can see serve to delete a project uh but looks like it's not perfectly working let's see if I do a hard refresh okay now it's deleted uh okay I still think this is due to our uh initial you know uh set state of the Conan it is going to work smoothly later and yeah before we end the project we are definitely going to take care of you know that whole uh router. refresh which causes this ugly loading uh state in the middle of you know our uh in the middle of our actions right so okay I have at least one or two uh tasks inside of your kban so you can continue working what we're going to do next is give our kban card uh some more options so let's go ahead and after we close this div encapsulating the task actions and our title let's add a dotted separator from components dotted separator and then let's go ahead and add a div with a class name Flex items Center Gap x1.5 and then let's add a member Avatar component which you can import from features members components member Avatar I'm going to go ahead and give our member Avatar a name of task. s do name so this exists right because let's go inside of our task view switcher so we refresh our knowledge of our data so we are fetching use get tasks so individual task is calling this get method right here and let's see in what way do we get the task so we load the tasks we need but we populate each project in each assign of that task so then our project our task has a full project and ass object inside of them uh the only reason why this inside of our uh where is my kban card here this is not typed because technically that's not you know if I go inside of my types for tasks we could add you know project here to be a type of project and we could add uh as to be a type of member right but we don't even have that for example uh but they are not exactly I I want to have my uh types stay true to app definition right and in the app right definition they are not populated we only populate them locally luckily for us the modules document allows us to have any additional fields that we need so let's go back inside of the conon card and now you should have the task a name here and let's go ahead and give this a fullback class name of text 10 pixels and now as you can see here since my name is Antonio in this account you can see that I have a little a character here from the person that created this task great so now what I want to do is the following I want to go ahead and go below the member Avatar and I'm going to render a div which will be a self closing tag and it's just going to represent like a little spacing dot so size one rounded full and BG neutral 300 and then after that I'm going to add our task date component which we also used in the in the de data table and let's go ahead and let's pass in the date so that is value task due date and since we made due date required it's always going to be here and let's go ahead and extend it with our class name prop text extra small so that's inside of our task dat why we added an optional class name so that we can modify the font size if needed and there we go so now we have the exact same text here and here right so we have the same warning inside of different views use great we have that and now let's go outside of this div and let's open up a new div with a class name Flex items Center whoops Flex items Center and GAP X 1.5 and then inside we add a project Avatar component which you have to import from features projects components project Avatar here and go ahead and give this a name of task. project. name and give this an image of task. Project image URL and now let's go ahead and add a fullback class name here to be text 10 pixels and after that a span task project name and let's go ahead and give this span a class name of text extra small and font medium and there we go now you can see the exact project that this task is a part of as well now we have to go back inside of our data Conan component so let me close the Conan card the task date my types just inser of the data Conan here after our draggable here we need to add provided. placeholder like this so now nothing much should change you should still be able to drag and drop it kind of locks in and then it resets back so we're going to fix that now so okay uh go ahead and make sure you have provided. placeholder added so after we close the dragable after we close these methods inside of here we have provided. placeholder and now let's go ahead and let's develop this the on drag and Method so we're going to go ahead and create the const on drag end and we're going to make this a use callback method so make sure you have imported use callback here from react oops use callback and let's go ahead and give it an empty dependency array for now and inside of here we're going to receive a result which is a type of drop result we have already added this import here from Pia you can import it as type drop result if you want to be more specific let's start the with uh checking if we don't have result. destination that means this drag and uh call is invalid and we can immediately break the method now let's go ahead and let's destructure the source and the destination from the result let's get the source status to be Source droppable ID as task status let's define the destination status to be destination. droppable ID as task status so now we know from where a task is coming from to where it's being dropped let's go ahead and create our updates payload here let's go ahead and give it a type of having a dollar sign ID string a status of task status and a position of number so this is what we're going to send to our back end no need to send the entire new new array of tasks or even worse a matrix of our tasks so we can just send the updated tasks uh so the only updated tasks are going to be the ones whose position has changed or whose status has changed and we need the ID of each of those as well so that's going to be an array of those and we're going to start with an empty array now let's go ahead and let's call set tasks let's get the previous tasks let's set them to be new tasks starting from the state of previous tasks like this now let's go ahead and let's add a comment here so we know what we're doing safely remove the tasks from The Source column so const Source column here we're going to spread new tasks by Source status and then we're going to get the moved task so inside of square brackets coming from Source column do splice Source index by one now in case we cannot find the moved task we're going to add a comment you don't need to add comment so I'm adding comments so if you read this you know you know what's happening so if there is no moved tasks which should not happen but just in case we're going to console an error and we're just going to return what previously existed so if there is no moved task we're going to console error no task found at the source index and then we're going to return previous tasks basically we are not going to change anything we are going to assume that you know this was some Edge case where the user I don't know somehow left in between drag and drops or you know did something incorrectly great otherwise if we have the move the task if we were able to destructure it from uh the Source column in that case we can go ahead and create a new task object with potentially updated status so let's do that by adding const updated task to be if Source status is not equal to destination status so if we change the status in that case we are going to spread the move task and so we leave all the properties inside as they are but we're going to change the status to be the new destination status like this otherwise we are simply going to consider the updated task to be the moved task so there are two types of moving tasks we can move tasks uh let me just add one more task so you can see what I'm talking about test I'm going to add a random task I say in the backlog project to so let me create one and refresh so you can see what I'm talking about so we can move tasks in between columns but we can also move them inside of columns by just changing their position so that's why we have to handle uh those cases here so we have to know did we change the status or are we just moving it up or down so if we have potentially updated status we check that here and then we uh modify the moved task with also a new status otherwise if the source status is exactly the same we are just considering it to be the moved task with a new position now let's add new tasks here from The Source status to be Source column what we're doing here is basically uh just updating the source column so let's add a comment for that and then after that let's go ahead and let's add the task to the new destination column so we now updated our source column and now we have to update our uh destination column so con destination column will be a copy of new tasks by that destination status and then we're going to do destination column. splice destination. index0 and updated move task uh updated mve task and I want to call this that so let's call it like that updated moved task like this uh updated move the task I have it incorrectly named there we go so this more closely uh resembles what it is so it can be updated but it can also just be moved so updated moved task okay we have that and then let's do new tasks inside of the destination status is now going to have the new destination column like this now let's go ahead and let's prepare the minimum update payloads we're going to do that by simply adding updates payload to be reset to an empty array here and then we're going to go ahead and push the moved task inside of the payload so we're going to do updates payload do push dollar sign ID will be updated moved task do dollar sign ID status will be the new destination status and Position will be be math Min destination. index + 1 time 1,000 and we're going to go ahead and ensure the maximum to be a million above that it's going to break so we're not going to support infinite amount of tasks is our in our conon board for that they're going to have the table so we're going to uh use the same logic that we use on our back end if you remember task server when we create a new task in side of here we Define the highest position task and we sort them by thousand so the new task will be 2,000 and then 3,000 and then 4,000 so in case something gets wrong in our database we can easily go back and you know programmatically fix these things by assigning one tasks to be you know in a half for example basically by using thousands instead of 1 2 3 4 5 six seven we allow a lot of room to fix errors if they happen so we we do the same logic here by defining the new position using the destination index uh since index starts from zero we plus one here and then we multiply by a th and we just uh use math mean to use the lower number if this happens to be above a million we are not going to support that change like that's way too many tasks for us to handle so we limit to a million here uh great we have that and now let's go ahead uh and let's do the following so so now we are going to update positions for affected tasks in the destination column so let's go ahead and do new tasks destination status for each get the task and the index inside of here we're going to check if task and task dollar sign ID is not identical to updated moved task. doll sign ID in that case we're going to do the following new position will be math Min index + 1 * 1,000 or 1 million oh and I didn't explain in JavaScript you can use underscores if you want to you don't have to so you can just write it like this but I find this to be way more readable when I just see a number like this I'm way too confused so this is definitely more readable for me so this is properly formatted in a normal number you don't have to worry so yeah you can do this for example and this is just a thousand great so we now have the new position so we are basically doing uh the same uh thing here so basically what we're doing now is what you can also do for example let's say I have a new task here to-do task let me just assign a random thing here let me give it a to-do and a random project so what are we doing here now basically besides being able to drag and drop like this like so we are just changing the position here in here we can change the status but what we can also do is change both the status and the positions inside of that new status so that's what we have to handle here so we are updating positions for affected tasks in the new column the destination column so that's why we have to do the new position here again so what we're going to do is if task. position is not equal to the new position it means we have to update it so let's do update spay load. push ID will be task ID status will be destination status and Position will be new position there we go uh like that so now what we have to do next is check if the task has been moved between columns we also have to update the positions in the source column what does that mean well remember how I just told you that we can do this we can drag from one column into a different status and we can update this right but what if we do this now both the status has been changed and the positions inside of this one and the positions inside of this one have changed so we have to take care of that as well so we have to be very careful when doing this there's a lot of logic happening here so let's just do if Source status is not equal to destination status meaning that we have changed the columns in that case new task Source status for each task and index if we have the task lowercase task like this and this is new tasks like that if we have a task con new position again will be math Min index oops index + one and then U my apologies times a th and then a million and then we're going to do if task position is not equal or identical to new position position in this case we're going to do updat payload do push ID task ID we're going to do status Source status we're going to do position new position there we go so I'm pretty sure we now handled every single possible case and we can now do uh outside of here we can do return new tasks so what this will do is remember we are doing all of this inside of set tasks so now we are finally uh let me go ahead and close all of these close all of this there we go so after we do all of this ifs you know all of this logic here we simply push the new tasks here and what's important here is that we have defined the update spay load outside of set tasks an interesting anecdote I have for you is that while I was building this I made a mistake and obviously we are now handling this locally so I think that already let's try it out let's call on drag end so I can continue my explanation here I'm just going to assign the on drag end here and I think that already now we should be able to there we go we can now drag and drop and you can see how nicely uh this is working uh and here's a mistake I made so after we handled this what we have to do is we have to call an onchange method to update our tasks right so we have to update this on the back end as well because right now now if I refresh everything will go back uh as it were and I thought well okay no problem all I have to do is call the methods every time something changes so instead of doing this kinds of stuff updates payload do push I would immediately call the onchange here or I will call the onchange here right that's what I was doing or here I would just do onchange right but that's an issue that cannot work because set task especially inside of its callback uh is not exactly I'm not sure what's the terminology for this but it can cause a mismatch between states right and you can get uh half of your function being called twice and half of it not being called twice basically what saved me was react strict mode and I basically noticed that I was getting multiple Network requests for each change of my uh columns here and while I was debugging I noticed that this UND drag eth UND drag end method right here here when I conso logged you know fired once this was true this only logged once but then instead of here I got multiple logs all the time and I couldn't debug why that was happening until I realized that I should not be calling on change inside of the Callback of a set state so that's why we're using this logic where we use the set tasks both to create the payload which we're going to call on change outside of of the set task callback but also to create new tasks that we finally return inside of this callback so now that we have that we can go ahead and call on change updates payload but we don't have on change I assume so it's going to be on change with a Capital C and let's add it here in the dependency array and now what we have to do is we also have to Define on change inside of our interface data Convent props here so this will accept tasks which are going to be an array uh of objects and more specifically these objects inside will take an ID of string uh a status of tasp status and a position of number so that's what we are going to send to the back end and now let's go ahead and let's destructure the unchange here so we get rid of the errors uh and there we go we should now be able to call the unchange here that's great uh but we are not done just yet so another thing that we have here which is not exactly working is this if I go ahead head and I click delete task the task is deleted but ignore this ugly refresh we're going to fix that later nothing happens here why is that well I'll tell you why it's because of how we initialized the task inside of the data conone here is because of this right so regardless we have this data is updated so this data in the next iteration doesn't have that task which I just deleted but that doesn't matter because I only use data here initially in my use State when this component has loaded so what we have to do is we have to implement a use effect to Simply repeat the what's happening inside of here let's do that after your tasks and the set tasks add a use effect here and let's go ahead and give it data as a dependency array so make sure you have use effect imported and what we're going to do here is very simple we're going to start by defining initial tasks like this but we're going to call this new tasks and then then we're going to go ahead and simply repeat the entire process so data for each task right here instead of calling initial tasks we'll be calling new tasks so we are basically assigning each task inside of their appropriate column and then we are ordering by their position right here so let's do this again instead of initial tasks we are calling new tasks here and then finally set tasks to be new tasks so now once you save this let me go ahead and refresh just you know uh to be sure and if I go ahead and remove this task now there we go after that refresh which we are going to take care of this has been removed now that we have all of that handled uh it's time for us to actually uh call this onchange method so you can see my task view switcher here is red because I did not pass the onchange method inside so let's go ahead and simply prepare the onchange method inside of the task view switcher here I'm going to go ahead uh and I'm going to go well anywhere here let's go ahead and let's add it after use G tasks I'm going to add Con on conun change to call use call back which we can import from react make sure you have imported used call back from react I'm just going to move it here to the top like this and now let's go ahead and inside of here inside of the parameters we're going to accept uh tasks which are an array of objects which hold dollar sign ID which is a string status which is a task status from do/ types and position which is a number make sure you have imported the task status from types let me just move this here okay and then and inside of here what we have to do is we have to call Bulk update but we don't have bulk update ready yet so for now we're just going to go ahead and call on Conan change here and we're going to assign it to the onchange the data Conan and what you can do inside of here for now is console log tasks so we can go ahead and try it out I'm going to open my inspect element here I'm going to go inside of a random project that I have I'm going to click on conb and when I drag and drop uh there we go we have tasks right here which are to be updated looks like we have a handy message here from our dropable unsupported nested scroll container detected um I think that might only happen when I Collapse like this I'm not sure if I go ahead and expand like this let's see yeah okay it looks like it's uh it's logging still but I have not noticed any problems I think it's just a warning in case we notice you know some uh unexpected Behavior but I think this is warning Us in case we are trying to do some weird you know scrollable droppers or something but we're not our is only scrolling like this right so you can see that this works just fine there's absolutely no issue whatsoever and this will only happen in development right this is a development only message great so we now have this so what we have to build is the actual bulk update now so let's go inside of our tasks server so tasks server which is located inside of features task server route. DS and now inside of here we have to add bulk update so let's go all the way down I want to change that I want to change that as the last method here so post you can also use put can use patch I'm not sure uh which one is the best for this but I think for bulk deletes or bulk updates post is used more often let's add a session middleware here and now let's go ahead and add a z validator which will validate Json z. object we already have Zod important that's great so we are going to accept tasks which will be a z do array of objects so z. object and inside we're going to have an ID which is the string we're going to have a status which is z native anun task status and a position which is going to be a number integer positive minimum zero um sorry minimum a th and a maximum of 1 million like this okay and after this let's go ahead and let's add our asynchronous controller here so that we can finally do the update here so as usual let's go ahead and let's get our databases from C.G get databases then let's go ahead and let's destructure the task some withit C request valid Json so this tasks right here and there we go they have the exact same props as needed here uh and now we're going to do a check whether all of these tasks have the same workspace ID so I'm going to do const tasks to update to be await databases list documents database ID tasks ID and I'm going to do query contains dollar sign ID tasks. map and get the individual task ID task ID oops I misspelled the task here uh in idual task like this do ID so we are loading all we are now populating all these tasks and this is what we're going to do const workspace IDs so multiple all of them will be new set tasks to update documents map get the individual task and return task workspace ID like this and you can go ahead and assign task here if you want to so then you're this will be typed there we go so workspace ID so inside of here now we're going to do this if workspace ID's size is not one in that case since we're using a set this is kind of a you know an non-orthodox way to check whether all of these are exactly the same so if any of this is different because new set doesn't allow for duplicate duplicates so this will all be if are all the same the new set will just be one workspace ID but if any of those are different it's not it's going to be larger than one right so if it's not one we are going to return an error all tasks must belong to the same workspace so we are not allowing uh this API endpoint to be abused and so that someone can potentially maliciously use it to change a task to a different workspace right so all of them need to be from the same workspace because once we have the workspace ID uh what we can do then is check whether we have uh a member or not so let's also prepare our user here and then what we're going to do is simply get the individual workspace ID which will which can be workspace IDs do values next value so that's the common workspace ID which all of these are supposed to have and then we're going to get our member using a weit get member databases workspace ID and user ID our user. dooll sign ID so that's how we confirm that we can only do the bulk update if we are a member of the workspace in which all of the tasks we are attempting to update are in right so that's why we are doing this kind of a security thing here so because I mean for a tutorial you know I was considering should I even you know handle this but I do want to show you know some things you should take care of right because this can be abused this is a very powerful endpoint it allows for literally any task to be updated so that's why I want to restrict so that only specific people can call this bulk tasks we don't want someone else from someone else's workspace to do that so that's why we have to add a constraint to this bulk update so that they can only be updated inside of a single workspace and by having a unique workspace we can do our usual is this user a member so if it's not a member we are not going to allow this user to do any bulk updating and then we can go ahead and do const updated tasks to be await promise all tasks. map get the asynchronous task so we can use async and await inside of map if it's wrapped inside of a promise all usually you can't do that so let's go ahead and the structure from the individual task here an ID status and position like this and let's go ahead and let's return databases update document task database ID tasks id id of the current task that we are updating here and we are simply updating the status and the position here there we go and now what we can do is return cjson data updated tasks great now we have the endpoint to handle bulk updates so now let's go ahead and let's create the API hook for that so we can use use update task let's copy and paste that and let's rename this to use bulk update update tasks like this use bulk update tasks use bulk update tasks as a renaming of the constant and let's fix the response and the request type here so we are going to be calling tasks and then we're going to be calling bulk update bulk update and then inside of here it's going to be a post method and inside of here make sure you keep the 200 as a positive result we will not be having any params just the Json and we can change this to bulk update and change this to post and and remove the Pam from here like this and we will not have any data like this then the toast here uh will be tasks updated and inside of here we're not going to invalidate that and we can remove the router refresh from here we can call this failed to update tasks same thing here and we can remove the router from use router and from next navigation here and honestly I'm thinking of doing that everywhere except in my log in and log out routes because that refresh is just unbearable to look at great so we now have use bulk update tasks let's go inside of our task view switcher component here and let's go ahead and let's add that so I'm going to go ahead and add it here const use bulk update tasks like this let's destructure the mutate method let's call it bulk update and let's go ahead and call it here so bulk update Json tasks and let's pass the bulk update here uh okay so property tasks is missing okay so I have to pass in the tasks as such like this um I kind of don't like this uh let's see if I go inside okay now let's leave it like this it's okay I I don't like that I have to say I don't like that I have to put it inside of the tasks object so in my bulk update perhaps perhaps I could just give it an array no need for the tasks object right we can just send an array for example but let's see will we have to change too much then um H yeah let's leave it like this actually yeah we have to pass it like this yes this is okay yes so bulk update Json tasks and now if we try it out I'm going to go ahead and take a look at my network tab here if I drag and drop this here it calls bulk update and you can see let's see what changed so my payload was to change it to to-do and my response was it's in to-do right here with the position thousand in that column and now if I refresh it stays in the to-do column and there we go tasks updated let's go ahead and let's create a new task here so we can play around a bit uh and see if they will update each other's position and things like that so if I go ahead and add this here tasks updated well they are named exactly the same so this doesn't make too much sense right let's go ahead and update the task here great so if I drag and drop them one Ben another and refresh they stay exactly like that so they have their positions intact excellent it seems like our logic is working flawlessly amazing amazing job you just finished the kban uh view of our tasks what's left to do is the calendar view and then we can go ahead and wrap up uh by adding some analytics some homepages and finally fixing that uh weird uh flash which happens for example when I delete a task this is what I'm talking about great great job let's continue and let's develop the last view of our tasks the calendar so () in order to do that we're going to have to install a package called react big calendar so let's go ahead and do bun at react big calendar and the version I'm using is 1.14.1 once this is installed let's go ahead and let's create a data calendar component so inside of my task switcher here I'm going to go down here where we have the data Conan and let's go ahead and let's prepare our data calendar here it's going to be a self closing tag and we can already pass in the data here to be data my apologies tasks question mark documents or an empty array now in the same components folder we're going to create a data calendar. TSX like this let's go ahead and let's create our interface data calendar drops which are going to accept data which is an array of tasks then let's create uh an export cons data calendar let's return a div data calendar and let's assign our props here data now let's go back to the task view switcher component and let's import this from /data calendar like this I'm just going to move it here alongside columns data table and data calendar and there we go now you should have data calendar here alongside kban and the table great now let's go ahead and let's develop this so we're going to have to add some imports from date FNS and some imports from react big calendar so let's go inside of the data calendar here and let's import all of these from date s format get day parse start of the week add months and sub months and from react big calendar let's import the calendar and date FNS localizer and it looks like I don't have the necessary types here for react big calendar so let's go ahead and add that so my version of react big calendar is 1.14.1 so I'm going to add bun add- D at types slash react big Calendar let me just zoom out so you can see it whoops well that's uh my apologies let me just pause as I zoom back in all right so basically this is the package let me show you types SL react big calendar at 1.14 one my apologies not this is not the version of the types so that's our version of react big calendar and our version for the types is going to be 1.8.1 like this so npm install this or bun add and I'm going to add slash D here uh so it's saved in my Dev dependencies like this so make sure you're using this version and now in a few seconds this should go away there we go we can now continue developing our date calendar so so we have the calendar the date FNS localizer here like that uh and let's go ahead and let's prepare some stuff here so I'm going to add a con locals English us to be nus which we have to import from date FNS local so let's import n us from date FNS local there we go uh so date FN s local has no exported member n us it's because it's us capitalized like this and same here great and then let's prepare a constant called localizer which will use the date FNS localizer passing the format the pars start of week get day and locals there we go so now let's go ahead and let's actually uh create the dat data calendar things inside here so I should be able to refresh this and there should be no errors in my calendar view there we go so inside of the data calendar here we're going to do this we're going to set the value and set value here using use state so import use state from react I will just move it here at the top and the default value here will be the following so if data. length is more than zero then we are going to set the date of the calendar uh to be the first one available in this data so due date the first one which we can find new date for otherwise we can just assign today like this so this will be controlling what month are we currently seeing for our calendar so if we have some data it makes sense to load uh the the first month where we actually have some data right otherwise we can just load today now let's go ahead and let's create create the events so that we can actually put them inside the react big calendar uh component so data. map let's get the individual task here and let's return an immediate object start will be new date task due date and will be new date task due date so both of them will be the same after start and end we're going to have a title which will be task name project which will be task project make sure you don't accidentally pass project ID here assign will be task assign and we're going to have status which will be task status after that we're going to have a final ID which will be task dollar sign ID great now let's go ahead and let's create our navigation so con handle navigate will accept an action of previous or next or today and it's if action is previous set value will be sub months value and one so we are going backwards for one month uh else if action is next we're going to set value ad months value one else if action isday let's go ahead and let's set value to new date so now we have the handle navigate method and then inside of here we can replace this entire thing with a calendar which is a self-closing tag and make sure you have imported it from react big calendar so I'm going to go inside of the calendar here and I'm going to add a localizer to be localizer I'm going to add date to be the current value which we control from our state after the date I'm going to pass the events then I'm going to add views and only allow for the month view so that's the only thing I'm going to allow here usually you can switch between day week and agenda but for this project I'm only going to keep the month view and let's also add the default view here to be month toolbar will be set to True show all events will be set to True class name will be height pool Max here will be new date new date do set full year inside of that method new date get full year executed plus one and formats here are going to be the following weekday format we'll use the date the culture and the localizer and it will return localizer question mark format date Triple E and culture or an empty string and then we can go ahead and leave it like this for now so let's just save this uh and there we go you can see we have something here and we can even see our task right here so let's go ahead and make this uh have some Styles we can do that very simply by adding the Styles import here so let's go ahead and and after we import everything here let's import react big calendar SL lib SL CSS react big calendar. CSS and let's save this and let's go ahead and refresh here and there we go we can see something uh right so it's looking a bit better but still not perfect so let's see how we can improve this so we have set the height full here but what I think is missing is inside of my task view switcher here so the place where we render the data calendar here might need to have some special classes around its tabs content so let's see if adding height full fixes it let's go ahead and refresh looks like height full did not immediately fix this so let's continue and let's prepare a padding bottom of four here just so we have that and now I just want to uh double check here my uh wrapper components here so let's see what tab list only encapsulates this so that's fine so we have uh this div should encapsulate okay so again it doesn't encapsulate everything so it doesn't need to have any height fulls here this div here has height full Flex Flex hole overflow outo this one has Flex one and with full okay so I think that this should extend to its uh height but some things are missing so here's what I suggest we do uh I suggest that we try and extend this ourselves but just before we do that I quickly want to go and take a look inside of my app folder inside of my dashboard workspaces workspace ID projects project ID page right here and perhaps here I am missing uh some things before I render the task view switcher all right so all of this look okay to me so what I'm going to do to try and uh make this calendar take some height is give it some special Styles so inside of the data calendar here let's focus exclusively on this component now after we import the Styles we are going to import our customdata calendar. CSS so data/ calendar CSS and we are going to put it inside of this components file so data- calendar. CSS that's because this calendar doesn't allow Tailwind edits so let's go ahead and let's add some classes let's try. RBC slm month row and let's give it an apply so we can use Tailwind inside of CSS minimum height of 180 pixels and let's see if this will uh expanded and there we go so now uh I can see that my calendar here has a minimum height and I can see my tasks right here this navigation is currently not working because we have to plug it in but since we are already inside of this data calendar uh CSS let's go ahead and let's you know complete it till the end so I'm going to add an RBC header class and I'm going to apply the following text small I'm going to apply font to normal I'm going to add padding bottom of four text muted foreground and I'm going to add a border bottom of zero so I think this should modify my header here you can see this Sunday Monday Tuesday now have a missing border here on the bottom we're going to improve that and also if you want to you can add a single apply and then just add you know a bunch of stuff here like font normal padding bottom of four like like you're writing a normal CSS class name but I just think it's more readable to repeat applies now let's add RBC header plus RBC header and inside let's add an apply border left zero after that RBC button link is going to have apply text extra small apply font normal and apply text muted foreground then let's add uh some other things to our RBC month row so besides the minimum height let's give it an apply border top and apply Border X then let's go ahead and let's do the following so I'm going to do uh RB see month row last off type like this and if it's last of type we're going to apply a border bottom and we are also going to apply a rounded bottom medium so let's refresh just you know uh ensure that we are seeing the most upto-date things here there we go it's starting to uh get some shape here so now we have the last of type and we have applied you know if it's the last row you can already see you know we still have some this huge border but I can see a very very tiny rounded border here inside of this sharp border happening so this is uh the doing of that and now I wanted do the same thing here on the top the problem is CSS doesn't have a uh first of type I believe or maybe it does have the first of type but it doesn't exactly work as expected uh so what we can do uh is the following we can I found this on I'm not sure if on stack Overflow or somewhere else we can do this trick not RBC month row add this I don't know I call it the average sign I'm not sure how you call it uh RBC month row and then RBC month row don't ask me why but this is the equivalent of first of type and let's apply rounded top medium uh okay so there we go you can see how this corner right here is rounded so that's what I wanted to do okay we now have this now let's add an RBC month view and let's apply border none and I think this should remove there we go so now that big border was removed and you can see how now I have this nice rounded corners only in the first one and only on the bottom one so that's what uh these two did so the last of type is working fine but the first of type was not working so I had to do this hack that's that's what I'm going to call it because it is a hack let's do a RBC date cell here and let's apply a padding of two let's go ahead and let's add a RBC today and let's go ahead and give it the background color of inherit and let's go ahead and let's add an RBC off range background and let's give it a background of inherit and we can do both background inherits instead there we go now our calendar is clean here even these off uh these off um what are they called off range backgrounds if you want you know you can leave some of them and then these off ranges you can see will have their own colors if that's what you prefer I'm kind of focusing more on design than practicality for this calendar you can choose if you want to specify the today you can go ahead and remove this and then the today will be highlighted and you can do the same thing for this if you find that very useful but here's how you can turn it off great so that's it for our custom data calendars and yes we have this unn know apply rule um if you want you can turn that off in your linter but you know uh it works it's just a lint warning and it will not stop any build processes it's just a warning okay now we have to go back inside of our data calendar here and and what I want to do is I want to create some custom components instead of these default ones which exist starting with my event card so I don't want my event card to look as simple as this so let's go inside of the calendar here and after the formats let's add components prop inside of here let's define the event wrapper component and let's go ahead and destructure the event from it and let's go ahead and add an event card inside of the event card I'm going to pass the to be event. ID I'm going to pass in the title to be event. tile I'm going to pass in the ass to be event. S and I'm going to pass in the project to be event. project I'm going to pass in the status to be event status so we don't have to put dollar sign ID here because we create events here and we assign ID to be dollar sign ID so we don't have to do the dollar sign ID here now we have to create the event card so let's inside of this components folder create the event- card. TSX like this uh let's go ahead and create an interface here event card props let's create a title which is a string and then just uh the rest of our things so as say KN here can be any for now let's create a project to be to be a type of project let's add a status to be a type of task status and let's add an ID to be a type of string there we go so make sure you have added the features project types and the task status here and now let's go ahead and let's export const event card let's destructure the event card props here inside of here I'm going to extract title as I project status and ID and then I'm going to go ahead and return a div with a class name PX of two and then another div inside with a class name uh let's immediately prepare CN from lib utils because this will be a dynamic so I'm going to go ahead and give it some default classes which will be the following let me expand my code screen here uh adding of 1.5 text extra small background white text primary border rounded medium border L4 Flex Flex call Gap y 1.5 cursor pointer hover opacity 75 and transition like this and then inside of here we're going to add a paragraph title this is an enough for now make sure you have added this class name here I'm going to go over it once again so you can pause and write it out let's go inside of the data calendar and let's import the event card from do/ event card and now you should be able to see your uh card right here there we go so now what we're going to do is we're going to go inside of the event card and we're going to create a status color map so let's create a cons status color map and let's give it a type of record for each task status we're going to produce a string so for example if task status is in backlog we are going to add border left pink 500 so basically the same ones from the badge component to do is red in progress is yellow in review is blue done is emerald and backlog is pink so we are going to match that uh so I'm going to go ahead and just wrap this up so you don't have to watch me spell it out there we go to-do is red in progress is yellow in review is blue and done is emerald and all of them have border l so the only difference are the colors great so now that we have the status color map here what we can do is we can go ahead and add an extra uh Dynamic class here which will be status color and then status and let's see oh status color map there we go so now as you can see this one has a pink uh border because it's in backlog if I move it to let's say done wait for it to be updated go to calendar there we go now it's green so this way we have a unified color system uh so we know exactly uh what color the event what color which status means besides having a title here uh we're going to add a div below it with a class name of flex item Center and GAP X of one and we're going to add a member Avatar component here Our member Avatar component will come from features members components member Avatar and inside of here we're going to pass in the name to be AE name and I really ought to create uh member type because I really don't like writing any here but I have explained a couple of times where this comes from in our get tasks API endpoint we populate the S and the project so that's why we have this object with the name here and let's add a div here which will represent like a little spacing dot so let's give it a class name of size one rounded full and background neutral 300 and then let's add a project Avatar here so we know what project this is a part of so name will be project name and then an image will be Project image URL so I'm putting you know question marks here just in case we don't load the project so we don't cause any errors here uh and now let me just move this so we get project a from features projects components project out there and there we go we now have a very nice event card right here what I want to do now is I want to make this toolbar here look a bit prettier and I also want uh this on click to redirect to uh a I want you to redirect to the actual view of that task so let's create that on click so we are finished with the event card I'm going to add a workspace ID from use workspace ID I'm going to add a router from use router from next navigation make sure you have imported both of those so we have use workspace ID from features workspaces use workspace ID and use router from next navigation and then inside of here we can specify const on click let's get the event which will be a type of react mouse event HTML div element and then we're going to stop propagation here and we are going to do router. push slash workspaces workspace ID and then tasks and then the ID which we have here we don't have this page yet so once we assign this on click to this inner div so here not to the top div it will lead you to a 404 page so if you click you will get to a404 that's okay for now but later we're going to build it properly okay so we have that ready now so what I want to do now is build the toolbar components so we can wrap up the calendar view so let's close the event card and let's go inside of the data calendar so down here where we specified our components event wrapper let's add another component called toolbar which will render a custom toolbar component the date will be the value and on navigate will be handle navigate like this if you want to you can specify it well yeah let's do that let's copy the custom toolbar here uh and yeah did I name this correctly toolbar okay I think this will be fine uh yeah oh my apologies not curly brackets here normal brackets because we are returning in jsx there we go go let's create a custom toolbar now uh but we can actually do it inside of here it's not going to be that complicated so and we have a lot of imports already here so what I'm going to do is just you know uh before we do export con data calendar let's do const custom toolbar let's go ahead and give it a date and on navigate and let's give it custom toolbar props let me just fix the arrow sign here let's create the custom toolbar props is going to have date which will be a type of date and on navigate which will be action either previous or next or today and they will return back a void and then inside of here let's go ahead and let's return a div with a class name Flex margin bottom four Gap X2 items Center full width outo width on large justify Center and on LG justifies start so we add a little bit of responsivity here now we're going to go ahead and render a button from components UI button so just make sure you have added this import I'm going to move it here and let's also prepare all the icons we which we are going to need from Lucid react so calendar icon Chevron left let's call it Chevron left icon and Chevron right icon yeah in Lucid react you can either import like Chevron right or you can append icon at the end they do exports of both so you don't have to do chevron right as Chevron uh as Chevron right icon you can do it like this as well why do they do that well let's say that uh you want to import the calendar icon you can see we have a conflict because our component here is named calendar so usually what you would do is you would rename this as calendar icon so they obviously know that people do that a lot so they allowed us to Simply import calendar icon like this so let's be consistent and let's use icon everywhere then there we go so these are the icons which we are going to need let's go back inside of our custom toolbar here and for the first button here I'm going to with an onclick on navigate previous variant here will be secondary size will be icon class name will be flex and items Center inside I'm going to add a Chevron left icon and the class name size four in between uh we're going to have two buttons so in between them let's add a div which will render our calendar icon with a class name size four and Mr of two and it's also going to render inside of a paragraph format the current date and in a formant of mmm y y y y like this and let's go ahead and give this paragraph here a class name text small and let's give this D let's give this div a class name Flex items Center border border input rounded MD PX3 py2 height of eight justify center with full and en large with Auto and then let's copy this button and paste it after this will navigate to next it will have the same attributes here except the class name here no need for the CL I don't think there's any need for this class name as well in this button and it will simply use the Chevron right icon and there we go you can see how nicely it looks responsive on mobile but when I expand to desktop it's just here and I can now click this and I can go to November I can go back and I will go to September there we go we have finished our calendar component now so we can now see multiple tasks through table through kban and through the calendar component amazing amazing job so what what we can do now is we can reuse this task uh view switcher component and we can put it inside of the my tasks page so we can end that page and then what's left is to create the analytics for our individual projects so analytics will go here above the task switcher and in the homepage we're going to have some other analytics great great job now that we have finished our task () view switcher component let's go ahead and let's create the my tasks page right here so we're going to do that inside of the app folder inside of dashboard workspaces inside of the individual workspace ID let's create a new folder called tasks and inside of here let's create a page. TSX I'm going to go ahead and Mark this as tasks page and since this is a server component by default I'm going to import get current and I'm going to import redirect from next navigation and then I'm going to mark this as an asynchronous component I'm going to await the current user and if there is no user I'm going to redirect to slash sign in there we go this route is now protected and now let's go ahead inside and very simply we can just render the task view switcher like this so now when you go ahead and click here it should render the task view switcher there we go uh and let's just go ahead and give it a wrapper so it's not just returning this I want to give it a div like this and the class name full height flex and flex column like this there we go so now it can extend to its full height if needed perfect so we have the tasks page here we have the settings page uh we have the members page right here so what I want to do now before we go on to creating the analytics is the individual task because that's something we have not done yet and one thing I also want to fix is right now on the my tasks it makes sense that we allow all of these filters for example I can select project two here and it will only load project two I can select project one and it will tell me no results right but if I click on Project two it doesn't make sense that I can change the project one inside of it so that's why we implemented inside of task view switcher or maybe we didn't Implement let's see um I think we added it only in the data filters we added the hide project filter so now let's add it in the task view switcher as well so I'm going to create an interface task view Switcher props optional hide project filter and let's destructure it from here so hide project filter and let's pass it to data filters like that now we can go on the individual project ID page so projects project ID page and we can go ahead and pass it here so let's go ahead and pass down uh the hide project filter and we don't have to this is equivalent to true so now if we've done this correctly Let me refresh and see does this work now okay it still shows the project filter that's because I don't think we actually use that component that prop so inside of task view switcher let's go inside of data filters and let's use the hide project filter so it's unused yeah so what we're going to do is we're going to find our project ID select and let's only show it uh if not hide project filter like this so make sure you put uh an exclamation point here and wrap the select around it like this and indent and there we go now it's disappeared for the project page but if you go into my tasks you have the project filter great so before we uh go onto the analytics page I want to create this the task Details page which we we can access through there or by clicking here which is currently a404 but first let's check whether we have the get task API at all so instead of features tasks server route. DS Let's see we have the get for all tasks but it looks like oh we do have get task ID great and let's ensure that inside of here we do populate the project and the member that's great and do I have an API use G task I do uh where do I use use get task okay in edit task form that's where I use it I just wanted to confirm okay now let's go ahead and let's go inside of source app folder dashboard workspaces inside of workspace ID inside of tasks and in here we can now create a new folder task ID and inside we can create a page. DSX let's go ahead and Export const or let's just do export default task ID page div task ID and now what I'm going to do is Mark this as an asynchronous component I'm going to get the user using await get current if there is no user I will return no I will redirect my apologies to SL sign in there we go so we resolved that and now usually what I do is I create a query to get the task but we've noticed that in order to update server components which use those queries what we need to do is router. refresh uh which really doesn't have nice user experience so I'm going to introduce a new structure now and then later we're going to refactor all of those places where we use this AC synchronous components as server components and load the initial data as well because I really really don't like that structure but we're going to do that later uh and we can start now so I'm going to go ahead and have alongside my page inside of task ID I will simply create a client. DSX and we know what this means this will simply be a use client component let's go ahead and let's export const uh well let's call it task ID client like this and let's return task ID task ID client great like this and let's go back inside of here and we are very simply just going to return task ID client inside like that so we can leave this to be responsible you know for the redirect and then if you want to you can pass from the params the task ID or we can just create a hook and use use uh params inside and that's what I'm going to do so I'm going to go inside of my features folder where are my features folder here inside of tasks inside of hooks and I will simply create a use task id. TS file and inside of here I'm just going to import use params from next navigation export con use task ID Define the params and search for pam. task ID so basically I am looking for the same thing that I have inside of my dashboard workspaces workspace ID tasks task ID right here make sure that the capitalization is correct and now let's go inside of client and now I can get that here so cons task ID here will be use task ID now that I have used task ID what I can do is I can fetch my data so I'm going to go ahead and get data and is loading here from use get task and I will pass in the task ID there we go and now in case I am loading I can go ahead uh and create a something called a page loader so if is loading I can return a page loader so the reason I'm doing this different kind of structure now is because I want to standardize it so I can then you know repeat it elsewhere where we previously used uh the queries I will most likely delete all queries because I really don't like using them they are good for uh preloading right but since I didn't Implement that kind of use Query at all it doesn't doesn't make sense to force server components where they're not useful for example for redirecting I find them very useful because there's no need for use effect right I find that great especially inside of my uh workspaces page. DSX so especially this part right I can already see this in use effect would just be a mess right but here it's it's pretty straightforward so I'm going to leave queries only you know for this kind of things but for the rest I'm just going to go ahead uh and do things like this so let's go ahead and create this reusable component page loader. TSX and it's going to be like this so import loader from Lucid loader from leid react export con page loader give it a div with a class name of flex item Center justify Center and height full and a loader component from Lucid react with a size six animate Spin and text muted foreground like that and while we are while we are here let's also create uh a page error inside of components so page error. DSX right here so import alert triangle from Lucid react Define the interface page error props right here the message is a string now we have a expert con page error the message by default will be something went wrong but it's going to be a props it allows you to specify a custom message if needed and there we go you can see the whole class names here so again flex but this time Flex column items Center justify Center hide full alert triangle icon the pretty much the same as in page loader with the exception of removing the animate spin so make sure you remove that and then a paragraph text small font medium text muted foreground with our message great now that we have the page error and the page loader page loader let's go inside of the client here and let's import the components form components page loader like this and if there is no data we're going to return page error with a message uh task not found and let's import this from components page error like that otherwise we can go ahead and Json stringify the data and there we go so now when you refresh this there we go you can see the loader and then it's transformed into this I like this uh filling of as Spas single page application way more than I do server side components that being said they are handy you know for things like this they're amazing but for handling this kind of stuff I I don't know I just prefer it like this especially with react query great so we have our task ID client here so now what I'm going to do is I'm going to style this let's go ahead and turn this into a div let's give this a class name of flex Flex column and inside of here let's create task breadcrumbs like this and let's pass in the project to be data project and the task to be data now let's go ahead and let's implement the task breadcrumbs inside of my let's go inside of features tasks components so let's add task breadcrumbs. CSX component uh the task breadcrumbs will have an interface which accept STS the project from features projects types and task from do/ types like this and let's export cons task breadcrumbs let's go ahead and let's assign the props here so we can D structure the project and the task and then let's open an arrow function here and let's go ahead and do the following let's create a div with a class name Flex items Center and GAP X2 let's render the project Avatar component let's give it a name of project. name let's give it an image of project. image URL and a class name size six and large size eight after that let's go ahead and let's create a link from next link let's give it an HRA slash workspaces and then we need a workspace ID so let's prepare con workspace ID we use workspace ID so ensure that you're having all of these Imports here as I do project avatar from components project Avatar and this from workspaces hooks use workspace ID and so we are adding workspace ID here after that projects and after that project dollar sign ID and inside of here we're going to add a paragraph which renders the project name and give this a class name of text small LG text large font semi bold text muted foreground power opacity 75 and transition like this then let's go ahead and let's add a Chevron right icon from it react so make sure you have added this import here and let's give the Chevron right icon a class name of size 4 LG size 5 and text muted foreground let's go ahead and add a paragraph here task. name with a class name of text small LG text large and font semi bold and then let's add a button component from components UI button uh which will have a CL class name ml AO so it's in the opposite corner of these let's give it a variant of destructive a size of small and let's go ahead and write a trash icon inside from Lucid react and a span delete task make sure you have added the trash icon here and give the trash icon a class name of size 4 and on large Mr of two because this span will be hidden by default and only visible on large like this and I forgot to return this so make sure you wrap this in return so you don't have the mistake as I do let me just indent it there we go let me move this here and now let's go ahead and let's go inside of client. TSX and let's import task breadcrumbs from features task uh components task breadcrumbs and there we go now now you can see uh that you will have the individual uh task here and you can delete the task from here and when you click here you will be redirected to the project page and then you can click here task details and there we go you are now seeing the breadcrumbs of that task and you will have a quick delete button here but on mobile this button will turn into just a small button like that so let's wrap up the task brrs Now by introducing uh the use delete task and the confirm dialogue which luckily for us we already have all of those so this will be a mutate method here use delete task like this and then we are going to have confirm dialogue and confirm method from use confirm from hooks use confirm so I'm just going to move this here so inside of the use confirm go ahead and give it uh a delete task this actually cannot be undone and destructive variant like this and let's create a cons handle delete task to be an asynchronous method which will check for await using the confirm if not okay we will break the method otherwise let's go and delete the task by passing in the Pam to be task ID task. dollar sign ID uh is it expected zero arguments but got one oh not use theet task my apologies mutate there we go and what we're going to do on success here is we're going to go ahead and redirect the user away from here back to the tasks page so let's go ahead and let's add a router from use router from next navigation so make sure you have added this import here use router from next navigation and we're simply going to do router. push slw workspaces workspace ID slash tasks and now let's go ahead and add the handle delete to the button here on click handle delete and we can disable it if is pending let's go ahead and fix the disabled prop and let's extract is pending here from use delet task mutation and let's render the confirm dialogue somewhere like this and now when you click delete task you have a confirmation when you click confirm you are redirected to the tasks page great so now we have to create a new task here so new task let's select the due date let's select an as a status and project let's create a new task uh and now let's go back inside of the task details here there we go so now we're going to go ahead and add the overview of the task here and then a description which will be modifiable by users to add more information about the tasks so none of these are going to be to difficult because we have most of these things implemented already so let's go back inside of the app folder dashboard workspaces tasks task ID client. TSX and alongside having the uh breadcrumbs here we're now going to add a doted separator component from components uh dotted separator and I should reverse this like that we are now ALS also going to give the dotted separator a class name my of6 and then we're going to add a div class name uh grid grid columns one but on large grid columns 2 and GAP four between them and then inside of here we're going to have a task overview and pass in the task to be data so now we have to create the task overview component so let's go ahead and do that so in the same place where we created our uh task brrs so the tasks components let's create uh the task overview component. DSX let's create an interface task overview props which will accept a task which is a type of task let's export cons task overview here let's destructure the props and let's go ahead and let's get the task from here and then inside of here let's go ahead and let's return this and let's add a div with a class name Flex Flex column Gap y4 and call span of one because we are using this inside of a grid let's go back to the client and let's quickly import the task overview so we don't have these errors anymore okay and now we will be able to see what we are developing let's add another div inside with a class name of background muted round at large and padding of four now inside of here I'm going to add a paragraph overview and I will add a class name here text large and font semi bold like this and then let's go ahead and let's add a button component from components UI button let's add a pencil icon from Lucid react so I'm going to move this here and I will separate these like that this will have a pencil icon the button will have a size of small the variant of secondary and this will have a class name of size 4 and Mr of two because it's also going to have an edit label like this uh now what we have to do here is ensure that uh this is inside of a div so these two should be inside of another div like this and give it a class name of flex items Center and justify between there we go now it looks better and now we're going to go ahead and add a dotted separator here so import that from components UI dotted separator let's give the dotted separator a class name of my4 like this and then let's create a new div and let's add a class name Flex Flex column and GAP y4 and what we're going to do now is create one more component which we are now going to reuse uh to nicely display some things here so we don't have to copy and paste a lot of things so inside of the same folder components create a new file called overview property. TSX like this and let's go ahead and let's create an interface overview property props will have a label and children so let's go ahead and let's define that here so I will just collapse this so you can see there we go overview property overview property props and then inside of here we are going to return a div with a class name Flex items start and GAP X of two then another div with a class name minimum with 100 pixels and then we're going to have a paragraph rendering the label and then a class name inside of the paragraph here text small and text muted foreground and then we're going to have a div rendering the children inside after that another class name Flex items Center and GAP X of two great so we now have this reusable component we can go back inside of the task overview now and we can add as many of them as we want so let's add an overview property here make sure you have imported overview property from do/ overview property we're going to give the first one a label of assign and then what we're going to do is we're going to add a member avatar from the as the children so make sure you have imported the member avatar from features members components member Avatar and I'm going to go ahead and give this a name of task. ass. name like this and I'm also going to give this a class name of size six there we go so we can already see the ass and the member Avatar and then a paragraph task assign name again here but let's also give it a class name here which will be text small and font medium then let's add another overview property here this time with a label of due date and inside of here we're going to go ahead and render the task date component from slask date like this this let's go ahead and give it a value of task due date and let's give it a class name of text small and font medium there we go now let's go ahead and repeat our overview property one more time and let's give it a label of status let's give it a badge from components UI badge so make sure you have added this import here let me just move the features here above now that we we have the badge remember they have all the necessary variants here for our status so we can safely do the same thing we did in The Columns of the data table add snake case to title case to task. status and passing the variant here to be task. status and there we go in progress yellow and make sure you have imported snake case to title case here there we go so that is our overview uh tab here and now here we're going to implement the description so what we have to do to wrap it up is just enable the edit button which will be quite simple uh we have to import the use edit task model so open use edit task model from do/ hooks use edit task model and on click of the edit button we are going to call the open and we have to pass in the task. dollar sign ID and now when you click edit it will load that task and you can change this new task one to three click save changes uh oh and this is supposed to close and I think it did close I think it's just my hot reload that was messed up let's see let's refresh again new task one to3 let's change this from impr progress to backlog for example so backlog save there we go change to backlog why did it update immediately because in my use update task I invalidate the queries right here task data ID right it's because of that and we store our use get task with that query key so you have to be careful that you're using the proper query Keys here uh great so now that we have this finished let's go back inside of the client and now we have to implement uh the last thing on this page which is Task description and it's not going to be uh awfully difficult we already have the update method uh we just have to implement the component so what we're going to do is implement the task description in the same place features task components and let's create the task description. DSX and now let's go ahead and let's simply create an interface task description props let's import task from types let's prepare some other Imports which we are going to need use state from react pencil icon and X icon from Lucid react we're going to need some components from shaten button text area and dotted separator in case any of these are missing for you you have to install them with shaten so let me show you once again bun shaten 2.1.0 add text area for example great and let's also add our API use update task from do/ API use update task great now let's go ahead and let's export con task description here let's add the task task description props and then let's go ahead and let's create the UI so return div with a class name which is going to be padding four border and rounded large and now let's go inside of the client and let's just import task description so we can already start uh seeing the changes here so I will just add it here and there we go I can see an empty box here so now we're going to continue develop inside let's add a div with a class name Flex items Center and justify between inside of here I'm going to add a paragraph overview and I'm going to add a class name text large and font semi bold and then I'm going to add a button component and I'm going to uh do the pencil icon inside like this with a class name of size 4 and Mr of two and I will say edit like this and let's give the button a size of small and a variant of secondary like this and then outside of this div let's add a dotted separator let's give the dotted separator a class name of my4 and let's go ahead and give this a div with a class name Flex Flex column and GAP y of four like this and then inside let's render a div with task. description which I think it's missing from my definition here yeah so let's go inside of features tasks types and let's add the description as an optional string so if we have task description we're going to render that or we're going to render a span no description set and give it a class name text muted foreground so there we go this now says no description set so what I'm going to do now is the following I'm going to add the is editing prop is editing set is editing use State PS I'm going to add value and set value from use State task description I will Define mutate and is pending from use update task method I will just separate them from the states like this and I will add const handle save method here update task and I will pass in Json to be an object and pass in the description here and then I will also add my pams and of course mutate let's call the Pam here with task ID being my task do sign ID and description will be value great we have that we have a spending and now let's create different states depending on uh whether we are editing or not so first of all let's start with this button here so I'm going to create an onclick here which will call set is editing and depending on its previous value we're going to do a toggle by simply doing the reverse of what was previously uh inside so if it was false now it's going to be true and then depending on that we're going to render one thing or another so if we are editing we're going to render one set of icons and text otherwise another one so let's do it like this and inside of here let's add an X icon with a class name size 4 Mr of2 and then inside of here if is editing it will be cancel otherwise it will be edit so now if you click edit uh is editing it should change to cancel so let's see why it did not oh I have to save there we go now it says cancel and edit and you can toggle great now we have to do the same thing here but just show the text area instead so I'm going to go ahead inside of here like this um and this is how I'm going to do this this div here can actually be outside it doesn't have to be inside of the flex Flex column so let's do this if is editing we're going to render that div and we're going to put text area in the confirm button inside otherwise simply render this div like this inside of here we're going to add a text area component we're going to give it a placeholder of add a description we're going to give it a value of value we're going to give it a rows of four we're going to give it an unchange to take the event and simply set the value to be event Target value and we're going to go ahead and give it a disabled if is pending and below that we're going to add a button component it's not going to be a self closing button so give it a close here and it's going to say if is pending it will be saving otherwise save changes let's give the button inside a size of small let's give it a class name wfit ml AO and let's give it an on click to be handled save and let's give it a disabled off is pending so now if you go ahead and click edit and change the description and click save changes it should work just fine task updated and there we go the description is set I can even do a hard refresh here and it should work just fine there we go change the description amazing amazing job you have just completed uh the individual task view so what we're going to do next is we are going to go ahead and create further develop the project Pages here and the home pages here what I want to build next is go back to () the project ID page right here and there's a couple of things I want to do first one is I want to refactor my server component usage inside of here so if you go inside of source app folder dashboard workspaces workspace ID projects project ID inside of here I'm using uh the await get project from projects queries I don't want to do that because in order to update this this page especially the name and the image I would have to do the router. refresh so I'm not going to rely on that instead what I'm going to do is what I did with the task ID page so I'm going to create a client. TSX inside of here and I'm going to mark it as use client I will export con page my apologies project ID client here and no need to add any props inside what I'm going to do is this entire thing so I'm just going to pass this so let's return there we go let's import project Avatar here let's import the button component from components UI button let's import link from next link let's import pencil icon from Lucid react and let's import the task view switcher so we should only have these initial values causing us errors I'm now going to move these two here at the top and I'm going to prioritize the features above the components now that we have that what we're going to do is go back inside of here and we are very simply just going to render the client so this will be called project ID client and now we don't have to do this anymore so we can remove get project project Avatar task switcher button pencil link and we can also remove the project ID page props no need for for them as well we will only handle the uh authentication here now let's go inside of the project ID client and let's go ahead and let's get the project ID from use project ID it looks like we don't have that one so let's quickly create it so it will work the same way our task ID or workspaces ID hook works so use task ID let's copy that let's go inside of projects Hooks and let's add it here let's go ahead and let's rename this to use project ID use project ID and this will be project ID with capital I now let's go back inside of the project client and we can import the use project ID from features hooks use project ID and now we can go ahead and call the use get project looks like we only have used get projects so we have to add that we didn't add it because we just use a server component but it's good to have API for that as well so first let's confirm inside of API we don't have use get individual project but do we have inside of server route. DS do we have the individual get project ID so let's see get all not this we have post so we don't have get individual project let's Implement that so I'm going to add get and then I'm going to add SL project ID I will add a session middleware and then asynchronous controller here I'm now going to extract my user from C.G user I will extract the databases from C.G databases and I will destructure the project ID from c. request peram now I'm going to load the project so project will be await data bases. getet document like this with the project type database ID tasks ID and project ID from our request param and then we're going to get the member using await get member databases workspace ID will be existing project or simply called project. workspace ID and then we're going to have our user ID come from user. dollar sign ID if we don't have the member we're going to throw an error here otherwise we can go ahead and simply return the project inside of data now that we have our get project ID we can go inside of projects API and let's copy use get projects let's paste it here use get project project like this make sure it doesn't have S at the end let's rename this to use get project and this to use get project and this will look for project ID and this will be used get project props and project ID here and this will be the individual project and then project ID and the query here will be just a project ID and it won't be a query it will be a PM because we are looking for projects and then looking for the project ID there we go so failed to fetch the individual project no no need for any console logs here there we go use get project is now here and we can now go back to our client for the project ID and we can import use get project so individual use get project and I will remove the falsely imported use get projects one and then we just pass in the project ID Here and Now inside of here we're going to have data and is loading and we can do the usual thing if is loading we're just going to go ahead and return a page loader component and if there is no data we are going to return a page error with a message project not found and then we're going to replace all the initial values usage with data there we go and we should get rid of any errors now so I'm just going to move this alongside here let me just sign it like that and let's move that here and let's double check can we load this or not do we get any errors here let's see it's loading a project and looks like I'm getting a 500 error because it says document with the requested ID could not be found so let's see what exactly are we sending that's wrong instead of use project ID we are looking for perams project ID we are sending the project ID that's for certain uh and let's go inside of client there seems to be an error here oh there's an error inside of here project ID client so we also have to replace this with data ID but that is not the reason we are getting that error but yes fix this as well so that's inside of the project ID client so what's happening here is that we are failing to load use get project so let's go back inside of our route here project ID project ID from Pam project and this is I think where something goes wrong oh because I'm loading tasks ID projects my apologies we don't need tasks ID here at all I I was so used to working with the tasks uh I forgot inside of the get project ID we have to use the projects ID collection and now we should be able to load our project project there we go and what's cool now is that when I click edit project here uh and if I go one to three here and if I go back there we go you can see how this nicely updated because of react query right uh so while we are here let's also fix the project ID settings page right since we just implemented this API endpoint I just want to fix those things so we have to find the project ID settings page and I want to resolve it let's go inside of source app folder Standalone workspaces workspace ID projects project ID settings and inside of here I'm going to remove these initial values here completely so I will not be needing this props here at all so let me remove this let me remove this get project and I'm going to go ahead and remove this as well so the only thing I'm going to do is create a client do DSX here Market is use client and I will export const uh project ID settings client like this and inside of here well what I can do is I can return this as well so let me add this and let me add a edit task form here my apologies edit project form and remove the edit task form here and what I'm going to do here is I'm going to get the data remapped to initial values from use get project and we can get the project ID here from use project ID and we can simply pass in the project ID there we go this is way more consistent if you ask me I just feel more in control than with server components uh and now I have to do the is loading here so is loading if is loading we're going to go ahead and we are going to return the page Lo fer component if there is no initial values we are going to return back page error component and a message of uh project not found like this and then we can pass in the initial values here to be initial values there we go and then let's just go ahead and separate these two so let me go here there we go let's go back inside of here and let's simply return project ID settings client from client and we can remove the edit project form there we go like this which now means that uh inside of our hook to update the project so features projects API use update project inside of here we no longer have to do the router thing thankfully because that just causes a very uh ugly refresh here there we go we are just invalidating the queries here and that's way smoother so now if I refresh we have a nice loading here there we go and I can go ahead and change this to 444 click save changes and look how smoothly this looks now uh looks like we do have this issue here that's interesting uh so let's see why that is happening that should definitely not happen uh but I think it's because yeah if we refresh it will be okay so this is what let's see what should we do here uh okay let's leave it like this for now I think I know why it's happening uh it's because we have to reload the initial values in the project right so maybe oh I know what we can do so let's go inside of projects components edit project form and on Save let's not reset the form at all so nothing to do in the unsuccess method here so let me refresh again and now I will change this to Antonio project and save and there we go now no need to do anything else there we go this is way smoother experience if you ask me uh perfect so we have that finished what I'm interested in now is are we using any of the queries from here do I call get project anywhere nowhere so I can safely delete the queries inside of my project feature folder great so that's one uh thing completely resolved here so I'm going to reserve this chapter for refactoring that let's do that in this chapter what I'm going to do next now is I want to refactor my members list here I think that's also problematic here and I feel like I also have the settings for the workspace right so let's do the settings for the workspace first yeah it's it's also awfully slow on top of everything so I'm going to go ahead inser of source inside of my uh app folder Standalone workspaces workspace ID and I'm going to go inside settings page here and I will no longer use the initial values here so I will just remove them completely I will also remove the props from here no need for that I'll remove the interface there we go and I will copy this entire thing and I will create a client. DSX inside of my workspace ID settings I will mark this as use client and I will export con workspace ID settings client and I will just return this I will import the edit workspace form here and I will go back here and simply return the workspace ID settings client from do/ client and I can then remove the edit workspace here there we go now it will cause an error of course so we have to go inside of here and what we have to do is the same thing that we just did in the project settings so what I will do is I will just copy this entire thing here and then I will just you know replace the values as needed so I will add this instead of use project ID I'm going to call use workspace ID I'm going to go ahead and rename this workspace ID I will call this use get workspace and looks like we don't have use get workspace for the very same reason so let's go ahead and see whether we have to develop that so I'm just going to leave this like this so leave it broken let's go inside of our features workspaces so the API yeah we don't have use get individual workspace so let's go into the server route. TS and let's see uh do we even have it implemented here so this is my post method my patch method my delete method my post method my another post method but no uh get method here for the individual workspace ID let's go ahead and let's add it here regardless of if we're going to use uh server components or not it's good to have all API routes as well if if you for example want to have a mobile application right you can't use the queries for several components for that let's go ahead and let's extract the user from C.G user let's extract the databases from C.G databases and let's extract the workspace ID from C request peram and now let's get uh the member using a way to get member which we already have here great and we can pass in the databases we have the work space ID and user ID will simply be my user. dooll sign ID great if there is no member I'm going to return c. Json here with an error of unauthorized and a 401 status code and then I'm going to go ahead and simply get the workspace to be uh await databases doget document I will pass in the individual database ID and then the workspace says IDs and then finally my workspace ID here and I will return c. Json data workspace there we go that is our protected get workspace ID route we can now copy from our newly created projects API use get project and let's paste it inside of the workspaces API use get project let's rename it to use get workspace and let's rename this to use get workspace props let's change this to workspace ID this will be used get workspace let's change this let's change this let's call this workspace and workspace ID and let's change this to workspaces workspace ID and workspace ID failed to fetch workspace and that's it great we now have us get workspace and now let's go inside of the client and let's import us get workspace from uh features workspaces API use get workspace great you can see how we even see the things we forgot to implement once we get rid of the server components here so I'm glad we're doing this refactor let's go ahead and import the page loader let's import the page error here like this and now we are going to have the initial values here but it looks like uh what I don't do here is Define the work space type so let's see inside of my workspaces server when I call this workspace get document I don't Define the type of the document do I even have the type I do have the type excellent so we are going to append that type here workspace and I already have it imported here from do/ types and now my error is gone so I can now go ahead and refresh this and there we go so what I should be able to do now is the same thing here let me just go inside of edit workspace form and let's go inside of the on submit method let's find the onsubmit so we call form reset but no need for that because the values will be reset and it will just look like it wasn't saved so I will refresh this page now let's call this under workspace one to three let's save it and we got the ugly refresh because we forgot to update inside of our workspaces API use update workspace here uses router refresh we don't want that we don't like that so let's remove that here there we go let's try it again and let's hope for a smoother experience so 431 save changes there we go that is what I wanted to experience a nice smooth experience when updating uh my workspace and now I want to go ahead and do the same thing uh but for the members list and I think that that will be the last of my server components here so let's go ahead inside of source let's go inside of app folder Standalone workspaces let's go inside of workspace ID members we also have join okay so we're going to have to refactor that as well let's do members for now oh and this looks good so we use use get oh great so we are not not using anything inside of here perfect no need to refactor members then let's go inside of join what about here in here we do we're using get workspace info here so this is what we're going to do now uh well actually I don't think we have to refactor the workspace ID join page because this page will not be visited after someone updates right so that router refresh will not really affect it but still you know I just refactored the rest so I want to be consistent here let's do the following let's go inside of my features inside of my workspaces API use get work my apologies server route. DS and we're going to implement uh a pretty similar route so I will copy this route to get to workspace I will chain it and I will rename this workspace id/ info like this and for this one it doesn't matter if we are a member or not because we will simply be returning an ID let's give that a workspace ID name and I think also maybe an image workspace image URL so let me go ahead and collapse this and this like that so inside of my data object here so let's see is that all we need we can confirm that we're going inside of our workspaces queries so inside of here we have get workspace info oh so we only return name great okay so we definitely handle that so inside of the workspace ID join page here I'm going to remove the initial values entirely I will remove the params I will remove this I will remove get workspace info I don't need it don't want it and then I'm going to go inside uh and create a client. DSX let's mark it as use client let's export const what's the name of this workspace ID join client like this and I'm simply going to return this entire thing inside like this let's import the use join workspace form here like that and now we're going to get the initial values here so instead of this we can import workspace ID join client here and we can remove the the form import from here so again our pages are only responsible for redirecting stuff we are not going to handle them for initial values it just doesn't look like a nice experience so what I have to do now is go inside of my features workspaces API I going to copy use get workpace so individual one and rename this use get workspace info like this let's go ahead and rename this to use get workspace info use get workspace info and you just get workspace info props so this is workspace info workspace Das info here so workspaces ID info fail to fetch workspace info so we differentiate in our errors here great now we can go inside of our currently erroring client here and I'm just going to to give it the same treatment as I did with the rest of our Pages for example the settings client here so let's just copy all of these things here let's add it here use workspace ID instead of use get workspace it will be use get workspace info this is a page loader component and this is a page error component like this there we go so I think that this could be the last of our uh queries which we used for initial values here I think that now there we go this is a nicer experience now okay and what I'm interested in is where else do I use my queries so let's go inside of features let's go inside of workspaces and I have the queries here so let's see get workspace info should now no longer be used anywhere so I can remove get workspace info from here that's great and I will also remove the info props let's see uh get workspace also not used anywhere perfect so I will remove that entire thing and now we have the get workspaces and I think that this can stay the reason I'm okay with this stting is because it genuinely helps us right so inside of our dashboard here we use it to redirect to SLC create or slw workspaces so I'm okay with that because server components are perfect for redirection it's done on the server side so it's safe uh and it's also more pleasant to debug rather than having the use effect you know magic happening so I'm okay with that I will leave the query to be for that let's see do I have any more uh queries whoops my apologies I have accidentally closed in my visual studio code so let's search again for where queries. DS let's see do I use queries uh okay so we have get current here okay so out queries out queries out queries workspaces queries out queries out queries out queries perfect so I think that's all the place where we are using uh the queries so we are no longer using anything besides out queries which is completely fine so the only place where we are using workspaces queries is here to redirect that's perfectly fine so I think we successfully refactored all of that which means that we can find last places where we use router. refresh and remove all of these things I'm only okay with Ed login and use log out so and so only leave them for the AL apis but for deleting the project no need remove the router remove the router remove router refresh for deleting the task no need remove the router refresh remove this and remove this because we will not be using server components to load that data for use update task no need for router refresh no need for this no need for that for use reset invite code no need for this no need for this no need for any of that perfect so this should now be working here the only place where we are now using our workspaces is inside of where we are now using the queries you know the server component thing is inside of dashboard uh workspaces page right here there we go so we redirect to the correct workspace perfect so do we have any other queries no great now let's go ahead and let's just check out our experience now so for example now if I go inside of my tasks here let's say let's just wait for a second to uh for this to load and now if I go ahead and create a new task it should not cause any big you know refreshes on my screen here it should it should just simply add the task if I go and update it it should again not not cause any big refreshes there we go it just updates it's so smooth now if I delete the task again so smooth perfect if I add a new project it should just add there we go it creates a new project and redirects me here no huge refreshes nothing clunky perfect I absolutely love this and now what I'm going to do is go inside of source app folder here inside of dashboard and I will remove the error and the loading from here no need for it so remove the error and the loading here here and let's see inside of Standalone error loading remove it here as well out error loading remove it here as well so I should have only one error. DSX inside of my entire app and one loading. DSX inside of my app perfect so we just refactor our app to not rely on server components for data fetching except if we need uh redirects done and if you want to this loaders seem to be kind of high uh so if you want to resolve that you can go inside of page loader here and you can give them a height of screen like this and then they will be a bit more aligned I believe let's just wait so if I go inside of settings here yeah there we go now they're not you know jumping up and down they're a bit more consistent here so let's see if I go to the individual task details now let's see there we go this now looks just fine perfect and now none of this causes any big refreshes as you can see uh and oh yeah once we save this what we should do is we should change this to stop being is editing State let's quickly fix that before we close the chapter so go inside of task description component and inside of here after we save go ahead and add un success here and simply call that is editing to be false and then when you click save here there we go great great () job let's go ahead and let's wrap up the individual project ID Page by introducing analytics and once we get analytics we will be able to copy and paste that and wrap up the homepage so what I want to do is I want to go inside of my features and I want to go inside of projects API my apologies server route. TS and then what I'm going to do is simply at the end of all of my routes I'm going to get uh a get route right here and I will be loading slash project ID SL analytics let's add a session middleware here and let's add an asynchronous controller and and as always let's do our usual checks here so we are going to destructure uh the databases and the user here then let's get the project ID from C request params and now once we have that let's go ahead and let's fetch the project and I have to replace this with projects ID and then let's go ahead and let's get Our member and if we don't have the member let's throw back an error so next thing we have to do is we have to import all the necessary uh functions and utils from date FNS in order to do those analytics so let's import end of month start of month and sub months from date FNS and let's go ahead and let's start by defining uh my now right so cons now is new date after that let's append this month start which will be start of month now after that this month end which is start which is end of month now after that last month start so we can compare with previous data start of month sub months now end one and this will be last month end end of month sub months now and one like that so let me just double check whether this is okay there we go so double check that this uses the correct naming and the correct logic here now let's go ahead and let's load all tasks from this month so const this month tasks will be await databases. list documents database ID tasks ID and let's add a query equal we are only looking inside of this project ID then let's add query greater than equal dollar sign created at this month start to is so string and query less than equal created at this month start to ISO string so this is our query to get this month's task for this project inside of a range of this month and less than equal here should be this month end my apologies like this now we can copy this entire method here add it here and let's replace this with last month tasks like that and instead of using this month start we're going to be using last month start and this will be last month end so now we have this month's tasks and last month tasks and what we're now going to do is we're going to get the task count here so this month tasks. tootal and then let's get the task difference so we can display it on the front end the task difference is Task count minus last month tasks. total like that now let's go ahead and let's copy uh the this month tasks here and let's rename this variable to this month assigned tasks so we want to see which projects do we have assigned here so we're going to add another query equal here a ID to be member do dollar sign ID so now we have this month assigned tasks let's copy and paste it so we can create the last month assigned task so let's do last month assigned tasks and we are simply going to change this to be last month start and last month end there we go now that we have both of those we can go ahead and create the same total and difference here so let's go ahead and create a constant assigned task count to be this month assigned task so the first variable dot total and then let's go ahead and let's add an assigned task difference to be the assigned task count minus last month assigned tasks. total there we go so we now have that and what we have to do now is we have to add incomplete tasks so what I'm going to do is I'm going to copy both the thison assigned tasks and last month assigned tasks I'm going to copy them and add them here so what we're going to do is rename it to sorry this month this month incomplete tasks and what we're going to do is remove the assign ID and instead let's add query not equal status task status from features task types DOD so we are only quering those which don't have done status make sure you have added an import for this all right so that is it for this month incomplete tasks inside of this project ID here and then let's go ahead and let's copy uh this query here for last month incomplete task and replace the assign ID with that query here the rest can stay the same here uh so task status is not done that's great and now let's go ahead and let's do the same thing we always do so let's get the total and the count so incomplete task count is this month's incomplete tasks. total and incomplete task difference is incomplete task count minus last month's incomplete tasks total so we have both of these values here great and now let's go ahead and add uh the completed tasks in the same manner so I'm just going to copy uh well we can copy this as well so let's start from here and let's get these two there we go so we don't have to write it every time there we go and let me just indent all of them so instead of this month incomplete tasks these were these ones are going to be this month completed tasks which have an equal status of task status done and these are going to be last month completed tasks which are going to have equal status to done and then we can change this to completed task count to use this Mount completed tasks make sure you change that this Mount completed tasks and this here will be completed task difference and make sure it uses the last month completed tasks here and make sure it uses the completed task count here like this so double check since we copyed make sure you don't have accidentally incomplete somewhere here otherwise it's not going to work and one more we have to do and those are the overdue tasks so again I'm going to copy the difference the count last month and this month here let me copy that and let me add it here after this okay let's indent it so this will be this month overdue tasks and how we're going to check that is if query equal sorry query not equal so if they're not done and also what we have to do is if query do less than due date is now to ISO string so we have to add these two not if they're are not done and if due date is passed today great so we have that and that is this month overdue tasks let's copy these two and let's add them here and let's change this to last month overdue tasks now let's change this to be overdue task account and let's make sure we use this month overdue tasks here and let's change the this to be overdue task difference make sure it uses overdue task count and last month overdue tasks like this and now we can finally go ahead and return c. Json data task count and task difference assigned task count and assigned task difference we can then add completed task task count and completed task difference after that incomplete task count in complete that task difference overdo task count and overdo task difference so make sure you have all of those let me just double check there we go all of these are necessary great so we now have our analytics here to load and compare with the last month all kinds of various things so what we can do now is we can go ahead and create that API here let's go ahead and change use get project let's copy it use get project analytics use get project analytics props use get project analytics change the props here project- analytics and we are using project ID and then analy i.get and this will be failed to fetch project analytics everything else is the same great so we now have used get project analytics so we can now go inside of project ID so we have inside of our dashboard workspaces workspace ID project project ID page. TSX let's go instead of client. TSX and then in here I'm going to add uh my data and is loading for use get project analytics and pass in Project ID and I'm going to now remap those two so this will be project and this will be is loading project this will be analytics and this will be is loading analytics let's go ahead and unify const is loading will be is loading project or is loading analytics like this and in inside of here we are simply going to check for both if there is no project available or if there is no analytics we're going to return project not found and now instead of using data data data data and data so be careful to change all of this we're using project there we go so I can refresh now and this should be able to work just fine let's take a look uh there we go so if you want to uh you can be less strict with analytics in case analytics fall for example you can go ahead and not show the page error instead we will just not show the component for example that's an option for you uh great and I think I'm going to do it like that yeah it makes more sense okay if analytics fail no need to you know not be able to show the user the project page so what I want to do now is I want to create the analytics component so we're going to do that uh just before we render the task view switcher let's add the analytics and pass in the data as analytics like this and now we have to create the uh analytics component so we're going to do that in reusable components instead of source components let's create analytics. DS uh. DSX let's go ahead and let's create an interface analytics props and it's going to accept an optional data like this so we can you know simply return null if there are no analytics to be loaded and since we have to type strictly now everything that we just had inside of our uh where is it projects server so basically we have to strictly type inside of the props all of this so if you want to you can copy them from here and then just paste them here and give them all the following task count will be number task difference will be number project count will and project difference will be uh the optional things why because we're going to have uh analytics for the workspace ID as well but right now we are doing analytics for individual projects so we did we did not implement this so no worries if you don't have this just add it and make it optional whoops so project count and project difference is optional incomplete task count and incomplete task difference is also going to be optional then we have assigned task count assigned task difference completed task count completed task difference overdue task count and overdue task difference great now let's export const analytics let's assign analytics props and we can simply structure data from here and let's go ahead and let's do if there is no data let's return null and I just got an idea uh about how maybe we can improve this if we go instead of use get analytics use get project analytics I think that in here we could export type response type and make it infer response type from hono if you already wrote it I'm sorry but I think there is an easier solution type of client let's see client projects project ID analytics 200 I think that this might give me okay it does not give me oh because I also have to specify the method get so now response type here there we go we have the response type so maybe we can use this instead let's call this project analytics response type and Export it from your use get project analytics and then inside of your analytics. TSX you can use that instead uh so let's say it like this uh just a second I want to see exactly what type they are so they have the data okay we're going to go here and we're simply going to assign that project analytics response type from features projects use get API project analytics like this and then we're going to have to modify this because they're all we expect the data to always exist so okay let's do it like that and data here now you can see is typed exactly as we uh return it okay I think this is more type safe because you now cannot make mistakes uh great so we have the analytics now now let's go ahead and let's add a return here let's add a scroll area from do/ scroll area this is from shaten so if you don't have this uh make sure you do banex shaten uh 2.1.0 add scroll area let me just quickly show you again bx- bun shn 2.1.0 add scroll area like this or npx shat 2.1.0 add scroll area what matters is the version great so we have this and now let's go ahead and give this scroll area a class name of Border rounded large full width and wi space no wrap and Shrink zero and then let's go back inside of our client and let's import the analytics from components analytics so it's reusable let me just move that here there we go and we have to pass in the data analytics so what I'm going to do here is if there is no analytics I'm just going to go ahead only if there is analytics I'm going to render this so if there's analytics I'm going to go ahead and render analytics otherwise I'm going to render null okay that way we fixed the typo uh the lint error there and now inside of here we're going to add a div with a class name uh full width Plus and flex row and then I'm going to check if data project count okay we don't have the project count here so what we're going to do uh well let's just continue with what we have div with a class name Flex item Center and flex one and then inside of here we have to develop an analytics card so let's go ahead and do that inside of components here analytics card. TSX and let's go ahead and let's create an interface analytics card props will accept a title which is a string a value which is a number a variant of up or down meaning increase or decrease so you can call it like that if you want to and the increase value and let's export const analytics card let's go ahead and let's destructure all the props that we need and let's assign the analytics card props here there we go and for now let's just return div analytics card let's go inside of the analytics and let's import analytics card from do/ analytics card and let's go ahead and let's give it uh a title total tasks let's give it uh a value data task count let's give it a variant if data task difference is large than zero it's going to be up otherwise it's going to be down uh data task difference uh why is that not working oh like this and increase in value will be data task difference there we go so we now have this and let's go inside of the analytics card and let's actually make this look cool so let's go ahead and import everything we need here so so from react icons slfa import fa carat down and Fa carat up from at Li utils import CN and from components UI card import card card header card description and card title and now let's go ahead and let's actually develop this so first of all I'm going to add some constants here icon color if variant is up we're going to do text Emerald 500 otherwise text red 500 then I'm going to do increase value color if variant is up in that case it's going to be text Emerald 500 otherwise text red 500 so pretty much the same as above perhaps we can even reuse this constant and let's do const icon with a capital I so we can use it as jsx if variant is up in that case we're going to use fa carat up otherwise fa carat down uh great so we have this for the icon now let's replace both of this with card class name Shadow none border none and full width inside of here I'm going to add a card header component and a div with a class name Flex item Center Gap x2.5 inside let's add a card description component let's give it a class name of flex items Center Gap X2 font medium and overflow hidden inside of the card description let's go ahead and let's add a span element with title inside and let's give it a class name of truncate text base like this out side of the C description let's add a div with a class name Flex items Center and GAP X of one and let's go ahead and let's render our icon component with a class name CN icon color and size four below that let's enter a span element which will render the increase value and let's give it a class name of CN CN increase value color and truncate text base and font medium and then let's go ahead and let's go here and add a card title and simply render the value inside and let's give it a class name of 3 Excel and font semibold and there we go you can see that now we have total tasks increase of one in uh in comparison to last month and the total tasks standing here right so this is only in this project if I go to Project one let's see I don't think I have any tasks here project zero and zero is considered negative uh I'm going to leave it at that great now let's go back to the project ID page specifically in the analytics here and let's create the analytics for everything else we need so we're going to copy this two and let's uh paste them so I didn't include this instead of the analytics card so it can be used Standalone somewhere if you want to but we need this wrapper around each of our analytics card for this analytics component here so it's scrollable on mobile so my next analytics card will include assigned tasks and it will use the assigned task count it will use the assigned task difference and data assigned task difference so so now I have my assigned tasks here great let's go ahead and let's copy and paste this uh so the next one here will be my completed tasks so completed tasks I'm going to use my completed task count right here and completed task difference right here and completed task difference here like this uh and what I'm forgetting to add in each of this is a separator and we're can leverage our dotted separator because we've made it so that it can be vertical as well so let me just import from my components here doed separator from do/ doed separator so I'm just going to go ahead and move it here and I'm going to add it at the end of each analytics card so dotted separator with a direction vertical like this and here and here there we go so you can see how nice our an analytics are now separated great let's go ahead and let's copy and paste this one and besides the completed tasks uh we are also going to have overdue tasks so overdue tasks let's go ahead and let's give this the overdue task count the overdue task difference and overdue task difference here as well there we go so total tasks assigned task completed tasks and overdue tasks we also have the incomplete tasks so let's go ahead and add that as well I'm going to add that as the last one here so this will be incomplete tasks so data incomplete task count incomplete task difference and incomplete task difference here there we go just like that uh and you can see how on mobile this uh well this is supposed to scroll but it's not scrolling okay let's fix um that so my scroll area should definitely uh make this scrollable so what I'm going to do is I'm just going to pause and play around and see why it's not working what is wrong is that we are missing uh one more component from scroll area and that is scroll bar and we have to add it right here scroll bar like like this and let's give it an orientation or vertical by apologies horizontal and now this should be scrollable there we go so we can now add as many uh of these projects as you want and when they become too large here you can see how they have a nice scrollable effect here and this is especially visible on mobile if you think this is too much uh tasks you can go ahead you know and remove one analytics card if you don't need it great so we've wrapped up our project ID page so what we're going to do next is we're going to do the same on the homepage here so we're going to load some information about the current workspace ID uh and we're going to extend this analytics because inside of our workspace we can have some analytics which projects don't have so we're going to have to make this be modular and we're going to have to combine two different response types so we're going to see how we're going to play around with that or maybe to keep it simple we can just use the same analytics from both of these nevertheless uh great great job let's go ahead and let's implement () the workspace analytics we can do that quite easily by first going inside of features projects and simply copying our recently created project ID analytics so let's go ahead and let's copy this into entire thing all the way to the end and let's go inside of our workspaces server route. DS and I'm going to go ahead and simply go all the way to the end of my router here and I will chain that route we're now going to fix all of these errors so let's start by renaming this to workspace ID and then fixing the D structuring of the Pam we don't need to load the project because we directly have works this ID to get the member here then let's go ahead and let's import everything we need from our date FNS here so let me simply add that here then let's import tasks ID from config and let's also import task status from features task types so this is what I added features task types and I have added tasks ID from config here and then go ahead and find every query which does query. equal project ID project ID like this and you're going to have to modify it right so you can see how many of them there are here and what you can do is you can do find and you can replace it with query equal workspace ID and use the workspace ID here like like this so just make sure that you didn't accidentally search for the one with the comma because you're then going to have to add commas everywhere and click replace all and there we go so you can see how now all of my queries here are looking for workspace ID instead of project ID so I no longer use project ID anywhere I use workspace ID in place of that and that's it that's our route for analytics instead of workspaces now let me close all of this and let's go instead of projects API use get project analytics let's go inside of workspaces and paste that let's go ahead and let's rename this to use get workspace analytics let's rename this to use get uh workspace analytics change the prop to be workspace ID change the infer response type to go to workspaces and use the individual workspace ID here analytics everything else can stay the same use the work space ID change this to workspace analytics for this workspace ID change this to be workspaces workspace ID and workspace ID pm and finally failed to fetch workspace analytics there we go that's our us gate workspace that's our us get workspace analytics hook now let's go inside of source app folder dashboard workspaces workspace ID page and inside of here let's return workspace ID clent client which doesn't exist yet so we're going to create it in a second so inside of this let's create a client. TSX let's mark it as use client let's export con workspace ID client and let's return a div here let's go back inside of page. DSX and let's import this from do/ client now we will continue developing inside of the workspace ID client I'm going to start by adding workspace ID from use workspace ID here and then I'm going to add use uh I'm going to add use get worksspace analytics and pass in my workspace ID here from here I can D structure the data and remap it to analytics and I can the structure is loading and remap that to is loading analytics I'm going to copy this a few times and for the second one I'm going to go use get tasks so make sure you've added an import for that then I'm going to do use get projects so make sure you have added this use get projects and use get members so make sure you have added all of those I like to order them by length like that I'm going to remap the ones for use get tasks to be tasks and is loading tasks then we have projects and is loading projects and finally we have members and is loading members now let's go ahead and let's D structure use create project model and let's get use create task model so make sure you have added uh those so this is my project model and this is my task model Imports make sure you have both of them here we're going to the structure open from both of them and since they are named the same let's remap them to create project and let's get this one open and let's remap it to create task then let's go ahead and let's create a unified is loading like this to use is loading analytics is loading tasks is loading projects or is loading members so if any of that is true we're going to go ahead and do the following if is loading we will return the page loader component and you can get it from components page loader let me just separate it from the rest there we go otherwise if there are no analytics no tasks or no projects or no members you can go ahead and return a page error here with a message fail to load workspace data and make sure you have imported the page error from components page error like this and then finally we can start developing this page so give it a full height Flex Flex columns space y4 let's go ahead and add analytics component we can that that get that from components analytics here and let's simply pass in the data to be analytics and now if you take a look you can see that I have two tasks here but inside of my individual uh projects I have only uh one task for this project right and here we have a little bug these tasks load all projects so that's a bit of a mistake but you can see how I have one task per project so the analytics in individual projects say you only have one task here but when you go to homepage you have two tasks because we are analyzing on a workspace level great so after the analytics let's go ahead and let's define a grid here with a class name grid grid columns one Excel grid columns 2 and GAP four now I'm going to go ahead and do the following so I'm going to create new components inside of here let's go ahead and let's export const task list here and let's go ahead and let's accept uh tasks here uh my apologies this is what I wanted to do so we will accept tasks which will be task list props so interface task list props let's go ahead and let's create uh the task Tas here to be a type of task and an array like this so task list props uh we have imported task here from features task types like this let's go ahead and return this and inside of here we're going to go ahead and return a div with a class name Flex Flex column Gap y4 and call span one and we're going to say tasks now let's copy the task list and let's render it inside of here there we go so now you should see the test uh tasks here and let's pass in the tasks or we can just make this be data like this data here and then inside of here we pass data which will be tasks. documents like this uh actually let's pass uh the we also need the total here so let's pass tasks. total like this so total will be a number there we go so I want to separate this into components so it's easier to develop great so we have data which we can iterate over and we have total here perfect so let's go ahead and do the following I'm going to go ahead and create a div here for this task list and give it a class name of background muted rounded large and padding of four then inside of here I'm going to create a new div which will encapsulate my title and my new uh task button so let's give it a flex item Center and justify between and now let's go ahead inside of here and let's add a paragraph tasks and then inside let's do total let's give this div a paragraph paragraph a class name of text large and font semi bold and then let's go ahead and let's add a button from components UI button with a variant of muted and let's go ahead and give it a size of Icon and let's give it an [Music] onclick uh and in here what we need to do uh well we can do that here yeah we can just move this create task model here inside of the task list component because we are not going to need it anywhere else so yeah we can do that here and then simply add the create task here there we go so you can then remove it from the main component the workspace ID client great and inside of here we're going to add a pens a plus icon from Lucid react and let's give it a class name of size 4 and text neutral 400 there we go so now this tasks should open open a new create a new task great so it works fine now we have to iterate over our tasks and render them so after this div encapsulating the title and new button let's add a dotted separator component and let's give it a class name of my4 so just you know be careful make sure you're importing these things right I have added like Luci react here I have added components dotted separator and okay while we are here how about we add all inputs which we are going to need so from mered react we're going to need calendar icon and settings icon alongside the plus icon from date FNS we're going to need the format distance to now and we're going to need to import the link from next SL link and we're alongside this buttons here we are also going to need the card and card content from components UI card and that's all the Imports we're going to need so now let's go back uh to our dotted separator here let's create an unordered list here with a class name Flex Flex column and GAP y of four like this and then we can iterate over the data here so we will do data. map get the individual task and inside of here let's add a list element with a key task ID and then let's add a link to be HRA slash workspaces then we have to add a workspace ID which right now doesn't exist so we're going to add it in a second slash tasks and then slash task. dooll sign ID so we need to get the workspace ID inside of the task list component here and we can use this from here we already have the import so why not use it there we go workspace ID and inside of here let's go ahead and let's add a card component let's give it a class name of of Shadow none rounded large hover opacity 75 and transition like this let's add card content here let's give it a class name of padding four then let's add a paragraph task. name here let's give it a class name of text large font medium and truncate after the task name let's add a div with the class name name Plex item Center and GAP X of two inside of here let's add a paragraph which will render task. project. name and let's go ahead and put an next a question mark here in case uh we are unable to load the project like this and then let's add a div here with a class name uh this will be actually a self closing div so let's do that like this it will have a size of one rounded full and BG neutral 300 so it's like a little separator and then we're going to have a div which is going to render two items so let's give it a text small text muted foreground FX and items Center let's render a calendar icon which we have an import for let's give it a class name of size three and Mr of one let's add a span element here whoops so span element which will use format distance to Now new date task due date which is a string and let's give the span here a class name of size three and Mr of one my apologies truncate that's what we need to add here uh great now outside of the uh but outside of this iteration but still inside of the unordered list component let's add the special list item which will be no tasks found and let's go ahead and give this a class name of text small text muted foreground text Center like this so right now this is visible and we're now going to hide it and only show it if this list item is the only list item inside of the unordered list here and we can do that quite easily by simply doing first of type block so it's only going to be visible if it's the first in the array so if I change this to an empty array you can see it says no tasks found but if there is data here then uh data will be shown here great so now let's go outside of the unordered list and let's add a button and let's say show all let's give it a variant of muted uh let's give it a class name of margin top four and full width and then let's add a link let's make an H rep go to whoa slash workspaces workspace ID and then all tasks and let's give this an as child prop so now this button will simply redirect the user to the tasks page great okay and that's it for our task list component so what I want to do now uh is well let's set separate this component how about that I'm going to do that here actually I think it's fine to keep it inside of one page I don't think it will cause any harm but let's copy it and let's paste it here and let's rename this to project list and this will be project list props and let's change this to project list props the data here will be uh project right from I have to import project type from feature project project types so let's add it here there we go and we are going to use the settings icon later great so we have the project list props and now let's go ahead into our main uh workspace ID client here and below the task list let's add the project list with data projects documents and total projects total there we go uh all right so we have a mistake here because you can see that our uh projects here use get projects which are API projects. getet so let's go inside of features projects server route and let's find our get here and probably when we do list documents we didn't Define the type so now let's add the project type inside of list documents here and now you can see that we are no longer going to have the issue here with passing those documents previously we had an error because the documents didn't match our data which we have defined here in the project list great so now inside of here we have a project so what we are going to do inside of here is the following we're going to change this to be projects we're going to change this to use create project we don't have this yet and we have a typo so create project and we can simply uh use this one from our main workspace ID client let's remove the use create project model and let's add it here inside of our new component instead of the use create task model there we go so now it's used here so projects total then we will be working with the individual project here so project ID this will be projects and then project. ID then inside of here we will change this to have a project name and then we can well how about we clear everything inside of the card content now and refresh now we should get rid of any errors here let's there we go so now we have projects here great so what I want to do now is uh modify this to show the projects so uh let's go ahead and modify the card content alongside having padding four let's give it a flex items Center and GAP x 2.5 like this uh inside of the card content we're going to have project Avatar so make sure you have imported project avatar from features components project Avatar let's go down here and let's give this component a name project. name image Project image URL let's give it a class name of size 12 let's give it a fullback class name of text large like this and besides that let's give it a paragraph project. name with a class name name text large font medium and truncate there we go so now we have a list of our uh projects here so the only thing uh that I would like to change is the following so my unordered list will no longer be Flex instead it's going to be grid grid columns one and on LG grid columns 2 and GAP four so now on large devices this is how going to look like great and let's go ahead and change the following I want to change this one to be so instead of project list let's change this div to from background muted to background white and let's give it a border like this there we go so a little bit of differentiation here and let's go ahead and change this plus icon button to have a variant of secondary like this there we go and and no need to for the show all button here so let's remove the show all button there we go so now the button here should be removed let's just wait a second for this to load and one thing left to develop here which is the members list so let's go ahead and let's copy this entire thing and let's add it here so this will be now members list the data will be individual member which I'm pretty sure we don't have so how about we go and develop it so it's going to be quite simple inside of features let's go inside of members inside of types and let's export type member and let's give it a workspace ID which is a string a user ID which is a string and a role which is a member role like this and then we can go inside of here and we can assign the member from where where did he here so features members types like this and now we also have to go inside of our features members server route. DS and find the get route and here when we list the documents let's go ahead and do members from dot do/ types uh but do we have any problems some member here type member oh yeah we forgot to do uh let's go how do I do it in projects for example the type here extends models. document so that's what I forgot to do so it will be models. document and our extension like this there we go so now the route for my members should work just fine there we go so make sure you've added it into your get route here onto the list documents you have given it a type which it will return great so now inside of the client here we have defined the members list to accept data which is a type of member great we don't need use create project model like that we will need workspace ID let's call this members and it this button right here will have the settings icon and this link will have an hre to go to slash workspaces workspace ID slash members like this and we're going to give this button an as child prop here there we go uh all right and let's go ahead and uh modify this slightly here so we're going to modify the UL it's going to be a grid again grid calls one on large grid on SM it's going to be grid calls two and on large it will be grid calls three like this then inside of here it's not going to have any link so we can remove the link here uh the card content here uh will be a little bit different so we are going to remove from the card itself hover and transition and let's give it overflow hidden and for the card content let's put the padding three Flex Flex column item Center and GAP X of two instead of rendering the project Avatar we'll be rendering the member Avatar component uh and let's just give it the class name of size 12 here and the name of well what will be member right so member. ID member. name and then we're going to have uh two uh we can add a div here around this paragraph because we're going to render the email as well so this div here will be Flex Flex column item Center and overflow hidden the first paragraph here will have a text of large font medium and line clamp one and render a member name and then below it we're going to have a text small and instead of font medium we're going to remove that and add text muted foreground and give this a member email like this and this will say no members pound like that and let's also fix inside of our project list here to also use no projects found like this and now let's go ahead and let's finally render this as well so we're going to add our members list here data will be members documents and total will be members total there we we go so now there we go we have our members list right here and going I click here it will redirect me to my uh members list perfect so when you click here you can create new project when you click here you can create a new task amazing uh so what's left to do now is to go through the project and you know fix some bugs perhaps fix some types which we have we're going to run a few commands to see about that uh and anything else we found that is missing or buggy uh nevertheless you pretty much finished the entire project at this point so uh props to that and as always amazing () job now let's go ahead and let's fix some leftover mistakes so first thing I can remember is that when I select a specific project ID page here I'm still loading all tasks regardless of the project so let's see how we can resolve that I'm going to go inside of source inside of my app folder dashboard workspaces projects project ID client and inside of here I render the task view switcher so let's see I'm using the project ID from the task filters but since there is no uh filter assigned in the URL I don't send that so how about we try and do this how about alongside my workspace ID I also get the project ID here and let's call this default project ID use or maybe param project ID so use project ID here and import this from features projects hooks use project ID there we go and I'm going to try to do this so the project ID will be either Pam project ID or my project ID uh let's add a comma here which comes from the filters here so let's try this now and see there we go so now when I click on test for example it should only load those in test which are none if I click on Project one it should only load the tasks which are inside of project one if I click on Antonio only those in Antonio if I click on my tasks it should load both of them except if I add for example test or Antonio project or project one and if I select all everything is good there we go so we useed the inside of the task switcher component to resolve that issue another issue that I can see here is that my navigation has a static text here so how about I change this depending on what I go to so let's go ahead and close everything and let's go inside of source components and let's go inside of my navbar component here so in here I have this static text right here so how about I go ahead and I create uh a con path name map which will have tasks and in that casee it the title here will be my tasks and the description here can be for example view all of your tasks here like this and then I can have project and this will be title actually this will be projects so Title Here will be my project description here will be uh view tasks of your project here and now let's go ahead and let's mark this entire thing as use client let's import use path name from next navigation and let's define default map here simply to be title of home and the description of what it already is here monitor all of your tasks and projects here so description will be this and then inside of here we're going to get the path name from use path name and then let's get the path name parts by using path name split by forward slash because our URL is currently slw workspaceworkspace idid and then for example tasks or maybe it's projects SL project ID right so that's why we're going to have to focus on a specific path name key so path name key will be path name Parts Third in the array as key of type of path name map and then finally we can do path name map using the path name key or if we cannot find it we will simply default to default map and inside of here we can now destructure the title and description so we can simply replace this with the title and we can replace this with description there we go so I think that now already if I'm on Project it says my project if I click on my tasks it says my tasks and if I click on home it says home great so that's two bugs resolved now what I want to see is in my terminal I will shut down my app what happens if we do Bun Run build so want to see whether I have any outstanding errors that I will have to fix before my production build this will more most likely be some missing types and maybe some lint errors there we go so this will now tell us everything that we need to fix okay let's go ahead and let's go inside of API rout route. DS so that is located here Source API API rout route. DS so routes is assigned a value but only used as a type okay well that's interesting const routes so how exactly do I fix that these are this is the new rule set from nextjs but I honestly don't really understand how they want me to fix it okay I'm just going to disable this Asin disable next line typescript no unused vs for this line because this is completely fine if you ask me I'm not sure what kind of lint rule is that uh then we have features out server route. DS so let's go ahead go inside of features out server. CS we have import Zod we are not using it great then we have edit project form so let's search for edit project form inside of here looks like we have is deleting project which is assigned the value but it's never used so let's see where do we use delete project where do we use handle delete here on the delete project so I'm just going to add is deleting project here so we are using it somewhere and we also have a toast from soner which we're never using so let's remove that and let's remove the copy icon from Lucid react if we are not using it as well okay that's it for edit project form then we have the create task form so create task form in here we have an error I have assigned the router but I have not using it so let me remove that and let me remove the import for the router I assume there there we go that resolves that then we have the data table component so data table component I don't know if you will have this error but I have removed my search so I don't need this input so if you have no errors here that's completely fine no need to do anything then that's it and then edit task form so edit task form here is telling me that I have a workspace ID and the router that I'm not using so I have removed that and now I'm removing the Imports for that as well there there we go and then I have event card here so let's go inside of event card and let's go ahead okay so as say KN is unexpected any well I think that now we can actually use the member from features members types let me just go ahead and move it here let me move react from react here while I'm already doing this and where do I use the event card let's see so my event card I believe is used in my data calendar component so now that I have modified this as I need to be the member from features members types which we have created recently let me see if my data calendar is working properly or is it having any issues here so as here looks like it's working just fine no errors in the data calendar here at least what I can see great so now let's go in setad of tasks types. DS so tasks types. TS projects we don't need it let's remove move it uh then we have app. DS storage is defined but never used so app. DS we have storage looks like we don't need to use it here uh really we don't we never use storage I guess we uh session middleware session middleware uses storage okay I just wanted to confirm okay so I resolved everything that says here let's go ahead let's do Bun Run build again and let's see if I still have some outstanding errors to fix or will this successfully build okay I still have some errors here uh so task server route. TS let's try that so tasks server inside of my source features tasks server route. DS inside of my bulk update is it the bulk update Route yes workspace ID here is string or undefined okay so I'm going to do if there is no workspace ID I will return c. Json with an error here workspace ID is required and 400 okay let's do Bun Run build again basically I'm just doing this until I can see my build uh passing because other if this doesn't pass we won't be able to uh we won't be able to deploy anywhere and there we go now there are no errors so what I'm going to do is just bun uh no sorry I'm going to do RM rf. nextt like this because uh once you build your project it can cause errors uh if you do Bun Run Dev uh without deleting the next file first great so let me just confirm that everything is still working just fine inside of my project here great so we just fixed outstanding box great great () job now let's go ahead and let's Implement o out logins so let's go ahead and let's go inside of our app right console here go inside of out and go inside of settings and I have already played around with this so go ahead and find the GitHub oth provider it should be down here somewhere if it's not enabled and yours will probably be disabled and it will be completely empty like this besides the URI which is as you can see filled here so now what you have to do is first of all click enable go inside of your GitHub here and you have to go inside of your settings go inside of developer settings and go inside of oal apps and inside create a new oal app I'm going to call this app right test my homepage URL here will be Local Host 3000 and what matters is the authoriz iation callback URL which you get from here this is your authorization callback URL so copy that and paste it here and click register application and then you're going to have your client ID here so go ahead and add that to app ID and click on generate a new secret to get the secret and copy it from here and let's go ahead and add it to the app secret and click update so now I'm going to go ahead and follow the documentation here so I went into into SSR login tutorials nextjs and then number seven oou authentication with SSR so let's start with creating This Server action so if you want to for a challenge you can refactor this to hono I'm now just going to follow this exactly as they have made it you can definitely do it with hono as well so we're now going to go ahead inside and create the .js here so go inside of lib and let's create oou in our case .ts and let's create This Server action so we have to change this it's not uh from lib server our app right is directly in lib so it's right here there we go our create session client and our create admin clients are right here everything else here can stay the same like this and now let's go ahead and let's skip the O form we're going to come to that in a second let's go inside of and create an oou call back so we're going to do it exactly where they tell us to do it and basically this is where your route will be you can change this if you want it to be somewhere else so I'm going to go ahead and do this I will go inside of my app folder and I will simply create a new folder oal because remember oh yeah mine already exists because I just tried this a second ago so create a new folder called o out and it's simply inside route TS and paste everything inside so change or fix this uh fix this import here make the request be a type of next request which you can import from next server and then we have this error here so let's just do if there is no user ID let's go ahead and let's return next response error like this and the same thing if there is no secret so like this or I think the proper way is to throw new next response and then simply say missing builds and then add a status of 400 can we do that there we go great so we can do that here uh and now this will redirect you back to you know wherever you want so I'm going to choose you know just my forward slash which is basically my workspaces right and I will change this to my Al cookie from features Al constants like this so let me just change this Imports here there we go let me remove the comment which is falsy I also have a comment here that's also falsy this use server is required because this is a server action okay uh we have this we have this everything here seems just fine I'm just unsure about this so SL o out here okay that's good but I'm not sure what the second one does let's see if they have an explanation here the O provider redirects the user back to SL o throughoute I'm just not sure what is the slash sign up I don't have that route so mine is slash sign- up so I think I have to modify it to that because inside of my out I have sign up so perhaps that's the route and I have all out which is my uh well now it became a route here so now we have to use this sign up with GitHub inside of our cards so let's go inside of sign in card right here and let's go ahead and let's import this so I'm just going to add it here import sign up with GitHub from slib o and what you have to do is simply find your login with GitHub and just just simply pass it here that's it just ensure that it has the used server here and I think that this should already be working so I will now refresh this and I will click login with GitHub and looks like I have an error uh okay a few classes or prototypes are not supported okay so let's see what did I mess up here okay I think we have to first wrap it like this let's try like that there we go now it works and then let's click authorize and this should redirect me there we go uh back to my page right here perfect and I can now create new workspace uh I believe there is one issue we have though and that is that um this user that was just registered here uh inside of my let's go inside of users here you can see it doesn't have a name that's the problem it only has an email so the all out from app right doesn't assign them uh any names so uh what we're going to have to do and let's see why exactly is this not working okay so user with the requested ID could not be found yes so there is there are some issues here uh but let's see again what's going on user with the requested ID could not be found okay I think the reason this is happening to me is because I previously created this very same user and I have a member with their email so I think for you this might work just fine but for me it seems to having an error so I'm going to go instead of members and I will simply delete all members here I'm going to go inside of tasks I will remove all tasks here I'm going to go inside of projects I will remove all projects here and I'm going to go inside of workspaces and I will remove all workspaces here so let's go here and let me go back to my local host 3000 and now there we go test workspace let's see if this will work now there we go now it works but as you can see we have a problem because if I were to create a new project so test project and now if I were to create a new task here you can see that in my assay KN I cannot see the name of this user so what we can technically do here uh let's see inside of O out there's nothing much I think we can do here really in create all to token Scopes yeah it doesn't really give us any options you know to assign a usern name here how about inside of app or out route create cre session uh it does not allow me to pass the name if it allowed me to pass the name that would be cool so what we would do here is I suggest you search for user.name and find all the places where you do that so for example instead of source features members server we do user.name how about we do user.name or user. email so we will use email as the name if it doesn't exist and let's do the same thing instead of source features tasks server so I'm going to go ahead and do user. email because email is something we are always going to have in one more place here in the S so user. email and let's see does that maybe improve uh developer user experience here there we go yeah so now we can work with emails so looks like that's how you can Implement that perfect and I will create this let's create task and let's see there we go perfect so this seems to work just fine amazing and on my homepage here I should now be able to see my name there we go yeah not exactly perfect but this is you know a challenge for you how to how you would handle this all out users let's say uh great and instead of members we have them here as well perfect nothing is crashing that's important we didn't do anything that crashes the app great uh and now uh what we are going to do next is well deploy this if you want to you can follow the exact same instructions to add login with Google uh so you just have to obtain the uh client ID and the server uh and you have to go inside of your app right inside of your let's go here out inside of settings and simply go ahead and find Google and enable it so let's find it here you have to add the app ID and the app secret so since you already did GitHub let me show you how to do Google in case um you haven't done it yet so type in Google Cloud console and click on the first link so CL console. cloud.google.com let's go ahead and let's create a new project here I'm going to call this jir clone and I will click create let's wait till the jir Clone project here is created so let's just wait a second click select project confirm that you're inside of Joc clone and search for apis click on apis and services here and then go inside of oou consent screen let's close this click external create close this give your app a name jir clone select an email you can skip all of this here and now the authorized domains here let's go ahead and see can we add Local Host 3000 or not can I add HTTP here must not specify scheme okay looks like I cannot add this okay but let's see should I maybe add this okay create all through client ID with web application as the application type and then add this looks like we don't have to add this anywhere but the redirect URI so I'm going to go back inside of my cloud console here and I will simply add my tutorial mailing gmail.com email here let's click save and continue hopefully this will be enough for the O consent screen click save and continue and save and continue There we go and then go inside of credentials create credentials or off client ID select web application for the type and go ahead and paste the the authorized redirect URLs which we just got from here so copy this and put it here and this one will be HTTP Local Host 3000 oops yeah make sure you have Local Host 3000 set here so let's see if this will be enough now there we go I have the client ID so let me go ahead and add it here and I should have the client secret now here so let's add that here and click update there we go now I should have my Google authentication I just didn't enable it so click enable and update again there we go we now have Google enabled and now let's go ahead and let's go inside of O and let's copy this thing sign up with Google and let's go ahead and change this to use o out provider Google and hopefully the instructions will be exactly the same now let's go back inside the signin card here and I will just copy this and I will just add it here sign up with Google so make sure you have added an import from for this and let's see if this will work now so I will log out I will go inside of my application I'll remove this user because I have only one email here both for GitHub and Google are the same I will go inside of my databases I will go inside of my tasks I will remove my tasks I will go inside of my projects I will remove my projects I will go inside of members and I will remove my members and I will go inside of workspaces and I will remove my workspaces so let's try this out now I'm going to refresh this and I'm trying this on the signin card so let's see login with Google looks like this is working just fine let's confirm and and Let's cross our fingers and there we go we are logged in and looks like I actually have my name here uh this is actually the name I put in so it actually does read the name from some o out providers that's interesting great so that's how we can Implement o out login uh just go ahead and also add this to your sign up card here so let me add these two Imports and and let me go inside of my signin card sign up with GitHub so let me use that here so let me find the button okay copy this and add it here as well except this will be Google there we go so now hopefully if I log out from here and if I try and click from either if I click from sign up or sign in it should be exactly the same I don't think there should be any difference yeah so it will either create an account or simply allow me to log in there we go so we now have all out here as well and since we just added a new feature how about we go and shut down our app and simply try B run build again just to see if this new scripts cause any errors so we can immediately fix them before we deploy our application there we go looks like no errors here linting went successful great amazing amazing job you just added all the features we said we are going to create and now all that's left is to deploy in order to deploy we first have to push this project onto GitHub so I'm () going to call this next4 jira clone I will make this repository private and I will click create repository since this is an existing repository I'm going to copy these three lines right here ensure that you have done get add and get commit for example deployment like this so I have nothing to commit so I'm getting an error here if you have nothing to commit you can go ahead and simply run copy this three lines here so let's push that now when I refresh here I should have my project running here great so now let's go to verell and let's create a new project and there we go here is my project project I will click import here let's go ahead inside of environment variables here and let's assign everything we have in our environment. loal here so I will just copy everything here and I'm going to go ahead and paste everything inside like this and now what I'm going to do is I'm going to click deploy let's hope that's the only thing we have to do so um since we tested build locally it should work just fine but you know you never know so I'm going to pause the screen and unpause when it's finished and there we go looks like my project was successfully deployed so I'm going to go ahead and click continue to dashboard here and let's go ahead and look at my next1 14 jro clone and here's an important thing to know this is your domain the shorter URL not the longer URL so always use this URL when trying things so I am now back I'm now on that URL right here so next1 14 Joc clone let me go ahead and enable developer mode for you so you can see there we go and while I'm sure that some things will work here there are some things we definitely have to change before we can continue doing anything what's important is that you obtain this URL and now you have to go back here before you can try anything and go ins setad of settings environment variables and find the next public app URL this is the one we have to modify otherwise our API will not work at all and you have to paste your deployment app so I copied it from the sign in so I will now remove it there we go like this no forward slash nothing and click save and now you have to redeploy so go inside of deployments here select the last one and click redeploy like this and while you are doing this go ahead and modify uh some of your all out providers here so you can go back to the cloud console here go instead of credentials here web client one and let's see what we can modify for example we allow HTTP Local Host but let's also add this one so let's click save so this our cell URL should also be able to trigger this credential login let's go instead of all off consent screen here let's click edit app and there we go so authorized domain has already been added here perfect we don't have to do anything and now we have to do the same thing here inside of our GitHub o let's go ahead and change the homepage URL to be this and click update application and now both of those should work uh here so let me just quickly check uh is my building finished it's still not finished so I'm going to pause the screen and see uh when it finishes and there we go looks like it is successfully deployed so how about we go and try our app again I'm going to refresh here and I will now try loging with Google purposely I want to see if that's working now or not so once I clicked on login with Google I got this app exception invalid redirect right here and I kind of think I know why this is happening let's go inside of source in inside of uh let's see inside I think it's inside of my lib or out here it's using origin I'm not sure if I should be using this I think that we should be using process. environment next public app basically our Local Host 3000 here or when we deploy uh the actual app that we have added so I will comment this out for now and make it work like this and let me just check inside of my app or out here do I use any origin here I don't next well what I can do is also you know hardcoded here let's do that process. environment next public app like this how about we hardcode it like that so so we don't go away from our application let's see if that will work so what I'm going to do is I'm going to get add get commit fix out in prod and do get push and what this will do is it will automatically trigger another deployment here so if you go inside of your project here deployments there we go another building deployment let's try that out all right so after some debugging I have found our issue first thing you have to do is revert the change we just added so don't uncomment this and bring back the origin here this is inside of your lib or out so both for sign up with Google use the origin from headers like this so exactly as we did the first time no changes needed for the route same thing bring back request next url. origin after you have made those changes go ahead and get add get commit I did reverse changes and then get push like this and this will re-trigger another deployment and once you do that it will still not work you can see I'm clicking here and what's happening is I'm getting some errors in my versel logs what you have to do is you have to go back inside of your app right console here you have to go down in the Integrations click on platforms click add platform web app select production for the name and select Asterix dovel doapp and click next and you can click skip optional steps and now you have the production which allows versell and if you try now on your production URL to log in with Google for example there we go no more errors and I am redirected here and I have my name perfect and if I for example log out and if I try log in with go with GitHub here same thing will happen but uh well interestingly it connected the accounts right so my Google account now became my GitHub account that's interesting uh great so you have successfully deployed fix all the bugs and have a working application thank you so much for watching this very long tutorial and see you in the next one before wrapping up one thing we () should take care of is proper invalidation of our analytics because right now if I were to let's say create a new project so this is a new account that I have set up if you have an existing project that is fine but right now what happens if I go ahead and I create a random task here let's just wait a second what happens is that my analytics is not updated immediately and same is true for my workspace analytics as you can see it does get uh updated because this is the first time it was fetched for me but uh back on my project ID page it doesn't get reinv validated so let's go ahead and do the following let's go inside of source let's go inside of our features specifically in the tasks API folders and what I want to do is for every bulk update every create every delete and every individual update I want to reinv validate two queries so let's pick a random one for example example use update task besides reinv validating the tasks and task I also want to reinv validate the product analytics and the workspace analytics I will just double check that these actually exist so let me just check inside of uh my get product uh my apologies not product it's project yes that's why it's not appearing anywhere so let me double check there we go I have that query key right here and for the workspace analytics I also want to double check there we go I have that query key right here and now I will just copy these two queries here from use update task and I will save this and I will go inside of use delete task and I will simply add those two here I will close and save use delete task I will go instead of use create task and I will do the same thing here like this and I will close this and I will go instead of use bulk update tasks and I'm going to do the same thing here there we go so now what will happen is if I refresh this I will get the new analytics because we are now fetching but if I were to create a new task this time and let's do something let's put it inside of done let's add create and there we go you can see how now one completed task two assigned two total tasks and inside of the homepage here we should get the exact same thing perfect and if I were to go inside of a random project I'm sorry random uh task here and delete it this should also affect this let's wait a second there we go you can see how it's updated not immediately but it will reinv validate there we go great uh so that's one thing I wanted us to do and then what I want to do next is go inside of your features out and inside of our API use log out what I want to do here is very simply just this use uh just this invalidate queries and we can also leave router refresh inside of these ones I think I've mentioned that before uh but I specifically just want to call invalidate queries so when you don't specify which queries this will invalidate all of them so the next user that logs in will not experience uh anything from the old user right and one more thing I want to add instead of our source app folder dashboard workspaces actually just dashboard page here we use this get workspaces right and if a workspace exists we redirect to that workspace otherwise we redirect to SLC create so what I'm worried about is if this caches and it remembers that we don't have any workspaces so uh even though I've never experienced this uh so every time I created a workspace the next time I joined this it redirected me to the correct ID I think just for you know for a sanity check I think it pays off to have it sorted inside of your features workspaces API once you create a workspace what I would like to do is I would like to add use router here from next navigation and I will allow this one to call router Refresh on success purely because uh you can see that we are invalidating the query workspaces so everywhere else we where we are fetching the workspace client side we will 100% have that new workspace visible but on this one this is not reinv validated by that but instead it's revalidated with router. refresh and since this is a pretty important action in our page I kind of want to take care of that one drawback of this is that we will have this uh uneasy uh loading when we create a new workspace but I think that's okay okay because changing a whole workspace is a pretty you know no big process you can see it doesn't even look half bad right so now if you were to go ahead and log out uh and let's go ahead and do like um new user mail.com I have to sign up so I'm going to create a completely uh new account here and let's add a new user 1 2 3 4 5 6 7 8 let's register and now inside of here if I create a new workspace I think the experience should be exactly the same nothing much here should change which is confirmed the entire query is reevaluated that's great and if I go back to Local Host 3000 I should get redirected to this new workspace amazing that's the last of the things I wanted to implement amazing amazing job
