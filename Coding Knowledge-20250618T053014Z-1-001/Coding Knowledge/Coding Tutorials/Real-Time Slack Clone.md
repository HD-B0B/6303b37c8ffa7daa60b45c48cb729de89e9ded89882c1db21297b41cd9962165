Title: Build a Real-Time Slack Clone With Nextjs, React, Tailwind, Auth.js | Part 1/2 (2024)

() hey there my name is Antonio and in this course I'm going to show you how to build a fully functional slack clone using Cutting Edge web Technologies this project is perfect for developers looking to enhance their skills in real-time communication and modern web development in our slack clone we'll Implement a wide range of features that you expect from a professional team collaboration tool you'll learn how to create a system where users can add reactions to messages reply in Threads and send edit and delete messages seamlessly we'll also cover more advanced functionalities like sending images in chats and setting up direct messaging conversations these features will enhance the user experience and make our clone feel more like a professional fully featured communication platform a standout feature we'll Implement is a custom invite system using a six character code and sharable invite links this adds security and exclusivity to your workspace you'll also discover how to manage user roles including how to promote users to admin status Channel management will be a key part of our project we'll Implement features to create new channels and delete existing ones giving admins full control over their workspace organization throughout this course you'll gain hands-on experience with state-of-the-art web development techniques learning how to create a responsive realtime application that can handle complex user interactions by the end of this course you'll have built a robust slack clone that you can be proud of and you'll have the skills to develop similar real-time communication platforms all on your own and now without further Ado let's get started you're watching part one of slack CL here on YouTube and you can find part two for free in the link in the description this is a quick reminder that you can also use my platform Cod withth antonio.com and you can watch this entire course in chapters and you can also Mark your progress you can also become a premium member and you can unlock special courses like canva clone as well as source code to over 20 premium projects and over 170 hours of Premium content () in order to build our project we first need to have nextjs installed and in order to install nextjs we need to configure some system requirements so as you can see from the documentation page of nextjs ensure that you have no JS installed if you don't you can visit the website and simply install the latest long-term support version after you've installed node in your terminal you can confirm your version by typing node DV by installing node you also get npx so you can confirm that version as well if you have both of this and if the node version is higher or equal than what it says on the documentation page here you're good to go and you can configure with the automatic installation of nextjs so if you want to you can go ahead and copy this command and run it but I'm going to show you one quick thp and one quick uh package manager which I will be using throughout this course so bun is a new Java script package manager runtime bundler it's basically a lot of things and it is blazingly fast as you can see from this comparison right here of BUN and nodejs that being said it is not required for this project so feel free to completely skip installing bun if you don't want to but I just want to bring to your attention that I will be using bun throughout this course so instead of running npx create next app which looks like this I'm going to be running bunx and if you install bun you can also confirm your bun version like this and your bunx version as well so instead of running npx create next app I'm going to be running bunx create next app at latest if you want to use node simply type npx after this let's go ahead and give our project a name I'm going to call this slack tutorial I'm going to be using typescript I'm going to be using Sint tail CSS as well this is important make sure you select yes for the source directory if your default is no you can use arrow keys to select yes and press enter also very important make sure you select yes for the app router and I'm not going to customize the default import alas so leave this at no and there we go since I'm using bunx you can see that this says bun install in your case it might be mpm install perfect we now have a new project installed at this location so let's go ahead inside of our Visual Studio code and let's open it up there we go if you get this prompt you can go ahead and press the button here and you should see the exact structure as I have you should have the source folder the app folder globals favicon layout page. CSX I'm using bun so I also have bun lock file you might be having a package Json lock file also ensure that you have nailwind config right here now let's go ahead and let's run this app inside of your terminal make sure that you go inside of this new directory so I'm going to go inside of my slack tutorial here and if you're using bun you can go ahead and do bun runev if you're using npm you're going to call npm runev but here's the cool thing about using bun I can do both I can also do npn runev and I can also do bun runev Dev so it's interchangeable so if you want to try it out feel free to do that you can also switch in the middle of the project and nothing will break after that head to Local Host 3000 and refresh your page and you should be seeing a nextjs landing page great what we're going to do next is we're going to add shaten UI we are not exactly going to install this because shui is not a component Library which means that we don't install it as a dependency instead we just have to configure it in our project first so let's go ahead and click on the installation here and let's select nextjs we already have our project so we can skip step one and go immediately into step two and the cool thing about their website is that it allows you to specify which package manager you want to use I'm going to select bun because that's what I'm using I will shut down the app so I don't get any hot reloading errors and inside of the repository so make sure you are inside you should see all of these files here when you type LS for example go ahead and run the bun initialization command for these options here I'm going to select the default style and the Slate color I'm also going to select yes for the CSS variables and there we go project initialization has been completed and now let's go ahead and do Bun Run Dev again and if you go to Local Host and refresh I believe that everything should still be the same but you can see that my background color has slightly changed to plain white color and if yours was in dark mode it's going to be in light mode now now let's go ahead and let's learn how to add a component in this Library so one component which we are most certainly going to need is the button component so let's learn how to add that you can always go ahead and simply copy the CLI command here or you can just write it yourself so I'm going to go ahead and click bun here I'm going to shut down my app again you don't need to shut down your app I'm just doing it for Simplicity and I'm going to run bun D- bun shat cn- at latest add button there we go now the button component has been added and here's a quick tip I also found uh this to work just fine right without the dash dash bun and it didn't cause any problems in my project so you might see me do both in this project right I didn't exactly find any difference now that you have added a button and you got the done message you can go ahead and actually find it inside of your project it's located inside of source components UI button. DSX now let's go ahead and let's ensure our app is running let's go back into Local Host 3000 and let's modify this page right here which we are seeing that page is located inside of the app folder inside of page. TSX go ahead and remove everything in the return method and you can also remove the image import I'm going to go ahead and return myself a div hello world let's go ahead and go back and there we go now I just have a Hello World written in here perfect I'm going to go ahead and try out some Tailwind classes Now by adding a class name property and writing text rows 500 text bold my apologies font bold and let's go ahead and give it a text of two Excel there we go and I have a I now have a large red bold font now you might be wondering how come I have this little color box here how come when I hover I can see the exact CSS and how come when I type I get autoc completion all of that is thanks to one extension which is called Tailwind CSS intelligence so go ahead and install this extension it's very useful when working with Tailwind besides that I will also be using simple react Snippets and error lens and color highlight great now we confirm that Tailwind is working inside of our project and I want you to confirm one more thing since we're using the source folder ensure that your tail wi. config.sys the content here so we never actually defined this explicitly right we we did not write this configuration file it was automatically generated for us and then it was further uh generated with shat CN but just confirm that the content file looks like mine because if one of the folders is missing here Tailwind Styles will not be applied throughout that folder but since we're using the source folder if source is written here I assume that also everything inside will be Tailwind compatible excellent now let's go ahead and let's actually use that button component which we've added so I'm going to go ahead and I'm going to import button from add/ component cui button and I'm going to go ahead and render that button component here and I'm going to say click me let's go back and there we go obviously I'm zoomed in so my button is quite large and now let's go ahead and take a look at the props for example I can add a variant prop and I can change its style to destructive what's cool about shat CN UI is first of all that this component is directly written inside of our project it's not hidden away in node modules which means that we can modify every single part of this component we can modify the name prop names we can modify internal component names we can can also modify the Styles variants anything we need basically we have full access to create our own component Library so for example let's practice this by going inside of the button variants and finding the individual variant object after link let's go ahead and let's add slack let's go ahead and give it the background color of emerald 500 a text of white and when we hover let's also use BG Emerald but let's also give it an opacity of 80 and now if you go to page here you can see that variant now has a slack uh AOC completion and there we go this is our Emerald button now so that's how we're going to use chatsi and UI to add components but also modify them into our own component Library we can now go ahead and remove our variant and if you want to you can play around with sizes prop here you can see how we also have an error here now and you can go ahead and play around with sizes if you want to check that out as well great you have successfully configured the project and you're now ready to start developing great great job now that we have the basics of our () project set up let's go ahead and let's Implement authentication screens so later our users can use them to log in we're going to start by revisiting our global. CSS file right here inside of source app global. CSS and inside of here just above the layer base I'm going to add the following rule set HTML comma body comma column root and I'm going to give it a height of 100% once you've done that let's go ahead and do the following I'm going to close everything here and inside of my source folder I'm going to create a new folder called features and inside of here I'm going to create the out feature inside of here I will keep everything I need related to out hooks API calls components and screens so inside of here I'm going to go ahead and create a new folder called components like this and I'm going to go ahead and create a new file out screen DSX like this I'm going to mark this as use client which means that this is now a react component and not a react server component basically it means that we can now use reactivity and inter activity inside of it things like use state for example or on click so let's go ahead and let's export const out screen and let's return a div out screen now let's go ahead inside of our app folder inside of page. DSX where we have our button this time we're not going to be importing the button but out screen from at features out components out screen and we can simply render that out screen and self close it just like this so now if you refresh your Local Host 3000 you should just see an out screen here great let's go back inside of the out screen and let's actually start developing first thing that I'm going to do is I'm going to go inside of my out folder and I'm going to add a types. DS file so outside of components but instead of the out file and inside of here I'm going to export type signin flow which will be either sign in or sign up this exact types are very important so make sure you don't misspell them or don't do your own abbreviations like this make sure it's in camel case exactly like this because we're going to need it later let's go ahead inside of the out screen now and let's go ahead and let's define our default state here so State set state from use state which comes from react I'm going to go ahead and give this a specific type which will be our signin flow which we can import from our types and I'm going to go ahead and by default make this a sign in screen I'm going to go ahead and give this div a class name of full height Flex items Center justify Center and I'm going to go ahead and give give it a specific background color 5 C 3 B 58 like this if you're wondering how come I can exactly see what color this is that's thank to the color highlight extension so this will Center my text right here and it will also give me a nice background now let's go ahead and let's create another div here with a class name MD H AO MD with 420 pixels and let's go ahead and add out screen again inside this will not change much but it will make sense once we add an actual container here so let's go ahead and do that inside of our components folder I want to go ahead and add a signin card do DSX let's go ahead and let's export con sign in card and let's return a div signin card I'm going to copy and paste this and I'm going to rename the copy sign up card I'm going to go inside of the sign up card I'm going to change the component export and the text inside as well so I can differentiate between the two I will now go back inside of the out screen and I will dynamically render so if state is sign in in that case I'm going to render the signin card from do/ signin card otherwise I will render the sign up card like this there we go now it says sign in card perfect so let's go ahead and let's actually develop the signin card before we can do that we have to add some components from shaty anui so inside of your project terminal go ahead and run bunx D- bun shat CNU at latest add card but besides card we're also going to have some other elements here also add input and separator and now we should get three new components added inside of our project let's check them out so I'm going to go ahead and close everything here inside of my source components I now have button card input and separator besides that let's also install a package so I'm going to do bun add react icons in your case this might be mpm install or yarn ad whatever you are using for your package manager so just make sure you've installed that great in here in the upper terminal I just simply have my app running great now let's go ahead and let's use our new components so I'm going to go back inside of features out signin card I'm going to replace this div with a card component from components UI card and I'm going to end it as well I'm going to give the card itself a class name of full width full height and a padding of eight there we go we can now see a card right here inside of there I'm going to add a card header again from component's UI card and I'm going to write log to continue I'm going to give the card header a class name of px0 and ping top of zero besides I'm going to uh below I'm going to add a card description again from the same import and I'm going to write use your email or another service to continue There we go perfect and now inside of here I'm going to go ahead and add a card content from components UI card as well and I'm going to give card content a class name space y5 PX zero and padding bottom of zero inside of the card content I will open a native HTML form element and give it a class name of space y 2.5 basically what space y means is that elements inside of this element will be spaced out one below another by this exact value so each input inside of our form will be spaced out one below another by this exact margin so we don't have to explicitly write that for every input inside so let me zoom out a bit so you can see how this is currently looking we have a text which says log to continue and we have a description but this login to continue looks a bit slim let's go ahead and wrap this inside of a card title which you can also import from our newly added component so make sure you've added all the necessary Imports card card content card description card header and card title now inside of the form here we are ready to finally add our input component so this is a new component which we've added as well the input component itself will accept a couple of props we're going to explicitly write disabled to be false so we remember that we have to make it modular later the value can also for now just be an empty string on change can be an empty Arrow function placeholder will be an email type will be email and we're also going to make it required there we go this is now starting to look like something excellent we can copy and paste this input to create a password input so I'm going to go ahead and change the placeholder to be password and the type will be password as well and it's also going to be required below this we're going to finally add a button component which we've already learned how to import there is it is let's go ahead and close the button and let's add some text inside the button will simply say continue the button will be a type of submit so it submits the entire form here and the class name for the button will be full width size will be larged and disabled will be explicitly false so we remember we have to add something here great now it looks like our uh card content here and our uh card description are messed up so that is because our card description should be inside of card header so just move it above so it is uh with card Title Here There we go now we have some nice spacing here perfect so this is a very basic um uh email and password form now what we're going to do next is we're going to go ahead and add some additional options like login with Google and GitHub so I'm going to go ahead and find the end of this form but still inside of the card content and I'm going to add a separator component which we have uh added recently to our project so separator from components UI separator like this make sure that you import these things from actual at/ components UI if you use automatic Imports like I do sometimes you can import from radics that will will not work properly so always check your Imports that you're using the components alas here great so the separator can stay as it is and below it let's add a div this div will have a flex Flex column and a gap y of 2.5 between each element inside and we're going to work explicitly with buttons here so let's add continue with Google let's go ahead and give this a disabled of false explicitly an on click which will be an empty Arrow method for now a variant which will be outline a size which will be large and a class name which will be full width and relative like this there we go we now have a continue with Google button so now I want to go ahead and I want to add my icon so I'm going to import from react icon slfc FC Google like this so now what we can do is we can add that icon here FC Google like this if you just save it you can see a small little Google icon here but now let's position it a bit better first of all I'm going to go ahead and give it a size of five now it's a bit larger since we've marked the entire Button as relative it allows us to mark this as absolute so we can absolutely position position it whenever wherever we need I specifically want to position it here in this corner I'm using this method instead of flex because that way my continue with Google text stays absolutely centered without the need of adding another element here so that's a little trick we can use so size five absolute and then I'm going to give it a top of 2.5 and the left of 2.5 let's see how that positions it there we go it's right here in the corner perfect and we can now go ahead and copy this button we can paste it here we can change this text to be continue with GitHub like this and let's go ahead and import the GitHub icon now so fa GitHub from react icons fa let's replace this with fa GitHub like this and let's see if it looks fine it looks just fine great now what I want to do is I want to go outside of this div and I want to add a little paragraph here I'm going to give this paragraph a class name of text extra small and text muted foreground this will be a little footer text so we're going to ask ask don't have an account question mark now this word is missing an apostrophe so if you attempt to add it like this you might get an error that you you need to escape this character depending on which version of vs code you have or whether you have Sint turned on or off so if you get an error you can simply write appos like this this will escape that sign and it will still look exactly the same in the text here so if the user doesn't have an account we're going to go ahead and give them an option to sign up and we're going to go ahead and give this div give this span a special class name of text Sky 700 hover underline and we're also going to give it a cursor pointer so it behaves like a link even though it's not exactly a link component it will just use our set State method there we go so we now have our elements and just by looking at this I think that maybe we can move the Google and the GitHub just a pixel below or maybe I'm nitpicking let's try with top three uh if you like it you can do it like that yes depending on how you prefer yes in my opinion this looks a bit more centered it's not really important of course all right now that we have this let's go ahead and let's go inside of our out screen here and let's actually provide the users with ability to change this state of sign in and sign up depending on which uh what they click here right so I'm going to go ahead and give my signin card a set state of set state so we can just simply pass it like that and we can do the same thing for the sign up card so set state of set State like this let's go inside of the signin card and let's actually Define uh the types so I'm going to go ahead and use interfaces for types and I'm going to follow the convention of having the component name and then props I'm going to call set State here which will accept a new state which is a type of signin flow which you can import fromt do/ types like this and we're simply going to return a void here so I'm going to now assign those props here and I'm going to destructure this set State and now what we can do here is we can add an on click to this span element so before the class name I will add an on click here and I'm going to call the set State and I'm going to change it to sign up so when we click on this sign up span right here it should change to sign up card which currently does not have the ability to go back to sign in so let's go ahead and complete that part so what we can do is we can copy the entire sign in card and go inside of the sign up card and just replace it entirely before you save go ahead and change the Imports to be sign up card props and the component to be sign up card so now you should no longer have any errors and now when you click you shouldn't exactly see any difference it's just switching between the exact same component so let's go inside of the sign up card be careful make sure you're inside of the sign up component not sign in we is think finished the UI for sign in inside of the sign up card let's go ahead and let's modify the initial text so instead of log to continue I'm going to write sign up to continue and we can leave the description to be as it is one difference that we're going to have here is we're going to have three inputs this input will be used to confirm the password there we go you can see how now I have three inputs here and let's go all the way down here and we're going to ask a different question instead of don't have an account we're going to ask already have an account like this and we're going to change the state to sign in and we're going to change the actual action to sign in so now it says sign up to continue and it asks me to sign in if I already have an account and when I click on it it shows me the sign in in card great so we can now differentiate between the two I want to do one more thing before we wrap up the UI and that is to enable control of our inputs so let's go inside of the sign in card since it is just a tiny bit simpler so I'm going to go ahead inside of the sign in card and I'm going to use Simple states to control uh my form you can of course incorporate react hook form if that's what you prefer but honestly for simple forms I have nothing against using uh simple States I think it's just easier to control rather than adding a whole form for Just Two inputs let's go ahead and Define our email and set email let's copy and paste this to be password and set password like this and now let's go ahead and give the first input which is email the email value and let's go ahead and modify the onchange to take the event and very simply call the set email with event Target value and now we can go ahead and copy these two attributes and paste it here we place this one with password and this one will be called set password there we go so now if you try typing here and try typing a password you can see that even uh when I click continue right here we have some validation because we marked the input as type email and we also marked it as required right so if you try to submit without you're also going to get an error this builtin HTML validation is actually quite helpful but we're also going to do validation on the back end as well now let's go ahead and let's copy these two attributes and let's go inside of the sign up card so we can add the same elements here so I'm going to go ahead and add those two elements here and we also need to add the use State import from react I'm going to move it here to the top and besides this I'm going to copy and paste this one and I'm going to call it confirm password there we go so now I'm just going to copy the attributes from my uh signin card so I can paste them here for the email I'm going to go ahead and paste it here and be sure to replace this with password and call set password I'm going to copy this ones and I'm going to replace the confirm password ones and this one will use the confirm password value and they're going to call set confirm password uh did I misspell it I did set confirm password there we go so now my sign up method should work as well please excuse this that's last pass extension so now if you try and click on sign up you should also have this kind of validation here perfect great great job what we going to do next is we're going to implement actual functionality and which means we're going to have to add our database our ejs package and all of those things great great () job in order to activate the actual authentication methods we first have to add our database and for that we're going to be using convex so head to the website and find the documentation in the documentation here you can find quick starts go ahead and find the quick start for nextjs we already have our project so no need to do this step instead we need to install convex inside of our project so I'm going to go inside of my terminal here inside of my project and I will simply do bun add convex like this let's wait a second and there we go we now have convex installed and if I go inside of my package Json here I can find the convex and its exact version right here here after that we have to go ahead and run npx convex Dev or bonex convex Dev if you're using bun so let's run bunx convex Dev like this this will prompt you to choose an existing project or create a new project I'm going to go ahead and select create a new project I'm going to give this project a name slack tutorial you can see how it automatically reads from my folder name so I can just leave that empty and press enter and there we go since I'm already logged in uh I didn't get any new prompts but if this is your first time doing this you probably got a prompt to log in with GitHub and once you've done that you were probably redirected to the convex page here so now I'm going to go ahead and log in to show you this new database which we've just created there we go let me just zoom in a bit so this is my original uh project which I developed and this is the new one which I just made in front of you here right so if you go inside of this there we go this is your database for now and now you can also take a look at everything new that was added inside of here so we now have the convex folder as you can see here so what we want to do next is in my opinion finish the entire quick start so we can uh learn how convex works so one important thing during this entire course is that you're going to have to have two things running first is mpm or bu run Dev which will be running our next JS application and the other one is bonex or npx convex Dev which will be running our backend so during this entire project I will remind you a couple of times to have both things running otherwise the API will not be able to connect so make sure you see the message convex functions ready and make sure this is actually running and now we can continue further so next time if you accidentally close this you just run the same command npx convex Dev it's that simple to start your convex up so now what I want to do is I actually want to follow this instructions if you want you can follow along you don't have to because we are going to remove this later so I'm going to go ahead now and I'm going to create this sample data. Json l so in the root of my project here I'm going to create sample data Json L and I'm going to paste it here right so a very simple uh Json for a to-do list and then I'm going to go ahead and do this npx convex import D- table tasks so this is uh the name of the table which we want and we're going to see the data from here but I'm going to be using bonex right so for this part I can actually shut down the uh server and I can run this directly so bonex convex import D- table I'm going to give the table and name of tasks and I'm ring the sample data. Json L which I just created and put in the root of my project so make sure it's not inside of any folders otherwise it won't be able to be found keep in mind you don't need to do this this is just so we demonstrate how convex works and there we go you can see how now it's added those three documents here and if you go back inside of your database you now have tasks and you can see how we have these three uh tasks right here great now let's go ahead and let's expose a database query so we can actually fetch that using react and nextjs so we're going to go inside of the convex folder and we're going to create a new file tasks. DS and I'm going to paste what we just copied so I'm going to import query from _ generated right here server I'm going to define the get constant and I'm going to use the query the first argument here are the arguments which you can skip or just leave it as an empty array and then in the Handler we are awaiting context which has access to our database and similar to uh let's say uh drizzle we have this query where we name our table and then we collect right here so this will return if you hover over there we go uh it's going to return an array of items here the reason it's writing any is because we don't have our schema defined that's something we're going to do in a moment so let's go ahead now and let's continue here by adding the convex client provider so I'm going to go ahead inside of my source here components and I'm going to create a convex client provider. DSX so uh there I guess you can see the name right I'm not writing that inside of UI I'm writing it inside of components here and I will just copy the entire thing here keep in mind this is something that you need to do so the previous thing adding uh this tasks and seeding the database you don't need to do that but you do need to add the convex provider so make sure you have this right here let's go ahead and see whether we have the next public uh convex URL or not I assume that when we run bux or npx convex Dev there we go it added these two to our environment. local so we don't need to do that ourselves perfect which means that this exists and it won't be undefined so just confirm that inside of your environment. loal you actually have the next Publix convex URL and convex deployment both of these were added by running the this Command right here excellent now that we have the convex client provider let's go inside of our app layout. DSX and let's go ahead and let's import convex client Provider from components convex client provider I'm just going to go ahead and separate my imports a bit there we go and I'm going to go ahead and wrap my children inside of it so convex client provider there we go keep in mind that just because we mark this as used client doesn't mean that everything inside will be a client component as well so children can be server components even if their parents are wrapped inside of you client as long as they're passed through the children prop perfect so now that we've done that we can go ahead and modify this and actually fetch the tasks so let's go ahead and do that together let me just revisit my Local Host here to ensure that it is running so I'm just going to refresh a couple of times and nothing should break let's also ensure that we have uh banex convex Dev running so our API doesn't fail so you should get the message convex functions ready like this and now let's go ahead and do the following so I'm going to go inside of app and I'm going to create a new folder where we're simply going to test out so let's call it test and inside let's create page. DSX so we are now actually also practicing routing in nextjs so if you want to create a new client route you create a new folder and then a reserved file name page. DSX uh one rule that this page file needs to have is that you cannot do this so Pages need to use default exports like this and let's call this test page and now since we named our folder test you can go to localhost 3000 SL test and there we go you now see the test page and now let's go ahead and Mark this test page with use client at the top like this let's also import use Query from convex react and let's also import API from dot do dot dot do do convex generated API so basically we are going all the way outside of the source folder inside of convex inside of generated and we target the API like this and then we can go ahead and Define our tasks here similar to how we would uh using react query and then we can iterate over them right here so I'm just going to copy the entire return method here so it looks nicer there we go so basically tasks question mark in case they are undefined in the beginning we are mapping them we are automatically D structuring the ID and the text we are assigning the ID as the key and we are rendering the text inside so if you go ahead now inside of uh create next app there we go buy groceries go for a swim and integrate convex and here's a cool thing convex is a real-time database by default so if you go inside of uh your database and if you decide to add a new document here I'm going to call this real time and click save there we go it's added right here in real time excellent so we now have a fully functioning uh we have a fully functioning uh database connected and we are now ready to explore uh convex out so previously when I used convex in my courses the only only authentication Solutions were clerk out zero or custom JT Solutions but now we have convex out which actually uses OJs so that's what we're going to build next but we're going to do that in the next chapter great great () job let's go ahead and let's add authentication to our project using convex out and ejs if you wish to follow the documentation as I am head to the convex documentation page and ins sidebar find authentication convex out keep in mind that convex out is currently in beta which means that some features might change so it's a good idea to follow along on your own in the documentation in case there are any changes in the setup so inside of here I'm going to select this to add convex out to an existing project follow the setup guide so we can skip this part because we already have our project instead we can go ahead immediately here in the uh installation so we're going to go ahead and add these two packages convex ddev slou and out core which is actually next out so let's go ahead and either run npm install or bun add to those two things there we go after you've installed that you have to run convex dd/ out so either and npx or bux convex dd/ out you now have this message there are unstaged or uncommitted changes in the working directory the reason it's asking that is because what it's going to do is these manual steps so you can go ahead back here and you have this option alternatively you can perform these steps manually so inside of here you can see everything that this command will do for you so it's going to overwrite some of your files right we in our case we don't have those files at all so this message doesn't really matter we can safely confirm that I just wanted to explain why that's working uh there we go so now uh it's asking us some questions enter the URL of your local web server so that is HTTP Local Host 3000 as you can see inside of my parenthesis it's already predefined here so I can just press enter there we go and it successfully set the site URL uh to Local Host 3000 and it successfully added my private keys my ts config file out config file all of those things perfect so we now continue by configuring our schema and our front end so we have not yet played around with schema but it is very easy to do that in convex so inside of convex folder uh where we recently play around with tasks you can see that now we have out which looks very familiar to OJs because it is based on that so let's go inside of convex and let's go ahead and Define our schema so inside of our schema which we Define as following so we import Define schema and then Define our schema using Define schema like this and Export default schema like that inside of here we can Define anything we want right so let's go a head and try something else so for example if I go ahead and Define tasks to be uh V do uh I think I need to import V from value so we uh Define I'm not sure which one it is my apologies let me just go ahead and go inside of the documentation here schema uh it's defined table my apologies so I'm just practicing now because we haven't exactly encountered the schema yet so here's how you would write it you would write Define table you would go ahead and give this a name uh you wouldn't give it a name my apologies you would just write Fields inside so for example it would have completed which would be v. Boolean right basically that's how you write schema inside of convex in this case what we are going to do is we are just going to import the out tables so we don't have to write them ourselves like this so let me just import all of these things and our tables is basically uh a collection of tables like this but instead of tasks it has users and then it has accounts and then it has you know sessions and all of those things which we usually copy and paste from the ejs page while convex has a quick little solution for us which we can spread inside of here but this by default did not add anything inside of our scha how do I know that well if I go inside of my database actually here and if I go ahead you can see that I only have the option to generate the schema I I'm not going to click it because I'm not sure what it does but usually if you already have a schema the button says show or display schema so what we have to do for this to be applied to our schema is ensure that we have bonex convex Dev running so bonex convex Dev like this and once you run that uh there we go so it's starting to uh notice something but looks like we have this error here here's what we're going to do quickly let's go inside of the tasks and let's completely remove them we no longer need that so I just want my uh there we go my schema to work so it got confused because we kind of seeded these tasks right but we didn't Define them in the schema so what I did did was I simply removed that tasks file and then convex Dev no longer found that and then this error went away and you can see how now I have a bunch of new things inside of my database and we can now remove the tasks entirely so I'm going to go ahead and delete the entire tasks table there we go now we have users out verifiers out Verification codes sessions refresh tokens out accounts all of those things which are ready for us to set up ourselves so let's go ahead even further and let's select nextjs here so we are using App router right here so let's go ahead and import convex out nextjs server provider let's go ahead and start in our layout right here I'm going to import that at the top and I'm going to wrap my entire app inside of uh this so convex alexj s server provider and let me invent the rest like that and now uh we also have to do something so we have to Pro uh uh change our convex client provider so let's go inside of convex client provider here and this time we're going to import convex out nextjs Provider from convex ddev out nextjs so let me go ahead and add that here and what we are going to do is we are going to replace the convex provider import with our new import and we can then remove this there we go so let me go ahead and collapse this perhaps this will be a bit more uh visible that way and let me just go ahead and finish this up there we go like that so basically we previously had the convex client right but now we replace that with this new import from uh convex Dev out specifically for nextjs right here uh perfect and we already have this added as you can see they instruct you to do that further but we already have that because we came uh with that set up we just now modified it so that it actually uses the out nextjs provider instead great and now we can go ahead and add a middleware so let's go ahead and create that I'm going to close everything here and I'm going to go inside of middleware dots like that and I'm going to copy the entire thing and I'm going to paste it inside there we go the setup is done so now let's go ahead and besides having bonex convex Dev running which I'm going to shut down because in my first terminal I want to run B run Dev and then in my second terminal I'm going to do BX convex Dev like this so always make sure you have both running when you want to test things out there we go and let's just go ahead and let's try uh seeing if this is still working there we go so it looks like I can access this page right here perfect so what I want to do now is I want to play around with server side authentication in nextjs and perhaps try and use this middleware to protect our routes so we can use these matchers right here so let me go ahead and import the create route matcher from convex Dev and let's go ahead and let's default uh sorry let's create uh const is public page so inside of here what we are going to write is very simply slash sign in like this and then inside of this middleware uh what I want to do my apologies this is a method so let's get the request what I want to do is I want to check if the request is public page so if it's not public page my apologies in that case all I want to do is I want to return this to the sign in page right and looks like we also have to use this so I will also import is authenticated nextjs so let me go ahead and add that so if we are not on a public page and if we authenticated nextjs what I want to do is return the nextjs middleware redirect which we can add here like this and I want to use the request in the first parameter and I want to redirect to sign in like that otherwise uh I don't think I have to do anything I think this should be enough to protect our routes but we are of course going to uh test it out I just realized I'm using this is authenticated nextjs improperly so this basically means whether the user is currently authenticated so if we are not on a public page and if we are not authenticated that's when we want to redirect to sign in like this so let's go ahead and try this out now so I'm going to go ahead and first of all create the signin page so I'm going to go inside of the app folder we can remove actually let's keep test just for testing but beside it let's go ahead and let's create this signin page and inside a page. TSX remember we have to add a default export so sign in page div sign in let's go ahead now and go inside of uh Local Host 3000 and let's see if I can access slash test uh uh my apologies so we have to go inside of test and I have to clean this up but this looks like we are able to access it so I just cleaned test right so we are not calling that query so looks like I can still access this page so let's take a look at my middleware again and see if there's something I'm doing wrong and I think I know what it is I'm using the source folder but my middleware is outside of the source folder this is a habit that we have from my previous courses so let's fix this I'm going to cut the middleware from here and I'm going to paste it inside of the source folder right here so now let's see if anything changes there we go so if I try going to/ test I'm redirected to the signin page if I try to go to Local Host 3000 I'm redirected to the sign in page so if I'm not logged in this is the only page I can see which is exactly what I wanted to achieve with this middleware perfect I'm going to add a little to-do here redirect user away from sign in if authenticated like this so now let's go ahead and let's go inside of our sign in here and perhaps we can make this more generic let's call it out and you can click yes for update Imports and if you get this unsaved file for next types you can just save that file as well or close it it doesn't matter just Ensure that you don't continue developing inside of the next folder that can happen so let's head back inside of our out here and I'm going to rename this to out page the name of the constant does not matter all that matters is that you do a default export from the reserved page keyword inside of the app folder and I'm going to do a very simple thing here I'm just going to add out screen let's go ahead and check whether our out screen has used client so it as which means we don't have to turn the entire page into out screen into client perfect and now let's go back inside of the middleware which we recently moved in the source folder and this time my public page will be slash out and we are going to redirect the users to slash out and I'm also going to change this comment to uh notify me of the slash out method there we go so now you can see that my Local Host 3000 is on SL out if I go to/ test I am immediately redirected back if I try anything else I am redirected back if I go to Local Host I am redirected back perfect now what we have to do is we have to actually enable one of the methods for the user to log in So at the moment if you go ahead inside of your convex out. DS we have no providers set up so let's go ahead and set up the easiest of the providers which is most certainly the GitHub provider so let's follow the instructions on how to set up the oal for GitHub as you can see here GitHub has better than most configuration developer experience and I fully agree with that which makes it really easy to set up first so let's go ahead and do the following usually we would just go inside of our profile we would go ahead inside of developer settings here we would go inside of oou app click on new O app and inside of here we would add Local Host 3000 with convex it is a little bit different so let's go ahead and let's follow the instructions right here so we have to visit the convex dashboard and inside of here we have to find the convex URL it seems so let's go ahead and do that inside of here I'm going to go inside of the settings and let's see which which one I have to find so these are my uh environment variables here these are my project settings somewhere in here we should be able to find our URL uh so this is the deployment URL I think we need the HTTP actions URL so let me just confirm that here there we go so the origin or the domain of the Callback URL for convex out is our back HTTP actions URL there we go we confirmed that here so go inside of settings URL and deploy key show deployment credentials and select HTTP actions URL and copy it let's go ahead and add that to our authorization callback URL and then we have to further Advance it by adding SL API slout callback GitHub so let's go ahead and add that there we go and the homepage URL I believe is the same thing and we can call this slack tutorial let's go ahead and click register application here and now we have the client ID and we also need to generate a client secret but let's not do that yet so uh we have to add this a little bit differently so we don't add this directly inside of our environment variable we have to add it inside of this project here we have to add it inside of here so if you want to you can manually add it here or you can use the instructions as below here so you can use the npx convex environment set so let's do that I'm going to copy the client ID and I'm going to go ahead and shut down my project here and I'm going to run bonex convex environment set out GitHub ID and I'm just going to paste what I copied uh from my client ID and once I add that you're going to see that inside of my project here there we go I have the out GitHub ID added which is exactly what I just copied from here and now we have to do the same thing for the generate client secret so let me just pass this verification here we go and now I'm going to use the exact same method so again keep in mind that this prefix is important so _ GitHub ID will be automatic clear recognized once we add a GitHub provider here uh of course if you want differently named environment variables for any reason you can configure that as well but I recommend that you just follow to the actual standards for now so now let's do banex convex environment set _ GitHub secret and paste your secret I accidentally copied something else so there we go copying my secret pasting this and and let's confirm inside of my environment variables I now have my out GitHub secret there we go so confirm there are no typos here confirm that both are inside of your project and you can now go ahead and do bonex convex Dev so your server is running so make sure that you have the success message convex functions ready now let's go back inside of here and what we have to do is import GitHub from out for providers GitHub so I am inside of convex al. CS here let me just add that here and I'm simply going to add GitHub as always you can expand this and you can specify the client secret and you can specify the client ID in case your environment variables are different but in case you name them correctly as we did it's automatically going to look for uh ones named exactly like this perfect so we have that and now what we have to do is we have to find this uh button where we want to use the sign in Via GitHub so let's do that I'm going to go inside of one of my cards so I'm going to use the sign in card and inside of here I'm going to go ahead and import uh these use out actions so let me add them here and I'm going to add them to the top of my project so use out actions and inside of here I'm going to extract this sign in method and now I'm going to do const on provider and the provider value will only be able to be GitHub or Google and then inside of here we're going to very simply call sign in and we can pass in the value actually like that so in our case it will only be GitHub or Google and now let's go ahead and add this on provider let's name it better uh let's call it handle provider sign in so it's a bit more descriptive now let's find a button which says continue with GitHub and let's go ahead and change this onclick uh to do exactly that we need to call it and we need to Define GitHub inside like that let's go ahead and try this out now so inside of my project make sure that you're on the login card your GitHub button should now do an action where it opens up GitHub and asks you for which one to authorize So currently at the moment inside of my database I have no users as you can see and if we've done this correctly once I authorize myself here I should have a new uh user inside let's take a look if I go inside of my data here there we go my first user is right here and it's authorized with GitHub and now if I go to localhost 3000 test let's see if that will work there we go so I'm officially authorized and now what we have to do is we also have to handle that reverse uh redirect logic which we have inside of our middleware so I'm going to write if uh we are not on public uh page my apologies if we are on public page and if we are authenticated in that case I want to return nextjs middleware redirect request to the root page basically so right now now uh we still render the exact same component here so it doesn't make much sense so go inside of app and inside of page. DSX remove the out screen and inside of here add a div logged in there we go now it simply says logged in and if you try and manually go to slash out you get redirected back inside of here great so now what I'm going to do is I'm going to remove our test method we no longer need it I'm going to do a very simple thing here mark this as use client import uh use out actions from convex Dev out react if those are the same ones we used let me just confirm inside of my uh login cards here yes use out actions from react and let's this time the structure the sign out method so I'm going to add a little button here sign out on click sign out let's do it like this so now I have a sign out button so if I click it there we go I can no longer access uh any page besides slash out perfect if I try and go to Local Host 3000 it does not work but if I go ahead and successfully log in again there we go I am back inside and this time I can't go back to slash out perfect so we've set up most basic authentication what we're going to do next is we're going to wrap up authentication by adding some loading states by connecting Google and also by enabling credential login great great job now that we have GitHub login let's () go go ahead and let's Implement a Google login so for that you're going to have to find your Google Cloud console so on Google skip the first sponsored result and find the one which says console. cloud.google.com and that will lead you to this page right here now let's go ahead and let's create a new project I'm going to call this slack tutorial and I'm going to click create create now let's just wait a moment for our new project to be created so that we can select it and then we can configure the O out so click select project confirm in the nav bar that you are in your new project and search for API and services right this and this one now inside of here go ahead and first set up the oou consent screen right here go ahead and select the external option give your app a name so slack tutorial in my case I'm going to select my email here skip the logo upload because if you need to submit your app uh it will take a long time for them to um verify your app right so if you want to use this in production just skip the app logo and it will be instantly approved you can skip these as well and now inside of here the authorized domain let's I always forget let's see if we can add Local Host 3000 or not uh looks like can I add HTTP okay looks like not so I'm just going to go ahead uh and do the following I think what I have to add here is inside of my settings URL uh and find the HTTP actions URL I think that might be it but I'm not entirely sure so we'll see later so let's add this perhaps okay and inside of here I'm just going to repeat my email and let's click save and continue and you can just skip everything here and click save and continue again and same for the last one all right uh now let's go inside of our credentials and let's click create credentials or client ID inside of here select a web application the name doesn't matter the authorized JavaScript Origins inside of here will be our Local Host 3000 there we go we can add that here and the authorized redirect Ur Uris will be the one which just copied from our HTTP actions URL and I forgot what's the Callback so let me just take a quick peek here so slash API slash out callback and instead of GitHub it will be Google so SL API slout callback and this will be Google and let's click create and there we go we now have client ID and client secret so first let's copy the client ID and let's go ahead and do bonex convex Set uh is it convex environment set and this will be _ goore ID and then uh let me just confirm I kind of forgot how we set this up okay so banex convex environment set _ Google underscore idid and just pass in the client ID there we go looks like you don't have to put the uh equals sign you can just add space and then add it uh and now that we have the client ID let's add client secret and while I'm here I'm also confirming in my environment variables that I now have out Google ID so now let's add banex convex environment set outg Google secret and this time I will try with uh space instead of equals just to confirm whether this still works great looks like both versions work yes so you can either you know do it like this with a space or you can add an equal sign both will work just fine so now I have out Google ID and out Google secret so you confirm that you have both of these inside of here uh great and now what I'm going to do is I'm going to go ahead inside of my sign in C Oh but before I try that out I have to go inside of convex al. Cs and I have to import Google from Google here and let's just add Google to the mix there we go now inside of the sign in card here nothing should change I believe I just want to change the name of this to on provider sign in and change it right here and then I can copy this find the continue with Google button and paste it here and change this to Google there we go so I'm going to go ahead and try and click continue with Google and let's see if this is working or not well mine is not working because my server is not actually running so let me run bonex convex Dev let's wait for the success message here there we go I will refresh my page and I will click continue with Google and I'm redirected and there we go I'm going to go ahead and select my account here I'm going to select continue and I'm logged in let's go ahead and go inside of my uh project here let's go inside of users and there we go two users and inside of my out accounts I have one from Google and one from GitHub both working flawlessly perfect so now we can go ahead and sign out and there we go it's working just fine so what I want to try out now is what if we use the same GitHub email and the same Google email so right now I think this will result in an in a bug so I'm going to go ahead and attempt this now so I purposely used a different email the first time but now I'm going to try and use the same email and looks like I'm logged in so looks like no error but yes what happened is that now I just have multiple users great so I just wanted to confirm that because if we used normal ejs I think this will be an error right so let me confirm one more time that I can still log in uh with my other uh GitHub user there we go so it looks like I can create normal accounts even if they have the same email because uh this out system seems to separate them or it it looks like it actually I still have only two users so what I believe happened is that it Simply Connected uh those users uh with multiple accounts I believe that perhaps is uh what happened here great so looks like that is solved we don't have to be uh afraid of that usually that's a problem withjs but looks like it's not a problem here so what I want to do now is the following before we go on to credential login I want to implement uh pending and set pending state which will by default be false then inside of here I'm going to set pending to be true and in a Dot finally I'm going to call set pending to be false and then we're going to use this pending to disable our elements so everywhere where we hardcoded a disabled false we are now going to paste pending so same thing for this big continue button and our continue with Google and GitHub all of those should be blocked while I am logging in so let me try this again there we go you can see how now when I click on something for a brief second uh it it is blurred out uh sorry not blurred out it's actually um it's gray out right great let me try GitHub GitHub works just as well perfect so we now have two providers uh which we can use uh to sign in and sign out and now what's left to do for us is to uh Implement a credential login also be careful that you don't have multiple tabs open because ajs Works in a kind of tricky way so sometimes when you log out it might tell you that it show you that you're still logged in try and just close any other tabs which you have opened great so now the last thing we have to do is implement the credential login great great job now that we have Google and GitHub () way of logging in let's Implement password and email login so I'm going to go ahead back inside of my m. CS inside of the convex folder and inside of here we're going to go ahead and import password from convex dasd slout SL providers SL password so as you can see this is an exclusive uh provider available from convex Dev because usually it's called credentials and we have to implement the register process ourselves but thankfully convex wrapped that in the password provider so now we can easily handle both signing in and registering from one method so let's go inside of the sign in card so we are still only working inside of here and what I want to add here is a new method which we're going to call const on credential or let's call it on password sign in let's go ahead and take the event to be react form event HTML form element inside of here prevent default so this is a form submit right that's why we have to do this and then let's set loading to be true my apologies set pending to be true and then call a sign in with a password method here and inside passing the email the password but also the flow the flow is important the flow will determine whether we are creating or signing in for this user so inside of here you have to pass either sign in or sign up right so that's why I told you to be careful about those types in case you want to reuse them right in case you want to use the out screen and then change the state and pass it here uh just be careful it needs to look exactly like this so since this is a login card it will be signed in so it's a bit of a shame that they didn't type this right you can see flow is just a string right but they are working on updating this part so this will in future be uh strictly typed which will greatly in increase security uh and type safety let's go ahead and let's catch an error if it exists and in the finally method let's set pending back to false so in order to catch an error we have to create a field for that so let's add error and set error here to be used State and by default it will be an empty string and now let's go ahead and find way to render that error so in between the card header and the card content if we have error so we're going to turn it into a Boolean by adding double exclamation points if we have an error we're going to open up a div the div will have a background destructive and an opacity of 15 a padding of three rounded MD Flex items Center Gap X2 between the items inside text small text destructive and we're also going to have a margin bottom of six and now inside of here we're going to render a triangle alert from Lucid react so we have this we didn't install it manually uh it automatically got installed when we added shaty Nui so if you take a look at your packet Json you should have lucid react installed here great we now have triangle alert here so it's a self-closing tag let's give it a class name of size 4 and then let's add a paragraph which will very simply render the error here and inside of here what I'm going to do is I'm going to set error invalid email or password let's go ahead and add the on password sign in in our form on submit like this there we go so now if you refresh this page Ure that you have bun convex Dev running and Bun Run Dev my apologies this is bun X convex Dev or npx convex Dev so I'm going to try testmail docomo 5 6 and if I try I get an error invalid email or password that's because this combination does does not exist perfect so now what we have to do is we have to create the sign up flow for this so let's go ahead and let's go inside of the sign up card here and I'm going to close everything besides sign in card so I can copy some elements from here so I'm just going to go ahead and copy the pending States so error and depending States I'm going to copy them and I'm going to add them here below the two things I'm also going to copy the error display which we're going to put in in between header and the content here so I'm doing this in the sign up card right I also need to import the triangle alert here so let me just quickly add that there we go uh and I can also copy the on provider sign in so let's go ahead and copy that here and I'm just going to go ahead now uh and all also add the use out actions so yes the method is still being called sign in make sure you also import use actions from convex out I'm just going to move them to the top here the method we are calling is still called sign in but we're going to specify the flow to be sign up when we add the credential login I first want to enable the on provider sign in which in here we can call on provider sign up and it will work exactly the same because providers are easy to work with I personally prefer them because of this so let's go ahead and find our continue with Google button inside of our sign up card and inside of here we call Google very simply and inside of here we call GitHub so this will automatically create a new account if it uh doesn't exist and if it does exist will just be logged in no no need to change anything so I literally just change the function name here to reflect that this is technically a sign up should be used for signing up right and now let's go ahead and use the pending here and let's replace all the explicit uh false disabled with pending including this button here this button here and this button here so basically nothing should be hardcoded to be disabled false uh great and now let's go ahead and let's Implement our on password sign in so on pass password sign up we'll again take that very same event I'm just going to copy it from here so I don't uh type it twice we're going to prevent default from that event and then what we're going to do here is we're going to check if password does not match the confirm password we're going to set error password passwords do not match and we're going to early return this so it doesn't go any further now let's turn the uh set pending to be true and let's call sign in password and we're going to pass in email password and our flow will be sign up in the catch method here we're going to set the error to something went wrong and in the finally method we're going to go ahead and simply return the set pending to be false now we can use the on password sign up here and we can add it to our form on submit there we go so now I'm going to go ahead and click on sign up here I'm going to ensure that I'm on the sign up method inside of my users here I only have two users and both of them are coming from Google and GitHub so now what I'm going to do is I'm going to create a new test mail.com and here's the thing your password needs to include uh a capital letter uh it needs to be specific length right if you just try one to three and one to three and continue uh you're going to get an error that something went wrong basically convex has set up some predefined rules of how our passwords must be so just for now I'm going to do you don't have to do this I'm just going to do it for you so I'm going to comment this out so you can see how the password must look like so for example I'm going to add uh Antonio uh let's go ahead and add a th and an exclamation point at the end so first things first we can try this out there we go passwords do not match so now if I add this and click continue There we go and if I go inside of data Dev I have a test at mail perfect and you can read more about passwords right here so in the convex out documentation we handled the O out here right in the passwords here you can read even further about this right so they have their examples here uh you can also follow their email reset you can also follow you know uh their uh verification everything is inside of here right so it's a very very good provider here you can also customize email and password validation so inside of here uh you can see what they use they use Zod to validate the basics like password length but they also use have I been pned uh to check whether the email the user wants to use has been previously leaked they also use this library to require a minimum password strength right so you can of course overwrite that as well it seems uh perfect uh great so now let's go ahead and try one more thing now that I can I'm able to register let's see can I now log in so if I go ahead and try a random password it should not allow me but if I try my old Antonio 1000 and an exclamation point there we go I unlogged in I'm just going to go ahead and enable this two back perfect so there we go you can see how now our website is working perfect perfectly amazing amazing job before we move forward I want to () bring your attention to a few differences between our oal provider and our password provider so let me quickly show you my terminal I have Bun Run Dev running and I have bonx convex Dev running so make sure you have both of those running as well and refresh your Local Host to ensure that it is working so I'm going to go ahead and create an account using GitHub as I am doing right now and I'm logged in and if I go ahead and take a look inside of my users table you can see that I have a name right so my oout provider automatically fills the name property here and same is true if I use Google but what happens if I use my uh password provider here so I'm going to use the same password uh that we have have used in the previous chapter and I've created this account now and when you take a look at the users now this new user which I've just created does not have the name property this will be an issue because name is something that we are going to rely on throughout the entire app so let's go ahead and let's fix that so first of all go ahead and sign out and then let's go ahead and do the following let's learn how to uh properly uh delete our users so let's start with the users table go ahead and click here and click clear table so this will remove all users and then simply go ahead and check through all of these so I have to remove my sessions as well I have to remove my refresh tokens here and I have to remove the AL accounts so I'm going to remove all of them here and what I'm going to do now is modify the sign up card so that I also have to fill in the name property so let's go ahead and let's go inside of our features out components sign up card and inside of here I'm going to add name set name to be controlled by the state and now let's go ahead and simply add a new input field right here I'm going to copy and paste this one placeholder will be name type is not necessary and value will be name on change will control control the name and let's go ahead and do the following inside of our on password sign up we also need to add the name property here like this so name email password and the flow so right now by default this will not fill that property right so we have the property here but it's not going to be filled in the database and I also just want to change the placeholder from name to full name so it indicates to the user a bit more precisely what we expect them to enter here so now if you look at the convex out documentation and if you click on passwords here you can scroll a bit down where you can find some password customization here so for example if we need to customize user information they are using an example of passing in the role so if you want to passing the rle you're also going to have to customize the schema which is just a bit more complicated but nothing we haven't done already uh in uh on my channel here but let's focus on the simple setup so go inside of passwords and scroll all the way down what we're going to do is we're going to create this custom password model and we're just going to pass in the name alongside email so let's go ahead and do that let's go ahead inside of the convex inside of out. DS and now what I'm going to do is I'm going to Define const custom password and then I'm just going to copy this entire thing here like this and then we'll simply use the custom password here and we also have to import the data model from _ generated there we go so make sure you're doing this inside of the convex folder so you have access to the underscore generated uh folder inside and I'm going to remove the r as simple as that there we go so that should now be working so let's go ahead and try it out I'm going to go inside of here make sure you are refreshed you are logged out make sure you have no existing users I'm going to go ahead click sign up I'm going to give this uh my name Antonio here I'm going to go ahead and add a fake email I'm going to reuse the password which we've used before let's create our account and let's take a look at the data now and there we go you can see the name property is now filled amazing so now regardless if the user uses the password provider or if they use one of the Google or GitHub providers you can see that they will most certainly have the name property always filled which is important for us uh great so go ahead now and log in make sure you are logged in because what we're going to do now is we're going to build the user button in order to build our user button uh we're going to need to add a specific component from shat ceni so if you want to you can shut down your terminals but I just opened a new one here and I'm going to add npx -- bun shaty Nui latest add Avatar or you can simply use npx shatan latest Avatar I'm just going to show you a bit if you are unsure you can always go ahead inside of the components here and find the Avatar component and simply uh I don't know where it is now basically find the Avatar component and copy the uh installation uh command great we now have the Avatar components and what I want to do now is I want to go back inside of my features inside of my out here and inside of the components I'm going to create a new file called user button do CSX like this and we're going to have to import first of all let's mark this is use client so we can add some interactivity to it and let's import everything we need from our new Avatar component which was just added in components UI Avatar here and besides Avatar we're also going to need one more component here whoops so we're going to need bonex shat nuui latest add dropdown menu so let's go ahead and installed our dropdown menu so now we can import everything we need from the drop down menu as well like this so make sure you have these three for the Avatar and these four from the drop-down menu great uh and now let's go ahead and let's export const user button here and inside of here what we're going to do is we're going to open up a drop- down menu model will be false we're going to add drop down menu trigger we're going to give it a class name of outline none and relative and inside we're going to render our Avatar component our Avatar component will have a class name of size 10 cover opacity 75 and transition and inside of here we're going to have Avatar image and then we're going to have some Avatar fback here which will not be a self closed tag instead it's going to be open like this and then inside of here we're going to have the drop- down menu content let's give it some properties so it's going to be aligned in the center side will be right and class name will be with 60 let's just fix this typo here and then we're going to have a drop down menu item inside which will be open like this so I just created a little skeleton here here uh and then we're going to go ahead and go inside of our logged in screen so inside of app page. vsx right here and instead of you having this button here perhaps you don't even have it basically just add the user button uh from feature features out components user button and then what I'm going to do is I'm going to add our user button here uh like this and right now you should just just have this weird gray Circle and when you click on it it should just open an empty uh well an empty space here so obviously we have to resolve this now right so what we have to do is we have to create uh our user API endpoint so that we can actually load the user data so let's go ahead and do that let's start with the API endpoint so we go inside of the convex folder and we create a new file users. TS like this inside of here we're going to import the query uh which will come not from convex server my apologies so we're going to import query from SL generated SLS server and we're going to import out from do SL out let's export con current to be our query inside of here we're going to have arguments which will be an empty object and then we're going to have a Handler which which is our controller which has access to the database and all other things let's get our user ID using await out get uh get user ID and pass in the context inside and very simply if user ID is null we are going to break the method and just return null otherwise I'll wait context database get user ID so that's right in convex when you use the database method and when you get some something you don't need to specify uh the collection which you're trying to get because convex has unique type types of IDE as you can see for users so it automatically recognizes okay this is your user I know exactly what I have to get you don't have to tell me that this is a user column right uh great so we have added that now and now let's go ahead and actually create a hook to call this so we're going to go go ahead inside of uh our source features out and inside of here let's create a hooks folder and let's create a file use current user. DS like this let's export con use current user and then inside of here we're going to go ahead and actually uh fetch the user so let's go ahead and get the data by using used query which we get from convex react and then we're going to get the API from uh this path so basically you have to go back until you exit the source folder and go inside of convex here and we have to specify api. users. current like this and if you go ahead inside of convex documentation here uh let me see if I can find it reading data uh I'm trying to find exactly where they have it written I can tell you that as well but I want to find uh the exact text which they have uh maybe it's somewhere else let me just see queries basically if your query data is there we go so if query data is undefined uh it will most likely mean that it is still loading so that's how we can determine whether it is loading or not because by default we didn't get the loading out of here right so you can see data can be null undefined or it can be the actual user object so this is how we're going to create our is loading very simply by checking if data is undefined because once it loads if it truly doesn't exist it will return null so that's how we're going to differentiate and then let's return back data is loading and this will be a standard hook that we are going to use to fetch all other entities so we're going to create hooks for each of our entities here in the features and that's how we're going to standardize that process now that we have this hook we can go ahead back inside of out components user button and inside of here we can go ahead and call the use current user from do/ hooks use current user and inside of here we can destructure the data and is loading like this and let's go ahead and do if is loading in that case we're going to go ahead and return a loader component from Lucid react so I'm going to move this to the top here and let's close this tag let's give it a class name size 4 animate Spin and text muted foreground and if there is no data for any reason whatsoever we're going to return it back uh great so let's go ahead now and do the following or maybe we can be more precise if data is null like this because this will be uh empty right data can be undefined but then it's loading which we technically override by early returning here but if you want to be uh more precise you can do a direct comparison with null great so we now have some user information inside of here so we can go ahead and now destructure those things here so if I go ahead and do data I can D structure the following so I can get the username I can get uh let me see image name and email let me just see whether I did something uh wrong here so we do have name uh it says that these properties do not exist so let me just go ahead and uh check why that is happening well it's happening because of this if Clause so I was incorrect when I told you that it can be uh just null simply do if there is no data return null so then we can safely destructure these elements here all right so now we have the image the name and the email but as you can see some of these things might not exist depending on what type of user this is so let's go ahead and use it to the best of our abilities so if you go inside of your dat database here you can see that my user which use the uh GitHub login has an image so what I recommend you do well we remove the log out button now so whatever you're logged in with will suffice let's go ahead and create an avatar fallback in that case if we can't load the image so we're going to get the name if we have the name we're going to get the character at the first index and we're going to uppercase that character otherwise if we don't even have the the name uh oh actually we're always going to have the name because we just resolved that right so we can safely do this you can put an exclamation point here which will basically tell typescript uh this will exist and then it won't cause these errors here so that's what we're going to use inside of the Avatar followback here so if I go ahead and look now there we go it says a because that's the first name inside of my user here so you should always have a name property that's why we ensure that great uh and otherwise we can go ahead and give this an out of name and a source here can be the image like this there we go this is my image you might not have an image if you're logged in with your credentials like password but if you use GitHub or Google login you should see an image uh also quick tip if you're using Google and you're still not seeing your image it might be because Google sometimes has these weird rate limits for images on Local Host for some reason it happened to me during development Google Images were simply not loading I didn't do anything to fix it it just fixed itself after sometime so don't be scared if your Google Images are not showing all right so we now have this uh and we don't need email here now what I want to do is I want to go ahead and actually add this drop down menu item and add a log out icon from Lucid react so just make sure you've added the log out icon give the log out icon a class name of size four and margin right off two and inside of the drop down menu item also add the log out text so now when you click here you should also see log out text perfect and now what we have to do is we have to add our use out actions from convex Dev out react let me just add that here to the top and inside of here we're going to dest structure the sign out method and every time the user clicks on this drop- down menu item here we can just call the sign out method and let's also give this a class name of height 10 so it just looks a little bit bigger so when I click here there we go I can now log out perfect so if I go ahead and try and log in with my other account here which doesn't have an image you can see how it's loading for a second and then we have a nice uh placeholder here perfect so if you want to you can also maybe color this uh let's see if I can do that can I give the outer fullback a class name of BG red 500 can I try that there we go if you want to you can maybe color it so it looks a little bit uh better like this and maybe give it a text white so that way it's kind of going to be visible against any background like this uh there we go so that resolved that part uh and we can now log out perfect so what I want to do is just go back inside of this page here uh well actually you don't have to do this but basically we no longer need the logged in text we no longer need this we no longer need this import there we go we can now control our logged in and logged out State uh in a nice way here and we also have this beautiful user button uh which you can see loads the image and also has nice fallbacks in case something goes wrong great amazing amazing job in the next chapter we're going to start and creating some workspace now that we have the ability () to create various types of users it's time to be able to create a workspace so let's go ahead inside of convex inside of schema. vs right here and after our tables we're going to define a new table called workspaces so let's use the defined table import from convex server and then inside of here we're going to Define some properties for the workspace so first of all is going to have a name which will be a type of string and you can import the V helper from convex SLV values besides the name we're also going to have user ID which is basically the user which created this workspace and we're going to have join code which will be a string as well and after you save this inside of your terminal here you should see schema validation complete and all of these success messages if you don't have this running just go ahead and run BX convex Dev or npx convex Dev and it will automatically read the new schema and it will upload everything inside if you get an error you most likely have a typo somewhere so if I try and save this for example uh there we go you can see how the banex convex Dev tells me that I have a typo and that it failed to update the schema so that kind of thing can happen so just be careful but it's very fast you don't need to shut down uh this ever it will automatically read everything for you and keep it in sync great so what I want to do now is the following so I want to go ahead and install uh two things well first thing will be bonad yoai I'm not sure how to pronounce this it's basically a global State Management from the same author as tand I believe I don't know how to pronounce any of their packages correctly but there's three of them there's I think Vol Tha yoai and uh tand uh previously we used tand a lot but I thought perhaps it will be nice to try this out uh for this course and I quite like it so let's add add that and besides that let's also add from shat CN a dialogue component great so now let's go ahead and do the following I'm going to go ahead and in go inside of source inside of features and I will create a new workspaces uh folder here and inside of here I'm going to go ahead and create an API folder and inside I'm going to create use get workspaces do DS and now I'm reminded that inside of my out folder I called this hooks while that is technically correct I want to reserve the hooks folder for actual react hooks right not for API calls so I want to separate these types of hooks in their own API folder so I want you to go inside the features out and just rename this from hooks to API and you also have to fix the import so that's inside of components user button make sure you also fix the import here to not use hooks but API and make sure you save this and you can reload your page to ensure everything is still working just fine now let's go ahead back inside of the used get workspaces before we can actually uh call the used get uh workspaces we also have to define the workspaces actual uh API call so let's go inside of convex and let's create new workspaces dots like this let's export con get which will be a query right here the arguments will be an empty object and then we're going to have a Handler the Handler will provide us with the context and the arguments since we don't have any arguments we we can actually remove the second argument and basically what we can do here is simply await uh works sorry wait context database uh let's go ahead and see query workspaces and collect them so this will simply return all possible workspaces in this project right now if you take a look inside of your database you have a new workspaces filled here but nothing inside yet so now let's go ahead and do the following inside of source inside of app folder page. DSX where we currently simply load the user button I want to go ahead and do the following so now oh sorry I can't do it yet because I have not connected this to our used get workspaces so let's quickly do that let's import query uh uh use Query from convex react and let's import API from its place and let's export con use get workspaces const data is use Query API workspaces get const is loading is if data is equal to undefined and let's return the data and is loading back and then we can go back inside of page. vsx make sure it's marked as use client here and we can go ahead and then call data is loading use get workspaces like this and I like to separate my features Imports so I know which ones are related to what and then what I'm going to do here is I'm going to attempt to get the workspace ID using use Memo from react so let me just prepare this so make sure you've imported Ed Memo from react here and I'm going to very simply attempt to get the first in the array and attempt to get its ID and and then I'm just going to go ahead and pass in the data here and let me see if I did something uh incorrectly here so data is null or undefined that does not seem right uh yes because I forgot to return my await here so I just awaited it but I forgot to return that so make sure that inside of convex folder inside of your workspaces inside of the get method you actually return this await and there we go now a workspace ID is a type of workspaces or undefined so basically I'm picking the first in the array but I also am careful and I'm adding these question marks because at any point this can be undefined so then what I'm going to do is I'm going to go inside of use effect here so make sure that you go and add use effect from react here and first of all if is loading we're going to return null here and then we're going to do if we have workspace ID we're going to go ahead and conso log redirect to workpace else we're going to go ahead and console log open creation model you can of course uh resolve this uh we are not with running null here my apologies we're just doing return and we also have to add in the workspace ID router we don't have the router so just is loading here so this is one of many possible solutions you can do I personally don't even prefer use effect but I think it's a really cool effect to open a model from here which can kind of only be done in a client component you can also do this in a server component if you want to completely avoid this use effect kind of uh Clause combination thing uh but that's not something I'm going to do for this part I really like that uh effect when a model opens so for now uh I just want to go inside of here uh I want to go ahead and log in yeah sometimes you will be logged out so don't worry about that just log back in and let's go ahead and zoom here and I hope you can see it says open creation model right so I also have this okay let me just remove this there we go so it says open creation model that's because it cannot find any workspace so that's what we have to build next so let's go ahead and actually uh create our controller for that model so we're going to go inside of source inside of features here and I'm going to create a new folder this time called uh not hooks again it's going to be called store and inside I'm going to add use create create workspace model dots and let's import atom and use Atom from your Ty and let's go ahead and create the atom so create workspace model atom is atom and by default it is false and let's export con use create workspace model and you're going to see how cool this is to actually use so the setup might be a bit unfamiliar to you but once we actually we can you can keep this simple and you can call this you know model atom this this name doesn't really matter right but this name matters uh great so we just have this now let's call it model State there we go uh so basically what you can now do is for example go back inside of the app folder page. CSX here and you can go ahead and call we use uh create workspace model and it will work exactly as set state so open and set open for example right so that's how we can control it and you can very simply call set open the same way you would you know call use state for example with false as default so this way we just made it Global so this is now global State and it will stay true whereever we add this hook and it will automatically become reactive so that's the cool thing about it so this is what we are going to do now so we're going to leave this as it is and inside of here this is what we're going to check if else if the current model is not open we're going to go ahead and open it for the user like this so nothing will happen now and we also have to add open and set open here in the dependency array don't forget that uh so nothing will will happen now really because nothing can happen right you we are not using this open value anywhere else but here so let's go ahead uh and create that now so I'm going to go ahead and close everything and I'm going to go inside of my source inside of features inside of work spaces and I will create a new components uh right here uh is that correct and I just realized that I created this store folder inside of my features I wanted to create it inside of workspaces my apologies so we have to update the Imports inside of our app folder page make sure that you call the use create workspace model from features workspaces store and save the file and simply refresh one more time here to ensure there are no errors excellent so now let's go back inside of workspaces where we now have the store folder the API and our new we created components and inside create the create D workpace model. DSX like this and let's go ahead and let's import everything we need from our dialogue which we have just added here uh using bun and shaten and let's go ahead and Export const create workspace model and now we can call open and set open here again from use create workspace model like this so now this will be controlled by whether in here we change it to set open true and if we do this will change and we can simply open that model so let's go ahead now and simply return our dialogue here let's map the open to be open here and let's go ahead and create our own handle close method and simply call set open to false because in here to do clear form right I want to do one more thing before I close and let's go ahead and do onopen change here handle close uh and the good thing about this entire solution that I'm doing is that we're going to reuse it one more time in the project later so I'm not doing it just for this page here that's why I want the model so because it's also reusable as a solution and now let's add a dialog content inside of here a dialog header a dialog title and let's add add a workspace here and I think that already uh this can be visible so I want to stop here uh and now basically uh we have to add this workspace model somewhere so for example we can go inside of the app folder uh layout. TSX and inside of here you can add your new uh create workspace model like this uh and let me just see okay use atom is not a function that's because inside of create workspace model we have to mark this as use client and there we go you can see that now when I refresh here even if I try to close it it will force me uh to have this opened right because we use this uh else if not open set it to open so basically we are not allowing the user to do anything other than create a workspace if no workspace is uh well for now what we're doing in the workspaces method is we're simply fetching all workspaces later we're going to change this and it's only going to load the workspaces which you are a part of right so we're going to have a whole invite system but since we don't have that now we simply return all workspace so basically if there are no workspaces we need to create at least one workspace first so let's go ahead and continue working on that but I just want to kind of create a better solution for these models because we're going to have some more models and I don't want to keep them all randomly here in the layout so what I'm going to do is the following I'm going to go inside of my source folder and inside of the components here I'm just going to create models. DSX like this and I'm going to Mark the entire models component in use client so I don't have to mark individual uh workspaces individual models later so let's import create workspace model from features workspaces here and let's simply export const models inside of a fragment because we're going to have uh more of them let's go ahead now and go inside of our app folder layout and let's replace this with models which you can import from comp components models and you can now remove this create workspace model import there we go so now it should work just as well there we go one more thing I quickly want to fix is sometimes there can happen a hydration error if we are using uh things like tand or Yi so there's a very quick uh fix for that which is to only render uh models if we are in client side rendering so the use client uh indicates here a boundary has opened between server and client and that's it it does not actually it's it's it's I as I understood it should not be used as a term which describes the current component as a client component even though I I don't think there's nothing wrong with saying it that way but I think the correct terminology is that Ed client opens a boundary between server and client that's why I can do it inside of here in the models component but my create workspace model is also a client component even if I remove use client you can see that it still works there we go it still works just fine so this technically opened a boundary between server and between client it did not it's not used to turn this into a client component the reason I'm explaining this is because I've mentioned that in order to fix potential hydration error here uh we have to ensure that models only show when client side rendering is done well use client does not mean that this component is not server side rendered it just means that this component and all subsequent components which are is which are its children uh are not server components so server side rendering and server components are not the same thing so what we're going to do here is call this uh mounted and set mounted and by default mounted is false then we're going to call a use effect method here and very simply we're going to change set mounted to be true the reason we are doing this is because use effect can only be called once we are doing client side rendering right so this will not happen on server side so if mounted is not true we're not even going to display any models so we don't cause any hydration errors and we prevent them from for our users and this will work just as it did before so nothing exactly has changed but we just prevented a potential hydration error from Happening Here by ensuring that all models which we add will only show on client side rendering great now let's go ahead and go back inside of our create workspace model and let's actually uh addit some uh forms here right so besides the dialogue we're also going to need the input from components UI input and button from components UI button and now let's go ahead inside of here outside of the dialogue header let's open up a form let's give the form a class name of space y4 inside of the form let's render an input component this in component will have a disabled property of explicit false a value which can now be just an empty string it's going to be required we're going to give it uh so required outof Focus uh minimum length will be three placeholder will be workspace name and let's also give the user some useful uh examples for example uh let's write work personal or home make sure that you use single quotes inside of here because we're using double quotes outside so if you try and use double quotes here it will cause syntax errors uh great so we have that and then below the input let's open up a div with a class name Flex justify and and let's add a button component which will simply say create and disabled let's explicitly write false so we remember we have to add something here and there we go you can see how now every time the user comes on this landing page you can see that uh they have to either create a workspace uh or uh well if they have one we're later just going to redirect them to their existing workspace great so now what we have to do is we have to create an API endpoint uh which will be used uh to create workspaces so let's go ahead and do that now I'm going to go inside of the conx folder I'm going to go inside of workspaces here and above uh get I'm going to add export con create right here and we also have to import mutation from the same place where we imported query from and the arguments are going to be name and the name will be V do string make sure you import V from convex values here and besides the arguments we of course also have the Handler here so the Handler accepts uh context and arguments in the second parameter here so let's first check if we are logged in so user ID will be await out get user ID Also let's turn this into an asynchronous method and we also have to import out from slou like this so out get user ID context if there is no user ID we're going to return sorry throw new error unauthorized like this so users will not be able to create workspaces if they're not logged in uh and now what we're going to do uh is we're going to go ahead and just Define join code to be one 2 3 4 5 6 so for now we're going to go ahead and add to do uh create a proper uh method later because for now I just want to you know create a workspace and now let's go ahead and do const workspace ID to be await context database insert workspaces and inside of here name will be arguments. name user ID will be user ID and join code will be join code and then let's go ahead and simply do return workspace ID there we go so yes every time you create a workspace like this uh it returns back an ID uh sorry not when you create a workspace when you create any document in in convex it returns back an ID it doesn't return the entire element uh if you want to you know you can easily now fetch the workspace so workspace await context database get workspace ID and there we go you know have the workspace in case you need it uh the moment you create it right but in my case I'm just going to need the workspace ID here so let's go ahead now and let's actually create a hook uh similar to our use get workspaces but this will be called use create workspace dots let's get started by first of all importing use mutation here from convex react and then let's also import the API from its place so same thing as we did in use get workspace right but use mutation will be a little bit more complicated and the only reason I want that is so we have a lot of options so I want to know the pending State I want to know if there are any errors and once we succeed I want to know uh when I succeeded and I also want to know did I get back some data from my request so basically I'm trying to replicate a very popular Library called react query and fun fact uh convex actually has the 10stack query uh adapter here the only reason I did not want to use it is because it is in its better state so I thought okay let's go ahead and go uh use it in a way that I'm familiar with it so it doesn't get outdated but feel free to try it out on your own if you don't want to write this entire thing but what we're going to do now is kind of create our own little uh mutation uh similar to react query so first of all uh let's go ahead and Define type options here so type options will give us an on success method here and on success will yield back a void we're going to have on error uh all of this of course can be optional so make sure you put exclamation points here and on settled settled my apologies so this are things that user will be able to add to this mutation uh Depend and basically they want to do some effect after it succeeds after it fails or after it's uh settled which basically means regardless of error or success after we finished the request do this uh excellent and now let's go ahead and do export const use create workspace and let's go ahead and do const mutation use mutation and pass in API workspaces create like this and then let's go ahead and do const mutate to be used callback the reason I'm wrapping this inside of used callback uh is because I need it uh to be supported in case I want to use it outside somewhere in use effect for example so I want it to be memorized so I can safely put it in the dependency array so this mutate method accepts the values as the first argument let's mark it as any for now and options which are optional and they are a type of options which we have defined here and perhaps we can also do uh a type here request type and just make it any and type response type also make it any like this let's go ahead and give the request type to be values like this then inside of here we're going to open a try catch and a finally method in the try method we're going to go ahead and do the following const response will be await mutation and pass in the values and also this is an asynchronous method yes and let's go ahead and immediately add the uh uh my apologies not mutation here uh oh yes it is mutation yes my apologies that's what we're going to do here in the tri block and then what we're going to do is call options question mark on success like this uh it says it cannot invoke an object that's because yes I also have to put exclamation point here there we go so after we succeed we're going to fire the on success method here on the error we're going to go ahead and call on error and execute that and in here we're going to call options unsettled like this and and uh now let's go ahead and do the following so obviously it's not complete yet but let's just go ahead and return our mutate method for now so now let's say we want to use this somewhere so the perfect place is of course uh the actual create workspace model here so I'm going to go ahead and add it here use create workspace from API uh use create workspace like this and inside of here I'm going to destructure our mutate method and let's go ahead and Define a mock handle submit method for now and let's pretend that we're submitting here so right now what we can do here is we can call the mutate method and I can pass in for example you know name of my workspace to be workspace one and uh well joint Cod and Joint code and the actual uh user ID are filled on the server so yes we actually only have the pass in name what you can do now is you can add the second argument for example on success and you can do something here for example uh redirect to that workspace ID and you can also do on error for example inside of here show toast error or you can do unsettled which for example can reset the form if that's what you want to do so this is an example example of how we can now use our API right this is quite familiar to react query but something is definitely missing so this is fine this is great actually but wouldn't it be nice if we could also uh you know get that from here right like data that would also be quite useful for us if we could await that not only that but it would also be useful if inside of here I had some globally controlled is eror eror is Success error data all of those things would be quite useful to also come from here so let's go ahead and see how we can do that so first things first I want to go ahead and I want to change my uh request type to be very simple I know it needs the name property which is string that's the only thing that I expect from here uh like this and my response type here do I even use my response type I don't use my response type and I don't need it because it's automatically generated from here right so the mutation has the response type uh so right now uh oh yes but we have to kind of manually edit here let's go ahead and do this first I want to that whenever we create a mutation that the data is actually passed inside of here so we're going to add data here and we're going to go ahead and give it a response type and then we can just go ahead and use this data or let's call it response actually because we're going to have data separately and let's pass it inside of here so now every time that you do uh your own success method for example you can see that we have access to data like this and then since we know what our create here returns so it returns a workspace ID we can hard type that here so let's go ahead and in import the ID from the same convex underscore generated but this time data model and let's go ahead and pass in workspaces like this so now inside of here I know that my data is actually uh my workspace ID so I could technically do router. push now/ workspaces and then data right that's one way we could use this uh but let's say in case you don't want to return back IDs you want to return the entire workspace so you could do a wait context database get workspace ID and you can return back that newly created workspace we now have some errors here so that's because we now have to modify the response type because this mutation now returns something else here and that would be Doc workspaces right here as you can see now this is a bit more accurate uh but we also have to modify that I believe uh well yes you can see it's not exactly doc uh looks like it has some specific types on its own so I think it's just better to work you know with returning IDs because that's what's default uh that's what's default in convex so let's use it like that I'm just going to replace that here response type and response type there we go and I'm just going to revert this back to return back the workspace [Music] ID uh okay this error is fine great so we now have this and now let's go ahead and do the same thing for the error right so if we actually catch an error it would be a good idea to get that error back to the user so error as error and inside of error here we can Define the error to be a type of error like that unsettle does not accept anything great so now if we have you know our on error we can actually read the information about that error here great so we now have those Solutions uh but I want to do uh a couple of more things here first I also want this to be uh usable in the form that I previously said right so I want to be able to kind of await this mutation if needed for example and I want to receive data here but currently nothing here will happen instead I will only get you know on success data in here but I also want it to be used in this form if needed well that's quite an easy fix in the try method simply return response right so that's the easy thing and now it would also be good if we could uh get error here so for example if I wrap this inside of a additional try and catch I want to get that error here right now I can't do that I can only get it here for example right but what if I really really need it in this way so we need to think about our API and how it will behave well what you can do uh is the following don't just return the error right so that is I mean throw error that can be a bit uh you know that that's a kind of a big decision to make because it kind of changes uh a lot about how this app will behave so what you can do instead is do the following go inside of options and add a new property throw error to be an optional Boolean like this and then inside of here what you're going to do is if options throw error only then throw back the error right there we go now it's safer but it also allows us to handle this in a very specific way so I highly recommend that you do it this way because it will be very useful in the long run great uh and now I also want to add some states here so we just handled all of these cases we can now get on success data here we can get data you can see right here we can get the data here we can also get some errors inside of catch or inside of here as well great but I also want to be able to you know disable all of my input Fields while this is submitting so I want is pending here and since we added is pending it would make sense to also add all the other fields is error is success and also data and actual error all of those things can be useful so why not add them it's very simple to do so so our uh mutation Hook is more powerful than uh it was in the beginning so let's Define data set data let's add use State here and let's define the response type here and by default it's null we also need to import this from react so let's add it here uh like that and response type uh should also be null uh why is this not working uh oh that's request type my apologies so response type or null there we go we have that error set error use State also null in the beginning but it can accept the field of error or null and then we're going to have is pending set is pending use State false we're going to replace this with is Success then set set is Success then we're going to have is error set is error and finally we're going to have uh is settled set is settled there we go and then we can go ahead and call those methods here so in the try let's reset everything so set data will be null set error will be null then we're going to have set is pending to be true but we're going to have all the other fields set is error to be false set is uh settled to be false set is success to be false like this if you want to you can separate them so you can logically see okay the first part is just resetting all of our states and then in here we're just setting the pending to be true like this uh great so now let's go ahead and go inside of finally here and let's add the set is spending to be false finally and set is settled to be true like that so that's how we resolve the pending state so now if you go ahead and actually add all of those things here so data error uh is pending is success is error is settled you can also use them inside of here so for example you can call is pending now and this pending will turn to true when you actually are submitting this so you can go ahead and catch this is pending and then disable the input on that right so that's how powerful our API is there's a billion methods we can now use uh to handle specific cases here now perhaps it might be better to not exactly call this States individually like this because then it can happen if you're not careful that pending is true but also success is true and also error is true so perhaps uh a better solution might be to introduce State set State and then call use State here which can either be uh you know uh either success or it can be error or settled or pending and then you would default it uh maybe you would also add null in the beginning or introduce like uh an idle state so something like that and then instead of having to control the fields like this let me just comment this out perhaps it's a better solution to check is pending to be used memo and check if status is pending uh State uh let's call this status and set status there we go like this so success error settled pending like this uh then let's go ahead and do is Success use memo status is success status here and let's go ahead and copy this for error so status will be error and is settled status is settled like this so I think that might be even better uh and then we don't have to reset none of this I just have to reset you know set status in here to be pending that's the only thing we have to do here and then inside of here I can do set status to null and Set uh actually this will be set status my apology is to settled right so perhaps that's one of the solutions you can use for example so in the beginning none of this would be true and then later uh you know one of them will be currently active like this so I think that's a better solution because this way uh it cannot happen that it's pending and error and settled at the same time but if you're not careful you know uh it could other otherwise happen uh perfect so I think we've covered pretty much anything now and now we can actually submit this right so that's basically what I wanted to do here I wanted to create a very powerful uh mutation which we're of course going to copy and paste for all the other things we need and it's very similar to use Query and it's going to be useful and it's going to be adaptable to all of our needs and cases which we are going to use uh great so now inside of this handle submit form uh we first have to Define uh the event here which is a type of react form event HTML form element and let's do event prevent default right here and then let's go ahead and call mutate and pass in the name and then inside of here oh we don't have name yes so let's go ahead and add name set name use State and let's import use state from react here and I'm is going to add this to the top like this uh let's go ahead and give this a value of name let's go ahead and give it an unchange value event set name event Target value uh did I do this correctly uh set name make sure you add an empty string here in the beginning so it uses the correct type here uh all right and we can the structure is pending here and then we can disable the input if it is pending and we can disable the button if it's pending as well and inside of here then what we can do is we can call on success with data here and we can do console log data like this and let's go ahead and give this form an onsubmit now handle submit there we go so we just created a huge method here and we can remove the import for dialogue description with don't need it uh but obviously I think you can already see how useful this is going to be for us so let's go ahead and try this out now so I'm going to go ahead and refresh this and I'm going to add for example personal and I'm going to click create you can see how it was disabled and now you can see inside of here we get a console log of the newly created ID let's check inside of here if that works so there we go workspaces and this is the ID of our new workspace which was just created Creed in here and now it also caught this redirect to workspace because inside of our page inside of here we finally got the workspace ID so it told us to redirect to workspace so we can redirect from here or we can just leave this page to do its thing as well but it's going to be useful for us to redirect from here as well because as I said uh this will be uh a very this will be a very uh reusable model later which we're going to use uh great so I just want to wrap up with that part so let's go ahead and just create and prepare our uh workspace ID redirect we can do that quite easily by going inside of the source folder and then we can go inside of app folder and create a new folder which we're going to call workspace and then inside we're going to add a dynamic part of the URL which will be workspace ID like this with capital I so our URL will be slw workpace SL1 23 for example and inside of here add page. TSX let's go ahead and Mark this as workspace ID page for example and what I'm going to do here is very simple I'm going to create an interface workspace ID page props params and we're going to D structure inside of here uh the workspace ID which is a string so how do I know it's workspace ID how do I know it's a string well that's because we named it workspace ID inside of this folder so this folder name is important and make sure it is in curly brackets otherwise this will not be recognized as Dynamic part of the URL so workspace and then 1 through 3 for example and then inside of here I'm just going to do ID and I will be able to destruct this so workpace ID page props forams perams workspace ID so let me go ahead and try manually now I'm going to go to Local Host 300012 3 uh whoops SL workpace one two 3 there we go it says ID one two three so go ahead and try out the same and now let's go ahead and actually redirect to that location so I'm going to go ahead and do the following I'm going to go inside of source inside of page. vsx I'm going to go ahead and add router from use router from next navigation and then inside of here I'm going to go ahead and do the following router. push or we can actually do router. replace so the user can't manually go back here and we're going to go to slash workspace slash open uh this template literal object inside and pass in the workspace ID and then we also have to add the router inside so the difference between router push and router replace is that uh router replace replaces the current history entry so when you click back in the browser uh it won't lead you back to you know uh just this page where we are now which is just a random slash so there we go you can see it's already working so now if you're logged in if you if you try to visit local close 3000 you get redirected to this page right so if you uh just logged in you will be redirected to the first workspace that we can find for you or we're going to open up a model so let's try this out uh one more time and we also have to do one more thing here which is we have to revisit our uh where is it features workspaces components create workspace model let's go ahead and let's add const router use router here from next navigation as well so make sure you've added the import and what I'm going to do we can also do in the handle close set name to an empty string now and then on success here I'm going to do router. uh push so we can do push here because you know it's a different type of uh this is kind of intentional whereas this is a side effect so inside of here I'm going to do SL workspace and then data right so I know that my data is an ID so you can actually call this ID if you want to perhaps that will make more sense right so don't confuse it just because I call it data does not mean it's an object if you really want to stay consistent throughout your project what you can do uh inside of the workspaces you can you know wrap the this inside it like this so then this will be an object and then everywhere you would have data and you can do data do ID inside right but you can see how it's kind of buggy right so I'd rather we just we just work with a direct return of workspace ID like that so make sure you directly return workspace ID and inside of here you do this great let's go ahead and try this out now so uh this should not be open now there we go it's not opened so what happens if I go inside of my workspaces and if I clear the workspaces table and if I go ahead and go to Local Host 3000 there we go and I will now type personal and there we go I'm redirected but this still stays open so that's one thing uh that we have to do is call handle close so let's try this again I'm going to go ahead and delete my workspaces table again let me go back to Local Host 3000 here I'm going to type personal and there we go I'm redirected to my workspace ID great so I want to add one more thing before we wrap up so it's another thing from shaten hold toaster uh soner that's what it's called there is a toaster but but I specifically want soner so let's go ahead and add soner now so this is quite simple to do uh we go inside of source app folder layout. TSX and inside of here we import the toaster from components UI soner and simply add it you can add it just uh above the models for example it's a self-closing component and then for example if you go inside of uh create workspace model you can go ahead and import toast from soner and then inside of your on success you can add post. success workspace created like this so let's try it one more time I'm going to go ahead and remove all of my workspaces here I'm going to go ahead and go back to Local Host 3000 and I'm going to write work here and there we go now I have this workspace created uh popping up right here perfect so what we're going to do next is start designing the workspace view great great () job now that we have our first workspace let's go ahead and let's Implement some methods some components which will actually display the name of this workspace and also give us an ability to create additional workspaces so I want to start by revisiting our page. SX but not this one our new workspace workspace ID page. vsx where this is how we accessed the current worksspace ID I want to show you another way of doing that which is if component is a client component or if it is inside of the client server boundary so in that case this is what you can use you can go ahead and Define your params by using use search params from next navigation and if you go ahead and try this uh looks like it is still not working because it's not search params my Hypes it is used params search params are four queries there we go now we have our ID in an alternative way the only issue here is that uh workspace ID might not always be uh a part of this params thing so what you can do for example is Define a type here for example you can go ahead uh and Define workspace ID to be a type of number and then this would be a number right so that's something that you can do here so what I want to do is a reusable hook which will be used to aace to access workspace ID wherever we might need that so let's go ahead and let's uh put this inside of our common hooks so I want to do that in the source folder here I'm going to go ahead and create some Hooks and inside I'm going to create use workspace ID like this and then inside of here I'm going to import use perms from next navigation and I'm also going to import the ID type from convex undor generated data model let's export cons use workspace ID here and we're going to go ahead and Define the params and then we're going to return param workspace ID as ID workspaces basically what this will do is save us a lot of type errors because the ID workspaces is something that is compatible with our convex mutations but also has the normal string properties so we won't have any issues for this being a type of ID because this is is inherently a string so let's go ahead now and try it out inside of our workspace ID page so I'm just going to go ahead and Define const workspace ID to be used workspace ID and then let's go ahead and just render the workspace ID directly here and we no longer need this just make sure you have used client put here and there we go works just as it did before great now let's go ahead and and let's revisit our workspaces API so inside of convex our workspaces here and let's go ahead and Below get let's export con get by ID let's go ahead and Define the arguments to be ID of workspaces like this and let's add a Handler here which will be an asynchronous method which accepts the context and the arguments like like this now inside of here I want to go ahead and get the user ID from await out get user ID if there is no user ID we're going to throw new error unauthorized and let's also pass the context inside of here like this and now what I want to do uh is I want to Simply do return await context database get and pass in arguments. so later obviously we're going to restrict this so only those who are members of the workspace can fetch its information but for now we don't have the members functionality yet so we're just going to allow anyone who has the ID to fetch that so let's go ahead now inside of uh page workspace ID here and let's go ahead uh and actually first go back inside of features workspaces API and inside you can copy and paste use get workspaces and rename the copy use get workspace so singular workspace like this let's go ahead and let's create interface use get workspace props to be an ID which is a very simple ID of workspaces let's go ahead and Define the props here to be used get workspace props and extract the workspace or sorry just the ID and use Query we'll use the API workspaces get by ID and in the second argument we're going to pass in our ID there we go now let's head back inside of our page here and then we can go ahead and exra data from use get workspace and pass in ID as workspace ID there we go so we are now using our newly created us gate workspace in combination with our newly created workspace ID and then in here we can Json stringify data and we can call this data and there we go now you can see the entire model and you can see the name work you can see the join code you can even see the user ID which created it great so now that we have this done uh let's go ahead and let's actually develop the layout for this specific uh route segment so inside of workspace ID where we have page which is a reserved keyword which is used to create new routes there is another type of reserved uh file which is called layout layout is used to create reusable well layouts uh among on a specific route segment so later in the workspace ID when we have slash Channel and then Channel ID this layout will be reused for that page as well so we can save some time repeating code there are a few cavates with the layouts so let's go ahead and learn about them first of all just like Pages you need to use default export for them so I'm going to call this workspace layout and the second cave is that if I just added div and write layout here you can see that now I can no longer see that page I can just see layout that's because just like our root layout so right here in layout. DSX so the root layout just like our layout here requires the children prop so the children are the rest of the route segment which will be rendered inside of that layout so let's go ahead and create create an interface workspace I want to call it workspace ID layout since this is you know workspace ID segment so workspace ID layout props will accept children which are a type of react react node and let's go ahead and Define workspace ID layout props and get the children let's fix this here and then we can render the children inside and then there we go we are back to where we started but we can do now is we can create some reusable elements for the rest of that route segment great so let's start by doing the following so let's go ahead and give this div a height of full and let's go ahead and give it a background color of red so we confirm that it took up the whole screen if yours is not in that case confirm that inside of your app folder your global. CSS you have this part of the code now okay I have this error here which is just because something is cached incorrectly uh you probably don't have that great so we're going to leave this at height full and then what I want to do in here is I want to add a toolbar component right so toolbar is a component that does not exist yet but we're going to go ahead and create it now so since we want to use it anywhere outside of this route segment we can just create a new file toolbar. TSX inside of here if you want to you can create a components folder inside but honestly uh the app router allows us to do whatever we want here so I'm just going to create a toolbar. vsx so this will not be you know what's important is that you don't name your components layout page error or loading because those are reserved keywords you can find them in the nextjs documentation but stuff like toolbar you know feel free to call it like that let's go ahead and Export cons toolbar here and let's go ahead and write toolbar then we can go back inside of the actual layout and we can import the toolbar uh let me just refresh and there we go now we have the toolbar here so that's basically how layout works right let me go ahead and try and explain this further so I'm going to give it the background color of red 500 and you can see that this is our toolbar or or nav bar above right so now if I in the future have you know for example channel here and then inside Channel ID and then inside a page. DSX you don't have to do this I'm just demonstrating something now so Channel ID page div hello and then if I change my URL to/ channel sl12 3 there we go you can see that it has a completely different route segment now but but it still has that toolbar right and the cool thing is that the layout part will not reender on route changes right so that's how those layouts work that's why the children prop are important uh great so I'm going to remove the channel folder now because I just used it for demonstration all right so back inside of my tool bar here let's go ahead and actually style this so instead of using div you can use the nov property instead of this color let's go ahead and give it a specific hex color of 48134 9 like this and let me just go back to my workspace ID page there we go now inside of here I'm also going to give this a flex items Center justify between height of 10 padding of 1 5 and that should be it right so I just kind of expanded it now right now inside of here I'm first going to go ahead and create an empty div and I'm just going to give it a class name of Flex one so basically I'm just going to go ahead and take up some space here in the Nar because I plan on centering uh my toolbar here now inside of here I'm going to go ahead and open up a div and I'm going to give this div a minimum width of 280 pixels I'm going to give it a Max width of 642 pixels I'm going to give it a grow of two and Shrink property and now inside of here I'm going to add a button component from components UI button so it should be visible right here now I'm going to go ahead uh and give this button a size of small and I'm going to give it a class name of BG accent sl25 that means opacity hover background accent 25 which means don't change it on Hover because by default buttons have different colors on Hover we are overwriting that now I'm going to give this button a full width which will basically be however uh this parent container is resized and I'm going to give it a justify start so the elements inside are not centered inside of this button I'm going to expand this button to height 7even and a px of two on left and right there we go so let me just zoom out a bit so you can see how this is looking now all right so now I'm going to go ahead and inside of this button I'm going to add a search icon from Lucid react I'm going to give it a class name of size 4 text white and margin right of two and inside of here I'm going to add a span element which will say search workspace I'm going to go ahead and give the span text white and text extra small there we go now we have a button here which says search workspace great and now let's go ahead and do the following so I'm going to go ahead outside of this div here and I'm going to create another div with a class name ml AO Flex one Plex items Center justify and and inside of here I'm going to add a button component with an info icon so make sure you've imported the info icon from Lucid react as well here and this info icon will have a class name of size five and text White and the button itself will have a variant of uh let's go ahead and try with Ghost and see how that looks like all right close but not exactly what I imagined so I want to go inside of the button and I want to modify it a bit so you can command click on the button here or visit your components UI button. CSX alongside Avatar card and all the others so we played with this in the beginning of our project and now we're going to go ahead and actually add a new variant here and let's call it transparent so this will have a background color of transparent on Hover it will be a background color of accent with an opacity of 10% and text will be accent but we're also going to do something else which is we're going to add a specific icon SM meaning icon small which will have a height of eight and a width of eight here uh like this and let's also do some modification here so the regular small button should have a height of eight here like this and the rest can stay the same now let's go back inside of our toolbar here and let's replace the variant of this button with transparent so now it should look just a little bit better great and let's go ahead and give our button a size of Icon small there we go now it's looking much better perfect so we now have that and now what I want to do is I actually want to render out the workspace name here so we're going to go ahead and do this I'm going to get workspace ID from use workspace ID from my reusable Hooks and then I'm going to go ahead and call use get workspace here uh so individual workspace from my feature workspaces API use get workspace and I'm going to go ahead and pass in the ID prop as workspace ID and then in here I'm going to destructure the data and then I can go ahead and use data question mark name inside of here and now we have a problem because my toolbar uh is not a client component but what we can do here is we can simply Mark the entire layout as use client because this is mostly going to be uh kind of an interactive app not much server s uh server components are going to be used here so we can safely Mark the entire layout as used client but here's the thing you might not know just because you mark a large chunk or segment of your route as used client like layout does not necessarily mean that children are going to be uh P passing the client server boundary because you can put server components inside of client components you can do that by using the children prop so in case you were wondering uh does this mean that all subsequent children nested routes will be clim nope as long as they're passed through children which is how layout Works they will not be client components by default all right and now since we marked our layout as use client it means we already are in the client server boundary here and there we go now at least for me uh this says search work because that is inside of here let me just log in here here I am let me find the workspaces there we go so my workspace name is work if I go ahead and change this to uh code with Antonio workspace and I go back here there we go it says search code with Antonio workspace excellent so we just wrapped up the toolbar and we have the basic functionality of how to fetch our data uh before I wrap up the chapter I just want to tell you that uh this use get workspace which we call here and the one which we call here is actually cached so whichever one uh gets called first will be cached so the any subsequent calls will not exactly be calls but more like a global state which is now stored until convex detects a change on the back end and it will automatically update in all places so no using it in multiple places uh is not causing multiple calls or stressing the back end so you can safely do that just like you would with react query great great () job just as we've created our toolbar component we can now create our sidebar component so let's revisit our layout where we render the toolbar and let's go ahead and wrap our children here inside of a div this div will have a class name flex and a height of calculation 100 viewport height minus 4 40 pixels which is basically the offset for our toolbar here which is 40 pixels so we could technically offset by 10 oh we are using calculations so yes we cannot do that we have to write specifically here in pixels uh great so now we have that and now let's add our sidebar so basically the children and everything inside of this div will be offsetted its height will have offsetted height by 40 pixels here so now we have to create the sidebar and we can do that in the same place here so sidebar the SX and let's export con sidebar and let's return not a div but let's use the aside element let's write sidebar and in the layout let's now import the sidebar not from L seed but from do/ sidebar so the same way we imported our tool bar uh and now you can see that I have the text sidebar here it's kind of conflicting with this text data but that's fine so basically this is our sidebar and now let's go ahead and actually give it some Styles so I want to give it a class name of width specifically 70 pixels a full height a background color of a specific hex 4 81 34 9 Flex Flex column Gap y4 items Center padding top of nine pixels and padding bottom of four pixels let's take a look there we go so now it has the same color as our toolbar here but it only fills up this much space and now inside of here what we can do uh is we can just add an empty div here and just type a letter A for example and then another div here which will render our user button component from features out components user button there we go this is our user button now now let's go ahead and give this div a class name here of flex Flex column items Center justify Center Gap y1 and margin top of AO and there we go you can see how now it is here at the bottom great now let's go ahead and replace this with a useful component called workspace switcher like this so let's go ahead and create our workpace Das switcher dtsx component in the same space here and we can just quickly export con workspace switcher here and return a div whoops workspace switcher let's go back to the sidebar and we can import the workspace switcher component from do/ workspace switcher and we should now just have a text which says workspace switcher I've been logged out let me log back in there we go workspace switcher great inside of this workspace switcher let's go ahead and let's import everything we need from the drop down menu so that's the drop down menu the content the item separator and the trigger so now I'm also going to go ahead and replace this div with the actual drop down menu like that and inside of here I'm going to add a drop down menu trigger and inside of here I'm going to add a button component uh from components UI button like this and then inside of here I'm going to go ahead and simply render a letter A for now let's go ahead and give this button a class name size 9 relative overflow hidden background color specifically of a b a b a d on Hover it will have the same background color but with a slight OPAC so sl80 and then we're going to have text slate 800 Font semi bold and text extra large so all of those class names for this button here so let's go ahead and take a look now there we go so this is the button which we're going to use to switch our workspaces so B below this we're going to have a drop- Down menu content which will have a side of bottom and a line of start and a class name of with 64 so now when you click on it there we go you can see a little drop down popping up here and now let's go ahead uh and actually add some hooks here before we go any further so first of all I want to get the workspace ID and I can do that using our usable use workspace ID hook like this I'm just going to move it here alongside with a button then we can also get uh data which will be Alias to workspace from use get workspace and pass in the ID as workspace ID and then down here let's go ahead and let's get data workspace from use get workspaces like this so we have these two features I'm going to separate feature Imports here like that so use get workspace and use get workspaces and we can join them here so this call is are together and let's add is loading and let's remap the loading to workspace loading uh and this other one use get workspaces which I've just moved above will have is loading remapped to workspaces loading like this great and if you want to you can separate this so it's more readable and now I want to go ahead and write const filtered workspaces which will be a very simple method which will look through the existing workspaces and use the question mark. filter and inside of the filter method it's going to get workspace as the argument and it's going to check whether workspace question markor ID is not equal to workspace ID basically in the list of available workspaces I don't want to render the currently active one right so if you only have one workspace I don't want to render it again in the list of available workspaces great so we now have that and here's another thing which we're going to already prepare here and that is using create workspace model remember that so that's the cool thing it is reusable so we use it previously for something else and now we can explicitly call it here how well very simply we have open and set open like this but we are not going to need the first argument so we can prefix it with an underscore which as you can see changes its color as if it is being used you can see when I remove it it's kind of grade out but when I add it it's like it's being used so this basically is a universal method of saying all right I'm not going to use this but I need something filled in this place because we can't just get to set open I mean there are you know some syntax tricks you can do but this is just fine so let's go ahead now and use all of these things we have just added so the first thing I want to add in this button here is this if workspace is loading so individual workspace not uh not workspaces but individual workspace if that is loading I want to go ahead and render the following I will just render a loader from Lucid react so make sure you've added loader here I'm just going to move the import to the top here I'm going to add a loader and I'm going to give it a class name size five animate Spin and hover whoops shrink zero otherwise if we finished loading I'm going to show workspace question mark name do character at index0 to uppercase like this there we go now it says C because the full name of this workspace is code with Antonio workspace which begins with a letter C excellent now let's go ahead and do the following in the first uh item here so drop down menu item we're going to do the following we're going to give it a class name cursor pointer Flex column justify start items start and capitalize and inside we are going to render workspace question mark name and then below that we're going to add a little span active workspace we're going to get give this span a class name of text extra small like this and text muted foreground so now there we go you can see that this is the currently active workspace here and let's go ahead and now also add the router here so con router use router from next navigation make sure you add this import here I'm just going to move it here and I'm going to go ahead and give this drop down menu item on click router. push open template literals SL workspace and then we're simply going to use workspace ID from our use workspace ID here so now the user if they click here will just get redirected to the homepage of their workspace so if they are in some Channel or somewhere and they just want to go back they can just click here and it will refresh the entire workspace for them great and now what I want to do is outside of this drop down menu item I want to go ahead and use the filtered workspaces map get the workspace and I want to add a drop-down menu item here I'm going to go ahead and give the drop- down menu item a key of workspace doore ID a class name of curs pointer and capitalize I'm going to give it an onclick which will call router push open backx SL workspace and then a simple workspace doore ID like this so now uh let's go ahead and well the thing is I don't think we should develop at now because we can see this right so this is what I want to do first uh outside of this map add another drop down menu item which we're going to use to create new workspaces so I'm going to go ahead and add a div here with a class name size 9 relative overflow hidden background color open this exact hex color F2 F2 F2 text will be slate 800 Font will be semi bold text will be extra large the entire component will be rounded MD we're going to have a flex here items Center justify Center and we're going to have a margin right of two like this so a very long class name here feel free to pause and take a look and inside of this div here I'm just going to go ahead and render the plus icon from lucid react so make sure you've added the plus icon here and then outside of this div I'm just going to say create a new workspace so now there we go you can see we have a nice little uh button here so let's also give this drop down menu item a class name of cursor pointer and let's give it an on click here very simple set open to True which set open well this one the use create workspace model so now if you click here there we go so I'm going to call this one uh personal there we go and now inside of here we can go ahead and try out whether this is working or not so let's go back inside of the filtered workspaces now and now inside of here I'm going to go ahead and add a div workspace name character at zero to upper case and then below that workspace do name there we go so I can now switch between personal and code with Antonio workspace here uh great so now let's go ahead and let's style this a bit better so I want to go ahead and copy this entire div here which we used for encapsulating the plus icon and we can paste it here right like this and let's just change the back color of this one uh to be 61 6 uh 061 I like this and let's use the text white and I'm pretty sure everything else can stay exactly the same as the one below and there we go now you have a nicer uh switcher here and I'm pretty sure you can notice this little uh kind of bug that is happening so the only reason that is happening is is because of this uh stringified Json here so let's go ahead and see if removing that will fix it so inside of workspace ID page. DSX let's just say uh workspace ID page here and we no longer need this nor do we need this and we also don't need any of this at that point so I'm changing workspace workspace ID page and I think that now regardless of which one we are on there we go we have a nice little uh look here perfect so this is a long name so perhaps we can kind of truncate it let's see instead of workspace switcher uh I can maybe add uh truncate here in the beginning and let's see if that will change anything it will not what if I add overflow here overflow hidden here still not how about if I add truncate here here uh looks like now it's beginning to look like something oh I added trunade here that's not what I should do what I should have done here is ADD shrink zero that's what I need to add here and then this should be truncated and I think that we can do that in this way so this is Overflow hidden and then this will be a paragraph and let's give this a class name of truncate there we go so now we have a nicer solution perfect so long names will now get truncated like this excellent so you now have a nice little sidebar here uh so let's go ahead and wrap up the sidebar by adding another type of component uh which we are not exactly going to you know use too much but it might give you some inspiration to uh extend this project yourself so below the workspace switcher let's add a sidebar button like this so sidebar button and let's go ahead and in the same place add it sidebar button. TSX like this so the sidebar button will have an interface sidebar button props it will accept an icon of either Lucid icon from Lucid react or I type and then we're going to have a label which will be string and is active which will be a Boolean let's export con sidebar button here and let's go ahead and add sidebar button props uh whoops sidebar there we go inside of here let's the structure label is active and all of these things and let's go ahead and let's return a div with a class name Flex Flex column items Center justify start my apologies justify Center Gap y.5 cursor pointer and group inside of it let's add a button component from components UI button and I want to stop as here because it would be nice to actually see what we are doing right so let's go back inside of sidebar and let's go ahead and import sidebar button from do/ sidebar button let's go ahead and give this an icon of home from uh whoops Lucid react so make sure that's the one you import we're going to give it a label of home and is active so now you should have a new button here so let's go ahead and give it some uh new uh uh uh props here so variant for this will be transparent class name will be the following let me just collapse this to so class name will use the CN from lib utils which will allow us to conditionally render Tailwind classes without any conflicts so yes there are you know of course alternative ways of doing that using template leral you can just do is active and then one class name otherwise another class name but it is very very easy for this to be messed up and cause some weird bugs so trust me just use the CN Library it comes with shaten UI so it is inside of lib utils so you have it if you have shat CN installed which is something we do so inside of here I'm going to go ahead and add default classes which are size 9 padding to group hover uh background accent with an opacity of 20 so that's the default classes right which are kind of hardcoded so we can put them in the first parameter and then in here let's conditionally render BG accent 20 to be the default one if something is active and inside we have to render the icon which we passed which we can do using the icon prop but we first have to remap it to icon with capital I so that it can be rendered as a component like this and then let's give the icon a class name of size five text white group hover scale 110 and transition all and outside of the button create a span which will simply have the label and give this a class name of text 11 pixels text White group hover text accent and there we go you now have a nice home icon here like this and now let's go ahead and go inside of the sidebar and we can render this a couple of times and let's remove is active from the other ones let's go ahead and add messages Square icon from Lucid react so make sure you've added this let's give this a label of DMS let's go ahead and give this a bell icon so yes with Lucid react you can either import Bell or Bell icon right so it's useful if you have a component named Bell and then you want to add an icon which is called Bell so Lucid offers you to either import Bell or Bell icon it's the same thing so all uh Imports are prefixed with uh suffixed with icon as well so I can also do messages Square icon you can see no error here in the import but it still works right so you can do that if you want to so Bell here and more horizontal here from Lucid react let's change this label to activity and let's change this to more and there we go you now have a beautiful sidebar here so we are primarily just going to focus on the homepage uh but if you want to you can later develop you know your own uh previews for this don't worry we will have DM functionality of course right but uh we're going to see what we're going to actually do for the screens of this so uh if you want you can also modify when these are visible right by using path name so use path name from next navigation like this so let's move that to the top and then you can go ahead and modify each of these is active to be if path name includes slash workpace for example there we go in that case home is active right so that's how you can uh do it dynamically if you don't want to hardcode it great so we're going to come back to this later uh what I want to do in the next chapter is implement the channel sidebar here so we can actually start rendering some channels and another important functionality is uh actually members right because right now I can load pretty much any workspace from anywhere right and if I know the ID of a workspace I can just enter it inside of my URL and it will join right here and I I will be able to see all the channels they have messages and everything well that's not good right so we're going to have to actually Implement some member functionality as well great great job let's continue and let's develop the () members functionality and also the beginning of the channels sidebar here and before we do any of that I have an error here which tells me that I have a hydration error and it tells that a button cannot be inside of a button so where is that exactly happening and you could perhaps have the same error it's happening in the workpace switcher component here because our drop- down menu trigger wrap a button component the drop- down menu trigger in itself is already a button so what you can do is Mark it as a child like this and when you refresh the error is gone great now let's go ahead and let's do the members functionality so I'm going to go inside of the source folder my apologies inside of the conx folder schema and below the workspaces I'm going to add members I'm going to use the Define table method here and I'm going to add user ID which will be associated with each member I'm going to add workspace ID so I know all right so this user is a member of which workspace right and we're going to have a role of each member in the workspace so that's going to be a union of options and we're going to use v. literal admin and member we can also use guest or whatever else you prefer there we go so basically each user will have its own member profile depending on what workspace they are in so that's how we are going to implement the DM functionality because otherwise uh DMS would be Global right but this way DMS are only on the level of a workspace so each user has a personal identity in that workspace which we are going to call member great and now let's also add uh some indexes here so we can query this faster so the first index will be called by user ID so if I quickly want to find a member by the user ID I will define an index here which will simply allow me to query faster and more optimized by a user ID then let's open also do the same thing by workspace ID and let's go ahead and Define which properties should we uh look for here well that's the workspace ID and last index we're going to add is a combination of both so by workspace ID user ID so for that we're going to look for both uh well in the first place workspace ID and then user ID there we go so we now have optimized ways of looking for these items right here great so where do I want to use this first well I actually want to use it in our uh method uh let's go ahead and go inside of uh workspaces here we're going to use it here right so this is where I want to use it first in the create method here so let's revisit our create method one thing that we are not doing after we create it is we are not creating any members so if we are the user that created a workspace it would be correct to assume that we are the admin and the member of that workspace so let's do await context database insert members user ID workspace ID and role of admin like that you could eventually uh you know every now and then just take a look at your terminal where you're running bonex convex Dev or npx convex Dev and just confirm that your latest logs are all uh uh correct right all success messages you should not have any errors otherwise the members might not be synchronized for you great so now every user that creates a new workspace will also be a member of that workspace so let's try that out now I'm going to go ahead here's my data so I have two workspaces right but I don't have any members but now if I try again and create a new workspace I'm going to call this test there we go I have a new workspace now and I now have a member role of admin for let's go ahead and see for this user ID that is correct and for test workspace perfect so our code is working great so now that we have this ability to add an admin every time we create something uh let's go ahead and modify our get query so this get query now uh should only show me servers uh I mean workspaces that I am a part of so let's do that by modifying it like so user ID will first of all be a wait out get user ID if there is no user ID and of course we have to pass in the context here if there is no user ID uh here's a practice that I'm going to follow in queries I will not throw errors right I will simply throw default empty States whereas in mutations I will throw errors because I can catch them but for queries I can only catch them with error boundaries and that's just not the perfect solution for me so I'm going to do things like this I will just throw an empty array for a person who is trying to fetch something right and and um I know that they won't be able to like this and then let's go ahead and let's see uh I want want to find all workspaces that this user is a member of right so what we can do is we can fetch all members that this user has right so I want to find all U tables which have user ID of my currently logged in user and I'm looking for all the members that exist basically I'm looking for all servers that he is a member of he or she is a member of right so let's go ahead and do uh await context database query members with index by user ID and let's go ahead and do query equals user ID equals the current user ID so we are using our uh newly optimized index here there we go and let's not forget to collect in the end so now this will get all the members that I am a part of with a very optimized index Here and Now let's go ahead and let's get all workspace IDs that we can extract from here so members. map member workspace ID let's go ahead and Define the workspaces array here so we are now going to generate the workspaces using this so very simple for const workspace of workspace IDs let's get the workspace by very simply calling await context database get and pass in the current workspace ID from the loop for con uh this is workspace ID like that if there is a workspace and only if there is a workspace go ahead and push to the array above like this so the reason I'm using four here is because I'm doing a weight you can use promise all in combination with map if you want to use do map really but I think this is just cleaner but you cannot use normal do map and then just mark it as a synchronous and use a weight inside you cannot do that you can do it if you use promise all solution but I suggest you just do it like this it's cleaner and uh uh it's cleaner what's happening right and then we are not going to return the entire query here but instead just workspaces so let's take a look at this now now if I go ahead and click here you can see that all of a sudden all of my workspaces have disappeared that's because remember even though I have multiple workspaces uh do I even have workspaces oh looks like I don't even have workspaces so this is what I'm going to do I'm going to go ahead and delete my workspaces here I'm going to go instead of members and I'm going to delete my members as well and now I'm going to log out all right I'm going to log back in here and I'm going to create a new workspace here which I will call uh GitHub workspace right so basically I want to ensure that I am a part of this workspace here then I'm going to create a new one which will be called GitHub 2 there we go so now I have have GitHub workspace and GitHub 2 right this is my GitHub account so I have these two workspaces because I'm a part of them and now I'm going to log out and I'm going to go ahead and log in with another account I believe I still have this there we go uh and let's take a look at what just happened so I am redirected back here for GitHub 2 but I am not a part of that and you can see that when I click in this switcher I cannot see these workspaces right I think I'm just accidentally actually seeing this because what should be happening is just this right but you're already noticing a bug here so this part works fine so this part knows that I am not a part of any workspace and I should be getting this model you might getting be getting this model right depending on where you were redirected it to but you can see that if I just copy the URL from my previous workspace which was in my GitHub account I can still see it right here right so let me repeat what I've just done I'm going to go ahead and go inside of this GitHub here there we go I am here so these are my actual workspaces which I've created and I'm going to copy the URL of one of them I'm going to log out and let me see can I even do this okay so I can do this because of our middleware but let me go ahead and use my Antonio account and I will go ahead and now change the url and there we go I can still access this workspace even though I'm obviously not a member of that workspace so now uh that tells me that we have to modify our get by ID here so it also looks for the member so we kind of have this solution finished here so let's go ahead and use const member to be await context. database query members with index by workspace ID and by user ID so we want to find that unique combination right so inside of here I'm going to check if query equals for workspace ID to be arguments. ID and then I'm going to change the equals for the user ID to uh equal to the current user ID so this way I fill the entire index and I know that this will be a unique member right so only one member with the same user ID and workspace ID can exist we obviously did not limit that in the schema but our functionality is telling me that that's how it's going to work right so now if there is no member I will just return no so now if I try and refresh this I should not be able to see anything and there we go you can see how it loads but not exactly right you can see that this is kind of broken and my search is also broken basically it doesn't know where I currently am so obviously later we're going to have some proper error screens here but right now I think this is working just fine uh great so we have this so what I want to do next is I want to go ahead and actually modify uh this uh join code method here so how about we do const generate code and we're simply going to go ahead and let's do const code to be array from length will be six and then we're going to create a method here which will very simply use a combination of all of these characters so 0 1 2 3 4 5 5 6 7 8 9 and then all lowercase letters so a b CDE E F G H I J K L M N O P QR s t u v WX Y and Zed there we go no need for any external library and let's go ahead and randomly generate something multiply this by 36 there we go and then join everything and return the code and now let's use that generate code here there we go so now if you go ahead and actually go back to Local Host 3000 here and uh write you know uh Code test for example go inside of data here check your workspaces and Code test should now have a more original code as you can clearly see right here great so I suggest that you don't add uppercase letters right so because we are any we I'm my codes are not going to be uh case sensitive right so whatever user enters lower case or uppercase will be correct I just want to keep it simple uh great so we have this now now what I want to do is I want to go ahead and build this part of the uh sidebar so I can open up the preferences and so I can also add some uh invite code generation so that we can practice inviting our users right because now we know that each user has their own workspaces right uh so not everyone will be able to look at them so we can already practice inviting that other user to be a part of our workspace so let's go ahead and now work on creating this sidebar () let's go ahead and let's implement the channels sidebar here so I'm going to go ahead and add a shatan component which is going to be called resizable let's wait a second and there we go so now let's go ahead and let's go back inside of our layout for the workspace ID so inside of source app folder workspace works space ID layout right here and let's go ahead and import everything we need from resizable here so resizable handle panel and panel group now let's go ahead and uh below the sidebar let's add a resizable panel group and let's move the children inside then inside of here let's that resizable panel where I'm going to Simply render a div workspace uh sorry channels sidebar and then for the children here we're going to add a new resizable panel and let's just wrap it around uh just like this now I want to go ahead and give the resizable group a direction of horizontal and I want to add uh right after this resizable panel let's add a resizable handle and let's add with handle here so let's see can we already take a look at this and there we go now we have this huge split in the middle of our screen one is a channel sidebar and one is a workspace ID page and you can see how cool it is that we can expand this right but it doesn't exactly load correctly so I wish that channel sidebar would load something like this and I wish that it can only expand to let's say this far and that it can only collapse to let's say this far well we can do all of that so let's go ahead and let's go inside of the first resizable panel here and let's give it a default size of 20 let's give it a minimum size of 11 and let's give it a class name of background color and let's go ahead and write a specific hashtag 5 E2 c5f and there we go this is now looking much much better but it's not perfect just yet specifically because every time I resize it to a certain point if I refresh there are some weird flashes and it just does not keep its size here so let's go ahead and do the following before we continue let's first add to this resizable panel with children a minimum size of 20 so this way we cannot collapse it entirely so both now have their limits right and now in order to fix the fact that this is forgotten after we refresh let's go ahead and simply add autosave ID and let's go ahead and call this uh I since this is going into Local Host let's prefix this with you know our uh I don't know I'm going to use some CA like code with Antonio you can use whatever you want CA workspace layout like this and there we go you can see that now when I refresh it stays where it was perfect now let's go ahead and fill the first resizable panel with a component called workspace sidebar now let's go ahead and create that so workspace there sidebar and inside of here we can just turn a div for now workspace sidebar let's go back inside of the layout and we can import our new component the same way we added toolbar and the generic sidebar great and before we can continue forward with this uh we need to create a few end points for our members so let's go ahead and go back inside of convex and let's create a new file called members specifically I'm interested in my current member so I'm going to go ahead and add a query here and of course we have to import the query from doore generated server the first argument is going to be whoops this is supposed to be an object just a second like this this so arguments will accept workspace ID and we also have to import the helper from convex values and then inside of the Handler here which has context and arguments which will also be an asynchronous method we're going to go ahead and fetch the current member for a specific workspace so let's get user ID using a weit out get user ID and pass in the context if we're missing the user ID we are simply going to return null remember my practice here is to not throw errors in queries only in mutations and now let's go ahead and write const member await context database query members and we are looking for that index which we previously already used by workspace ID user ID so that index is what we are looking for so now inside of here we can get uh the query and we can do query equals workspace ID with arguments workspace ID and then we can chain another equals user ID equals user ID and let's not forget to collect the result if there is no member return null again otherwise we can go ahead and return the member there we go so now let's go ahead and let's actually uh turn this into a hook so I'm going to go inside of source features and I will create a new folder called members and inside of here I'm going to create an API folder and a new use current member. DS let's exper con use current member and let's get the data using use Query from convex react and API from its location so just like we previously did and we're going to call Api members. current and we also need to create an interface here use current member prop to accept workspace ID which will be a type of ID workspaces and in here let's just assign those props so use current member props we'll get the workspace ID and then we can pass in the workspace ID HST is loading will be uh if data is undefined and let's return data and if is loading like this so now we can go ahead back inside of the workpace sidebar so that's located inside of the app folder workspaces workspace sidebar here and we don't have to mark this as a client component because we already uh crossed that boundary in layout here so we use the workspace sidebar inside of here so everything is fine let's get the workspace ID using our use workspace ID hook here and then let's go ahead and let's get the member use current member and let's go ahead and get use workspace whoops use get workspace so the reason I differentiate between uh you know calling this use current member and this use get workspace is because we are not explicitly telling anyone uh what member I want to load right so it's just the current member depending on the workspace ID whereas in here I specifically want to load this workspace ID so that's the difference in naming so that's why I also have use current user because I don't specify which user just the currently logged in user right all right so inside of here we have to pass the workspace ID and inside of here the same thing but we call that ID no need to be redundant right so I'm going to go ahead and get the data to be member here is loading will be member loading and inside of here data will be workspace and is loading will be workspace loading there we go and now what I'm going to do is if workspace is loading or if member is loading because those two are crucial for the things we're going to do further is I'm going to return a div with a class name Flex Flex column background of 5 E2 c5f full height items Center and justify Center and inside of here I'm going to display a loader from Lucid react so let me just move that to the top here and I'm going to go ahead and give this a class name of size five animate Spin and text white like that so we can already try it out there we go every time I refresh for a split second you can see the little loader here great and now we're going to do something else we can copy and paste this and this time change the if Clause to if there is a no workspace or if there is no member meaning that obviously something was not loaded correctly we're going to modify this slightly by adding a gap Y2 here and this will now be alert triangle from Lucid react right here and below that we're going to add a paragraph workspace not found and we're going to remove animate spin from here because this is not a loader and this will have a class name text white and text small like this so for now what I'm going to do is you don't have to do this I just want to demonstrate I'm going to turn this to true so there we go this is how that will look like so previously it wasn't very clear you know when I was in another workspace and I copied the URL and then pasted it here it wasn't exactly clear that I should not have the access for this but now it's going to be very clear because we are not going to be able to load neither the workspace nor the member so we're just going to show the user hey this workspace is actually not found I have nothing else to show you here uh great so now I just want to go ahead and copy this div and just replace it here and let me go ahead and close it like this so it's going to be Flex Flex call and hide full but it's not going to have items Center or Justify centers it's going to be a little bit more simpler and then inside of here we're going to develop workspace header component which we're going to use uh to Showcase some preferences about workspace right or to delete a workspace so inside of here let's create a new workspace dashe header. TSX there we go so let me uh close everything besides death for now and let's export const workspace header and let's return a div here let's go back inside of the workspace sidebar and you can now import workspace header from do/ uh workspace header so let me just see where did I create the workspace header uh my intention was to create the workspace header in the same place as workspace ID but I accidentally created it in the workspace folder so I will just drag it inside of the workspace ID uh perhaps you did not have that issue and now you have to go back inside of the workspace sidebar and just fix this so it's do slash instead of do do slash in case that even happened to you uh great so now we can go ahead and develop this workpace header here or at least the initial design so let's give this a class name of flex items Center justify between padding X of four a height of 49 pixels and a gap of5 like so now inside of here we're going to have a drop- down menu so let me go ahead and just add everything we need from drop down menu which is the menu the content item separator and the trigger so let's go ahead and develop this so we need drop- down menu drop- down menu trigger remember to mark this as child because inside we're going to have a button component so button cannot be a descendant of button that causes a hydration error so by marking this as child this entire component will actually become this so make sure you've imported button here as well let's go ahead and now actually uh style this button here so I'm going to give it a variant of transparent I'm going to give it a class name of font semi bold text large width of Auto padding of 1.5 and overflow of hidden then I'm going to give this a size of small inside of here I'm going to create a span with workspace name uh do I actually have workspace inside of here all right so there are several ways we can uh do this so if you want to we can use the hook use get workspace here uh to actually you know um and have it inside of here or what you can do is you can simp simply pass in you know the workspace for example and then just pass in the workspace like this so let me go ahead and see whether this is a better solution or to reuse our hook because we can reuse it it's cached right so let me see workspace header props workspace will be a document of workspaces so you can import the doc type from convex the same place you import the ID type and just I'm just interested whether this will be compatible or not so let's see workspace and there we go it seems to be perfectly compatible here so now that we have the workspace here we actually don't have to use the question mark because if there is no workspace we return this specific error here great so now workspace header can be kind of a dumber component uh and we should already see how that looks there we go perfect let's go ahead and give this span a class name uh of truncate and then let's go ahead and give this Chevron down icon which you can also import from Lucid react let me just move that to the top and I'm going to give the Chevron down a class name of size four ml1 and Shrink zero like this there we go so now we have this nice little uh header for our workspace and now when we click on this we are supposed to be seeing some options so below the drop- down menu trigger let's add the drop- down menu content let's go ahead and give the content a side of bottom let's go ahead and give it in a line of start a class name of with 64 and inside of here let's add a drop down menu item this drop down menu item will have a key of workspace question markor ID well we have the workspace so no need for question mark here and it actually does not need a key my apologies so just a class name will be cursor pointer and capitalize now inside of here let's go ahead and open up a div and let's go ahead and add workspace do name do character at Z to uppercase uh let me just see so character at my apologies there we go so I'm going to go ahead and give this a class name of size 9 relative overflow hidden background color 61 6061 text white font semi bold text extra large rounded MD Flex items Center justify Center and margin right of two so a pretty long style feel free to pause and write it out then we're going to go ahead and go below this and we're going to add a class name Flex Flex call and items start I'm going to add a paragraph which will render the workspace name inside and I'm going to give it a class name of font bold below that I'm going to have a paragraph of text extra small and text muted foreground and this will render a text active workspace let's go ahead and try it out there we go but obviously we should not have added the margin right off to my apologies let me remove that uh looks like it's still not centered oh we should have margin right okay I see the issue we need the margin right but we don't need a typo in justify Center which is something you might not even have there we go perfect so now we can see our active workspace here and uh what I want to do now is I want to add a couple of more drop- down menu items inside of here so below this let's add another drop down menu item and we're going to go ahead and uh inside of here uh my apologies okay uh I don't know why I skipped the properties so class name here will be cursor pointer and py2 and then on click for now will be explicitly an empty Arrow function so I remember that I have to put in something here uh later and let's write invite people to workspace do name like this there we go so now we have this little button here and I also want to go ahead and add a drop- down menu separator component here there we go so now it has a nicer look great and then I'm going to go ahead and copy this entire segment once more but this time I'm going to say preferences like this there we go so invite people and preferences great but I only want to render these if I am an admin so I'm going to go ahead and add is admin which is a required Boolean in this case is admin I'm going to go inside of the workspace sidebar and besides passing workspace I will pass is admin to check if the current member or how did I call it member uh do roll is equal to admin let me just confirm whether I can use this as such do I have a member role I do uh use current member I think something might be a little bit wrong here that is because inside of here I wrote dot collect so let's resolve that so inside of convex inside of members here instead of using do collect I am certain that this will be unique there we go so only one is returned now so now inside of my workspace sidebar here I can with no errors pass in this roll check here great and now we have the is admin here and I only want to show these two options if we are admin so if is admin only then should we go ahead and show these two I'm going to go ahead and uh open up a fragment like this and then I will just copy these two options so these two drop down menu separators and the menu item there we go like this so nothing should change much right because I still have my admin privileges but if I for any reason whatsoever I'm just going to test this out myself I'm going to go inside of members uh oh well I don't know which exactly I am uh I'm going assume it's the newest one so let me change this from admin to member and I think that now um is that still my account okay maybe not that one I'm just going to change all of these to member one of them should definitely be my current member account you don't have to do this I just want to demonstrate it there we go so this is how a guest will see it right they will not see those options here great so now I'm just going to bring everything back to admin here and we're going to add two more things here and we can wrap up the chapter since for now I just want to build the UI around this and then we'll actually uh make the models for this in uh the next chapter so outside of this drop- down menu I want to add a div here with a class name which will be Flex items Center and gap5 so something to fill the space here let's go ahead another button component and and a square pen icon from Lucid react so make sure you have button and square pen here let's go ahead and give the button a variant of transparent and the size of Icon small let's give the square pen a class name of size of four inside like this there we go we now have a nice little new message method here which we can use for whatever we want maybe to redirect and focus on the new message or maybe some specific screen great uh so if you want to uh you can also add another uh button here for example list filter from Lucid react if you want to and there we go now you have this filter here and perhaps that will give you some ideas about filtering out the channels or maybe it can open the search which we're going to have anyway here above we're going to see that later uh great so just one more thing I want to do uh before we wrap up is Implement a hint component so let's go ahead and let's add tool tip first so bonex let's add tool tip there we go and now we're going to implement our own reusable tool tip which will be a bit better than the existing one so I'm going to go inside of components and I'm going to create hint. TSX and I'm going to mark it as client and I'm going to go ahead and import everything we need from our new tool tip component here then I'm going to create an interface hint props the label will be a string children will be react react node here and then we're going to have side which is going to be optional and we're going to have a line which will be optional as well so for the Align we're going to have Start Center and end and for the side we're going to have top right bottom and left so it's important that they are exactly these because the tool tip component supports those and now let's go ahead and let's actually export con hint let's go ahead and Define hint props here and then we can go ahead and we can destructure all of them so label children side and align and inside of here we can go ahead and build the hint component so we start start with the tool tip provider then we add a tool tip we give it a delay duration of 50 because by default it takes some time to show up when we hover on something so I want to make it quicker and inside we uh uh render the tool tip uh trigger like this and we render the children and in order to avoid hydration errors we mark this as child then below that we add the tool tip content we give it the side prop the Align prop and we're also going to give it a uh class name here so background color will be black text will be white border and border Das white sl5 so this is the class name now inside of here we're simply going to have a paragraph which will render the label and then a class name to that paragraph font medium and text extra small now let's go back inside of our app folder workspace workspace ID workspace header here and we can import that new hint component from component hint and we can for example wrap our uh new button inside of a hint here and let's give it a label of new message and a side of bottom so now when you go ahead and hover there we go you get a helpful message describing the button you can go ahead and copy that for this one as well and instead of new message for example we can just say search or filter conversations like this there we go uh great so that is it for this chapter in the next chapter we're actually going to go ahead uh and uh first modify the preferences so we can uh edit the name of this workspace and actually remove it and then before we do the whole invite thing I actually want to do the channels and the display of members so you can see the invite happening in real time great amazing amazing job before we move forward with our () preferences and our invite people model I want to bring your attention to our terminal inside of here I have notied this warning detected multiple y instances and we also have this warning for panel default size this is okay because we're going to come back to this later because there are still some more panels that we have to add so if you're wondering what is this panel default size well that is referring to our workspace ID layout right here so these resizable panels basically for this one we have the default size but for this one we don't have the default size that's okay for now but this is this is the one that I'm worried about detected multiple Yi instances that's because we didn't do proper initialization to use Yi inside of nextjs so let's go ahead and do that I'm going to go inside of the source inside of components and I'm going to create yoai provider. TSX I'm going to mark it as use client I'm going to import Provider from yoai and I'm very simply going to export yoai provider here I'm going to create an interface which will very simply have children inside let's go ahead and let's assign those props here and let's very simply return the provider which will wrap our children and we also have to destructure the children from here and that should be enough to resolve our issue all we have to do is go inside of the app folder layout and we have to wrap uh our toaster and models and children inside of that yoai provider like this specifically make sure that the models and the children are inside toaster is not really that important and let me just move this to its place and there we go I'm going to refresh this to ensure it's working I'm going to try and open a model so all of that is working and there we go you can see that no longer are those errors popping up and still everything is working just fine so that is the proper initialization of yoai inside of nextjs uh you can see that in the documentation uh of yoai specifically for nextjs great so what I want to build next is the preferences I want to do that because uh I want to wrap up all uh everything needed for our workspace entity that includes updating that entity and also removing that entity so this preferences model will open up and it will give us the ability to rename our workspace but also to remove the workspace now that we resolved this we can go back inside of our workspace ID folder right here and inside of here I'm going to create the preferences model. DSX let's go ahead and Export const preferences model let's go ahead and now render it inside of the workspace header here so it's not going to be uh controlled globally we're just simply going to render it here so I want to go ahead and wrap this entire thing inside of a fragment like this and for now what we're going to do is we're going to render the references model here like this if you go ahead and look at it now you will just see this weird text in the beginning so now we're going to go ahead inside of here and we're actually going to import everything we need from the dialogue components like this so that will be dialogue dialogue content trigger header title close and footer and we're also going to prepare some props for the preferences model so interface preferences model props will have open which is a Boolean set open which will control the current Boolean value and initial value which will be a string so we can go ahead and assign those here and we can structure them open set open and initial value now inside of this instead of this being a div this will be a dialogue like this and inside of that we're going to have our dialogue content a dialogue header and a dialogue title let's go ahead and simply write uh value here which will be controlled by state and it will have have the initial value as the initial value here and we can import use state from react like this and for the dialogue let's go ahead and give it open of open and set open my apologies on open change set open now we can go back inside of the workspace header here and we can create our own open set open use State and false by default so it's going to be controlled by this component because this is the only component that will be able to open it so no need to create the whole uh Global State and to put it in our reusable models uh provider right we can just easily do it here so open is open set open is set open and the initial value here will be workspace name like this and now let's go ahead and let's find our preferences drop- down menu item and in here we're going to change this to set open true there we go so now we going to go ahead and click on the preferences there we go you can see a new model has popped up so I just want to name this a bit uh more precisely so this will be called open uh preferences open and set preferences open I want to call it like that in case we have additional models in inside of here so this will be preferences opened and set preferences open and then we're going to change this to be set preferences open through there we go still works as intended great so now inside of here I want to go ahead and give the dialogue content some Styles so let's give it a padding of zero background gray of 50 and overflow hidden then for the dialogue head we're going to give it a padding of four border of bottom and background color of white and then inside of here outside of the header we're going to have a div with a class name PX4 and padding bottom of four alongside that Flex Flex column and GAP Y 2 just like this let's see if we can notice any differences now so quite subtle but the header should now be white and this should be slight gray color now inside of here we're going to go ahead and create a div with a class name px5 py4 background color of white rounded LG border cursor pointer and hover background gray 50 like this now inside of here we're going to open up a new div with a class name oflex items Center and justify between and then a paragraph inside with a class name of text small and font semi bold this will be the title which will simply say workspace name below that we're going to have another paragraph which will say edit this paragraph will have a class name of text small and text of 1 26 483 without the number seven like this power underline and font semi bold and then outside of this div which encapsulates our two paragraph paragraphs we're going to have another paragraph which will render the current value and a class name text small like this there we go so we now say have the workspace name and we have the name of the workspace in here so when we click on this thing a new model will open which we're going to use to well update uh our name but before we go there let's go ahead and let's create another thing here so I'm going to let me just see where does this begin uh like this so after you close the dialog header we have this div which has Flex SC and GAP y of two and now we just created this uh container here so that's this part right so below that part go ahead and add a native button here and let's go ahead and style it a bit so disabled here will be false by default on click will be explicitly just an empty Arrow function and then the class name here will be Flex items Center Gap X2 PX of five uh py of four background color of white rounded large border cursor pointer hover background gray 50 and text rows 600 so quite a large class name feel free to pause so you can type it out and then inside we're going to render a trash icon which will be a self closing tag and a paragraph delete workspace let's go ahead and give the trash icon a class name of size 4 and let's go ahead and give the paragraph a class name text small and font semi bold make sure you've imported the trash icon from Lucid react here so there we go now we have this nice edit container coner and also this delete container and now it's time for us to actually uh create some further functionalities regarding this and I think the best place to start is to actually uh create our update API endpoint so let's go inside of our convex folder inside of workspaces here and I'm going to go ahead and go all the way down here and export cons update this will be a mutation for the arguments it will accept the ID which is V ID workspaces and it will also accept a new name then we have the Handler which is an asynchronous method which accepts the context and the arguments in the second parameter now inside of here we have to do our usual uh verification so we can copy this from the one above which is get by ID like that so let's go ahead and do it here so we get the user ID if there is no user ID we throw unauthorized here and then we attempt to find the member using the arguments. ID as the workspace ID and the user ID and we know that that will be a unique member and now we'll do the following if there is no member found or if if member role is not an admin meaning that a member is trying to access this we will throw a new error back unauthorized and then we will simply do await context database patch arguments ID and we're going to go ahead and pass in name to be arguments name there we go and now let's go ahead and let's create our use update workspace method so I'm going to close everything here and I'm going to go inside of source features workspaces API and we can copy and paste use create workspace and this time do use uh which one will this be update workspace like this and I want to keep that opened so make sure you are inside of use update workspace and let's also keep the actual workspaces API opened so let me just see if I uh make this a constant workspace ID will this be a workspace ID uh looks like it will not be okay so in order to be consistent I want to return back arguments. ID so at least we return back something right I always want to return something from my API endpoints so and let's fix this typo to be update like this so this way at least we are updating it uh we are returning the ID similar to the one in the create method so we don't have to modify our use update workspace much there we go so the request type is the same the data is the same the response type is exactly the same and now we're just going to go ahead and rename this from use create workspace to use update workspace like this and we're going to modify the mutation to call Api workspaces update and now we're going to see uh what whether we missing something and well we are yes so besides the name in the request type we also need to pass in the ID there we go so the request type needs to be modified so it accepts the ID and the name there we go and I believe there's something I forgot to do here both in the use update workspace and use create workspace and that's that I never uh set the error status so let's go ahead and do that so if we get inside of the error here we also have to set the status to error like this so I'm going to go ahead and do the same thing inside of the use create workspace here if we get in the catch it means that I have to set status to error there we go so we now have the use update workspace so ensure that inside of your use update workspace you are using the API workspaces update and that you have modified the request type to accept the ID and the name and it will return back an ID because we explicitly defined that here to return something you don't have to return anything of course but you know I just want to be consistent with expectations of my API great now that I have that uh let's go ahead inside uh of my API workspace workspace ID preferences model right here so now that we have that we can go ahead and actually add that mutation here here or at least initialize it so I'm going to go ahead and add a constant use update workspace like that and from here I will get mutate which will be update workspace and we're going to have is pending which will be is updating workspace like this and now that we have that let's also go ahead and let's prepare our delete method so we can go ahead and copy the update method here because the delete will be quite similar so this copied one now has an error of course because it's the same named constant so I'm going to remove this do not call it delete because you can see delete is not allowed as variable declaration name because delete is a reserved keyword so let's call it remove and it will not accept a name just the ID of the workspace we are trying to remove and this rule rule set can stay the same if there's no user ID unauthorized if there is no member unauthorized authorized so what we're going to do here is we're simply going to call delete arguments ID like so but that is not everything we have to do here right so we also have to delete all Associated members in this workpace otherwise we're just going to delete the workspaces so let me remind you of our schema right so our members are connected to the workspace but by default convex will not Cascade uh all entities they do have something called convex ends which is a different way of writing convex but it is a bit unfamiliar to me so I just wanted to use it convex in the way I'm familiar with so basically when we delete the workspaces table we also have to delete the members associated with that workspace manually we have to do that ourselves so let's go ahead inside of the workspaces here and what we are going to do is the following we're going to prepare members from await promise all so for now it's just going to be members but later it will be something else so let's go ahead and do context databasequery members with index by workspace ID and very simply we're going to use the query to find workspace ID with matching arguments ID so this will find all members inside of this uh workspace ID so later on when we have channels for example and we also want to clean them this is exactly what we're going to do we're just going to you know extend this with channels for example we're going to add a new query here and this will query for channels and it will be pretty much exactly the same so that's how we're going to handle that so for now we just have members so let's go ahead and resolve that here for const member of members context database delete member ID and let's just see uh what type of error do I have here oh yes we are missing do collect here there we go so now we have the functionality to delete work spaces as well and as always I just want to return back some things just ensure that you are returning something from this uh remove mutation here so now let's go ahead and let's go back inside of our features workspaces API and we can now copy use update workspace paste it here and rename it to use remove workspace like this let's go ahead and change the request type to only accept an ID because that's the only thing we are accepting here let's go go ahead and rename this to use remove workspace and we're going to go ahead and modify uh our mutation here to call Api workspaces remove there we go everything else works just fine perfect so we now have those two hooks and we can now revisit our workspace header precisely the preferences model so this is where we uh last stopped and now we can do the same thing but with use remove workspace so make sure you've added the import for use update workspace and for use remove workspace I'm just going to go ahead and move them here and have them separately now inside of here I'm going to rename this to remove workspace and this will be is removing workspace there we go so now let's go ahead and first implement the update functionality because I want us to be able to see those changes before we uh well remove everything here so for that we're going to need another model because once I click on edit I expect another model here to pop up which will allow me to fill in the name so for that we have to go ahead uh well we have everything regarding dialogue here so let's go ahead and build another dialogue which will again be controlled uh inside of here here so let's go ahead and call this uh let's see how did I call it inside of here I called it preferences open so this will be edit open set edit open use State and false by default like that and then we have to find this div right here so which is above our button and which is the first element inside of this div here and we want to encapsulate it inside of a new dial like this so this will be indented all of this thing inside and then this dialogue here uh will be controlled as such so let's go ahead and give this an open of open edit or edit open and on open change will be set edit open like so then inside of here this entire thing will be a dialogue trigger right so this won't be the content when we click on this entire thing that's what's going to open uh the model right and let's go ahead and give this an as child property and then below the dialogue trigger we're going to have a dialogue content again and inside of here we're going to have a dialog header and a dialogue title which will simply say rename this workspace like so and then outside of the dialogue header we're going to have a form element the form element will have a class name space y4 and it's going to have an onsubmit which for now will be just an empty method and then we're going to add the input component here so make sure you've imported the input from components UI input let me just find where we were so in this form this will have a value of value which we are holding in the state which has the default value of initial value which is the workspace name property disabled will be is updating workspace besides that we're going to have onchange which will get the event and set value to event Target value like so then we're going to have required out of focus minimum length will be three maximum length will be 80 and placeholder inside of here can be the same thing that we had in our create workspace model so workspace name right workspace name for example work personal or home like so and then outside of the form here uh my apologies inside of the form we're going to have a dialogue footer so you should have all of these things imported inside of the dialogue footer we're going to have a dialogue close and have the as child prop here which will have a button component so make sure you've added the button import from components UI button like so let's go ahead and close this button so this will serve as the close button which will simply say cancel let give it a variant of offline a disabled of is updating workspace and outside of dialogue close another button which will say save and this will have a disabled prop on is updating workspace as well as well so now when you click here there we go you can see that you have a nice model which opens up and tells you to rename the workspace great so now we actually have to implement the onsubmit method so let's go ahead and give this on submit method a handle edit prop like so and now we actually have to develop it here so after we initialize this hooks let's add const handle edit this will have an event of react form event and HTML form element inside whoops let's do event prevent default like so and then simply call update workspace and pass in the ID to be uh let's see what do we have inside of the preferences model so we just have the initial value and we need to find a way to get the workspace ID so we can either pass that as prop or we can call our handy workspace ID from use workspace ID because it's always going to be a part of our URL so we can safely use that use workspace ID here there we go workspace ID is here and the name will be the value that user has typed and then we're going to go ahead and open our on success method here so we don't need to work with data in this case but we can call the toast success workspace updated and make sure you've imported the toast from soner package like so and then we're going to have on error here tost error failed to update workspace in case something goes wrong and if it succeeded we can also do set open edit set edit open to be false meaning just close the thing there we go perfect uh so we now have handle edit let's go ahead and check it out so I'm going to click on preferences and I'm going to call this renamed and there we go workspace name is renamed search renamed and it says renamed here here and if I switch there we go I can switch back to renamed let's see if I can rename this one preferences I'm going to call this public there we go Works instantly amazing and now we have to do the same thing for delete and I just want to bring your attention to you know one little thing that you might be wondering why I did so I kind of put a lot of ways into opening this inner model so this one right I control it both with the prop edit open but then again I use the dialogue trigger to open it instead of a separate button which will simp simply call set edit open and then down here for example I use dialogue close instead of just set edit open to false basically I'm using this combination because I want a specific behavior so when the user clicks cancel this can close instantly but when the user clicks save I don't want it to close I want it to submit and I want it to only close after a successful update so that's why I added both the control via the open prop and also via these components such as dialogue trigger which automatically changes the set edit open to true so that's what this prop does it will basically be called on the dialogue trigger and also on the where is my dialogue close for example right here also on the dialog close so in case you were wondering about that and now we have to do the same thing but for handle close so sorry handle edit con handle edit U my apologies handle remove so inside of here we're going to go ahead and call the delete workspace remove workspace we're going to pass in the ID workspace ID and the same thing so we can go ahead and copy this on success and on errors from here and we can call this one workspace removed and don't need to change anything here and we can go ahead and say fail to remove workspace what we'll have to do here is redirect the user right in order to give them some proper experience so let's add use router from next navigation basically we don't want the user to stay in this removed workspace right so this is what I'm going to do now for now I'm just going to go ahead and prepare this so router push actually router replace I don't even want the user to be able to go back to that route right so let me get this handle removed now and let's chain it to our button which has the trash icon so handle remove and disabled is removing workspace like so so I have a couple of workspaces and I recommend that you create at least three workspaces so let me just have multiple workspaces so we can play along with them so I'm going to go inside of one and I'm going to go inside of preferences and I'm whoops and I'm just going to go ahead and click delete workspace and there we go you can see that I was immediately uh redirected back all right so let me just see uh that's because of this right but I will now comment this out and try it out on a new one so you see how that looks like so that's how it will look for the person who deleted the workspace but what about everyone else who is in the workspace and doesn't know that the workspace was deleted well for them they won't be redirected but they will have the workspace not found message and I think that's good enough because later we're obviously going to have that displayed here as well and then they will just switch to another workspace which they have this will be of course an edge case every other time they try to visit that they will just get redirected right so we can now get this back one thing that I am missing though is that it is very very easy to delete the workspace it feels like we need some kind of confirmation here so let's go ahead and do that next so I want this confirmation model to be reusable because there will be a lot of other things that I will need confirmation from the user so let's go ahead and separate that into its own hook so I'm going to go ahead and create a new use confirm TSX hook yes TSX that's because we're going to have some uh jsx elements inside so I'm going to go ahead and prepare some things let's get used state from react let's import button from components UI button and let's import everything we need from the dialogue dialogue dialogue content description footer header and the title now inside of here let's export con use confirm inside of here the first argument will be the title which is a string and the second one will be the message which is which will be a string as well now let's go ahead and let's define what this will return so for now let's return any and any and I will just return that back so just two strings now let's go ahead and Define our promise and set promise inside of use State here by default the value of this will be null but the entire type will be the actual promise which has the resolve method and inside of the resolve it will give back the user Choice which will be true or false AKA confirm or deny and return this as a void or it can be null like this so make sure you allow this prop in the used State and now what we're going to do is we're going to Define our confirm method so let's go ahead and Define new promise we get the resolve and the reject and we call set promise and we Define our resolve method inside like so then inside of here let's go ahead and let's define const handle close so when we close we are simply going to set back the promise to know let's go ahead and do con handle cancel so cancel is an explicit false so inside of here we're going to do promise and question mark. resolve false and then call handle close to reset the promise and we can copy and paste the handle cancel for the handle confirm so this will send an explicit true back from the user so if you're wondering why are we doing it in such an odd way that's because I want this to be uh very easily usable so for example inside of my my preferences model inside of here when I do handle remove what I want to do is Mark this as an asynchronous method and then I want to do const okay a await confirm and this will open the model right and then in here I'm going to do if not okay simply break the method so during this await the model for the confirmation will be opened and this confirm will come as a return of here so we're going to return the confirm here right so that's how I want that to work that's why I'm doing it in such an odd way and full disclosure this is a genius Solution by a medium blog which I will link in the description so make sure to uh read that as well so let's go ahead and continue developing this so we have the handle confirm method we have the handle cancel method and now we need the actual confirm dialogue in inside of here let's get the dialogue and it will be open if promise is not null right so if it is true or false let's go ahead and open the dialogue content inside the dialog header the dialogue title and the dialogue title will simply render the title below that we're going to have the dialogue description which will simply render the message outside of the header the individual message M like this outside of the dialog header we're going to have the dialogue hter let's go ahead and close the dialogue fer component let's give it a class name of padding top two and inside we're going to render a button component which will have an on click of handle cancel and a variant of outline and it will say cancel and then we can copy and paste this button and we can add an on click to handle confirm here and this will have a normal variance so we don't have to Define it and let's call it confirm and then we're going to return the confirmation model here confirmation dialogue and inside of here we're going to have the confirm method there we go so confirm dialogue and confirm and then we can modify these types here to be a bit more precise so the first one will be a return of jsx do element and the second one will be a return of promise and unknown inside there we go no type errors so now we can go inside of our preferences model right here and we can go ahead and we can get our confirm dialogue the confirm method from use confirm hook make sure you've imported The Hook from use confirm like so and let's go ahead and give it inside of here uh the first message which will be uh let's go ahead and say are you sure and then a description this action is irreversible and then we have to render the confirmed dialogue somewhere so let me wrap the entire thing here in a fragment it really doesn't matter where you put it of course but I just want to keep it separated from everything else I don't want it to be in the component tree so we have to render it somewhere the confirm dialogue and then we have this confirm method here so we can go ahead and go inside of the handle remove here and we can mark this as an asynchronous method const okay a wait confirm and then if not okay we're going to do an early return and break the method so this will not be called let's try it out when I click delete workspace there we go it asks me to confirm so so I can safely cancel and the cool thing is you can easily add that to handle edit for example you can go go ahead and click asynchronous here and do the same thing con okay a wait confirm and you can add multiple hooks right so if you want separate confirm for edit you will just copy this this will be confirm edit dialogue and this will be confirm edit and then you can have different messages right so that's how cool this Hook is that's why I really wanted to use it of course we don't actually need for handle edit we just need it for handle remove make sure it's asynchronous make sure you await the confirm and I I think you already saw that confirm so if I rename this to confirm to there is no error here that's because confirm is as you can see uh let's go ahead and open this looks like it is a native inside of uh JavaScript right it's part of the window object so perhaps there could be some better name for it I don't know but if you override it you know it will it will use your constant instead of the window one right in case you were curious why no errors are being thrown so when I click confirm there we go we just deleted all of our workspaces perfect so we now have full control over renaming and deleting our workspace next step is the invite people but before we do that I want to go ahead and render the channels and the users here in the sidebar great great job now let's go ahead and let's () actually list out the members in this workspace as well as the channels and some other stuff I want to do that before we add the invite feature so you can see new people appearing here in real time so let's go ahead and do the following I'm going to go ahead and go back inside of my workspace sidebar here so at the moment the only thing I have is the workspace header with the workspace and is admin props so below that I'm going to add a div with a class name Flex Flex column px2 and margin top three then I'm going to go ahead and create a sidebar item component which we are going to reuse I'm going to go and already pass it some props here so I'm going to give it a label of threads I'm going to give it an icon of message Square text from Lucid react and an ID of threads so let's go ahead and just make sure you imported the message Square text from Lucid react and now we're going to go ahead and actually create the sidebar item here so I'm going to go inside of the workspace ID folder and create sidebar Das item DSX let's create an interface sidebar item props here and let's give it a label of string an ID which will be a type of ID channels which we don't yet have or it will be a string so let's actually do this let's just write string for now and you can remove the ID import because we don't have the channels model yet the icon will be a type of lucid icon from Lucid react or icon type from react D icons SL lip like that and let's export cons sidebar item here let's go ahead and D structure the props sidebar item props like this and then we need label we need ID we need icon which we can immediately remap to icon with a capital I so we can use it as a component inside let's go ahead and let's return something so we're going to return a button component from components UI button make sure you've added that import here and inside we're going to go ahead and add a link from next link as such I'm going to move it here we're going to go ahead and give this an HRA open backx SL workspace then we're going to go ahead and fill it with workspace ID which we can get by our hook which will be called use workspace ID like that so slash workspace workspace ID slash Channel and then ID there we go now inside of here we're going to render our icon and then a span which will render our label let's go ahead and give the button and as child property so it becomes the link so this way we are not doing an anti pattern of putting an hre inside of a button so this with an as child now becomes an a an anchor tag right so let's go ahead and give this a variant of transparent and a size of small as such let's go back inside of the workspace sidebar and we can now import the sidebar item from slidebar item and there we go we now have this threads icon here great so now I want to create a variant for this sidebar item and I want to use this method which is seen in our shaty and components inside of components UI for example button you can see how they handle variance for default destructive outline this seems to be more reusable and cleaner way than just adding a bunch of if else Clauses so I want to implement that so let's go ahead inside of our sidebar item and let's add CVA and type variant props from class variance Authority so you already have this because it comes installed with shaty nuui just in case you don't have it let me show you inside of my package Json which version I'm using great so we have that now and now let's actually create those types so con sidebar item variance will be CVA in the first argument we pass in the default uh look of this component so Flex items Center Gap 1.5 justify Center font normal height of 7 PX of 18 pixels text small and let's do overflow hidden now let's go ahead and open up variance individual variant and then let's go ahead and give it a default of text hashtag F9 e d ffcc and then let's go ahead and create an active variant text 48 1349 background white with a 90% opacity and the same one on Hover like that and now let's go ahead and add this variant prop here so variant will be an optional prop variant props type off sidebar item variants and we specifically Target the variant property there we go so now we have this as an optional prop and we can D structure it here and then we can go ahead and pass it to our button here through class name so let's use the CN library from lib utils and we are very simply going to dynamically decide which variant to activate using this sidebar item variant and passing the variant as variant here so there we go using a prop you are able to decide whether this style should be applied or this one so this is especially useful if you're going to have many variants inside of here so you could add a notification variant as well if you want to there we go so let's go ahead and take a look at it now let me just refresh all right looks like something has uh gone wrong here and I believe that's because we have defined variance yes but we forgot to add the default variant so let's do that as well so default variant default like so uh all right and now let's change this from justify Center to justify start there we go so now it's looking like a variant great so now I want to go ahead and I want want to try out for example giving it a variant of active there we go so this is how it will look like when it's active great so now that we have that let's go ahead and reuse it one more time to add some Cosmetics to our app so this could can for example be uh drafts and send and it can use the icon send horizontal from Lucid re Act and the ID can be drafts send horizontal messages Square text make sure you have all of those uh oh and let's go ahead inside of the sidebar item and let's actually uh continue styling the icon I forgot about that so I want to give the icon itself a class name of size 3.5 margin right of one and Shrink zero and I want to give this span a class name text small and shun eight there we go so now if you go ahead and reduce this you can see how it has a nice truncation effect great now I want to reuse this sidebar items and render our channels but that's something we don't have yet so let's go ahead and let's actually implement the channels it's going to be uh quite easy to do that so we're going to go ahead inside of source we're going to go in my apologies inside of convex inside of schema here and after members let's go ahead and let's add channels so Define table the channels are going to have a name which will be a string and a workspace ID that they are associated to so v. ID workspaces and we're going to add an index for them by workspace ID workspace ID there we go so we can easily remove them later on when we need to do so great so now that we have the channels it's still not enough right what we have to do now is that every time we create a workspace it should have at least one channel right so we can do that by going back inside of our convex workspaces right here find the create method there we go and just as we insert a member we can also insert a channel so await context database insert channels and let's go ahead and give it the name of General and a workspace ID there we go so now I'm going to go ahead and revisit my database so as you can see since I have bonex convex Dev running you can see that it detected my uh channels index here and all the new changes and it successfully deployed all of that so that's why I have channels here but nothing inside yet but we just added this change to the create method so if I go ahead and create a new workspace which I'm going to call Channel test and now go ahead inside of here and there we go you can see I have a new channel called general which is associated to what works space workspace called Channel test perfect so go ahead and do that make sure that you have at least one channel and now we're going to go ahead and render them but before we can do that we have to create uh the actual uh get method for that so let's go ahead inside of our convex and let's create channels. TS inside of here let's do export cons get to be our query from gen generated server the arguments inside of here will be workspace ID so we are loading channels for what workspace ID and we also have to import the convex values here and besides the arguments we also have the Handler which is an asynchronous method which has the context and the arguments let's go ahead and get user ID using the await out from do slou so out. get get user ID and pass in the context if there is no user ID since this is a query I'm not throwing any errors but I will return an empty array here and now we have to find the associated member with this workspace and this user ID since that's a unique member so context. database let's query by members with index by workspace ID and by user ID let's get the query here query equals workspace ID will be arguments workspace ID and let's chain another equal for user ID which will be the user ID which we detected from above and let's get the unique user I mean member in case we cannot get that member that means whoever is trying to do this is not a part of this workspace so for them we return an empty array and then finally we can get the associated channels safely so query the channels and we can use an index here so with index by workspace ID let's get the query and let's do query equals workspace ID arguments workspace ID and of course collect let's return the channels back there we go that is our uh get channels here so now we have to implement the equivalent uh hook for that so let's go inside of source features and let's create a new feature folder channels inside of here another folder called API and then use get channels. DS let's import use Query from convex react let's import API from the convex generated API and let's import the ID type from generated data model let's create an interface use get channel props a workspace ID which is a type of ID workspaces so we are querying by this workspace which we're going to get via our use workspace ID hook and let's export const use get channels inside of here we assign use get channels use get channel props and I should name this channels because there's more of them like this and inside of here we can destructure the workspace ID now let's define the data use Query API channels get and passing workpace ID is loading is if data is undefined and let's return back data and is loading there we go so now we are ready to display our channels so let's go ahead inside of our app folder workspace workpace ID workspace sidebar here so back inside of here and now we can go ahead and render uh the channels so const use get channels from feature channels I'm just going to go ahead and move that here we already have the workspace ID here so we can go ahead and simply pass in the workspace ID there we go and from here the data will be channels and his loading will be channels loading there we go so we now have the channels and channels loading great so we can already go ahead and try this out so below this I'm going to go ahead and do channels question mark map let's get individual item and let's go ahead and add sidebar item here like this let's pass in the key to be item undor id like that let's go ahead and give it a variant which will check if item underscore ID uh well we can't do it for now yes I wanted to check it with the current ID but we don't have that yet so ignore that for now the icon will be hash icon from Lucid react so make sure you've added this import as well besides the icon we're going to pass in the label to be the channel name and ID will be Item uncore ID and do not call this channel right I purposely called it item in here because later we're also going to load the channel here and we're going to uh Alias the data as the channel so you won't get an error it will just not work right so call this item or something unique or Channel item if you prefer to use the world word Channel great so now there we go you can see my general channel here but in my other one I don't have it why well remember we just added the functionality so only new workspaces will have the general Channel inside of here because we modified our workspaces here in the create mutation that we insert a default General Channel great so make sure that you are in a workspace where you can see at least one channel here and now I kind of want to separate the channels into their own section right I want them to be separated from these two cosmetic items here so let's go ahead and wrap these channels inside of a workspace section so workspace section here we'll encapsulate this iteration of channels and we're going to give it a label of channels we're going to give it a hint of new channel and an on new for now will just be an empty Arrow function and now we have to actually create the workspace section so inside of the workspace ID folder let's create workspace section DSX I'm going to create an interface workspace section props which will accept children as react react node label as string hint as string and on new to be an optional method which is a function and now let's export con workspace section let's go ahead and Define workspace section props here now we can go ahead and destructure the children label and hint as well as on new and inside of here what I want to do is I want to render out a nice little section which will say channels oh I can show you because we have not actually so let's just go ahead and wrap this up let's just return a div and children inside like that now go back inside of workspace sidebar and import this so workspace section from do/ workpace section right now nothing should be different but we're now going to work into giving this a more separated look and feel so go ahead and give this outter div a class name Flex Flex call and margin top of three as well as PX of two like this so there we go you can already see it being separated Here and Now inside of here go ahead and give it a div class name Flex item Center PX 3.5 and group and now inside of here uh also move the children out like this so now we're doing something else inside of here add a button component from components UI button and inside of here we're going to have a fa Carro down icon so let's go ahead and add an import for that so import fa karat down from react icons fa like this and let's go ahead and give this uh a class name size four like this there we go we have a huge button now so let's go ahead and style it a bit so variant will be transparent last name here will be padding point5 text small text here will be matching our sidebar item so F9 e ffcc and Shrink zero as well as size six there we go so a very small button here and now we're also going to go ahead and have another button here which will uh simply say uh oh it will render a span here basically and a label like this let's go ahead and give this a variant of transparent let's go ahead and give it a size of small and let's give it a class name group PX 1.5 text small text will have the same color as as the one above height will be 28 pixels justify start overflow hidden and items Center like that we're going to go ahead and give the span a class name of truncate as such there we go so now this says channels right here great so now I want to go ahead and add this ability to render uh a plus icon if we pass an on new function so outside of this button if we have on new go ahead and render a hint from components hint so make sure you've imported hint here the hint will have a label of our hint prop it will have a side of top and a line of Center we can go ahead and add a button inside as well on click will be on new here variant will be transparent size will be icon small class name will be opacity zero group power opacity 100 transition for the set opacity ml Auto padding of 0.5 text small then we can copy the text color from one of the instances above there we go size six and Shrink zero like that and inside of here we're going to render plus icon from Lucid react so make sure you've added Lucid react here as well we're going to go ahead and give this a class name of size five like this and now when you hover you can see that we have this nice little plus which tells us okay you can use this to create a new channel of course we don't have that functionality yet so what I want to do now is I want to be able to toggle the channels to hide them or show them and to open a model which will be used to create new channels I also noticed that this is more indented than the one above and I think that's because in my workspace sidebar here I am rendering this workpace section inside of this div right here so that's not something I'm going to do I'm going to close the div at this point uh my apologies at this point there we go so I only want this sidebar items to be inside of that div workspace section will have its own indentation there we go you can see how now everything is perfectly and nicely aligned so now let's go back inside of the workspace section and I want to add a uh package here so bun add react use or npm install react use so it's a collection of useful Hooks and one of them which I want to use here uh is the uh use uh use toggle so inside of the workspace section let's import use toggle from react use there we go and now inside of here we're very simply going to add on and toggle use toggle and false true in the beginning like that and then we're going to go ahead and give this main button with fa Carro down on on click of toggle like this and then we're going to dynamically render the children so only if it is on are we going to render the children so now when you click here you can see how the children disappear but we also have to reflect that with the carrot rotation so I'm going to go ahead and import CN from lib utils here and I want to find the fa carrot down so I'm going to go ahead and add CN here size 4 and now we are dynamically going to change it so let's also add transform uh my apologies transition transform and then we're going to go ahead and do this dynamically so we can do this in the first argument and then in the second argument here check if it is on in that case rotate for 90 but add a minus in front so minus 90 and now there we go you can see how it looks like great now that we have the workspace section component we can do the same thing for our members here so let's go ahead and do that next in order to do that we first have to create an API endpoint no need to modify the schema so we already have members inside of here and we currently only have the current so now what I want to do is I want to get uh implement the get API endpoint so export const get will be a query inside of here the argument will be workspace ID so basically okay you want members for what workspace ID and the Handler which is an asynchronous method with the context and the arguments so first of all user ID we can copy it from here and we can also copy this exact logic right so you can copy it from the current user ID and check for the member so let's paste that here whoops but we're going to modify it slightly since this will return an array if there is no user ID we will return an empty array here as well as if user is not a member of this workspace and wants to access the other members for them it's just an empty array purposely not null because I don't want to break the app on the front end so I want to ensure that this get endpoint always returns uh an array right let's go ahead now and let's define const uh members here and before that let's get the data which will be await context database query members with index byor workspace uncore ID let's get the query and let's do a very simple query cools workspace ID arguments workspace ID and let's collect all the members that's great we now have the members but here's a problem if you go into the schema members are not exactly something we can show on the front end right I don't even have a name for this member I know their role that's great but I need their connection to the user and then I want to display their name and their image so what I'm going to do is I'm I'm going to add a little method helper here called const populate user so I want to get the context which will be a query context type from generated server and I need a user ID which will be an ID users like the like so and since this is already populate user no need for this to be uh user ID this can just be called ID so we're very simply going to do return context database get ID there we go this will now populate our user wherever we need to do so so make sure You' added the ID and query context Here and Now inside of here we can go ahead and actually Implement that functionality so we Define the empty members array and then we're going to do four cons member of data which we are loading here so basically these are all the members in this workspace so for each of that member attempt to populate the user they are connected to so await populate user context as the first argument and member. user ID inside of here and I just clicked something so we were here okay so this is how we get the user and we are only going to push to our members above if we were able to load the user if for any reason we were not able to populate the user there's nothing we can show on the front end and now let's simply do do members. push spread the member and then also add the newly loaded user like that and return the members array right here there we go so that is how we are going to load our members in a safe way with the actual user information like their name and their image now we have to go inside of source features members API we can copy and paste this one and and let's call it use get members there we go and let's go ahead and change this to use get members props this will be use get members and let's fix the props here and this is the same we still need the workspace ID but let's just change this to be get there we go we now have use get members hook so we can go ahead and close everything and go back inside of our Source app folder workspace workspace ID I believe we have the workspace sidebar so inside of here now I'm going to go ahead and add const data members is loading members loading use get members and pass in the workspace ID make sure you've added the feature members here I'm just going to move it here there we go and now let's go ahead and use members in a same way right so I'm going to go ahead and go just below this for now members map Also let's call this item because we will have individual member later and now inside of here let's immediately return something right so a div which will say item user name like this and there we go you can see my name here because I am the author of this uh workspace and I am also a member of this workspace great so now we have to make this a little bit better right so let's go ahead and actually create a user item component so just like we had the sidebar item we're now going to have user item because it's it's very different than the sidebar item and in my opinion it doesn't make sense to create a specific variant for it we it also needs a specific redirect on its own and it it just looks very different so let's go ahead and Export con user item here which will return a button like this and we are also going to need everything from the Avatar here so make sure you've added Avatar Avatar fallback and Avatar image from from components UI Avatar like that and let's go ahead and create an interface user item props which accepts the ID which is an ID type of users it also accepts label which is an optional string image which is an optional string and variant uh which for now can be an optional string as well so make sure you've added the convex ID type here now we're going to go ahead and Define this user item props and pass in all of these so ID label image and variant there we go and for the variant uh we can actually copy uh from the sidebar item which is ironic because I just said it's going to be very different uh but let's do it this way yeah let's just copy the sidebar item variance from the sidebar item and paste it in inside of the user item here let's rename this to user item variance let's import CVA and type variant props from class variance Authority package like that and let's go ahead and see whether we should change something so Flex item sender Gap I think all of this is just fine let's go ahead and change this to bx4 like F there we go and I think the text can stay the same here great so we now have user item variants which means that we can properly type this so variant props type off user item variants and specifically targeting the variant prop great let's go ahead and give the label a default value of member if for any case we cannot load it here like that and and let me just go ahead and close this like that go ahead and give this button a variant of transparent a class name CN from lib utils so make sure you've added this import here and we're just going to do the same thing as we did in our sidebar item uh so inside of here inside of CN we're calling the user item variance and matching the variant to our variant prop we're also going to have a size of small and as child because inside we're going to have a link component the link component will lead to slash workspace workspace ID slash member and then ID of that member and inside of here we have to get the workspace ID use workspace ID so just as we did in the sidebar item component I will just move this here there we go but you can see this will lead to a different URL now inside of here we have to add our Avatar we also have to give the Avatar a class name of size 5 rounded MD and Mr of one then an avatar image here with a class name rounded MD and source of image and an avatar fullback here and for the Avatar fullback we actually have to uh create it here so Avatar fback will be lab character at0 to uppercase as such and inside we just render the Avatar fullback let's go ahead and give it a class name of rounded MD and then outside of the Avatar add a span element label and give it a class name of text SM and truncate there we go now we can go ahead inside let me just move this to the top here we can now go ahead inside of our workspace sidebar and we can replace this with user item from do/ user item the same way you added the Side Bar item there we go and now we're just going to go ahead and pass in everything we need here so the key will be item uncore id the ID will be member ID label will be member username my apologies item item. user.name image will be uh item. user. image variant will be if member uncore ID is equal to the current uh member ID which we can easily uh get but let's just not the same thing as in inside of here you remember I wanted to control the variant we can't do that yet because uh we don't have that part of the URL yet that's why I'm skipping that sorry uh all right so just this will be enough and now let's go inside whoops let's go inside of the user item and this ID will be members like that there we go so ID is for member not for the user uh great so we now have the user item here and I want you to be logged in in something that doesn't have a picture because you can see I'm noticing a little uh kind of a bug here right so let's go ahead and actually resolve it and it looks like we will have to uh wrap this into its own sidebar as well so let's go inside of the workspace sidebar and let's copy this workspace section and let's wrap this members inside there we go so so we can call this direct messages and hint will be new direct message there we go so these are now direct messages and these are the channels and I can add a new direct message here there we go so now nothing is really visible here I want it to be visible the same as this so let's go ahead and visit the user button and let's uh visit the user item so we can detect some differences here so the Avatar fallback should have this class name it seems so let's go ahead inside of the Avatar fallback and let's add this and see if anything changes there we go and I actually want to use this kind of rounded uh instead of rounded full so can I give this Avatar a rounded MD will that work and I think I also have to do it here so rounded I'm doing this in the user button component if you haven't notice basically I'm trying to do a change there we go I want them to be rounded and I'm also going to give it to the Avatar image just in case there we go so just like the one in the user item so they are now you know matching right and perhaps inside of the user item we can make the text a bit smaller maybe extra small yeah I think I don't know I can't even tell if it changed but I think this looks fine great so we can now render members and we can now render channels excellent so what I want to do next is I want to implement the ability to add new channel and the ability to invite people so that we can get more direct messages uh as options here and I just want to log out quickly and I want to log in with my GitHub because my GitHub has an actual image so I want to see whether this looks fine this looks just fine fine great amazing amazing job and of course you know if you go into some of your older workspaces like mine I don't have any channels here right so don't be surprised only in the new workspace will you have the general Channel inside great great job let's go ahead and let's Implement a functionality to add new channels on the () click of the new channel button so what I want to do is I want to go ahead and revisit my channels feature if I have it at all I do great so inside of the channels feature folder let's go ahead and let's create a new folder called store and inside of here you can open an existing one from workspaces and you can just copy use create workspace model and you can paste it in our newly created channels store right here let's go ahead and let's rename this instead of use create workspace model to be use create channel model like this let's also go ahead and rename the hook itself so use create channel model like that everything else can stay the same this is just a constant name great so now that we have that let's go ahead and let's actually create the channel model so we're going to do that inside of the channels feature fold let's create the new components folder inside and let's create create channel model the SX like that let's import everything we need from the dialogue component right here and let's import the hook which we've just created so use create uh Channel model from do/ store use create channel model like that and let's EX ort con create channel model now inside of here we can return a dialogue which we've added an import for above and now let's add the controls so I'm going to add open and set open from use create channel model like that let's go ahead and pass in the open prop to match our open State and on open change we'll call the set open method inside the dialogue component let's add the dialogue content like this and then let's add the dialogue header the dialogue title and inside let's write add a channel like that let's go ahead and stop here and let's try and render this out so the first thing I want to do is I want to add this inside of our source components models. DSX so I'm going to go ahead and import create channel model from feature channels components create channel model and I'm just going to add it here create channel model there we go so now we don't have to worry about any hydration errors and we can initiate this model from anywhere in our app so let's go ahead and do that by revisiting our workspace sidebar so I'm going to go ahead inside of the app folder workspace workspace ID and let's find the workspace sidebar here now I'm going to go ahead and actually add our newly created hook so const use create channel model from features channels stores use create channel model I'm just going to move that here above inside of here I'm technically not going to need the open field but it will need the set open field and what we can do here is Mark the open with an underscore prefix and then it will become this color as it is being used so now let's go ahead and copy this set open and let's find our workspace section which indicates new channels here and on new we'll Now call the set open true so now if you go ahead and refresh your app and of course ensure that you have Bun Run Dev running and bonex convex Dev or the equivalent npm run Dev and npx convex Dev when you go ahead and click on channels there we go it should open up at a channel model just like that I just want to go ahead and protect this just a bit further by adding a new hook here which we already have which will be called use current member let me just see oh I already have that it is right here my apology so let's actually use this member here inside of this method so what we're going to do is say if member role is admin in that case call this method otherwise undefined so in case a guest is looking at this list they will not see the plus Batton at all why well for example in direct messages here if I remove the on new entirely you can see that the plus button does not exist so if again test is looking at this or if their role is not admin in other words they're just going to see it like this right without the plus button but since we are on admin we can see the add a channel model so now let's go ahead and let's continue developing this uh Channel model here so I'm going to go back inside of the create channel model and outside of the dialogue header I'm going to add a form here the form will have a class name space y4 and inside I'm going to render an input component from components UI input I'm going to go ahead and give this input a value which will for now be an empty string a disabled of explicit false on change for now an empty Arrow method I'm going to give it required autofocus minimum length of three maximum length of 80 and I'm going to give it a placeholder for example plan- budget like that and below this input but still inside of the form I'm going to create a div with a class name Flex justify and and inside I'm going to add our button component so make sure you've added the button import here inside of this button component I'm going to write create and I'm going to go ahead and disable this explicitly like this so for now false so let's go ahead and see how this looks like now there we go we have a very simple form to enter the name of our Channel and click create now I want to add some specific rules of how channels can be named so I want channels to be all in one word meaning I don't want any spaces and if there is a space I want to automatically turn that into the this Dash so let's go ahead and Implement that first of all let's go ahead and import from react use State now inside of here I'm going to add name and set name and use state with an empty string here and then let's go ahead and let's add our const handle change here to accept an event of react change event HTML input element and inside of here we're going to uh parse our value so event Target value and then we're going to replace some of its parts more specifically we're going to use regex to replace all white space so I'm going to go ahead and add a forward slash I'm going to add uh a backwards slash S Plus forward SLG and then go ahead and add a dash here into lowercase like that and then set name value now let's go ahead and let's actually assign this so the value will be name and on change will be handle change so now if you try typing something plan you can see how many spaces I add but it actually writes a so plan budget or my channel test wh space test there we go so we cannot write white spaces great so that's the behavior I expect here now let's go ahead and let's add one more reusable uh function here so handle close will have a very simple job of calling set name and resetting it back to its initial State and then set open back to false and then instead of on open change calling set open directly we're going to call the handle close method now let's go ahead and actually create an API endpoint to create a channel so let's go inside of convex channels and let's go ahead and Export con create which will be a mutation from generated server the arguments for this uh will be the name which is a string and also a workspace ID in which we are creating this channel then we're going to have an asynchronous Handler here which has the context and the arguments and now we're going to go ahead and write the logic inside so let me just fix the typo here there we go let's start with getting our user ID here so we need to check for that and then of course if there is no user ID we're going to go ahead and throw an error so if there is no user ID since this is a mutation we can throw errors because we can catch them so unauthorized here and let's go ahead and throw new error now we have to repeat our member logic so we can steal that from here so I'm going to write if there is no member but also we can immediately check if member rle is not an admin in that case they cannot create a channel so we can go ahead and throw new error again unauthorized only now can we go ahead and actually create our channel so I'm going to go ahead and call this first name so in case they bypassed the frontend validation of our rules for how channels must be named we're going to repeat that on the back end as well so I'm going to call this arguments. name name do replace forward slash backward slash S Plus G and then a dash and let's call to lowercase here like that I have a typo in my regular expression so I'm missing I forward slash before G there we go and now let's go ahead and actually create the channel so const Channel ID is await context database insert channels name will be par name workspace ID will be arguments workspace ID like that and let's return that back the channel ID there we go we have our method to create new channels now let's go ahead and let's create a hook for that so inste of source features channels a Pi we already have use get channel now let's go ahead and go inside of workspaces and let's copy use create workspace because it's quite similar and we can paste it inside of our Channel's API features folder I'm going to rename this hook that I have just copied and pasted in here to be use create channel make sure you didn't accidentally cut right so make sure that you still have used create workspace in your workspaces API folder and then go ahead and go into inste of the new use create channel double check that you're working inside of here and now you can go ahead and modify some things so we already know that our response type now will not be an ID of new workspace but an ID of new channel so that will be a type of ID channels we also know that this will be called use create channel and we also know that we are going to modify the mutation call here to be API channels create like that now we also have to modify our request type to besides name also ask for workspace ID which is an ID of workspaces there we go once we addit this this and modify this no more errors inside of this code so now we can go back inside of our create channel model here and we can add that hook so I'm going to go ahead and add our use create channel not model but use create channel from do/ API use create channel here and I'm going to the structure mutate which we can call or we can leave it at mutate because we're not going to have any other mutations here so no need for an alas so mutate and is pending like that and then let's go ahead and Implement our handle submit so const handle submit method is an event of react form event HTML form element let's go ahead and prevent default here and then let's mutate let's go ahead and pass in our body or our arguments which are the name and our workspace ID let me just confirm whether we have workspace ID or not we do not so let's add it here workspace ID our reusable hook use workspace ID from hooks use workspace ID like that now we have the name which we control inside of this state and we have the workspace ID great so now I also want to add our on success method here so after we successfully create a new Channel I want to redirect to that channel so I'm going to add a to do here redirect to new channel but we don't have that part of the URL yet so I'm not going to do that yet instead I'm just going to call the handle uh close method now let's go ahead and assign the handle submit to our uh form here so on submit handle submit and let's modify this explicit disable false to be is pending which we now have D structured right here from our use create channel so now if you go ahead and try it out pick any workspace I'm going to go ahead and create a plan budget for example and there we go we have a new channel here if you click it's a 404 because we don't have that part of the URL yet there we go you can go ahead and create any channel you want General random however you want it to be great great job now let's implement the invite model () which will appear when you click on the invite people to name of your workspace here so let's go ahead back inside of our Visual Studio code here and let's go inside of our workspace header which is located inside of source app folder workspace workspace ID and inside of here you should have the workspace header so let's go ahead and alongside preferences model let's also add the work uh the invite model like this let's go ahead inside of workspace ID and let's create a new file invite model DSX let's go ahead and Export con invite model here and let's return back a div invite model now let's go back to our workspace header and let's import the new invite model I'm going to go ahead and just move this above so now you should see the text invite model here at the top now let's go ahead and let's copy and paste this state here so this will be invite open and set invite open and let's go ahead and pass those props here so open is invite open and set open will be set invite open like that now let's go ahead inside of the invite model and let's import everything we need need from the dialogue so I'm going to go ahead and add dialogue dialogue close content description header and title let's replace the main div with a dialogue and let's go ahead and let's uh destructure our props so for that we need an interface invite model props so I need open which is a Boolean and I need set open which accepts the open value and returns a void so we can now use these props to D structure our items inside so that's open and set open and now we can control the dialogue open feature by passing in the open prop and on open change to call set open here let's go ahead and add the dialogue content here inside a dialogue header and then a dialogue title here and then inside of here we can go ahead and write invite people to your workspace like this so now if you go ahead and try and click here uh it should open up a model looks like it is not so let's go ahead and thebug uh why that's not happening so we do have the invite model rendered here but we are never calling a set invite open right so let's go ahead and find our uh invite people to drop down menu item and change this to set invite open true and if you try it out now when you click here and click invite people to GitHub workspace there we go invite people to your workspace now we need to pass some data to this model so let's go ahead and go inside of the workspace header and let's see what is available to us so it seems like the entire workspace here is available so how about we pass in the name of the workspace via workspace name and how about we also pass the join code to be workspace join code like that so let's go inside of the invite model here and let's go ahead and Define the name to be a string and join code to be a string as well there we go no more errors on this side because joint code is a string and workspace name is a string as well so now we have those props so let's add them here to our destructured list so beside open and set open we now have name and join code so now we can be a bit more descriptive here so we can say invite people to name like that and below this we can add a dialogue description use the code below to invite people to your workspace outside of this dialogue header let's go ahead and create a div with a class last name Flex Flex column Gap y4 items Center justify Center and py of 10 so a big space on the top and on the bottom here and then inside of here we're going to add a paragraph which will render the join code there we go so I just picked a random workspace and in the beginning we created just this hardcoded join code 1 2 3 4 5 six right but if you try on some new workspace it should have a bit more uh proper looking invite code like this so look this looks more random than the previous one so now let's go ahead and style this so it shows a bit nicer in this model here so I'm going to go ahead and give this paragraph a class name of text for XL font bold and I'm going to give it tracking Wiest and uppercase so the reason I'm putting uppercase here is because I made a decision that my codes will not be case sensitive and also on the invite screen it's automatically going to be uppercase regardless if the user has their caps lock on or off you can of course decide that for yourself whether you want to work like that or not there we go so now we have a big code showing here that allows people uh to see what the invite code is great so now what I want to do is I want to go uh below the paragraph and I want to add a button from components UI button and inside of here I want to say copy link and I want to add a copy icon from Lucid react so besides having the code we also need to have an invite link for the user so copy icon here will have a class name of size 4 and mL of two the button itself will have a variant of ghost and a size of small so there now in here you will have a copy link button which will copy the URL where other users have to visit to get to enter this invite code right so let's go ahead and create a method which will actually do that so I'm going to go ahead and add const handle copy and now we're going to generate the invite link so the invite link will actually always be static and inside of here we need to get the window location origin so we get the protocol and everything else where this app will be hosted on so in my case it will be Local Host 3000 right we don't have to write that because what if it's deployed somewhere else that's why we're using this so window location origin slash jooin and then workspace ID and we can get the workspace ID using our use workspace ID you can also pass it as a prop if you want to but I want to make use of our hooks here there we go so now we have the invite link and now what we're going to do is Navigator do clipboard so this is native uh browser API this comes from window. Navigator I believe let me just check yes window. Navigator but you don't have to type in window so clipboard write text invite link like that and this is actually a promise so what you can do is you can import toast from soner and then you can chain a DOT then and you can do toast success invite link copied to clipboard like that and then go ahead and use the handle copy on this button right here on click handle copy so if you go ahead and click this there we go invite link copied to clipboard and let me go ahead and show you this is the this is what was copied so Local Host 3000 SL jooin and then the uh workspace ID so we're going to develop that later because if you try and go there now it's a 404 page right so just ensure that your invite link is working but that is just one part of what we are going to do here we also need to allow uh the admin the user to reset the invite code in case people are uninviting coming in right so let's go ahead and develop that first let's go inside of our workspaces API so convex workspaces here and let's go ahead and let's add a new export const new join code it will be a mutation which in its arguments will accept a workspace ID which is Av ID workspaces type then as always we're going to have a Handler which is an asynchronous function let me just fix the async typo here inside of here we can do the thing we always do which is check whether we have a user ID or not here like that and then let's also go ahead and check whether we have a unique member so we can write it out again so we remember how we do that so we get the unique member by doing a weit context database we query the members and then we use with index by workspace ID and by user ID so we get the query here and then we're going to chain those two so workspace ID to be arguments workspace ID and then another do equals user ID to be the user ID which we just got via this method right here which knows the currently logged in user and we can safely do do unique on this query if there is no member or if member role is not admin we're going to go ahead and throw new error here unauthorized and now we can go ahead and generate new code so I'm going to go ahead and reuse this method generate code so let's go ahead and write con join code will be generate code and then await context database patch arguments workspace ID join code there we go and let's go ahead and return our arguments workspace ID here like that now let's go ahead and let's create a hook for this so I'm going to go inside of my source features workspaces API and I'm going to copy use update workspace because it's the most similar one I believe so we're going to go ahead and let's call this uh use new join code. the s like that so the request type only accepts the ID workspace the response type will return back workspaces uh let's go ahead and change this to use new join code and this will be API workspaces new join code here and the values here let's see if we're doing something wrong so the ID should be workspaces but let's see inside of new join code all right let's explicitly do workspace ID because this does not include workspace in its name so yes let's be more explicit here let's change workspace type to be workspace ID there we go so now our new join code accepts the value of workspace ID here and that will safely be passed here perfect so now that we have the use new join code we can go ahead and add that mutation so let's go ahead and go back inside of our app folder workspace workspace ID let's find the invite model here it is and inside of here now let's go ahead and add our use use new join code which you can obtain from features workspaces API I'm just going to go ahead and separate the features here like that and inside of here we're going to get mutate and is pending so now let's go ahead and actually add some buttons to use that as well so last thing we did was we added the copy link button so now outside of this div add a new div so just before we close the dialog content here and let's go ahead and give this div a class name Flex items Center Justified between and full width and then let's go ahead and add a button here which will on click handle the uh let's let just give it an empty function for now and let's give it a variant of outline this will say new code and then we're going to go ahead and add a dialogue close here give it an as child so we close this in a component controlled way and a button which will just say close like this so now we have new code here and we have close here uh let's go ahead and also go ahead and add a refresh CCV from Lucid react here let's go ahead and style this so class name size 4 and mL of two uh did I add a mistake here my apologies there we go so now it should have a little icon here and now let's actually add the method to deactivate or regenerate the new code so const handle new code we'll first of all uh call the mutate here method pass in the workspace ID and then we're going to have on success here toast we already have toast great so toast. success invite code regenerated and on error toast error fail to deactivate to regenerate invite code so now go ahead and copy the handle new code here and paste it here in the new code button so when you click this there we go you can see how new code is regenerated so I want to go ahead and disable this if we are pending at the moment so if I go ahead and click here there we go I don't want to be able to spam this uh while it's generating the new code uh and since this is a pretty destructive action and if you've shared the code with anyone else before they will no longer be able to get inside let's go ahead and let's use our confirm dialogue here for a better user experience so I'm going to go ahead here and I'm going to add the confirm dialogue and the confirm method from use confirm hook so you can import use confirm from hooks use confirm now inside of here let's go ahead and add the title which will be are you sure and the description this will deactivate the current invite code and generate a new one just in case the user is not aware of what they are doing so now let's go ahead and wrap this entire thing inside of a fragment let's go ahead and let's add the confirm dialogue here and then let's go ahead and modify the handle new code to be an asynchronous method which will get okay from await confirm if not okay we're doing an early return here so if you go ahead and try it out now there we go you get a confirmation this will deactivate the current invite code and generate a new one if you click cancel nothing happens but if you click confirm new code is generated great amazing job so you just finished the invite uh model what we have to do next is the invite or the join screen now let's implement the join () screen before we can do that we have to create the join endpoint so let's go back inside of the convex workspaces API here and now we're going to go ahead and create a new mutation which will simply be called join so we're going to go ahead and add mutation here which will have arguments the arguments pass will be join code which will be a string and workspace ID uh to which we are going to check whether the code matches or not as always we're also going to have a Handler which is an asynchronous method with context and arguments here and now we're going to do our usual checks so we can go ahead and copy this if there is no user ID there is no user to join then let's go ahead and let's check if we have workspace so await context database get arguments workspace ID if there is no workspace it means that again we cannot join that so new error is being thrown here workspace not found and then what we have to do is if the workspace join code does not match arguments join code to lowercase again we're not going going to uh use uppercase letters in my code so if you want it you can go ahead and confirm whether the casing matches as well but let me remind you my generate code only uses lowercase letters so yes it makes sense for me to lowercase whatever the user wrote so inside of here I'm just going to go ahead and throw a new error invalid join code like that so basically if the join code that we received in the ARG arguments does not match the one we have in the database for this workspace we cannot join this and if all of this is okay we're going to go ahead and do const existing member and this existing member will be the exact method as the one we have above which we usually use to check whether someone is a member or not so wait context database we query the members and we use the width index by workspace ID and user ID and if we have an existing member we're just going to throw back new error here already an active member of this workspace or just already a member of this workspace like that otherwise we're going to go ahead and do await context database insert into members and we're going to create a new member based on this user ID and workspace so user ID can be passed like that workspace ID can be passed as workspace doore ID and then we're going to have a roll of member here because this user joined they did not create this and let's return back workspace ID there we go so now we have our join mutation and now let's go ahead and let's create a hook for that so inside of source features workspaces API as let's go ahead and copy the use new joint code and let's go ahead and call this use joint join let's go ahead and modify the workspace ID I mean the request type to accept the workspace ID but also to accept the join code which is a string now let's go ahead and modify this to be called use join and let's modify the mutation to be workspaces join so there we go it accepts the workspace ID and the join code everything else canay stay the same now let's go ahead and let's actually create the join page so I mean on this page when we click copy link right now this is what we need to create slash jooin and then a workspace ID so let's go ahead and create that structure we're going to go ahead inside of the source folder inside of the app folder and inside of here we're going to create a new join folder and then inside we're going to create a dynamic workspace ID like this and then page DSX so ensure that you don't have a typo here in workspace ID and ensure that it is in square brackets so that it becomes a part of dynamic URL now inside of here I'm going to Mark the entire thing as use client and remember it's a page. TSX file which means it needs a default export so join page and let's return a div join page now let's go ahead and copy this link and let's try pasting it in our browser you should now see the text join page here make sure that your url is Slash jooin and then some ID make sure that this is your structure join workspace ID and make sure that inside of the invite model you did not accidentally do something wrong here so this is the Local Host part this is Slash jooin and this is SL workspace ID I'm telling you that in case you have any errors at this point great so now let's go ahead and let's actually uh style this page a bit so I'm going to go ahead and give this div a class name height full Flex Flex column Gap Y8 items Center justify center background color white padding of a rounded large and Shadow SM let's actually use Shadow MD and now let's go ahead and add an image from next image here and now we have to go ahead and add uh a logo so you can use whatever you want for the logo uh I have this little hashtag icon here so I'm going to paste it here uh logo.svg whatever you do make sure you put it inside of the public folder right if you want to use external URLs in that case you need to modify your next config here but we're going to do that later because we will load images from external URLs but not yet for the logo I want you to find any image you want any image you like you can use Google you can use unsplash you can use logo ipsum whatever you want just go ahead and paste that inside of your public folder you can also use the pre-existing versel or next if you want to so make sure you have something inside of your public folder and then inside of page. DSX here go ahead and give this a source of/ logo.svg like that and then let's also go ahead and give it a width and height so the width here will be 60 and the height here will be 60 as well and let's give it an ALT of uh logo there we go so if you want you can change this to overell SVG if you don't have any other image right whatever image you want to put here and then below that let's add a div and a class name Flex Flex column Gap y4 items Center justify Center and Max with MD inside of this another div class name Flex Flex call Gap Y 2 this time item Center and justify Center again inside of that div we're going to have an H1 paragraph which will say join workspace and below that another paragraph enter the workspace code to join there we go now let's go ahead and give this H1 element a class name of text to Excel and font bold and this paragraph a class name text MD and text muted foreground like that and then let's go ahead outside of this div here and what we have to do here is we have to add a verification input so for that we can use a nice little package so I'm going to go ahead and do bun add or npm install react Das verification Dash input like that let's go ahead and let's import the verification input from react verification input and then go ahead and render it here so verification input like that and now we're going to have to go ahead and style it because it looks fine but it can be much better so let's go ahead and give it some styles using the class names which is an object so inside of here we're going to style each part of this uh component individually so we're going to go ahead and add container here to have flex and GAP X of two then we're going to have a character to have uppercase height of Auto rounded MD border border gray 300 Flex items Center justify Center text large font medium and let's also add text Gray 500 so this is the class name for our character here and there we go you can see that it already looks much better now let's just add some finalizing Styles here so below the character we're going to have character inactive which will be background muted we're then going to have character selected which will be background white and text black and we're going to have character field which will be background white and text black again and there we go so I quite like how this looks you can of course play around and create your own version of this I'm going to go ahead and also pass in the autof focus here and I'm also going to limit the length of this to be six like that and let's also go ahead outside of this div here and just add a new div which will be used to go back home in case a user accidentally stumbled upon this website so Flex Gap X4 and inside of here a button which you can get from components UI button the button will have a size of large a variant of outline as child because inside we're going to have a link component so we are not doing any anti patterns this button becomes the link right so it's not like we are putting a link inside of the button and let's give this an hre of just going back to home and let's write back to home and the link was imported from next link package there we go so you now have back to home in case you stumbled upon here accidentally now let's actually go ahead and let's use uh our use uh join workspace here and another thing we can do since this is a page component we can destructure the workspace ID in several ways so we can do workspace ID here via use workspace ID or we can go ahead and create an interface uh join page props perams workspace ID is a string so this is how you you can do it in nextjs way right and then params so now if you try and for example console log workspace ID and pams you're going to see that they are identical just ensure you have used client at the Top If you're adding any hooks here so now let me go ahead and refresh this there we go you can see that the my Pam's workspace ID and my workspace ID both give me the same result so choose which solution you want to use I prefer my hooks here great so we have the workspace ID and now let's also do uh a use get worksspace and here's the thing I actually want to add another endpoint besides use get workspace because use get workspace is pretty let's say confidential right so it is get by ID here and as you can see we don't allow any non-member to visit the data so let's create a new method above the get by ID which will be called export con get info by ID so we just need some basic information about this that even unauthorized users are allowed to see so for that the argument here will be the same and let's go ahead and copy the Handler here and the difference about this Handler is that I will not AC expect the user ID inside my apologies we will need the user ID of course uh but we will not expect the user to be a part of this workspace as a member so let's do our usual get user by ID right here if there is no user we are simply going to return null remember this is a query so we're not throwing any errors and we can actually copy the member functionality as well but we're going to use it for a reverse type of logic so in here in my get info by ID I'm looking for a unique member with this workspace and user ID but I'm not going to do anything regardless if we are a member or not what I'm going to do instead is just get the workspace so await context database get arguments workspace ID or actually it is ID all right and all I'm going to do is return back the name of the workspace so workspace name name and is member which will be very simply a Boolean whether our member exists or not so I just want to bring back basic info back to my front end here so now let's go ahead and let's actually uh add this get info by ID to a hook so let's go ahead inside of our features workspaces API and just as we have used get workspace let's copy and paste this and let's call this use get workspace info so let's call this use get workspace info props use get workspace info and this will be get info by ID everything else is the same so now we can go back inside of our page here and we can use that hook instead use get workspace info so this Hook is safe to use and inside we're going to pass an ID workspace ID so this allows us to provide new or non members of this workspace with some useful info without compromising on security so inside of here we can structure the data and is loading and then you can go ahead and say join data name here and there we go now it says join test because that's what I uh used this four great so what we can also do now is we can leverage this is loading so if is loading let's go ahead and let's return a div class name full height Flex items Center justify Center and a loader and let's give it loader a class name of size six animate Spin and text muted foreground let's go ahead and move the loader above and there we go so now when you refresh there we go you first have a nice loader and only then do we get the information so now let's also add our mutation so use join from workspaces API use join here and inside of here we get the mutate and is pending so let's go ahead and implement the handle complete method which will be called once you enter all six uh characters so const handle complete will also give us the value of what user wrote and we're going to go ahead and call mutate with workspace ID which will uh also have join code to be the value there we go and then let's go ahead and add on success here which will have the ID so we can redirect to that ID so I'm to add a toast success joined uh workspace joined and let's go ahead and add on error post error failed to join workspace now let's also add the router from use router and let me just move these two Global Imports to the top and now besides that we can also do router. push or let's actually use replace so user can go back to this page workspace and then ID and I should have used template literals like this there we go and now we can go ahead and assign the handle complete method to the verification input on complete hand complete so let's try out what happens if I just type in a random code there we go it says failed to join workspace so if you try and write some random letters you will not be able to join and what we can do is make the verification input look disabled while it is submitting so let's go ahead and let's import the CN library from Libs and let's go ahead and add to the container here a dynamic class name so if is pending we're going to go ahead and write opacity 50 and cursor not allowed and you can get the is pending from the use join hook here so now if you try and type something there we go you can see how we have a nice little indicator while we are attempting to join this workspace so now let's actually try out the functionality I'm going to go back home and I'm going to go ahead and copy uh my invite link here so I'm going to okay so it's 1 2 3 4 5 six that's quite easy I'm going to copy the link and I'm going to log out I'm going to log back in into my other account and I'm going to paste that new invite link inside of my URL and there we go join GitHub workspace 1 2 3 4 5 6 then there we go workspace joined and as you can see there are now two members in this workspace so if I try and go back there again I can still see this page and if I try and join you can see that I have an error failed to join that's because we have a check for that here so inside of the uh where is my join workspace let me just find my uh join okay it's here so in case the user is already an existing member we throw an error so what we can do is we can go inside of page. TSX and remember we actually have something useful inside of the data which is is member so we can use that to redirect the user away from this if they are already a member so I'm going to go ahead and D structure const is member use memo you can get used Memo from react I'm going to go go ahead and move it here and I'm also going to import use effect so I have it prepared so I'm simply going to do if data question mark is member and I'm going to pass in data question mark is member in the dependency array and below that I'm going to get a use effect here which will simply look for is member and it will also need a router and the workspace ID now inside of here what we're going to do is check if if is member and we're going to do router push open backt SL workspace and then very simply workspace ID basically the user is already part of this and that's it we don't even need the else so this is the only thing we need so if you try and and there we go I'm a member in here so you can see that I don't have all of those options like creating a Channel or uh seeing additional options to invite or the preferences right but if I try and I think I still have it I don't okay so let's try and log out let me log back in with my uh GitHub account here and if I copy the invite link and I try pasting it myself here you can see that for a split second I see the screen and then I'm redirected back because I'm already a part of this workspace so no need to do that to allow this to even be seen because I'm going to get an error if I try uh joining anyway right so even if I try the correct code I get back the error so what we can do is just redirect any members away from this page and now let's go ahead and try it out again but in a reverse way so I'm going to go ahead and log out here and I'm going to log in with my email and I'm going to go ahead inside uh of my new workspace here invite we're going to call it and let's go ahead and click new code so we generate the new code here so I'm going to go ahead and copy both of this and then I'm going to go ahead and log out I'm going to go ahead inside of my other account and I just want to confirm that the new invite code is now working so I'm using Ray uh raycast so I have the clipboard history feature here so there we go this is my new code I'm going to paste it and there we go workspace joined perfect so you now have the ability to invite people to your workspaces and you can even change the invite codes amazing amazing job so what I want to do next is build () the individual Channel ID page so right now when you click on any channel in your sidebar you will be redirected to a 404 page that's not something we want to happen and besides that I also have to fix this current state so at the moment the user is visiting a workspace but they don't have neither the channel nor any direct message selected this exact State Should technically not be possible so whenever someone is visiting a workspace we want at least the general Channel or one of the direct messages to be active so this current page should not even exist the only purpose of this page should be to redirect to General for example or the first channel it can find for this workspace so those are the two things we need to fix today so let's go ahead inside of our app folder workspace folder workspace ID and inside create an additional part Channel and then inside of that a new folder inside of square bracket Channel ID so exactly the same as we did workspace and workspace ID the only important thing is that this and the subsequent Channel ID folder are both inside of the workspace ID and then inside of the individual Channel ID go ahead and create a page. DSX go ahead and Export default the channel ID page and for now let's just return a div Channel ID page and here's the cool thing about this since we put the channel inside of the workspace ID they will share this layout which we have with our resizable panels and our workspace sidebar toolbar and all other useful things so if I now click on General there we go I'm redirected to channel ID page and look at this my toolbar my channel sidebar and my main sidebar are all active and they did didn't even rerender so that's the power of layouts so in case you're getting a 404 still confirm that your url is workspace workspace ID channel and then Channel ID also ensure that you have the exact structure as I do inside of my app folder so app folder workspace workspace ID channel channel ID page and one more thing I want you to confirm is that inside of your workspace ID inside of the workspace site Side bar here on the sidebar item confirm that you are redirecting to slw workpace workspace id/ Channel and then the ID of the channel and we pass the ID from item. ID inside of our use get channels hook which is calling the API channels get so confirm you have those exact things great so now that I've confirmed that we actually have this get API endpoint for the channels right and we also have the use get channels what we can do is we can already solve our problem that workspace ID should only serve to redirect to the nearest channel so let's go inside of the workspace ID page. TSX so at the moment the only thing we do here is well just uh write workspace ID page so what I want to do now is I want to go ahead and actually redirect the user if they this page so I will mark this entire page as use client I'm going to go ahead and prepare the workspace ID from use workspace ID from my hooks here I'm going to get the router from use router from next navigation and I'm going to go ahead uh and also prepare my use create channel model hook so why am I preparing that hook as as well well in casee user removes all of their channels including the general Channel I still don't want them to see this workspace ID page but in that case we also cannot redirect the user to any page so what we have to do is we have to uh prompt the user to create a new channel if they don't have any channels available and if we cannot redirect them to any other channel so let's go ahead and do the following I'm going to prepare use get workspace and inside of use get workspace I'm going to pass in the ID to be workspace ID and inside of here I will be structure data to be workspace and is loading workspace loading besides this I'm also going going to add data channels is loading channels loading which will be use get channels and inside of here I will pass in the workspace ID to be our well we can just use the Shand operator like this and you also have to import use get channels from features API channels like that there we go so we now have the workspace and we have the channels here so what I'm going to do here is I'm going to add the first channel ID I can find and I'm going to memorize it so that I can just easily add it to use effect here let's go ahead and just quickly import use memo and use effect from react inside of this Ed memo what we're going to do is attempt to get the first item in the channels array and then get its ID and I'm going to go ahead and add channels in the dependent array here and then in the use effect we're going to add the channel ID here and what I'm going to do first is I'm going to check if we have workspace loading active or if we have channels loading active or if there is no workspace in any of those CES I'm going to break this functionality here which also means we have to add all of those so that will be the channel ID the workspace loading the channel channels loading and the workspace itself like this and then if I have the channel ID what I'm going to do is I'm going to call router. Push SL workpace workspace ID and then slash channel channel ID else if my create channnel model is not open I will call it and set it to open this way we will either find the first channel in this workspace and redirect the user there or we are going to open the channel creation model in case the user tries to close that model we are going to run through use effect again and we are going to detect that the user is not opened I mean that that model is not opened mean meaning it's been closed and we are going to forcefully open it back again so we have to now also add open here and set open I believe and we also need a router and workspace ID there we go and then what I'm going to do here is I'm going to add some loaders so if workspace is loading workspace loading or channels loading I'm going to return a div here with a class name I full Flex One Flex items Center justify Center Flex column and gap of two and inside I'm going to add a loader from from Lucid react so make sure you've added the loader import here let's go ahead and give the loader some quick class name which will be size six animate Spin and text muted foreground if there is no workspace in that case we can copy the return but what we're going to do is we're going to write an error here so I'm going to go ahead and add a tri triangle alert icon from Lucid react make sure you've added this this as well and below the triangle alert just make sure you have Flex column and GAP two you can add a span workspace not found so this will be kind of an error page if the workspace gets deleted while we are a guest or looking at this space this is the message we're going to uh be prompted with so text small text muted foreground like this and otherwise we can just return null no need for the user to see anything else because at this point the user should already be redirected somewhere else so right now there we go I'm already on channel ID page so I will try and forcefully now uh go back to my workspace ID I'm loading an I'm redirected to the channel page right here there we go so that's how we resolved that issue so what I want to do now is I want to go ahead and try and delete my general channel here so I will try and find this invite I invite Channel invite workspace and I will try and delete this General channel so let's go inside of our convex database here and I'm going to go ahead and find the channels and what I can do is just remove every single Channel inside like this and now I'm going to go ahead and go back to the workspace ID page and let's see whether this will now prompt to me and there we go I'm prompted with add a channel and if I close it you can see that I can't escape this screen so in any case if I'm visiting workspace and then SL workspace ID I will either be redirected to the first available Channel channel in this workspace or I will be forced to create the first channel so I will write test there we go so now inside of here what we have to do is we have to highlight this channel as one of the active channels here because I'm going to go ahead and ADD test two and let's also add test three so we can see the differences now and also you don't even notice it at the moment but when you create a new channel you should also be redirected so let's just quickly resolve this as well but let's go ahead and do it uh in a second because I want to First implement this feature that the active channel is highlighted so just as we have the use workspace ID and use uh well what else do we have let me just find it so inside of hooks we have just used workspace ID let's copy and paste it and let's now create use Channel ID so use Channel ID we'll be looking for brs. Channel ID and it will be called use Channel ID and the ID will be a type of channels like this so how do I know it's Channel ID well because of my app structure inside of workspace we are looking for workspace ID but inside of Channel we are looking for channel ID with capital I here so that's how I know what to look for so now what we can do is we can go inside of the workspace ID inside of the workspace sidebar and we can import besides using workspace ID use get uh use Channel ID like this and then inside of here we can get the active Channel ID and if we have the channel ID we can then compare it here inside of our workspace section for the channels so I'm going to add a variant if Channel ID is active to Item undor ID in that case it's active otherwise it's default so now if you try it out there we go when you click on different channels the URL changes and the channel ID is updated and now let's also create this if I create another Channel I want to get redirected to that channel immediately so for that I want to revisit the model for that so I believe that's inside of features channels components create channel model let's go ahead and let's add the router from use router from next navigation I'm just going to move it here to the top now that we have the router once we created there we go we have a TOD do here so let's go ahead and do router. push slash workspace workspace ID slash Channel and then the new ID like this so let me just confirm that we have workspace ID here we have a great make sure you don't misspell I'm using singulars so I'm not doing slash channels right make sure if you have a habit that you don't accidentally do that so now if I create a new channel there we go I'm immediately redirected to that channel great so one thing that I want to take care of which is a rare possibility to happen so I'm going to go ahead and see is there uh a channel I am in which I am not a uh member of right so if I try and create this there we go you can see that uh I can find a channel which I'm not a member of I mean which I'm not an admin of and what happens is that I can't create a channel so I'm being prompted to create a channel but since I'm not an admin we block that user from doing so so two things I'm noticing here uh if you can't get if you're not able to get on this screen uh the steps on doing this are basically to invite yourself to another Channel where you will be a member and then go inside of that channel and also remove all of your channels right so just go ahead and delete all documents for your channels here and then you should have at least one you know workspace where you are not a member of and you will get prompted to create new channel and you will kind of be blocked here because you can't escape this Loop so first of all what I want to do is I want to revisit the create channel model and I'm missing the on error here so let's add the on error toast. error failed to create a channel or just failed to create channel and we can import the toast from sonor and let's also go ahead and add toast. success Channel created make sure you've imported the tost here from some honor so now if I try this here at least I'm getting the error so I know that something is wrong and looks like we have a dialogue description imported which we're are not actually using so now what I want to do is I want to go back inside of my app folder workspace workspace ID page. DSX and what I'm going to add is I'm going to add data member is loading member loading and this will be use get or use current member and we also have to pass in the workspace ID argument here so make sure you've imported the uh use member feature here uh my apologies use current member and now what I'm also going to do is const is admin which will be use memo and it will check if member role is admin and it will look for member row like this then I'm also going to go ahead and do the following if we don't have uh if member is loading and if we can't get the member so in any of these cases I want to break this entire method so I also have to add those new features here so that is member I believe and member loading and I also believe I need is admin so we're going to do else if not open and is admin so only if we are admin there we go so now this is the screen that non admins will get right and then I also want to go ahead and copy the last return here and just add this here and this will simply be Chanel no Channel found let's write it like this no Channel found and oh yeah we don't need our triangle to spin so let's remove the spin from here and from the no workspace error here there we go so no Channel found and well there's nothing the guest can do about it right but if you go ahead and visit one of your own there we go inside of here you should be able to create that first channel and you will be redirected to channel ID page so that's how we resolved that issue uh great so we now have that resolved uh and now what I want to do is I want to go ahead and start creating uh the channel ID page sections here great great job so now let's go ahead and let's () Implement a header component for our Channel ID page so what I also want to do here is just quickly go back inside of my workspace ID page here and I want to add it to workspace loading channels loading I also want to add member loading and I'm going to chain if there is no workspace or if there is no member we're just going to pass in workspace not found everything else can be no Channel found like this and now let's go ahead and let's go uh inside of Channel page. DSX and I want to go ahead and keep this open and I want to go inside of convex inside of channels here and I want to implement the get by ID method I believe we don't already have it so let's go ahead and add it here export cons get by ID so this will be a query here and it will accept some arguments the only argument we are going to need is the ID which is going to be av. ID channels and then we're going to have a Handler which will be an asynchronous method with context and arguments here and now what I want to do is I want to go ahead and get the user ID from our AWA out get user ID with context as the argument if there is no user ID we are going to return a null for the get by ID method and then we're going to fetch the actual Channel using a wait context database get and arguments. ID in case there is no Channel we are going to early return now back and now what we are going to do is we're going to check whether the user is a member of this workspace but you've probably noticed we are missing the workspace ID for our index which we usually use well have no fear because channel has the workspace ID so that can save us one unnecessary argument for our query so member is await context. database query members with index by workspace ID and user ID get the query here and let's do query workspace ID to be our Channel workspace ID and then our user ID will simply be our user ID from above and we can call do unique safely here and now in case there is no member in this workspace with this user ID we are going to return null because this user is not allowed to see information about this Channel and finally let's return back the channel great so now let's go ahead and create the API uh my apologies the hook for that so inside of features channels API you can copy the use get channels and go ahead and rename this to use get individual Channel like that let's go ahead and modify this to be used get channel change this to be ID of channels and go ahead and modify the props here modify the use get channel name here and modify this prop to be ID modify the query to call the get by ID and finally change the arguments to only accept ID there we go use get channel Hook is now ready so we can go back inside of our workspace ID channel channel ID page. TSX here and let's go ahead and Mark it as use client because we're not going to be using any server side components here so let's go ahead and add our Channel ID from our use Channel ID hook and then let's go ahead and let's get our use get channel from features API use get channel inside of here we are going to pass the ID as Channel ID and then we will be able to destructure the data which is the channel and is loading which will be Channel loading like this and now let's go ahead and add some early returns here in case we are loading so if Channel loading we are going to return a a div with a class name height full Flex One Flex items Center justify Center and inside a loader from Lucid react with a class name animate spin size six and text muted foreground and make sure you've imported the loader from Lucid react here there we go an early return then we can copy this and paste it here and if there is no channel in that case we will return a triangle alert from Lucid react so make sure that's another import you have here and remove the animate Spin and go ahead and uh oh this is a typo so this should just be Flex like this and inside of here modify the flex to also have a flex column and GAP y of two and below this go ahead and add a span Channel not found and give this span a class name text small and text muted foreground like this so there we go now you have a little uh loader here let me just see is this spinner perhaps a tad too large I want to check what's inside my workpace sidebar here uh let me just find it yes in here the loader is size five so let's go ahead and keep it size five here as well there we go let's be consistent it doesn't of course really matter but there we go and I want to go ahead and hard code this to true just because I want to see how it looks there we go this is how it will look Channel not found great so now let's go ahead and modify this there to have a class name Flex Flex column and height full and then inside we're going to have a header component with channel name as prop which will be our Channel dotame let's go ahead and create this channel uh this header component inside of Channel ID folder so header. DSX let's export const header and let's return a div header let's already prepare the interface header props to accept a name which will be a string let's destructure the header props here which is name and we can go ahead and render the name here you can now import the header from do slhe header and the channel name here let's see is a string and I believe I uh well we can call it name actually and just rename this to name no need to be redundant right uh there we go header test so perhaps we can actually call it title that will make more sense if you ask me it's more generic there we go title header test if I go ahead and create new one header is a new one there we go so we are now successfully loading data from our channels and passing it into the header component so now let's focus on the header component here and let's style it as we want to so first of all I'm going to give this div a class name of background white border bottom height of 49 pixels Flex items Center PX4 and overflow hidden so that should already separate the header from the rest of the page here now inside of here I want to go ahead and I want to add a button component from components UI buttons to make sure you've added add an import for that and inside of here I'm going to add a span element with a hasht title like this I'm going to go ahead and give the button itself a variant of ghost I'm going to give it a class name of text large font semi bold BX of two overflow of hidden and width of Auto and I'm also going to give it the size of small and then I'm going to continue and give this span a truncate method I'm also going to go ahead and create an fa Chevron down from react icons fa like this and let's give the fa Chevron down a class name of size 2.5 and mL of two and there we go we now have the name of our channel in the header here and it will serve as a dropdown to access more options for the channel so what we have to do next is turn this into a proper drop down so let's go ahead and import everything we need from the dialogue which is the dialogue the content the trigger header title close and footer now let's wrap our button here inside of a dialogue like this and let's also add a dialogue trigger around the entire thing make sure that you add an as GI drop to the dialog trigger so you don't have any hydration errors and so that this becomes the button below the dialogue trigger add a dialogue content the dialogue content will have a class name of padding zero background of gray 50 and overflow of hidden inside of the dialogue content we're going to have a dialogue header component the dialog header we have a class name of padding four border bottom and back ground of white the dialogue title itself will simply repeat the channel name so it will have a hashtag space title like this so if you try and click here there we go you now have channel name opening up in a model so we are now going to propose the user with a couple of options for this channel here so outside of the dialogue header here add a div and let's go ahead and give this div a class name of PX4 padding bottom of four Flex Flex column and GAP y off two inside of here we're going to go ahead and add a div with a class name px5 py4 uh let me just go ahead yes py4 background white rounded large border cursor pointer hover BG gray 50 like this so there we go we now have this little container here inside of that container we're going to go ahead and add another div with a class name Flex items Center and justify between inside of this positioning Flex we're going to add a a paragraph channel name like this now let's go ahead and style this paragraph since this will serve as a label to what this action will be so text small and font semi bold below the paragraph itself we're going to go ahead and add another paragraph edit and we're going to give that paragraph a class name of text small and then we're going to specify the text color 1 2 six for a three and let's give it a hover underline and font semibold there we go channel name and edit is here and now outside of this div we're going to add a paragraph hashtag title and let's also add a class name text small inside there we go channel name right here as an option great so now what I want to do is go outside of this this div right here so I want to still be uh inside of this div which we've added below the dialog header but outside of this one with background white and border and the cursor pointer and in here add a native button element and inside of here we're going to add the trash icon from Lucid react so make sure you've added this I'm just going to move it here to the top we're going to go ahead and style the trash icon by giving it a class name of size or below the trash icon we're going to have a paragraph delete channel the paragraph itself will have a class name of text small and font semibold and now let's go ahead and give the props to the button so it's going to have a class name of flex items Center Gap X of two PX of five py of four background color of white rounded large cursor whoops cursor will be the pointer border cover background gray 50 and text rows 600 like this so quite a long class name feel free to pause to copy it or write it down yourself like this there we go so now we have to implement another dialogue which is going to open when we click C on the edit so basically we're doing this right you can see how similar it looks to our workspace here so when I click edit I want this another dialogue to pop up so that's what I want to achieve here right now so let's start by adding a state control uh opening here so const edit open set edit open use state from react will be false by default I'm just going to move it here to the top like that and let's also add value and set value to be used state with a default value of title so we can have some input uh property in the beginning great so now what we have to do is we have to wrap this div right here above our delete button right so this one we have to wrap it around we have to wrap another dialogue around this entire thing so so let's do that let's add a new dialogue here around the entire thing and let's go ahead and give it a open which will be edit open and on open change set edit open now let's add a dialogue trigger here and let's also give it an as child prop so around this entire en thing and as child so let's also add a dialog content here and the dialogue content uh should simply have a dialog header a dialogue title which will say rename this channel so now if you click here there we go rename this Channel and you should be able to close it by clicking out side now let's go ahead outside of the dialogue header here and inside let's create a form element let's go ahead and add our input from components UI input so make sure you've added an import for that and I'm going to go ahead and give the input a couple of props here so the value will be value disabled will be explicitly set to f so we remember we have to disable it by something later on onchange for now will just be an empty Arrow method it will be required we're going to add autof Focus to it a minimum length will be three a maximum length will be 80 and place Holder will be for example plan- budget so now when you click here there we go rename this channnel outside of the form my apologies inside of the form but just below the input we're going to add a dialogue footer inside of the dialogue footer which we also have to remember to close we're going to add a dialogue close and as child prop to it which will wrap another button which will simply say cancel it will have a variant of outline and it will also have an explicit dis AED prop set to false so we remember to turn it on to something else later besides the dialogue close we're going to have our save button which will be disabled as well explicitly set to false so we remember we have to do something later we also have to kind of separate the two so let's go ahead and find our form element here and give it a class name of space y4 there we go so now what we have to do is we have to create our handle change method so we can copy the handle change method from our create channel model you can find that inside of source features channels components create channel model inside of here you should have the handle change with this uh regex which separates the white space and turns it into the dash so let's go ahead inside of the header here and let's just copy it and add it here and instead of set name this will be set value let's copy the handle change here and let's give it to onchange Here and Now when you try to add white white space there we go it automatically turns into a dash great what we have to build now are the actual methods to update and delete the channel so let's start by adding the update method let's revisit our convex channels right here and just as we have the mutation to create let's add the mutation to update so export const update will be a mutation with arguments of ID which is v. ID channels workspace ID which is v. ID workspaces and name which is what we will be updating so let me just collapse those here like this and then we're going to have a Handler which will be an asynchronous method which accepts the context and the arguments here first things first we check whether we have the user ID so let's go ahead and throw that error here the other thing we have to check is whether we have a member and whether the member role is an admin so I copied that from our create mutation right here so these two Clauses here so we throw back unauthorized if any of this is true so now what I want to do is very simply do uh a wait context. database. patch arguments. ID and then go ahead and pass in the name to be the new arguments. name and return the arguments. ID so we return back something from this mutation there we go so you can decide how you want to handle this passing of workspace ID if you want to you can simply make it required for the mutation so why do we need workspace ID when we are updating the individual Channel because we needed for this index to check whether the currently logged in user is actually a member of a workspace so that's how we have to do that because otherwise if we are simply working with you know user ID we can't exactly know for for what member are we looking for but there is an alternative which is the following you can go ahead and get the channel using await context database get and passing arguments. ID if there is no Channel we can go ahead and throw new no error here because this is a mutation Channel not found and then inside of here you can use channel. workspace ID so using this method which honestly I kind of prefer looking at it we can avoid passing in the workspace ID and we can simply simplify it for the front end by just passing in the ID of the channel we want to update and the name we are updating to and that way in that case we don't care about the explicit workspace ID because we will get it from the channel and I quite like this solution so I suggest you switch to that as well now let's go ahead and let's actually create that uh hook so inside of features channels API we have use create channel copy and paste it to use update Channel go inside of the use update Channel modify the name to be use update Channel and modify this to pass in the ID of channels here so it passes in the name and the ID of channels and modify the mutation to use API channels update and when you save there should be no errors inside of this code let's go ahead and wrap it up by also adding the delete here so I'm going to go ahead and copy the entire update mutation and I'm just going to go ahead and paste it here and I'm going to call it remove it's going to be quite similar with the exception of passing the name name so we don't need the name at all but this can stay the same this part can stay the same this as well and the uh way it's going to end is very simply by arguments. database. delete arguments ID and we return back arguments. ID so that is the remove method as you can see uh pretty straightforward but I'm going to go ahead and add a to-do here remove associated messages so later on we're going to have some messages which exist and if a channel is deleted we should probably delete all messages inside of that channel as well so let's go ahead and also add that so I'm going to copy the use update Channel and rename it to use remove Channel I'm going to rename the hook to use remove Channel I'm going to modify the request type to Simply pass in the ID channels and I will modify the mutations to be API channels remove and there should be no errors inside of this code so now let's go ahead back inside of our header component so that's located inside of source app folder workspace workspace ID channel channel ID header. DSX let's go ahead and let's add our use update Channel and pass in the ID and we can get the ID from our const Channel ID use Channel ID you can also pass it as a prop to this entire header component if you prefer it that way but I found this hook to be quite handy and I know that it will be true because we rely on ID from our URL as the structure so my channel ID will be passed as such uh use update Channel let me just uh oh my apologies we are not passing that here we will pass it later in the mutation method so mutate will be update Channel and is fending will be uh updating Channel like that there we go so now what we have to do is we have to implement the handle uh submit method so const handle submit will'll accept an event of react. form event which will be based on HTML form element here now that we have a proper typed event we can go ahead and call uh event. prevent default let me just go ahead uh and see what I've made a mistake of right here there we go and then we're going to call update Channel we're going to pass in the ID which will be Channel ID and the name which will be our value right here there we go now let's add on success here the on success will very simply call the toast from Sunner with success variant Channel updated and then we're going to implicitly do set open set edit open to false so we close that model on error here we're going to go ahead and we are going to do toast. error fail to update Channel there we go and let's just ensure that you have the toast imported here and now we can attach the handle submit to the form here so onsubmit handle submit let's find these explicit disabled false properties so this will be is uh which one is it is updating or updating channel so updating Channel this will be updating Channel and this will be updating Channel and now that I look at it I prefer the is updating channel so I will just go ahead and rename it to is updating channel so let me find this three instances here so one two and three is updating channel is updating Channel and is updating channel so now I'm going to go ahead and attempt to rename this to rename test and there we go rename test right here excellent now let's go ahead and do the same for the delete channel so I'm going to go ahead and just below the use update Channel I'm going to add mutate remove channel is spending will be is removing Channel and use remove channel will be imported from the same place so features channels API use remove Channel now let's go ahead and let's actually implement the handle delete method so const handle delete will be an asynchronous method do you know why asynchronous well because we are going to add our confirm model confirm dialogue confirm from use confirm hook so let's go ahead and move that here let's go ahead and add uh some text to the use confirm hook so the title will ask delete this channel the description will say you are about to delete this channel this action is irreversible like so let's go ahead and wrap our entire thing uh actually we don't have to wrap the entire thing we can just go ahead go inside of the div above the dialogue and render the confirmed dialogue inside like this so now go inside of the handle delete const okay is await confirm make sure you have the confirm right here if not okay return the method like this otherwise let's go ahead and do delete channel my apologies remove Channel pass in the ID which will be the channel ID and then add on success here which will call toast. success Channel deleted and then it will redirect the user to the root of the workspace ID so we can assign this user to a new channel so for that we need the router from us router from next navigation I'm just going to go ahead and move that import here to the top so let me just go ahead and Implement that uh inside of my remove Channel we are now going to do router. push SL workspace workspace ID we are missing the workspace ID so let's quickly add it the same way we added our uh Channel ID so workspace ID use workspace ID make sure you've imported the workspace ID from its relative hook here great now we have the workspace ID here as well and on error here let's not forget to add toast. error Channel failed to delete to delete channel there we go and let's assign the handle delete method here to our delete button right here so on click handle delete disabled is removing Channel like so so now if you go ahead and click on delete channel you get the confirmation if you cancel nothing happens but if you confirm there we go the channel has been deleted and what just happened we got redirected to what page to workspace workspace ID and do you remember what we recently implemented there we implemented the functionality to find the first available Channel ID and redirect the user to that channel ID so as long as I have another Channel and if I go into another one and if I remove this one I will be redirected to that channel but if I go ahead and remove that channel as well there we go we have this functionality where if we are an admin and we can't find the channel ID and our model is not opened we are going to forcefully open the create a new channel and there we go amazing amazing job so what we have to do now is also disable these features for non-admin users so let's go ahead and add inside of the header component the use current user use current member actually so use current member who needs the workspace ID prop which we have now because of our use workspace ID make sure you've added the use current member here there we go and inside of here we are going to destructure the data which will be our member and we don't need the is loading so we just need the member here so what we're going to do is we're going to implement a const handle open and I believe the value here will be a Boolean so let me just check that inside of this dialogue trigger here uh right here let me just find which one uh this one right so on open change yes it accepts a Boolean so we're going to have and pass it the handle open here let's actually call it handle edit open so it's a bit more clear so handle edit open if I just modified this to be set edit open to true to Value I think it will have the exact same functionality as moments ago so that's fine so what we're going to do here is if member question mark role is not an admin we are going to return and break this entire thing so it cannot even happen right so I want to go ahead and try that out now so let me go ahead and try and go okay so I have another member inside of this GitHub workspace who is not an admin so I will log out and I will go into that user let me go inside there we go so I have plan budget and there we go if I click here nothing is opening exactly as I expect here but of course we still have this which should give me back an error excellent it gives me an error so we cannot do it the back end is protected well enough we just need to protect the front end so I recommend that you uh take a look at you know take a look at the workspace from a member's perspective so you can go ahead and see how this will look like so let's also go ahead and remove the little edit button here so this paragraph let's go and only do if member role is admin only then go ahead and render this edit otherwise don't render it at all and you can go ahead and copy this entire thing as a decision whether to render the delete button or not there we go so this is what guests will see and not much other functionality for them but for those who have created their channels I believe this is the one there we go you can see that they can rename it they can delete it amazing amazing () job now that we've wrapped up the header component let's go ahead and let's develop the editor component so I'm going to go ahead and go back inside of my channel ID page. TSX and inside of here I'm going to add a div with a class name of Flex one and it's going to be a self closing div so this is just temporarily now below that go ahead and add a chat input component let's create the chat input component in the same folder as header so chat Das input. DSX let's export con chat input and let's go ahead and let's return a div chat input now go back to the channel ID and import the chat input compon component the same way you've imported the header component and there we go you should have the chat input component here at the bottom of the page because we've added Flex one above that part now let's go inside of the chat input let's go ahead and give it some styles to this div so we're going to add a class name here px5 and with pool then inside of here we're going to add our editor component component so the editor component does not exist yet but we're going to go ahead and create it so I'm going to put the editor component inside of our reusable components folder because we're going to reuse editor in many other places so let's create the editor. TSX component like this the editor will behave a little bit differently we are primarily going to have to do a default export on the editor because later on we're going to have to dynamically import it I'm going to explain all of that once we add all the packages we need and how they work but for now make sure that you add the editor like this so let's just return a div editor here and then do an export default of editor like that then go back inside of the chat input and for now you can import editor exactly like this later we're going to change this to be a dynamic import because the package which we are going to use does not work well with server side rendering so we're going to have to avoid that by using the uh Dynamic import so let's go ahead and continue developing uh this editor here I'm going to go ahead uh and give this div here a class name of flex and then Flex column I'm then going to go ahead and create another div with a class name Flex Flex column board order border slate 200 rounded MD overflow hidden Focus within border slate 300 Focus within will also have a shadow SM transition and background color of white like this and let's go ahead and add a little text here in a div editor so already you should see a little editor here with a small border so what we're going to do now is we're going to go ahead and actually style this editor but we are not going to write out the entire editor ourselves instead we're just going to have a div here which will have a reference to our quill editor so let's go ahead and install all the packages necessary so let's head inside of the terminal and let's do bun add or npm install quill now let's go ahead and let's add everything we need here from quill so I'm going to go ahead inside of my editor and I'm going to import quill whoops from quill make sure you don't misspell it as I did besides this we are also going to need to import the CSS from the package so quill slis SL quill do snow. CSS like that and now we're going to have to create a quill ref or a container ref component to be a bit more specific so let's go ahead and add const container ref to we use ref react and then we're going to go ahead and modify this div to be a self closing tag and have a ref of container ref like this uh let's go ahead and just add a proper type for the container ref here so this will be a type of HTML div element like this and by default it will be null there we go now let's add a use effect from react and inside of the use effect we're going to initialize quill and we are actually going to add it to the container ref right here so we're going to start by checking if we don't have the container ref. current in that case we're just going to break the use effect because we cannot initialize this at all and now let's go ahead and let's add const container to be our container ref. current so we can easily access it let's let's then create an editor container here to be container. append child and pass in container. owner document. create element div like that now let's go ahead and let's create our options for the editor so this will be a type of quill options which you can import from quill so I'm just going to go ahead and import type Quil options like this there we go so this is an object and inside of here we're going to add some properties so the theme will be snow because that's what we've imported here so that's the CSS it will load for this editor and the only other thing we actually need here well we are going to have some modules later on but let's go ahead and keep it simple let's just make our options have a theme and nothing more and now let's finally create the actual quill constant which will be new quill and we're going to pass in the editor container and options in the second argument like that uh and then what we're going to have to do uh is also take care of our return method so when we unmount it's very important to do this especially in react if you have strict mode on because use effect will be called twice so we need to do proper Cleanup in this case so inside of here what I'm going to do is I'm going to check if we have container in that case container inner HTML will become an empty string so that's the entire thing we're going to do for now right and we technically don't need this to be a constant yet but we are going to need it later so that's why I added it like that so I think just looking at this there we go you should now be able to see an editor here at the bottom so what we have to do next is just style it a bit so it looks more to what we want let's head back inside of our global. CSS file so inside of our source app folder we should have a global. CSS and let's go all the way to the bottom here and inside of here we're going to add some custom class names so ql toolbar is going to have a border of none and in uh important thing is that we add important to almost all of our class names here because we have to overwrite the default quill Styles so background color here will be f8 f8 f8 and also override with important then we're going to have ql coolbar ql formats not last child inside of here I add a border right to be one pixel solid DC DC DC and important as well also add a padding right of 12 pixels and important then let's go ahead and let's add a ql container here to have a font family of L sense serif and important at the end let's give it a border of none which we also have to prefix it important and a height of unset outside of the ql container let's add the ql editor line height will be 22 pixels padding will be 8 pixels by 12 pixels color will be 1 d 1 C 1D font weight will be 400 by default of course we will be able to change that font family we're going to repeat the one from above so L and sense serif and font size will be 14 pixels by default then let's go ahead and let's edit the ql editor anchor element to have a color of 1 2 6483 let's go ahead and let's add a ql editor anchor element hover which will have a text decoration of underline let's also prepare another uh class name which we are going to need ql renderer so this doesn't actually uh come with quill but we are going to use this later so let's already prepare it padding zero and important and let's add ql editor before to have a left of 12 pixels a font family which we can repeat from any of the font families above a color which will be uh 8D 8D 8D and important a font style of normal font size of 14 pixels font weight of 400 and what we can also do is we can use the at apply and we can write truncate and what this will do is it will apply a Tailwind class inside of CSS so you can also uh use the applies all the way through if you prefer it that way I forgot to give you that tip uh and now let's keep it like this for now we're going to go ahead and modify it later even further but go ahead and keep it like this for now and now let's go back inside of our components editor component here and let's give our main uh div here which is the container a class name of H full and ql custom and already you should see a big change in the editors so this header is now kind of grayed out the border is no longer available here and the text is a bit smaller now great so what we have to do next is style it just a bit more further and then we can go ahead and start adding some functionality to it so below this container but still inside of this border slate 200 div let's go ahead and let's add another div which is going to hold some our additional tools so let's add Flex bx2 padding bottom of two and Z index of five and inside of here let's go ahead and let's add a button which you can get from /ui button or components UI button however you prefer we are in the components folder so we can use the Shand here so inside of this button I'm just going to add a pa pa text AA which is a uh icon so let's go ahead head and import PA text AA from react icons Pi like this now let's go ahead and let's give this button a disabled of explicit false so we remember we have to disable it later a size of Icon SM a variant of ghost and on click for now to be an empty Arrow method here uh and let's go ahead and see am I able to even see that why am I not able uh to see that right now let's go ahead and try and write hello here all right so we can see it here so did we even see it before maybe I just missed it but here it is here is our uh AA icon great let's give our AA icon here a class name of size four so it's just a little bit bigger like this now go ahead and copy and paste this button and this one will have a smile from Lucid react or any other icon library that you prefer so there we go we have this for forting we have this for emojis uh and we are going to need one more so let's go ahead and copy this and this will be our image icon I suggest you import it as image icon rather than image because you can import imagees here image from here as well but there is a component from react from nextjs called image so it will be conflicted so import image icon from Lucid react and render it here there we go so we now have these three icons here uh and what I want next is I want the submit button so let's go ahead now and let's add another button here which will simply say uh submit or uh let's not say submit let's just add an MD send icon we can import MD send from react icons MD let me just go ahead and refresh so yes uh go ahead and often refresh when you're working with this quill because hot reloading is not activated in real time but here is the chance for us to do what I told you we are going to have to do later so the the way quill works is that it just doesn't support serers side rendering so what you should do is go inside of your app folder workspace channel channel ID chat input where you import the editor and import it like this import Dynamic from next Dynamic and then you're going to go ahead and import editor in a different way way so you're going to write const editor will be dynamic open an arrow function and then import at/ components SL editor and then add the options SSR false like this there we go so now you can see that it loads the editor a bit later after we go into server side rendering but you should now not have any errors and I think that even the hot reloading should now be improved all right so let's go ahead and let's continue developing this send button here so for the MD send we're just going to give it a class name of size 4 and the button itself let's go ahead and give it a class name of ml AO and let's give it a background color of 07a 5A and let's also do a hover to the same background like this uh but let's add an 80% opacity and let's do text White uh there we go let's also go ahead and modify this button to have a size of Icon small there we go so we now have the send button and we have all these other helpful uh items here as well great so let's go ahead and give this button a disabled off false explicitly like that and let's give it a onclick of an empty Arrow function like this great so now let's go ahead and and let's wrap these buttons into hints so that we know what they are supposed to actually do so go ahead and import hint from SL hint and let's wrap our first button with our AA icon here so hint wrap the entire button inside and let's give this a label of hide formatting like this so when you hover over there we go it should say hide formatting so let's go ahead and wrap the other div the other button inside of hint as well and this one should simply say Emoji let's go ahead and wrap it one more time for this one this one will simply say image like this so now we have image emoji and hide formatting like that now let's go to the bottom of our div here just before the last div ends and let's add a new one which will have a paragraph beginning with strong which will be shift plus return to add a new line so basically a little hint after the end of our editor here and let's give this div a class name of adding to text of 10 pixels text muted foreground and let's give it Flex justify end so there we go you should now have a little text shift plus return to add a new line here great so this is looking very good now and what I want to build now is I want to build different variants for this editor so this will be a very reusable component we're going to use it both to create the message but also to edit a message so for that we're going to have two different types of editor so let's create the editor props and let's add the variant which will be an optional prop which can be either create or update so let's go ahead inside of here and let's add our editor props here and let's destructure the variant itself and what I want do is I want to give it a default of create so if the user does not pass anything we're going to assume that this editor is used to create a message so now let's go ahead and let's actually uh use this logic to hide or show certain elements so for example find the image button we are only going to show that if the variant is create so go ahead and wrap it like this so only when we are first creating a message will we be able to attach an image to it as well we will not be able to attach an image if we are updating so right now nothing should change you should still see an image but go back to your chat input here and give it a variant of update once you save you can see that the image should no longer be available so go ahead and I'm just going to go bring it back to create now so we can easily change so if it's create you should see the image now let's go ahead and let's use it even further here so this MD send button should also only be visible if variant is create like this and go ahead and invent it inside so right now it's perfectly visible right but if I change this to update the button is no longer visible that's not because we're not going to have a button but because we were going we're going to have a different button so above this go ahead and add a if variant is update in that case we're going to go ahead and add a div here with a class name ml AO Flex items Center and GAP X2 and inside of here we're going to have two two buttons one to cancel and one to save so this is how it will look like on the update method so let's go ahead and style them so let's give them a variant of outline let's give them a size of small an on click for now to be just an empty Arrow function and disabled of explicit false for now and the save button will be quite similar so disabled of explicit false on on click which will just be an empty Arrow function a size of small and we can steal the class name from this one but we don't need ml AO so just the background the hover and the text here so there we go you should have the cancel and the save buttons If you are in edit mode like that uh great so we've handled the variance now and we should now be ready to actually uh start adding some other props to our editor so let's go ahead and do that I'm going to go inside of the editor here and I'm going to add all the other props it can have so I'm going to add the onsubmit method which will be a me a method where we're going to have to pass the image and the body and I'm going to call this a type of editor value let's go ahead and give it like call it like that so the image will be a type of file or null so not every uh message will have to have an image right and the body will be a type of string like that so then we can assign the editor value here like this and it will return a void uh besides the on subm we're going to have an optional on cancel so you can add a question mark here and this will just be a void like that then we're going to have a placeholder which will be an optional string we're going to have a default value which will be optional as well and this will be a type of Delta which you can import from quill core so I'm just going to go ahead and move that uh to the top here so Delta from quill core and also op from Quil core so default value will either be Delta or an array of op values so quill has its own let's say language for Rich Text values which is quite good for us because it allows us to save that inside of our database and we can then use the quill component as a renderer and then we don't have to worry about sanitizing ing HTML or converting this to HTML so it's much safer this way uh and yes there actually is a quill react editor package but I found it way more useful if we create our own editor just by using the quill package because that package itself is great but we need a lot of customization here so we are just going to build our own editor and this will also allow us to build our own renderer of quill uh this Delta and op values later on now let's go ahead and give it a optional disabled prop which will be a Boolean and let's give it an inner ref which will be an optional value here and a type of mutable uh ref object which you can import from react and it will accept the quill editor or null so make sure you've imported the mutable RF object here from react and the variant can stay the same great and you can now extract all of those here so let's add on cancel on submit placeholder and let's go ahead and uh write a default placeholder of write something like this let's go ahead and give it a default value of an empty array disabled by default will be false inner F and variant and we already have it here it is create great now since most of the things inside of this editor will be done inside of this use effect here we have to be careful about how we're going to store all of these methods here this functions the default values right so we're going to do something that you might be a little bit unfamiliar with but we're going to heavily rely on refs why that's because refs do not have to be added to dependency arrays and they don't cause reenders when changed so what we're going to do is we're going to store all of these values we have here into their own refs so for example we're going to have submit ref which will be user ref and we're simply going to pass in onsubmit and this way we will be able to call the onsubmit function inside of use effect but we won't have to pass the onsubmit in the dependency array making our code more reliable so let's go ahead and also add some other const placeholder ref so this will also be something we're going to have to add inside of the use effect but I don't want to add the entire placeholder inside of this dependency array because if it changes from the parent component it will cause some render issues here so let's add use ref here and call placeholder that now let's add a quill ref here this will be a use ref which will very simply accept quill or null and it will be null by default then let's add a default value ref which will have the default value here we already have the container ref I believe so let's just move it here with the other refs and let's also add disabled rep to be used ref oh we can just pass in disabled from the prop great and now let's also add a use layout effect which doesn't accept any dependencies array and inside of here we are simply going to update all of them so submit refed current will get the new value of onsubmit if it happens and then placeholder ref. current will get the new placeholder value and then we're going to have default value ref. current to be the new default value and disabled ref do current will have the new disabled value like that there we go and now we can go back inside of this use effect and we can go ahead and style it uh just a bit further so for example inside of our options now besides theme let's also add this placeholder to be a type of placeholder ref do current so we are now able to pass from the placeholder prop into the ref which we can then use inside of this options and as you can see we don't have to add anything in the dependency array if we just use the placeholder value you can see that I need to add that to the dependency array and that can cause some rendering issues so this solution that I found with use layout effect and passing these things to refs is from quill official documentation page where it shows how to use it with react it is a bit simpler than this but this is basically the gist of it so make sure that inside of your options you're passing placeholder ref. current so inside of this chat input now let's go ahead and let's pass in all the props uh we didn't have until now so I'm going to pass in placeholder to be let's go ahead and write test placeholder placeholder then let's go ahead and pass in on submit to be an empty Arrow function let's go ahead and add disabled of explicit false and we can go ahead and pass in the inner ref as well so inner ref is something we're going to do so that we can control the editor from the outside of the component which we are going to need because our on submit is going to live in this chat input component so for example once we successfully send a message I want to clear the editor we just learned that we won't be able to rely on passing new props for example we don't have value we have default value which means I don't expect this editor component to be controlled via props so that's why we need this inner rep for example so if you want you can already add that here uh let's go ahead and add editor ref to be used ref from react passing quill from quill or null and null by default and then you can pass in the editor ref to be the inner ref like this you could we call it inner ref because if you want to pass it as ref you then have to modify the editor to be with forward ref right but that's just necessarily complicated and apparently in react 19 that will no longer be an issue but for now you can safely use the inner ref and just pass it like this so it's not doing anything now but I just want to get rid of all the errors and test out our props so there we go now you can see that we have a test placeholder here uh excellent now let's go ahead and do the following I want to modify the chat input here to have an interface chat input props and let let's go ahead and give it a placeholder which will be a string and then inside of here let's destructure that placeholder and chat input props here and let me just fix the typo placeholder and then we can just go ahead and pass in the placeholder as the prop as well and then go back inside of your channel channel ID page. DSX and now let's modify the chat input to have a placeholder which will basically be uh message # T and then channel. name so this way we control it all the way from here so we don't have to pass the unnecessary channel name prop to the chat input we can just pass the only prop we need which is the placeholder and when I refresh this should say message plan budget if I go ahead and create a new channel this should say message new channel and when you switch you can see how it has a new message for you great so we have that let's go ahead and let's continue developing inside of the use effect uh of our editor here so now I want to go ahead and I want to give it the ability to pass in some default values if they exist right so this is what we're going to do we're going to turn this back inside of a constant so we have it available like that and what I'm going to do is I'm going to pass this quill initialization to our ref Quil ref here so that we can access it throughout the rest of the code which is not inside of this use effect so for example here or here right so let's go ahead and do that I'm going to do quill ref. current will be quill and quill ref. current will also be Focus so what this will do now is that every time you refresh and load you can see how my editor is immediately focused so I didn't click anywhere on the page I can just start typing already or if I go to a new channel you can see how I'm immediately focused inside of here so if we don't add this part and refresh you can see that I'm not focused here if I'm typing nothing happens but when I click I'm focused so that's the kind of things that this quill ref will be used for and we are already using it inside of here and now we're going to do if inner ref was passed that means that we obviously want to control the uh the quill in the same way from outside of the component right so for example we can do this uh Quil we want to do this focus in the chat input for whatever reason I don't know maybe you know after our onsubmit do then I want to go ahead and focus the editor right so how can I do that well we can do that with this editor ref which we're passing as the inner ref here so if we have the inner ref we're very simply going to attach the inner ref. current to quill as well like this right so it doesn't matter both of them can have the same value so now this inner ref has the same functionality as this quill ref inside of our component so now in chat input later on I can do editor ref current and I can do Focus for example if I want to right so that's what this allows us to do and now let's go ahead and do the following let's go ahead and prepare a use State here so this use state will be called text and set text so why all of a sudden do we need the uh State value if I just told you that this was not going to be a controlled component well the only reason we need this is because depending on whether we are empty so depending on whether our editor is empty or we typed something it's going to show different things for example it's going to disable this button if we are empty but here's the thing with refs so they are great for using inside of use effects but remember they don't cause renders which means that for example if I have a value ref or if I use uh this quill ref right let's go ahead and say that I want to disable this button here uh right here if quill ref. current uh I don't know get contents do length is zero right technically you think okay I I guess this makes sense yes if this get contents method returns everything that's inside of the editor and if it returns zero that would mean that the editor is empty right yes that's correct but quill ref will not render right so it will not change if if something was written and then it was removed it will not be updated it it will not be rendered so that's why we need to have a separate type of control for things that we want to show differently and those things we're going to hold inside of our states like this let me just quickly see uh oh yes so one prop which we are going to have to pass uh is the inner ref but no worries about that because we know that's a ref so it will not be able to cause any additional renders but let's get rid of this warning message here so just pass the inner ref inside of the use effect so now make sure you have the text and set text here and basically what we're going to be able to do now is anytime uh that the quill text changes we're going to go ahead and change that state and that state causes rerenders so depending on state change we will be able to detect all right something has changed in the editor or not right so we are using a mix and match of state and refs depending on where we need to use it so let's start by uh appending a default default value to this editor if it exists so Quil set contents default value ref. current this way we avoid an additional dependency in our dependency array and then let's do set text will get text like this and then let's go ahead and add a listener so quill on qu. events. textor change go ahead and do set text Quil get text so I want to only refresh the text on every keystroke change we also have to update our uh return or cleanup method here starting with quill do off for quill do events. text change so the quill I think is just the basic quill import here right nothing special so make sure you turn off the listener and then we also have to clean up our quill ref. current so if it exists qu ref. current will be null and if inner ref exists we're going to do the exact same thing so we have to clean the entire thing up so this will be inner ref. current will be null like this there we go so now what what you can do is the following you can do const is empty and you can now check if text. trim. length is zero and this text is from State here right so this will be rendered constantly so this will be updated true and false but if we use the quill ref do current. getet text for example you'd think that this works the exact same way because this is technically what we are adding to our set text here right well that's the problem Quil ra. current get text does not update it only works great here in the use effect but not in the this render world let's call it like that right so that's why we separated that inside of the used state so it's controlled differently but this will not be enough to detect whether something is empty or not so we also have to do a proper regex here so let's do a text do place and we have to uh remove some things inside of the text which are considered empty but technically have some elements so when you initiate the quill editor its default value might be this right or just you know some empty paragraph like this this is technically empty right but if we just read the text this this is you know not empty obviously this is something inside so we have to add a regex to remove all of these elements and then check if it's empty right so inside of this regex we're going to go ahead and remove empty HTML elements that could possibly appear here so let's go ahead and add a forward slash let's add the beginning of the pointy bracket and let's open normal brackets inside add a DOT then add a straight pipe add a backwards slash and n and then outside of the first parenthesis add an asteris question mark end of the pointy bracket and a forward slash Global like this there we go and of course we have to replace that with empty string so now I'm going to conso log is empty here and can also consol log the actual text right so let's see what's happening I'm going to go ahead and remove this and I'm going to zoom in a bit here so I will write hello right here let me just refresh everything first you also often refresh right so this is what I was talking about right this is technically empty right but you can see that the text value has something inside it has this new line tag right so when I type in hello world you can see that now is empty is false but if I remove the entire thing text is not technically empty but thanks to our regex we got rid of things like this so we know it's empty or if we for example uh add new lines still we consider that empty right unless a letter has been written we consider it empty right so that's why we added this regex here and you can see that this conso log is updating in real time time which means that we can use it to for example disable the submit button if we have not written any letters and are just adding Whit space so we don't want to send messages which are obviously you know just wh space so let's go ahead inside of this is and use this is empty somewhere so I want to find first of all my variant create here and I'm going to go ahead and I will disable the Vari and create if our disabled prop is active or if we are empty so remember in my components I am not using the disabled ref. current because this is not updated this doesn't cause rerenders that's why I'm using a mix and match of my props inside of my jsx elements but inside of my use effect I'm using uh the refs right so that is the difference so remember refs are to be used inside of use effect everything else should be used via normal regular props so already you should see a difference here as you can see my button here is disabled even if I had if I had spaces and uh new lines it is disabled because we don't consider this a message until you add a letter then it becomes a message like that uh and now let's go ahead and also modify its style a bit so I'm going to go ahead and wrap this inside of CN from lib utils make sure you've imported the CN from lib utilus I'm just going to go ahead and add it here like that and then we're going to go ahead and modify it so that this is you know the default and then we're going to go ahead actually let's do this let's make ml AO the default and then this one will only be if is empty we're going to have let's go ahead and do it like this copy it twice all right so if it's empty we're going to have one style and if it's not empty we're going to have another style so we are now going to modify the if it is empty in that case the background color for this will be white the hover will be white as well and the text will be muted foreground the rest can stay the same so there we go this is how it looks like now a completely different style until you write something and then it becomes uh active again amazing uh great so now what I want to do is just a few more things here which will help us uh you know style this editor a bit better and have it some uh make it have some greater controls so as you can see here I wrote that if you want to add a new line you should press shift plus return but right now you can see that we can do that by pressing regular return but I want to overwrite that I want my return to call the onsubmit method instead so what we are going to do is we're going to go back inside of the use effect and we can we're going to find our options quill options here and what we can do is we can add for example modules and inside of here we can add for example keyboard and we can override some of the uh combinations some bindings specifically so bindings inside of here let's add if you hit enter we're going to do the following so we have to Define we call this enter yes but you have to manually Define which key is that so that is the enter key and then you can go ahead and pass in your custom Handler for that so what do you want to happen once Handler H has been hit so I think that if I just go ahead and you know return here now when I hit and I first refresh right when you hit enter there we go nothing happens so that's how we can overwrite this so I can add you know to do submit form and using the same way you can go ahead and add a shift underscore enter and inside of here you can add key enter whoops where was I so the same as we started above key enter but also add shift key to be true so then it will look for the combination of those so let's add the Handler here and inside of here what we're going to do is quill insert text quill get selection executed and then with a question mark let's get the index or default to zero and then we are simply going to insert a backwards slash andn indicating a new line so now when you refresh again normal enter does nothing but shift enter adds a new line so that's how we can handle that amazing and you can go ahead and use these modules for even uh further right so for example let's say you don't want this right for example this is not something that I want in my message editor if you want to you can have it here but I don't want it in my messages so what I'm going to do is I'm going to go inside of modules here and I will add toolbar and I'm going to modify the toolbar so we simply uh in this toolbar my apology this is not an object this is an array so in the toolbar you now kind of write sets of elements you want so I want bold it I and strike and now you can see that when I refresh those three will be in its own section here and I can continue writing stuff here or I can separate and go into another and add link for example and you can see that now when I refresh link will be separated via this little divider here and we can go ahead and wrap it up by adding the few more options list ordered and let's add list bullet like this and refresh again and there we go we now have our lists and you can go ahead and add new lines like this there we go so we just modify the editor in our custom way so this allows you to explore a lot so you can go ahead and Google you know quill documentation quill options to explore everything else it has here excellent so before we go on onto you know submitting the entire form I want to go ahead and do one thing which we can immediately resolve and that is this hide formatting this is a very simple function which we can Implement so let's add a new state which we are going to call you know toolbar visible So Below this go ahead and add is toolbar visible and set is toolbar visible and by default it will be false like this and now let's go ahead and let's implement the toggle toolbar method so I want to do that after the entire use effect here so just above is empty con toggle toolbar will first of all change the set is toolbar uh visible to the opposite of the current value and then const toolbar element will be container ref question mark my apologies. current question mark query selector and we're going to get AQL Das toolbar because that is this element right here if you hover yourself you should find the ql uh toolbar class name right here ql toolbar so we find that and then if we find the toolbar element we're going to go ahead and do toolbar element. classlist do toggle hidden like that and then let's go ahead and let's actually call this method from our button which has uh the pi text AA here so you can go ahead and click toggle toolbar here and you can disable uh you can disable it if our general disabled prop is true like that and I'm going to go ahead and modify the hint here so if is toolbar visible we're going to say hide formatting otherwise it will be show formatting and we can also go ahead and pass this disabled prop to these other explicitly disabled false buttons like this and for the update one we're going to go ahead uh and do the same thing as we did in our create one so we are going to disable the save button if the general disabled prop is true or if is empty like this so now if you refresh I believe we should be able to there we go toggle formatting on or off and it should have a different message so okay it's the opposite so now it's says show formating so let's just fix that so if toolbar is visible it will say show forat thing or let me just go ahead and see this logic here uh just a second because it feels like the logic is correct but uh the text is not exactly oh so yes it's because we started with the invalid use state in the beginning so is toolbar visible set is toolbar visible should begin as true right so it's true in the beginning so now it says hide formatting and now it says show formatting great so we are still not done with the entire editor component but we are going to stop here for now in the next chapter we're going to implement the Emoji functionality the add image functionality and then we're going to finally go ahead and submit our form great great job





Title: Build a Real-Time Slack Clone With Nextjs, React, Tailwind, Auth.js | Part 2/2 (2024)

() you're watching part two of slack clone here on YouTube you can find the link to part one in the description this is a quick reminder that you can also use my platform code withth antonio.com and you can watch this entire course in chapters and you can also Mark your progress you can also become a premium member and you can unlock special courses like canva clone as well as source code to over 20 premium projects and over 70 hours of Premium () content now let's go ahead and let's implement the Emoji selection tool but just before we do that I want to quickly modify this text here below I want it to show dynamically so let's go back inside of our editor component here and let's find that text it should be right here at the bottom and the first thing I want to do is only display it if the variant is create so I don't want to show this text later when we use this component to open the edit variant for a message so only if we are creating like this so now it should be shown because in the chat input we did not specify the variant but if you add the variant to be update there we go you can see how it's much different and there is no that that text below so let's go ahead and remove the variant and now you should have the text appear here and let's also add one more thing here so I want to make this class name Dynamic so I'm going to wrap it inside of curly brackets here and I'm going to introduce the uh CN wrap around that so we should already have the CN library from CN Li utils and this can stay as the default class and we're going to go ahead and just add a opacity zero as the default and we're going to add transition here as well and then if not empty we're going to go ahead and change the opacity to 100 so just make sure you have a little comma here at the end because this is like a new uh parameter here so now you can see nothing is written here until I start typing right so only then does that appear the same uh time when our button is enabled great so now that we have that resolved let's go ahead and let's actually implement and our Emoji uh button here so for that we're going to need to install two packages so let's write bunad at emoji-art slata that's the first one so use npm install or bun ad and the second one is emoji-art SL react so we need two packages like that there we go and now let's go ahead and let's Implement a pack package called Emoji popover so I'm going to go ahead inside of the components here because it's going to be reusable and let's call it Emoji dasp over. DSX like this and inside of here I'm going to go ahead and prepare everything we need from the popover component which looks like we don't actually have so let's first add it so bun X D- bun shat cnii latest add popover like this or just a quick reminder if you are using node npx shaty Nui at latest at popover right great so I now have the popover and there we go I can now go inside of it and no more errors for my imports here and besides this we're also going to need the tool tip and perhaps some of you already noticed we could technically use the hint component right why not use the hint component well unfortunately we can combine the popover and the tool tip but not exactly in a way that this hint component works so this hint component allows us to pass children only inside of the tool tie trigger but the solution we need is to have popover around the tool tip provider and then the content of the popover inside of the tool tip trigger so it's a pretty complicated solution so so it's best that we reimplement the entire thing here from scratch in the Emoji popover component here so make sure you've added these two Imports and let's add an interface Emoji popover props and I'm going to add children to be react. react node a hint will be an optional string and on emoji select we're going to get an emoji which will be a type of any and return back the void and let's go ahead and Export const Emoji popover here let's destructure the Emoji popover props so children hint and on emoji select and inside of here what I want to do for now is just return a div and render the children inside so that's all I want for now now let's go back inside of the actual editor component here and now we have to use that emoji popover so let me just go ahead and import it so import Emoji popover from do/ emoji popover like this and we are now going to wrap it around our button uh which has the smile icon inside so we are going to replace the hint wrapper with emoji popover wrapper like this and let's go ahead and give the on emoji select here to for now just be an empty Arrow function like this so let's go ahead and go back inside of the Emoji popover here and let's go ahead and give the hint a default value of emoji and then if we want to reuse this component somewhere else we can modify the hint if we wanted to say something more specific like add a reaction which is something we are probably going to do once we get a list of messages and we are going to want to reuse that component and a better hint would be add a reaction but for this place the hint uh emo of text Emoji is just fine so great we now have that let's go ahead and add two states pop over open set popover open to be use state from react and let's go ahead and put false as default and then we're going to have tool tip open and set tool tip open use State false like this and now I'm going to go ahead and I'm going to wrap the entire thing inside of a tool tip provider inside of the tool tip provider I'm going to add a popover let me just properly wrap the children there we go and the Pop Roll we have an open value of popover open and on open change to be set pop over open then we're going to add a tool tip component like this and we're going to give the tool tip component a open of tool tip open on open change set tool tip open and delay duration will be shortened to 50 now we're going to add a popover trigger around the children we're going to mark it as a child so it becomes the children we pass it but inside we also need to add a tool tip trigger so this is what I was talking about right the composition of combining a poer with a tool pip is a little bit complicated so that's why we could not reuse our hint component because you can see that the structure is inherently different so this one uses tool tip provider uh at the top this one does as well but then immediately inside of tool TI provider we need to add the popover right so they work on in a different way uh great we have that and now in the uh tool tip content here we're going to add uh render our uh hint inside so let's add a paragraph and hint that's what the tool tip is for and let's give the tool tip content a class name background black text white border border DH sl5 and let's give the hint text itself font medium and text extra small and then outside of the tool tip content and outside of the popover trigger and more specifically outside of the tool tip entirely we now add the popover content right so you can see that uh composing the combination of these two is quite confusing right and now we can finally add uh let's go ahead and first just style it so the pop content will have a class name of padding zero full width border none and Shadow none and then inside of here we can add a picker component so for that let's go ahead and do the following import picker from at Emoji Mart SL react and we also need the data from at Emoji Mart data so we need these two right here and let me just move react use state to the top like this and now inside of here we're going to go ahead and render our picker component with data as data and on emoji select Well for now just be an empty Arrow function and we can actually log out what we select and you can ignore this typescript error for now and if we've set this up correctly and looks like I've messed somewhere up let me just go ahead and see uh okay so this is okay inside of the Emoji popover but probably inside of some trigger I've messed something up so let me see inside of the popover trigger here uh so inside of the popover trigger yes this is the mistake I've made the popover trigger should end right here the popover trigger should only encapsulate the tool tip trigger like this so I think that now if I refresh there we go no more errors but I'm going to bring it back just so you can uh see what I've made so in my previous example my popover trigger was also encapsulating the tool tip content in order to fix that I have to move the popover trigger to only encapsulate the tool tip trigger right so the tool tip content and the popover trigger are on the same level they are both encapsulated by Tool tip like this so I will zoom out just in case you want to pause the screen and write it out like this all right so let's go ahead and try it out now now I'm going to go ahead and there we go I can now select an emoji I'm going to open my inspect element here when I click on an emoji there we go we have a lot of information about this emoji and we're going to use this native right here to insert it into our text bar uh right here like that so let's go ahead and let's implement the on select function here const on select we'll get the Emoji which is a type of any because unfortunately the Emoji mark library at least what I've been able to find is not strictly typed so we don't have the exact type of that object uh but let's go ahead and do on emoji select emoji and then let's forcefully close the pop over and let's also do set timeout set tool tip open we have to time it out because unfortunately otherwise it kind it's kind of buggy right it will stay open which is like completely okay but you know I kind of want it to behave a little bit better than that so let's repl replace the on select here like this and now let's go inside of the editor and let's actually go ahead and implement the on emoi select method so first of all we no longer need uh this button to actually have an on click so we can remove that from here we just have to develop our own own Emoji select so let's go ahead and do that I'm going to go ahead and just below the toggle toolbar I'm going to add const on emoji select which will give you the Emoji object right and inside of here I'm going to get quill from quill ref. current and then I'm just going to do quill question mark insert text qu question mark get selection question mark index or we fall back to zero and then I'm just going to add Emoji do Native inside make sure you don't misspell the native because we typed it as any so you know you won't get any errors so make sure you properly spell native which is basically uh what you see oh we remove the conso log okay now let's go ahead and add the on emoji select to the actual uh emoji pop over here like that so now if you try and go ahead and add an emoji there we go an emoji has been added and what's cool is that we've developed it so that it will always add it to the end of your line right so that's why we had to implement uh this so we get the selection and we get the index right like what is the last character's position if we don't have an index we need to fall back to a number so we fall back to the first position meaning okay maybe there is no selection at all and I think we already do that somewhere else yes in shift enter uh when we insert the new line we do the exact same method to get uh the new line always at the end of our current text great so you've implemented the Emoji tab right here excellent the next thing we have to do is the image selection great great job now let's implement the image () functionality for our editor so I want to go ahead inside of the editor component and besides the text and set text I'm going to add image and set image as well as well let's go ahead and add use State and give it a default value of null let's also Define what it can accept so it can be either a type of file or null so this state here will be controlled to indicate to the user that an image has been uploaded right uh well technically not uploaded yet at this moment but it has been selected right for that we're going to be use be using State because state rerenders right but besides that we also need an image element ref so image element ref will be use ref and null and it will otherwise also accept HTML input element so we're going to use the image element ref to extract the image in use effect for example in here when we need to submit our form so for that we're going to need to use an image element ref so we don't have to add the image inside of the dependency array because then every time the user adds a new image the entire editor will have to get reinitialized which can cause some problems so that's why we have to have two states one in ref and one in image now let's go ahead and let's create a so-called Phantom input right so this is what we're going to do inside of the flex Flex call we're going to add a self closing input tag here and we're going to go ahead head and give it a type of file we're going to give it an accept of image and an asteris here a ref of image element ref and on change here will be an event set image event target. files and then the first one in the array and you can put an exclamation point here to get rid of the typescript error and then a class name hidden or like that there we go so now let's go ahead and actually uh connect this to our image button so we're going to go ahead and find the image button it is right here and this on click will do as following image element ref do current click so we are going to simulate clicking on this Phantom input which doesn't actually exist in sense that it is not visible so let's go ahead and click on image and there we go that should open up a new uh a new uh well file explorer here great so then after we select an image we should also find a way to display that image so we're going to do that just below our container ref here so if we have an image for this we use the image state right and let's let's go ahead and turn this into a Boolean by adding two exclamation points and at the top here let's go ahead and give this a padding of two let's go ahead and write another div inside with a class name a relative a size 62 pixels Flex items Center justify Center and group slash image y group slash image well in case we have another group and I believe we do have uh another another group somewhere uh or perhaps actually forgot to add uh group here but nevertheless you can either you know use group or you can specify the name of the group so this is tailin specific syntax right so this is group image but usually you're also able to do just group but that becomes a problem if you have multiple uh group hover elements inside right but I think we actually don't have any but still better save than sor I'm going to call this group slash image like this and you're going to see how we're going to use that in a moment here so inside of here we're going to go ahead and add a native HTML button element with a on click which will do the following it's going to call set image and set it to null and image element ref. current do value will be an empty string and add an exclamation point here like this and we are also going to give it a class name let's just prepare that for now so I want to add an X icon here basically we are doing the delete icon now so it removes the image we just added so make sure you have the X icon here and give the X icon a class name of size 3.5 so now if I add a random image here let me just go ahead and add an image there we go you can see the little x button that I have here but I still don't have the actual image so let's go ahead and just style this x button first so I'm going to give it hidden but on group hover SL image it's going to become FX it's going to be rounded full it's going to have a background color of black with a 70% opacity on Hover it will be black in its entirely we're going to give it an absolute position minus top minus 2.5 minus right right minus 2.5 text white and then we're going to have size six Z index of four border of two border white items Center and justify Center so a very long class name but this will make our x button look much better now there we go so you can see now when I hover in this well for now uh transparent image we have a nice uh delete button here only if you've added an image right and now let's go ahead and actually render that image so I'm going to go ahead outside of the button here and I'm going to add an image from next slash image so make sure you've imported this let me just go ahead and move it to the top like this there we go and we are now going to go ahead and give it a source of url. createobject URL and pass in our image from our state an ALT of uploaded and it's going to have a fill property and the class name will be rounded extra large overflow hidden border and object cover and there we go we have a nice gradient so now we can go ahead and add an image for examp example and there we go an image has been added here and when you hover you have this nice little uh uh button which will remove that image and let's just wrap it up by uh adding a hint around this button and let's give the hint a label of whoops remove image so now when you hover there we go it says remove image perfect so you just added the image uh tool so what we're going to do next is finally call our submit methods so we're going to implement this submit form here but also we're going to implement uh this onclick save and on click submit methods here great great job now let's implement the submit functionality so I'm going to go ahead () and close everything besides the editor and our chat input inside of uh my channel channel ID right here so keep the chat input and the editor open and let's go ahead and let's create a handle submit method which will accept a body and image and that will be a type body string and image file or null and let's conso log body and image here now let's go ahead and assign the handle submit right here in the onsubmit method let's go inside the editor now and first thing I want to do is a very very simple thing actually which is find my own cancel which I'm not using anywhere at all so let's just go ahead and actually use this inside of our uh update variant so let's just quickly find the variant update and we should have a cancel button so we're just going to go ahead and call whatever function that may be that we're going to pass on later and now let's go ahead and go inside of the create method here and let's actually uh call on submit properly so go ahead and add on submit and pass in body which will be json. stringify and then quill ra. current question mark get contents and then image which we can get from our state that's it and now we have to copy this and we have to add the same thing for our save method here like that so basically in our database we're going to to be storing the contents which are the type of Delta and op here so that's how we are going to store that without having to sanitize HTML and now we have to do the same thing in the options in the use effect here so let's go ahead and prepare that so it's going to be a little bit more complicated first we're going to go ahead and get the text version so quill get text then we're going to add const added image here to be image element ref. current question mark files first in the array or null whoops like that and then we're going to have a new is empty rule here because remember we can't use any other is empty we have one is empty right here but we can't use it but we can reuse it so let's just copy this here because we have to reuse this regex that's why we are transforming it into text here so that we can uh use our is empty logic here so our is empty it's going to be very simple if there is no added image because if a user just adds an image that will count as a non-empty submit right because user will be able to just send an image and not type anything else so if there is no image and if we have this a text without those new lines is empty that means user truly has not typed anything nor have they added an image so we're going to do if is empty we're going to do an early return otherwise our body will be Json stringify quill get contents so inside of here we don't have to call the quill ref because we we have access uh to the actual uh quill which is I believe just here below so we can go ahead and pass it like that and let's then call our submit function but we are not calling on submit we are calling submit ref. current like that so let's go ahead and call that conditionally here because the ref can technically be empty and let's pass in the body and image will be added image make sure you don't do this because if you do this then it will read the image from State and then you have to add that to the dependency array but we don't want that right so go ahead and add added image right here there we go so make sure you have the console log for your body and image here make sure you've handled the onsubmit when user presses enter make sure this has not been modified and the only other thing we have is the onsubmit here in here we can use the quill ref uh so if you're wondering why can we use the ref here we can use it because this will be uh what's the word uh called right it's a method that will be called and returned back a result right so we can use that in this cases but we cannot use it and expect it to constantly update so for example I can't use it here in the disabled field but I can use it on click because it's going to be clicked and then it's going to be executed and then we're going to get the result whereas here it will only be executed once and never again that's why we have to use the state here and let's also just do a quick more modification so our is empty here should now be modified this uh this is empty which is used you know to control the states here so if there is no image and if the text replaced trim length is empty and let me just go ahead and check some other quick things here do we have any left over uh explicit falses I don't think so false uh there we go none perfect so let's go ahead and try it out I'm going to go ahead and open my inspect element here and I'm going to write hello world and I'm going to submit and there we go you can see my body here has this specific uh quill value which we are going to store in the database and then later we are going to render and the image is null because the image has not been added so if I go ahead and this time uh I add an image and if I submit there we go now we have an image which is a file you can see my image from unsplash right here so what we have to do now is we have to implement uh a schema for messages and we we're first going to do a simple thing which is just you know add a new body m message with the body and then we're going to do image upload with convex so let's go ahead and let's revisit our schema so we can add the message so I'm going to go ahead and close everything here and go inside of convex and inside of schema right here and after channels let's go ahead and add messages which will be Define table the message is going to have body which will be a type of string image which will be optional and it will be a type of ID and this is important underscore storage so this is internal ID make sure you don't misspell it underscore storage then it's going to have a member ID so the user who sent this message but specifically member right we don't want to map our messages to users we want to map it to members in channels so this will be a VI ID of members besides that it's going to have a workspace ID it was sent in so this will be uh v. ID workspaces and then it's going to have an optional Channel ID so this will be v. optional channels so you might be wondering uh oops v. optional v. ID channels so you might be wondering how exactly can the channel ID be optional we need to know where the message is yes but remember our message can also be sent in a direct one-on-one conversation which is not a channel ID right so we're going to have an optional Channel ID but also a parent message ID so optional and then v. ID messages so it's going to refer to itself right because it can be a reply in a thread and we're also going to have updated at which will be again optional number like this uh or perhaps let's actually make it a default and required and we're going to add a too here add conversation ID as well which right now does not exist but we are going to have it later and once you do that just confirm inside of your bonex convex Dev or npx convex Dev you get this message convex functions ready schema validation complete make sure there are no errors this means that you have successfully added uh your schema update so what we have to do now is we have to uh develop the actual uh create method to send a message so let's go ahead and do that let's go inside of convex and add messages. TS let's export const create to be a type of mutation let's prepare the arguments and let's prepare an asynchronous Handler here so the arguments are going to be body and we also need the values from complex values like this so body image which will be optional completely which is an ID of underscore storage then we're going to have workspace ID which is required then we're going to have Channel ID which is optional and it will be v. ID channels and then we're going to have another optional parent message ID which will be messages and I'm just going to add a to-do here add conversation ID because we don't have it at the moment so in the Handler we can D structure the context and the arguments let's get user ID using await out from do/ out get user ID and pass in the context so make sure you've added out here as always if there is no user ID we're going to throw new error because this is a mutation unauthorized like that there we go and now uh it's time for us to find a member so how about we create a little helper because inside of this messages we're going to need to associate it with the member a lot especially when we implement the get method so let's create a little helper here const get member will be an asynchronous method which in the first argument will accept context which is the query context from generated server in the second argument a workspace ID which is a type of ID workspaces and in the last argument a user ID which is a type of ID user so let me go ahead and collapse all of these make sure you've added an import uh for the ID module so what we're going to do here is very simple return context. database query by members with index our familiar index by workspace ID and by user ID so we're going to query workspace ID by workspace ID and we're going to chain user ID and user ID like this there we go and of course ensure that we return a unique result here so now we have this little helper so let's go ahead and go back inside of our uh create mutation here and let's go ahead and get the member by passing away to get member context arguments workspace ID and our user ID if there is no member throw new error unauthorized and now let's go ahead and let's insert the message so const data will be a way to context database insert messages member ID will be our member uncore ID body will be arguments body image will be arguments image Channel ID will be arguments Channel ID workspace ID will be arguments workspace ID and parent message ID will be arguments parent message ID and let me just see whether I did something wrong here is there something uh Missing inside of here so I'm inserting inside of messages and I add the member ID here I do have a member ID so this should work but it is throwing me an error so let me just debug for a second well I am missing the updated ad property which I have defined here to be defined yes so update ID updated ad will be new date and this is not correct so let me just quickly see instead of new date let's use date do now there we go and we have the data we don't have to actually do anything with it what I just want to do now is well not data but we have message ID so let's go ahead and return that as usual return message ID there we go so I'm just going to go ahead and do one thing I'm going to add a comment here handle conver ation ID so there is a possibility that conversation ID should uh be used for this type of API call uh but even though we will later add it as arguments we won't actually pass it it's an edge case which happens when we reply to a thread inside of a oneon-one conversation so we're going to have to take care of that so we can extract the conversation ID from previous messages and handle that you're going to see uh exactly what I'm talking about when we get to that but I just want to add a important to-do here because we do need to handle that edge case but for now you should be able uh to send messages so let's go ahead and turn this into a hook so I'm going to go inside of source features and I'm going to create a new messages folder and inside I'm going to create an API folder and inside of here I'm going to create a use creat message. DS and let's go ahead and for example copy use create workspace we can copy the entire thing and paste it inside of use create message here let's rename it to use create message and let's go ahead and modify the mutation to be API messages. create and now we have to modify the request type so this will have a body which is a string it will have an image which will be a string or null I think workspace ID which is also uh a string or actually we we can use the proper types so the image will be an ID of storage workspace ID will be ID of workspace workspaces but I still think that we did not exactly handle it entirely uh let me just see so the response it doesn't match messages is not assignable to type workspaces here uh so API messages create we request optional image optional Channel ID parent message ID so workspace ID did I pass that in workspace ID is ID of workspaces okay uh besides this we also need the channel ID which is ID of workspaces parent message ID which is ID of messages and to do add conversation ID as well so in in Channel ID I meant to write channels here and what we have to modify is that parent ID and channel ID are optional and also the response type here should be messages oh looks like that resolved the entire thing right so we don't have to explicitly write uh this to be optional I believe let's see yes I think if we actually no this is required right oh but we probably should do this so from our side this hook doesn't cause any problems right so the image should be optional the the channel ID should be optional the parent message ID should be optional like that so we can move the required ones first here and leave the too here and just ensure that there are no errors you know inside of this hook here great and now that we have this we can go back inside of our chat input component so let's go ahead and go inside of source app folder workspace workspace ID chat input here and I'm going to go ahead and I'm going to add our use create message Hook from features API use create message inside of here I'm going to extract mutate uh which we can call uh create message like this and now inside of here what we can do for now is extract our workspace ID use workspace ID get our Channel ID use Channel ID so make sure you've added these two hooks use workspace ID and use Channel ID and instead of we can still leave consol log if you want to just for this part so it's easier to debug and then we can go ahead and add create message we can pass in the workspace ID the channel ID the body and that should be it we can't pass the image just yet because image first needs to be uploaded otherwise we're going to get an error uh great so now what I want to do is I want to refresh the entire thing and I also want to prepare my database so inside of here I now have the messages but my messages are completely empty so I'm going to go ahead and attempt to send a uh hello world message and let me go ahead and make sure that I can also see my cons log here there we go so my conso log is here it should be my body should look like this right so if I go inside of data here there we go this is exactly uh how my body looks like here and let's see which channel I did this is associated to my new channel let's see if that's true that's true it's the new channel perfect and let's see what workspace ID this is associated to GitHub workspace which is exactly uh the one we are in GitHub workspace and last thing should be to confirm that this is sent by this member so let's go ahead and confirm quickly that and we should it's an admin so I already know it's the correct user and this should basically well I can't find uh The Click is it this one there we go so this is my uh GitHub user perfect so we now know that we can send messages so what I want to do now is that every time we send the message I want to clear this input so it's ready for a new message so we can do that with kind of a dirty trick so the reason I want to do it like that is because let me just show you what I have in mind so I'm going to add a state here which will be called editor key and set editor key and it's going to start at zero and let's add use state from react here and then what we're going to do is every time create message is uh finished we're going to go ahead and call set message get the previous key and do previous key + one uh not set message my apologies set editor key and then we're going to go ahead and pass in the key here as editor key so every time the key changes the editor component will be destroyed and rebuilt again and this way uh the entire state will be reset so if you try and click test there we go the entire thing is now reset so that's simply easier to do than to you know we can technically use the editor ref here so we could use editor ref current uh set contents right and then inside of here we could set an empty array so if I try that that is also a solution so if I write test there we go you can see that's also a good solution the problem arises when we add an image for example so when we do this one clears and the other doesn't clear now we could technically fix that as well by you know adding image element ref we could do that and then somehow you know capture inside of our editor when we assign the image element ref right here so I believe we could kind of turn this you know into a method and then uh basically you see what we have to do right in my opinion we can just use this trick right so we're just going to force the entire Editor to reender by changing the key like that so for now I'm not going to use any of the callbacks inside of here instead we're going to go ahead and do uh uh something a little bit differently so inside of here I'm going to add an option throw error to be true so this will now throw an error which means that I can go ahead and mark the entire handle submit method as an asynchronous I can remove this console log and I can also wrap the entire thing inside of try and catch now like this and I can put a weight here and let's also add a catch here like this let me just indent this this will be an error here and let's also add finally here so the reason I'm doing this is because we're going to have to for the image we're going to have to do some fetch API calls inside of here and as well as some other mutations and it's just simpler to chain them instead of try and catch rather than uh those you know on success here so then we would do one thing and then we would have to do you know inside of another mutation here we would have to do on success here another thing and do that multiple times right so it's just not a nice syntax so thankfully our uh use create message hook has the throw error option so we can safely do this inside of try and catch here so now set editor key will only be called after this is successfully called right so while we are here let's also do this let's add uh pending set is pending and let's call this is pending so we are not going to have uh the is pending this time from our mutation because we're going to have lots of mutations that have to be called so it's just easier to handle it like this so inside of the tri block let's set is pending to true and only in finally set is pending will come to false like so and let's also go ahead and do a uh my apologies inside of the catch we're just going to do toast. error failed to send message and import toast from soner and now we can use this is pending here from chat input and disable the editor if we are pending like so so let's see if our editor will be disabled or not so hello world and I think for a split second it actually is disabled especially these buttons here but I think we can make this even better before we wrap up this chapter so inside of the editor what I want to do is I I want to find uh my main div here which encapsulates this container ref right and let's go ahead and wrap this inside of curly brackets because this very long class name will now become Dynamic so when we are disabled we're going to go ahead and add some opacity so let's wrap this inside of CN Library which I believe we already have inside of here we do great in case you don't CN is from Li beils here so this will be our first class name as in our default class name make sure you add a comma at the end here and then we're going to check if disabled opacity 50 and make sure you put this like that so I'm going to refresh the entire thing and I'm going to write hello and there we go you can see how now for a second the entire thing uh is grayed out EX excellent so what we're going to do in the next chapter is actually uh give us the ability to submit something with an image because right now we are not doing anything with the image right we just have it here but we are not assigning in here that's because we first have to upload it so that's what we're going to do next and then we're going to work on displaying our messages great great () job now let's Implement image upload so let's go ahead and let's create a new endpoint inside of convex we're going to call this file upload inside of here we're going to have a single mutation so let's first import mutation from generated server and then let's export con generate upload URL which will be a mutation which will very simply accept a Handler inside and it will return a weight content text storage generate upload URL that's it this is our entire API endpoint now let's go ahead and create a hook for this so I'm going to go ahead inside of my source folder features and I will create a new folder called upload inside of here I'm going to create our API folder and I will copy a random mutation for example use create workspace I'm going to C copy it and paste it inside of upload I'm going to rename this to use generate upload URL so pretty descriptive make sure you are inside of the use generate upload URL and rename the hook so use generate upload URL like this now the request type will not exist like that so let's go ahead and remove that immediately so the Val values in this case will just be an empty object and they will not be required at all like this now let's modify this uh mutation to be to API SL upload SL generate upload URL like this and inside of here we can completely remove the values we don't need to pass them at all and the response here uh seems to be let's just go ahead inside of the generate upload URL so this is returning uh do we actually care about what it returns all right this is what we're going to do we're going to go ahead and remove the response type here completely and just use any so inside of here we're also going to add any we can remove this import and I believe then this will be okay there we go so it doesn't really matter because we're not going to uh use it besides or actually I think that the response type can be a string so let's try that what if the response type is just a string will that work so string or null there we go that seems to resolve the issue here so the response is a type of string and in here the response is a string perfect so I don't know why in here okay it does have a string inside of a promise my apologies okay great so our response type is string or null we don't need this import and we can keep the response type here the response type here as well perfect now that we have this and you've ensured that there are no errors inside let's go back inside of our app folder workspace workspace ID channel channel ID chat input and in in here I'm going to go ahead and I'm going to add use generate upload URL from features upload API use generate upload URL I'm going to add a mutate here generate upload URL like that and now we're going to go ahead and do the following let's create a type here which we're going to call create message values so we're going to expect a channel ID which is an ID of channels make sure you've imported ID from its place here like this besides this we're going to have workspace ID which will have workspaces body which is a string image which is ID of underscore storage and let's go ahead and just Mark the image as optional and now we're going to go ahead and modify our handle submit method so one thing I forgot we have is the editor ref so how about alongside passing the disabled prop we can also actually disable the quill editor so editor ref question mark current enable set to false and mandatory and finally make sure that you turn it back on to tr like so great so now let's go ahead and continue developing here so we're going to modify these values just a bit we're going to prepare them here so values will be create message values we're going to pass in our Channel ID our workspace ID our body and for the image we're just going to set undefined here and I think we need to modify this so image will be undefined uh I just have to fix this create message values there we go so this is now fine right so now we're going to check if the User submitted an image in this message so we are reading from this prop right here we're going to generate the URL using await generate upload URL we're going to do uh do we have the options here oh so these are the options the values and then inside of here we're just going to do throw error true here as well and then we're going to do const result to be await petch URL which we just got from above like this and then we're going to give it a method of post we're going to give it a headers of content-type image. type and the body will be image and then from Storage ID we will be able to await results result. Json like this and we're going to get a storage ID here let me just see what's wrong with the URL here uh string R defined is not uh valid here so so it's possible to get undefined here all right so if there is no URL um what we can do is we can throw new error URL not P so this error will will be caught inside of here and it will be failed to send message uh but is it actually possible for that to happen uh I'm not exactly true let me just go ahead and see instead of generate upload URL inside of oh it's right here generate upload URL so the response type can be null so I suppose that yes it can be undefined okay that's all right we're going to go ahead inside of chat input and if there is no URL we're going to throw an error because we are inside of uh try and catch but I think if there's no URL this will throw an error in itself right okay so what we're doing here basically is just skipping our values prop right we're just is passing in an empty object here in order to get to the options so we can assign it throw error through uh so that it gets caught inside of our catch method here great so we have the URL now and then we're going to do a fetch API call and we are going to attempt uh to extract storage ID from here but before we do that remember uh this await fetch will not throw an error if it fails instead we have to check manually so if result is not okay in that case let's get toast. error well we can just throw a new error we and we are going to throw failed to upload image and then this will get caught inside of here like that and if we have storage ID in that case we can go ahead and do the following we can add values. image storage ID like that and then we can modify the create message here to Simply get the values there we go so this should now handle the entire upload process for us so let's go ahead and try it out now I'm going to go ahead and prepare my database here more specifically I'm going to prepare my files so inside of my file storage I have nothing at the moment so let's go ahead and try this out I'm also going to open this in case we can notice any errors and I'm going to write text with image and I'm going to go ahead and select a random image I have and let's go ahead and click submit and looks like there were no errors at all that would mean that we successfully uploaded let's take a look inside of my files and there we go I have my image right here I can download it and this is my uploaded image perfect and let's check one more thing inside of my messages here in the latest one I also have the image storage ID Associated here and well it looks like it doesn't have a link like these others one do I don't know if this is but I think this means that yeah it's it's basically uh connected to our storage so later when we uh return the message list we're going to have to turn it from Storage ID into an actual image perfect so we can now upload images amazing in case you got any errors uh you can always visit the source code and you can also you know double check that you you can add a console log here for the URL for example to see if you get the URL so let me go ahead and do that so let me give you a console log of my URL here so that you know what I'm seeing here and inside of here a console log of my result so inside of here you should be able to see what's going on I'm going to refresh the entire thing I'm going to write test here and I'm just going to pass a random uh message so let's write out there we go you can see that I got the upload URL above right here and my result is a response right here with uh I don't know exactly where it is it's a readable stream okay uh perfect and if you got any other errors so I'm just showing you now in case this works you know you can speed this part up in case you still have errors it could could be that your await create message is failing so that can happen if you misspell the ID of the image so that should be underscore storage make sure it's underscore storage here make sure inside of your use create message you do the same thing here so image is idore storage and make sure that inside of your API messages create you also handled the image as v. _ storage uh you can also maybe see some helpful errors inside of here if it's not working and final thing you should check is your schema make sure images have the ID of storage amazing amazing job before we move to loading our () messages I actually want to wrap up our schema entirely so that I can properly add the conversation ID where I need it because we are going to need it anyway to populate our messages so let let's go inside of schema. TS inside of our convex folder and in order to add the conversation ID we have to implement the conversations themselves so just above the messages after channels let's define conversations let's write Define table and let's go ahead and define the properties so each conversation will be held inside of a individual workspace ID so each conversation needs the workspace ID every conversation will be one to one only for everything else we have channels so we're going to have Member One ID which will be v. ID members and then we're going to have member 2 ID which is going to be the same thing so it doesn't matter which one is the first one and which one is the second one but more often than not the member one will be the one who initialized the conversation in the first place and that's it that's our entire conversations schema so now let's go ahead inside of our messages table here let's remove this to-do and let's actually add it so conversation ID will be V do optional v. ID conversations like that of course make sure that your bonex convex Dev or npx convex Dev is succeeding and it's not failing at any point so just make sure that your schema is updated you should also now see all the new values inside of your data here so you should see the conversations right here great now there's one more uh table here that we need and that is the reactions but before we do that let's actually add all the necessary indexes to messages here uh so the conversations are also going to need an index so let's go ahead and take care of that as well so the index here will be by workspace ID and let's add the workspace ID here and similarly we're going to have to add some indexes here for messages so for messages we're going to need a simple by workspace ID as we had above but we're also going to need a couple of others then we're going to have by member ID member ID then we're going to have whoops not a comma we are still chaining after that we're going to have by Channel ID let's copy this one and let's go ahead and let's write by conversation ID and that will use the conversation ID after that we're going to have by Channel idore parore messore idore conversation uncore ID so this will be a very large index that will be used to load threads in channels and in one-on-one conversations and we also need the parent message for what the thread is actually loading so let's add everything we need in correct order so we first need the channel ID then we need the parent message ID and then we need the conversation ID there we go and the last table here we need is reactions so Define table again we're going to have a workspace ID for reactions so v. ID workspaces we're going to have a message ID for what this reaction will be attached to we're going to have a member ID as the user who added the reaction and we're going to have a value which will be a string and the value of the Emoji right let's go ahead and add the index by workspace ID which will have the workspace ID and let's go ahead and add the index by message ID which will have the message ID and last one will be by member ID member ID there we go so we finished our schema and now that we've added the conversation ID to our messages let's go ahead and let's resolve all of those places where we need to add it we're going to start inside of the messages. DS here where I have in the create method added a to do add conversation ID so I'm just going to copy and paste the channel ID and write conversation ID here v. optional ID of conversations like that but it's not not going to be just that so this is what we are going to do after we do our member check we need to handle conversation ID separately so I'm going to do this I'm going to write a letor conversation ID and by default it's going to be the one inside of the arguments right but there will be a special case if we are replying inside of a thread of one-on-one conversation when we reply in that thread in our URL we are not going to have the conversation ID we're going to have the individual me other member ID that we are talking to right so the conversation ID is something internal that we know of right so that is a case where message being sent will not have the conversation ID come from the front end but since it is a reply in a thread it will have the parent message ID so that's what we're checking for here if we don't have arguments. conversation ID and if we don't have arguments Channel ID so this ensures all right this is now definitely a reply inside of a one-on-one conversation and to further enforce that we're going to ensure that we do have the parent message ID so this combination is only possible if we are replying in a thread in oneon-one conversation that is the only case where this can happen so inside of here let me just modify uh this to four like this so inside of here I'm going to go ahead and add con parent message here uh okay let me just fix this too like this parent message will be await context database get arguments parent message ID because we have that but in case we don't have the parent message ID if that happens we can just throw a error because we have no idea where this message is supposed to go it doesn't have a channel ID it doesn't have a conversation ID and even the parent message ID is incorrect in that case we truly have no other option than to throw an error parent message not found like that otherwise we are going to modify our conversation ID to be parent message. conversation ID so that's how we are going to discover which conversation ID do we need if it has not been passed and then inside of here besides Channel ID we can pass in the conversation ID to be our conversation ID just like that so that's how we took care of that case why are my indentations all of a sudden so weird oh it's because this is the weird one all right there we go and this one as well I have no idea how they became so weird okay there we go now we also have to modify the hooks so let's go ahead inside of our features inside of messages use create message inside of here we're going to add the conversation ID optional ID of conversations and once you add this nothing should really change at this point this should still be working because we modified our create to accept the optional conversation ID we also handled this special Edge case in case there is no Channel ID no conversation ID but there is the parent message ID we are going to come back to this I know it might be a little bit confusing because you can't exactly see what's going on but I have to write this because I'm afraid I will forget it later so I'm going to go ahead and try and remember this later to reminds you why this is happening all right and let me go ahead and quickly go through to-do uh and it looks like we also have to remove the associated messages here so let's go ahead and do that uh let me see uh where I actually am here okay we're going to do that later actually we we're going to have some other chapters for that what I want to ensure now is that I have the conversation ID in all the places I need there we go so we have finished our schema now with we have added the conversation ID to our messages create method to our messages create Hooks and we are now ready to continue developing let's just confirm that chat input has no errors there we go chat input has no errors because this create message does not need to accept uh the conversation ID right so inside of this chat input create message value we don't have the conversation ID because we don't need it this is just for channels at the moment great great job you are now ready to load some messages now let's go ahead and let's build an API endpoint where we are going to load () all of our messages for a specific Channel but this is going to be a bit more complicated than you think so let's go inside of convex inside of messages. TS we've already started building a helper method here called get member right and we use it throughout our uh code for example inside of here in the create function we leverage that g member so we have to write less code well before we can build the get uh query here we have to add a couple of more of these helpers so let's go ahead and let's start by populate user so const populate user will be a very simple method which will accept the query context as the one below it and a user ID which will be a type of ID users inside of the populate user method we are very simply going to return context database get user ID we're also going to add populate member which will have the exact same queries but instead of user ID it will of course have the member ID here which is a type of ID members and inside of here it's going to return context database get member ID so what's the difference between the uh my apologies not export just const so what's the difference between populate member and get member so populate member works very simply I just want to populate the member using the member ID right I don't care about user information inside of that member whereas get member serves as a general method where I want to get a member by a specific workspace and user ID right so populate member is just a generic you know okay using this ID load the member but get member is with a combination of this workspace ID and this user ID what member is that right so that's the difference make sure that you have populate user and populate member and now let's go ahead and add const populate reactions so again we're going to have context which is query context and then we're going to have a message ID for which we will be loading reactions so that's an ID of messages a quick reminder so our reactions are inside of our schema here in the last chapter we've wrapped up the schema so now we have reactions which are attached to messages and that's something we're going to have to populate inside of our API endpoint to fetch all messages so inside of here we're going to return context. database we're going to query reactions with index by message ID and we are very simply going to do query equals message ID by our param here message ID and let's simply collect all reactions that we have great and there's one more thing that we have to build which is populate a thread so in case we have some replies send to a message we have to add that information to each message object object inside of our array so let's add a con populate thread here so uh that will be an asynchronous method which will accept a context which is query context and message ID which is an ID of messages now inside of here we're first going to get the messages using await context. database and then we're going to add query messages with index by parent message ID which looks like is something that I have missing so let's go ahead and add the by parent message ID to our messages schema so let's go inside of schema here and let's find the messages table and we have a bunch of indexes here so let's go ahead and after the buy conversation ID let's add index by parent message uncore ID parent message ID like that there we go so now we have by parent message ID here and then we can actually use the by parent message ID inside of this populate thread method and let's just modify it so I'm going to go ahead and immediately return uh query equals parent message ID message ID which we passed in here right so we are now uh loading after we had collect of course we are now loading all messages which are replies to this messages right so we don't have uh a different table for replies we just reuse the existing messages table by adding the parent message ID to it so if a message at any point has a parent message ID then most definitely that's a message that should only be loaded as a reply to a certain message it should never be loaded right here in the channel it should be loaded in the sidebar here once we click on replies great so now we have all messages which are a reply to a specific message and now let's do if messages. length is zero so if there are no replies we're going to go ahead and return the following the count of replies will be zero the image which be will be undefined and timestamp will be zero so if you're wondering what is this well we are not going to populate the entire collection of messages what we are going to use this method for is to display for each message all right this message has five replies and the image will be used as this is the image of the last user that replied similar to this literally something like this right like it will say Antonio 18 seconds ago that's the last reply and that's what the time stamp is four so if there are no replies we have nothing to render on the front end because we're going to see if count is zero that means no replies for this message otherwise we're going to have to get the last message message so last message will be messages messages. length minus one and let's do con last message member will be await populate member context and last message. member ID so now we are reusing our populate member uh method right here now that we have the last message member we're going to do this if there is no last message member we're going to go ahead and return the following count will be messages. length image will be undefined and Tim stamp will be zero so we're just going to display some part partial information here but if we do have the member we're going to add con last message user to be await populate user cont text last message member. user ID so now we have the entire user and now we can add full data here so count will be message. length messages. length image will be last message user question mark. image and timestamp will be last message doore creation time like this and let's go ahead and actually resolve this so if we can't load last message member it doesn't make sense to add an impartial data we're just going to return zero the same way if messages if there will be no replies at all there we go so now we have everything needed to load our messages so now let's actually go ahead and create the get end point so I'm going to go ahead and create that just above our create mutation here so export con get will have a query which will have specific arguments and as always an asynchronous Handler uh async uh let me just see did I uh oh we need to add query my apologies I was wondering why I have those type errors so make sure you import query query context and mutation from generated server here all right so we have populate thread populate reactions populate user populate member and get member these are our helpers and now let's focus on the get method here so first of all let's add the arguments we're going to accept a channel ID which will be optional because remember we are also going to be able to load by conversations so this will be a conversation ID which will be an ID of conversations besides that we are also going to be able to load messages by parent message ID which will be an ID of messages so these are the three combinations by which we are going to be able to get messages messages are also going to be infinitely loaded right so there could be thousands of messages and we can't load all of them so we're going to have to add pagination here luckily for us convex takes care of that so let's go ahead and add pagination options opts so make sure that you write it exactly like this so pagination options will be pagination options validator and you can import that from convex SLS server so pagination opt validator make sure you add it here under the pagination Ops uh argument excellent so now let's go ahead and let's do what we always do which is get our user ID using a weight out which we should already have imported from do/ out get user ID right here and then we're going to go ahead and check if we don't have a user ID let's throw an error and now we're going to have to uh specifically Define where we have the conversation ID or not because remember even in the create there is this Edge case with conversation IDs so let me remind you this Edge case is only possible if we are replying in a thread read in a one-on-one conversation and I know it probably still doesn't make sense why we have to do this but I promise once we actually get to having the threads and having one-on-one conversations uh we are going to go ahead and have it you know clear Insight why that's happening you're going to see that even though we are sending a message in a conversation in a reply we will not be able to send conversation ID but thanks to the parent message ID and lack of of Channel ID we are going to uh get the conversation ID from the parent message so let's go ahead and do that here again so letor conversation ID will be arguments. conversation ID by default but if we don't have arguments. conversation ID and if we don't have arguments. Channel ID but we do have arguments. parent message ID that can mean only one thing that we have to load that parent message using await context database get arguments parent message ID and if we don't have the parent message I the parent message here we're going to go ahead and throw new error here parent message not found so if this happens we are okay to throw an error because there's no way this combination can happen and we truly don't have anything else to load here so this is one exception where I will allow an error inside of a query here uh great so now if let's go ahead and actually finish this so if we do have the parent message we will modify our conversation ID to be parent message do conversation ID like that so that's the edge case that we have to cover for conversation ID make sure that you have that I will of course come back to this later now let's go ahead and let's get our results so I'm going to go ahead and do await context. databasequery messages and let's do with index by Channel ID parent message ID and conversation ID let's go ahead and get query here and we're going to now chain query equals Channel ID to be our arguments Channel ID we're going to change parent message ID to be arguments parent message ID and they need to be in this order if you know make sure that inside of your schema for this large index here in the messages by Channel ID parent message ID and conversation ID you have the exact same order so that's important right so we do it in that order uh not a comma but another chain do equals uh conversation ID argument convers actually my apologies is not this will be underscore conversation ID because remember there's imposs Edge case let's order them by descending and important here we're not going to collect them but instead we're going to use paginate method and passing arguments and paginate options like that there we go we now have results but we're not done yet what we have to do now is we have to iterate over all of those results and we have to properly populate everything inside so let's go ahead and first just return back the uh results here so we're going to go ahead and come back to this later because I want to show you how it looks like now and why we needed all of these helpers here right so this is you know pretty straightforward this is the confusing part the reason I'm already writing this even though we don't have this functionality is because it's very important and I don't want to forget uh writing this so let's go ahead and do the following let's create our use get messages uh method so we can go ahead and load what we already have so I'm going to go inside of source here inside of my features and I'm going to go inside of messages inside of API I'm going to create us get messages. TS like that and let's actually go ahead and write this this one from scratch so let let's add use paginated Query from convex react let's go ahead and let's import API from convex generated API and let's import the ID type from convex generated data model here and now we're going to define the batch size so how many messages do we load at once and let's set it to 20 we can later experiment with this and set it you know to a lower number if we want to actually see the infinite load in action without having you know a million messages now let's create an interface use get messages props so this will accept a optional Channel ID which will be a type of ID channels besides that a conversation ID which will be a type of ID conversations and besides that an optional parent message ID which will be a type of messages and now let's export type get messages return type because we're going to have to type this explicitly so that will be a type of API messages doget and then we're going to get the return type and we're going to get individual page right because it's paginated so this is the individual message that gets returned ID the creation time the image the channel ID parent message ID updated right so this is the individual message that we are getting uh and we can see right now it's not exactly populated here yet so we're going to have to work on that as well and now let's create our expert const use get messages here so I'm going to add use get messages props and let me see if I misspelled it I did not looks like it works so let's go ahead and add the props so Channel ID conversation ID and parent message ID and now let's go ahead and let's call use paginated Query in the first argument passing the api. messages doget in the second argument you're going to pass in uh the channel ID the conversation ID and the parent message ID and in the third argument you're going to find the initial n of items which will be our batch size constant like that and from all of this we're going to return back the results the status and load more method and then we're going to go ahead and return the following results status and a method load more which we are going to create on our own by calling load more once again and add a batch size in side this way we don't have to handle this anywhere else but this place right so batch size is defined inside of use get messages and it can only be changed inside of here great so we now have the use get messages method and now let's go ahead and actually add it to one channel right so let's go inside of source app folder workspace workspace ID channel channel ID page. TSX and and this is already marked as use client and we already have some use get channel here so how about we add messages here use get messages like this I'm going to go ahead and add that right here and I'm going to pass the single argument Channel ID here and I should be able to get results here the only thing we're going to do with results for now is console log the results like this and if you want to inside of here inside of this div Flex one we can also stringify them so Jason stringify uh this would be results let me see if this will break the page or not there we go so this channel of mine has no messages but if I send a message here there we go you can see how it's immediately populated here right and the problem is I don't think uh okay yeah so here's the thing uh let's say we want to use this array right and this individual object inside to load and display this message well what we can definitely show is when the message was created we can show that and we can also show the body right we can use this Delta op inside of quill renderer component which we're going to create and it will be the exact same text as we wrote in this editor we're going to have it here right so where is it there we go EX exact same text we can do that but what we can't do is display when a specific member uh sorry who was the member that sent that right we don't have the image we don't have the name of the member we also have no reactions to this message and we also have no idea how many replies this message has so it's okay it's good enough but well it's good enough you know for a quick demo to show you that our messages here are working working right if I go into a new channel you can see in here I have much more messages if I go ahead and create a completely uh another channel it's going to be empty in the beginning until I send a message here so that part works right but now let's go ahead and let's improve our uh use get messages here so I'm going to go back inside of our API messages get which we are developing in the convex folder and now we're going to modify these results and actually uh well populate everything we need inside so we're going to go ahead and return an object and we're going to spread the results inside but we are going to override one element of results which will be called page let's go ahead and open the parenthesis here and let's write await promise.all and inside of here inside of the parenthesis add results. page. map so for each page we're going to go ahead and do something here uh no semicolon at the end right so since we're using a do map inside of Promise all we can initiate asynchronous method here otherwise you can't use async inside of map but if you wrap it inside of Promise all that's a syntax you can use so inside of here each page will have a message so let's go ahead and populate everything we need for this individual message const message will be a wait my apologies const member will be await populate member passing the context and message. member ID now we have the member const user will check if we have the member and then do await populate user and pass in member. user ID otherwise it will be null and we also have to pass in the context here my apologies if we have no member or if we have no user we don't have the ability to display this message so just return null and then we're going to filter it out later now let's do the same thing with reactions so const reactions will be await populate reactions context and message ID then let's load the thread or replies so await populate thread we'll pass in the context and message uncore ID and then we have to load an image If the message has an image what do I mean by that well remember inside of our schema if we upload an image and attach it to message we store it as image ID of underscore storage so that's not a URL that's stored inside of our database we have to generate the URL from our convex storage right so inside of here you know I have these files and I have the storage ID and this storage ID is stored inside of my messages here right so let me go ahead and there we go so these two messages of mine have the image but this is not a URL this is just a random storage ID so now we have to populate that using message. image and then let's add a question mark if we have the image we're going to do await context. storage. getet URL message. image otherwise undefined for the image constant there we go and now that we have the reactions we have to normalize the reactions data so the way I want reactions to show is like this you know this will be for example my message and then below that I'd expect for example a smiley face and then one Bel besides that I want for example a fire this would be four right so we have to uh modify our reactions and normalize the object so that we reduce by each emoji and also count all members that reacted with the same emoji and add that up to the final count right so this is the what I want to do on the back end so I don't have to do that logic on the front end because it's going to be faster and I want my front end to receive normalized data here so let's go ahead and add con reactions with counts so this will do reactions. map individual reaction here and let's go ahead and return reaction but count of each reaction will be reactions. filter we're using the r shorthand for reaction r. Val is equal to reaction. Value like that and let's do do length here like that we know have reactions with counts we now have to D duplicate the reactions right because just by doing this we would have things like this I would have one and then I will have one again so what I want to do is uh combine this two into just being this inside of our reactions object right so right now we manage to count the reactions but each reaction has its own count right we did not join them in any way so that's what we're doing now so let's add const duped reactions will be reactions with counts. reduce inside of reduce here we're going to get the accumulator and a reaction like this and now in order to uh resolve this immediately uh we have to Define a type of this so this will be an array as and then open parenthesis document which you can import uh from generated data model besides ID so we are defining this is basically an initial value of the reduce method right so in the first argument of the reduce method is our function let me show you this uh there we go so we have the Callback function and the initial value we are now defining the initial value and giving it the proper types so this will be a document reactions but we're going to extend it by adding a account number to it and we're also going to add member IDs to it so ID of individual members so we're going to know how each member ID that reacted like that and this entire thing will be an array like that there we go so this is the type of our initial value now let's go ahead inside and let's actually uh develop the method here so const existing reaction will be accumulator do find go ahead and use the shorthand r as reaction so R.V value is equal to reaction. valal like this if we have an existing reaction we're going to use set to remove the duplicates so existing reaction do member IDs will be array from new set and then spread existing reaction do member IDs and then add the new one so reaction. member ID like so else we're going to go ahead and push the new member IDs so accumulate push spread the reaction add the member IDs and this will be a single reaction. member ID like that and let's not forget to return the accumulator here there we go so that's our duped reaction uh duped method here we can of course revisit this later and I would suggest that you revisit it later as well when we actually add uh the reactions I know it's a bit hard to follow uh when you don't have the entire thing visible for you but we simply have to do it uh in this way otherwise it's extremely complicated to inject it later on uh and the last thing I want to do is the following I want to remove one property which is member ID right I don't want to return that to the front end because I don't need it I have the populated member in the reaction I mean in this array of member IDs so I'm going to go ahead and do const reactions without member ID property so pretty descriptive here duped reactions. map and then go ahead and add the first argument here where we're going to get the member ID the rest will be spread in the rest constant and just return the rest so this is kind of a quick way to remove a property uh from every single item in the array so we are now removing member ID from every single object of the dup reaction there we go and now we are ready to return everything in the message but passing the new image which we now have the member which we now have let me just pass it as member the new user which we now have reactions which will be reactions without member ID property thread count which will be thread. count thread image which will be thread. image thread timestamp which will be thread. timestamp like that there we go but we are not done just yet so what we have to do now is we have to on this page so on the parenthesis which is ending this page I don't know how it's easier for you either go one two three four From Below right or simply at the end of this bracket after the bracket and the parenthesis after another parenthesis right here we have to add do filter add a message and we're simply going to do message is not null but uh we have to give it some specific type here so let's go ahead and do message is non nullable like this type of message like this but it looks like it works even without it so you know I have no types errors here so whether you want to put this or not this is explicitly adding the type right so you can remove it if you don't want to if it's causing you any problems there we go so let's go ahead and try it out now so now we should have uh a different value here so let me just go ahead and refresh the entire thing am I still getting errors I think I'm not getting errors I think that now this is a single message that I sent and look at the abundance of information that I now have so I now have the body as I did before right I have the member which I can see the ID of and I can see the role of the member that sent this which is quite useful for me right I have the thread count I have the thread timestamp and I have the user that sent the message and for the user I can see their email and I can also see you know their name here let's go ahead and try can I also see their image I think I also have more information here but it's getting cut off let me try it like this maybe there we go so I should have looked at this because this is way more readable right so this is now how individual message will look like you can see the abundance of information here we have an array of reactions here we have the user we have the user image the username we have the workspace ID creation ID all of these things which we are going to to use uh great so one thing I quickly want to do before we wrap up this chapter is just fix one thing with our messages so go ahead and do the following I want you to remove all of your messages here so go inside your messages table here select everything and delete all documents I don't want you to have a single message inside and then I want you to go inside of your schema here inside of messages and wrap updated at in optional like this I want it to be optional make sure you do this and make sure that you have no errors inside of your bonx convex Dev here or npx convex Dev and then go inside of messages find the create mutation and when you create a message remove the updated app it's just going to be simpler because we're going to use the comparison if updated at is older I'm sorry newer than created we're going to consider that message edited right but the problem is that using this that's always going to be the case right because date. now will not be in sync with what convex will insert for its own creation time so each element inside of convex has its own creation time and it's impossible to match that like this so we are going to be fine with updated ad being undefined if updated ad does not exist that means this is an original message if updated ad exists and it's more recent than uh create creation times which will be pretty much always uh that means this message has been updated so just go ahead and save that and let's go ahead and refresh in a random Channel and let's say hello world here and there we go you should still be able uh to see your messages with all of this information what we're going to do next is build a component called message list and the actual message and start rendering out our messages great great () job now let's go ahead and let's render our messages so I'm going to go ahead and revisit my channel ID page so that's inside of source app folder workspace workspace ID channel channel ID and inside of here we have page. TSX and the first thing I want to do here is I want to also get the status and load more from my used get messages here and I'm going to go ahead and do this channel if channel is loading but also if status is equal to loading first page so that's the only time I want to display the full screen loader any other subsequent loading will be a different status so that will be loading more for example right so loading first page is for the initial batch of messages so this loader is perfectly fine to be loaded uh with that logic great now let's go ahead and let's remove this div here and let's Implement a message list component the message list component will have a channel name which will be channel. name a channel creation time which will be channelcore creation time data which will be results load more which would be load more method which we've just exported is loading more will be if status is equal to loading more can load more will be status can load more like this and now let's go ahead and create the message list component so the message list component will be a common reusable components so we're going to go ahead and build it inside of source components let's create a message Das list. TSX like that and now let's go ahead and let's create an interface message list props I'm going to give it a uh bunch of possible options so we're going to have a member name which will be an optional string a member image which will be an optional string channel name which will be an optional string Channel creation time which will be an optional number and then we're going to have a variant of the message list so message list component will be reused across the channel variant a thread and an individual conversation so that those will be different variants right and then we're going to have the data so the data will be a type of get messages return type which we Define inside of features messages API use get messages here where we Define the batch size remember that we've added the get messages return type so make sure you've added an export here so that you can then import it here there we go so this is our use paginated Query right the method we recently created so it's the get messages return type or undefined and then we're going to have a load more method which is a very simple void is loading more which is a Boolean and can load more which is a Boolean as well and now let's export con message list here let's assign the props message list props and let's D structure uh everything we need inside so that will be the member name member image channel name Channel creation time data variant which by default will be a type of Channel load more is loading more and can load more like so and then let's go ahead and actually render these things out so I'm going to go ahead and return a div here with a class name Flex One Flex Flex column reverse padding bottom of four over flow y AO and messages scroll bar so this is a custom class name that we have to implement so let's go ahead and do that by quickly revisiting our source app folder global. CSS and let's go all the way to the bottom here and add messages Das scroll bar and let's go ahead and Define the scroll bar width to be thin and the scroll bar color to be #t DC DC DC and then f8 f8 f8 like that great let's go back inside of the uh message list here and what we're going to do uh is the following we're going to go ahead and simply uh iterate over our me uh data here so let's go ahead and see if I can do data. map and I should be able to have a message inside and what I'm going to do here is I'm going to return a div and Json stringify individual message here like this so now let's go ahead and let's go inside of the page and let's import the message list from components message list I'm going to move it here there we go uh and let me just go ahead and log in here and let's see if we are able to see anything here there we go so we do have some messages but looks like my scroll here uh is in Reverse but I think that's only happening uh well I think it's happening let's go inside of my message list I think I'm missing a class name here so we did add overflow y Auto here and we did add Flex One Flex C reverse I think it's simply happening um due to the fact that this is an extremely long text here right so what I want to do now is I want to add a spefic specific grouping of these messages by the time they were sent right so what I want to happen is that if I send two messages let's say 1 minute apart I want a little separator between them to be loaded right and we are going to go ahead and later change this so it works by day right but let's go ahead and try and group our messages like that so this is what we're going to do we're going to group them all by their unique unque dates and for this we also need uh a bun at date FNS or npm install date FNS so let's go ahead and do const grouped messages will be data reduce go ahead and get groups and message and let's go ahead and Define the initial value to be an object as record of string and type of data and inside of here we're going to do the following const date will be new date message undor creation time and then con date key will be format which we have to import from date FNS so let me just go ahead and import format from date FNS package which we've just installed so let's pass in the date and let's format it in year mm and day like that and then if we can't find the date inside of our groups I mean the date key we're going to go ahead and Define uh whoops let me open the brackets we're going to Define d uh that date key to be an empty array so groups date key will be an empty array like this otherwise groups date key unshift message meaning add it it's the opposite of push right and let's return groups like this so these messages are now grouped by their date so what we can do now is the following instead of rendering our data simply like this right we can do the following object. entries grouped messages or an object do map open parenthesis and then the structure date key and messages here and immediately return the following let me just fix this so grouped messages so this is an object right the way this looks is like I didn't explain that properly so the way this looks will be like this for example 2024 8th of I don't know 25th and this will be then an array of message one message two message three right so that's how this is going to look like so now we are doing object. entries so we get the individual array from an object and we're going to do the following we're going to create a div with a key of date key and then a div with a class name text Center my2 and relative inside of that we're going to add uh an HR element which will be a self closing tag with a class name of absolute top uh one and a half left zero right zero border top border gray 300 below the HR element we're going to have a span with format date label and date key inside and now let's just quickly develop the format date label so I want to display uh specific uh time when this batch of messages are being sent but I don't want to just display the date if possible I want to say today so the messages that are being sent today and I also want to capture for example yesterday and everything else can just be a normal date so const format date label we're going to have a date string which will be a string con date will be new date date string if is today from date FNS so make sure you've imported is today from date FNS is yesterday from date FNS and we already have format all right so if is today date in that case return today if is yesterday date return yesterday otherwise return format date uh for letter e four letter M's and then D like this now we have the format uh date label key here and now let's go ahead and just add a class name here relative inline block background white PX4 py1 rounded full text extra small border border gray 300 and Shadow SM like this and now outside of this div right here but still inside of the date key div we're going to go ahead and do messages. map get the individual message and get the index of that message and inside of here for now let's go ahead and write return div Json string if message and let's go ahead and give this a key of message ID like that and there we go you can see that now we have a separator for our messages so if you you know wait a day and send a new message it will be sent under uh this will be separated by today and this will write yesterday so now we have that kind of message grouping great and now let's go ahead and further develop this so what I want to do is start to finally render this message so it looks like something so let's go ahead and add a message component which doesn't yet exist and let's go ahead and pass in key to be message id id to be message uncore ID member ID to be message. member ID then we're going to have author image to be message. user do image then we're going to have author name to be message. user.name after that we're going to pass uh reactions to be message. reactions body will be message. body image will be message. image updated at will be message. updated at created at will be message. creation timecore creation time and then we're going to have uh thread count to be message. threadcount thread image will be message. thread image thread timestamp will be message. thread timestamp right so a bunch of useful information on how to decide how we want to display this message Mage right here and we are still missing a couple of other things so let's actually just add them I will just prefix them to something else so is editing this message will be set to false by default set editing ID here will just be an empty Arrow method is compact will be false and hide thread button will be false as well so these are pretty much all the things uh that we need to pass and one more thing here is missing uh after Alor name let's add is Alor and this will be false by default right so these are all the possible things that the message component will have and now let's go ahead and let's actually add the message component so it's going to exist in the same place as message list in the components in Source components so message. DSX let's go ahead and let's create an interface message props ID will be a type of ID messages member ID will be a type of ID members author image will be an optional string author name will be an optional string as well is author will be a Boolean reactions will be an array of omit document which you can import from the same place you imported ID document of reactions like this and we're going to emit member ID from it and we're then going to extend it to have count number and member IDs ID members and that's an array the reason we are doing that is because remember inside of our messages API inside of our uh where is my get method here so this is my get method right my get query inside of here we modify how reactions look like right document reactions count and member IDs so that's what we are doing here count and member IDs and then also remember that we are removing the member ID property so that's why we're using the omit and then we remove the member ID from it like that all right we have that and now let's add the body so body we can simply do do document type of messages and then just body like that let's go ahead and add an image to be string or null or undefined like this created at can again be document messages underscore creation time updated at can be updated at is editing will be a Boolean is compact will be an optional Boolean set editing ID will accept ID which will be a type of messages or it can accept null if we want to remove the editing uh preview hide thread button will be an optional Boolean thread count will be an optional number thread image will be an optional string and thread timestamp will be an optional number so a bunch of properties for this message component now let's export const message let's go ahead and let's assign the message props to the type here and let's the structure everything we need so we need our ID is author member ID and author page an author image and for author name in case it doesn't exist we're going to fall back to member right let's at least have something the author image is fine because we can create the image from the name so if anything let's go ahead and at least have the name and then we can just go ahead and add everything else we need so that's the reactions the body the image created at updated at is editing is compact set editing ID hide thread button thread count thread image and thread timestamp basically ensure that you have everything that you have in the message props right here and let's go ahead and just return a div Json stringify and you can pass in the body like this and now let's go inside of the message list and let's import the message component from do/ message like this there we go so now there we go you should be seeing a much smaller Json output now uh basically it should now render this kind of message great so what I want to do now is I want to build a renderer component which will be able to turn this special kind of syntax into exactly what I see here for example what if I bold it and put it in italic right you can see that now we have some attributes here so I want to build a component which will be able to read this and properly displayed here on the screen so let's go ahead and let's build the renderer component so instead of the message here instead of using Json stringify body we're going to go ahead and develop a renderer and pass in the value as body and it's going to be a self closing uh component so now let's go ahead and build the renderer so I'm going to go inside of the components the same place where we have the message list and the message itself and let's add the renderer do DSS like this let's import quill from quill like so let's import use effect from react use ref from react and use state from react let's create an interface renderer props to accept the value of a string let's go ahead and Define the const renderer and just like an editor we will not do export const we're going to do export default here because we're going to have to dynamically load it so we're going to go ahead and type this with renderer props let's go ahead and Define is empty and set is empty to be used State and by default it's going to be false let's define the renderer ref to be used ref HTML div element and by default null let's go ahead and add a use effect here inside of here if we don't have the renderer ref. current we're going to return this method then let's go ahead and Define the container constant to be renderer ref do current renderer ref like this let's go ahead and initiate quill using new quill document create element div and for the properties here we're just going to add a theme of snow nothing else because we're not building an editor we just want uh to uh render the text so for that we're going to ensure that quill is not enabled so quill do enable false this will make it readon mode and now let's go ahead and add the contents to be Json pars value because we store it as a string of Json so now we turn it into an actual object and now we can do quill set contents contents like that and now let's go ahead and do the following let's check if is empty so if is empty will.get text and we can use a little uh help from our editor component inside of source we should have uh the editor instead of source components you should have the editor here and go ahead and copy uh this do replace. trim length equals z from our is empty method so text. replace with this exact regex doth length is zero and then set is empty is empty like that and then container do innerhtml will be quill root inner HTML like that and in the unmount method we have to properly clean this up so I'm going to do if container is present container. inner HTML will be an empty string there we go and let's just add value inside of use effect here and then if is empty we're going to return null so there is a chance this can happen if someone just sent an image in that case the renderer will not be able to display anything otherwise let's go ahead and return a div which will be a self-closing tag and it's going to be very simple ref here will be renderer ref and class name will be ql editor and also ql renderer so make sure you have both of them let's go ahead back inside of our app folder global. CSS make sure that you have ql renderer and make sure that you have ql editor you should have both of them here and now let's go ahead inside of our message component which is inside of components here and let's import renderer but let's import it dynamically right so I'm going to import Dynamic from next Dynamic and then I'm going to go ahead and do const renderer to be dynamic like this return a method inside which will be import at slash components SL renderer like this and pass in SSR to be false and we have to go back quickly inside of the renderer because I forgot to do export default renderer there we go so now if you take a look you will see that my text is styled correctly so for example a list 1 2 3 and now let's go ahead and write something else which is bolded and then let's add an italic here for example italic and then let's add an italic strike through and if I go ahead and send that there we go you can see that it renders exactly as we saw it here in the editor perfect so what I want to do now is I want to give my message component some Styles here so let's go back inside of the message component here and let's give this div a class name of flex Flex column Gap 2 padding of 1.5 PX of five on Hover background Gray 100 uh gray with an a gray 160 group and relative like this and I think that already there we go it should start looking a bit better right we now have this hover effect and it's kind of pushed to the side it's not it's not stuck with the sidebar here so much better already uh great uh and now let's go ahead and render when it was created so we're going to do that above the renderer still so inside of here add a div with a class name Flex items start and gap of two and now let's add a native button element which will use format from date FNS so just make sure you add this this button will add new date created at and it will just use hours and minutes here there go so you should now see a button with hours and minutes when a certain message was sent like that and let's go ahead and give this button a class name of text extra small text muted foreground opacity zero group hover opacity 100 with of 40 pixels like that leading of 22 pixels we're going to have text Center and hover underline like that there we go so now the time shows only when you hover on it and now let's go ahead and let's wrap our button inside of a hint component so go ahead and import hint from do/ hint because this is in the uh Source components where all of these are kept together you know let's go ahead and give the hint a label of format full time and for format fulltime we're going to have to Define our own uh method again so just pass in format full time new date created at let's go ahead and create the format new time method here so con format new time will accept the date of date and inside of here it will return turn a string but open template lals like this so we're going to go ahead and do is today from date FNS date in that case we're going to write today so make sure imported is today and let's also add is yesterday so if it's today we'll render today otherwise if is yesterday date we're going to R yesterday else we're going to go ahead and do format date mmm D comma and then four y's here and then we're going to continue at format date hmm SSA so basically we're going to have either today or yesterday or a very specific uh month day year at this exact time so basically if someone hovers on the hint here they're going to have a much more specific time when this was sent including the seconds as well right or an exact date if it will either say yesterday if you wait a day here or if you sent it a couple days uh in the past it will say the exact date so you are aware of when these messages here uh were being sent great so we now have that and now let's go ahead uh and style this uh even further we're actually going to modify this a bit by using our is compact here so if is compact then we're going to return this because we just created a compact version of a message message right so if you go ahead inside of your message list here and add a variant to it do we Define oh my apologies is compact uh just add it to true there we go then all of these messages here are visible right so we're going to go ahead and bring this back to false now and we're going to style them in a different way so if it's compact we return one thing but if it's not compact back it's going to return a similar thing so for now you can copy it but we are going to slightly uh modify this entire thing here so uh first thing that we have to change here is inside of this div before the renderer so let's start a div with a class name let's item start and gap of two and let's add a button my apologies a native button element which will have an avatar from do/ UI Avatar and let's also add everything else we need from /ui Avatar so that's going to be the Avatar image and the Avatar P back like this make sure you have all of those so let's go ahead and add the Avatar inside of that let's add the Avatar image which will be Source author image and then we're going to have an avatar fullback and for this we can use uh the solution from well any other place I think we have one called user item so if we go inside of source app folder workspace we should have user item here so let's go ahead and first get the Avatar fullback here instead of message let's just add const Avatar fullback and this will simply use the Alor name like this and let's go inside of user item and let's copy the entire uh well we can copy the entire avatar from here actually because it has all these classes we're just going to slightly modify the props so let me just paste that here there we go and the source will be Alor image and then this will be an outo fullback like this so there we go I can now see my little uh message here uh like this great uh and now what we have to do is we have to add a rerer inside of that div right here so right next to the button so now it should be looking slightly better right they should be next to each other like that uh but let's go ahead and style it even further so I'm going to wrap this div uh this renderer inside of a div and I'm going to give uh the div here a class name a flex Flex column whoops full width and overflow hidden then inside I'm going to add another div with a class name text small so we are going to keep the renderer just in the first div here right we're not going to put it inside of this one so inside of this div text small we're going to have a native button element which will render the Alor name and the class name for this will be font bold text primary and hover underline and let's also add an non click here which will be an empty Arrow function for now like this there we go so we now have uh my name here as well great uh now let's go ahead and go outside of this button and let's add a span element and we're going to go ahead and forcefully write NB nbsp which is uni code for white space so we are basically adding some space here some invisible space here uh we can also use you know Tailwind gapex to if you want to and let's go ahead and add a button here which will have uh a class name text extra small text muted foreground and hover underline and inside of B we're going to use format new date created at and just simply hmma a like this there we go so next to the name we now have the time it was sent and as we did in the compact version let's wrap this around a hint and let's give the hint a label of format full time new date created at so now when you hover there we go you get a more specific time perfect uh so we have that great so we have the renderer here and what I'm going to do now is the following if we have updated at I'm going to go ahead and add a span and say edited here if I don't I'm just going to do null and let's give this span a class name text extra small and text muted foreground and let's change this to true and there we go you will now see how this looks like when it's edited so when we edit a message the updated ad field will be added and then we're going to render the edited text here so for now change it back to update at uh like this great so what I want to do now is I quickly want to go back to my message list and I want to turn the is compact to true so there we go now they uh look a little bit differently and they actually are incorrect so let's go ahead and properly add them so inside let's go ahead and scroll up uh inside of the message to where we can find if if is compact here and first of all uh let's move the renderer inside of this div Plex items start right so right below the hint component so there we go now time is next to the message here uh but that's not all I also want to go ahead and add a div here around this renderer and give it a class name of flex Flex call and full width like that and below this I'm going to do the same thing update at and add a span edited and let's go ahead and add otherwise null and the class name here will be text extra small and text muted foreground uh there we go like that uh and now if you go ahead and turn this into true your compacts should also have this so now to answer the question when do we use the Compact and when do we use the regular variant of our message here when does the is compact turn to true and when does it turn to false so basically if the same us user sends a message not even minutes apart the second message of that user and any subsequent message after that will be a compact message because this is way too much information I don't need to see this user's name an image so many times if they are writing in a very short interval so let's go inside of the message list and let's fix that so what I'm going to do is I'm going to add a time threshold right here I'm going to add a little constant in my message list now so constant time time threshold will be five as in five minutes until uh I am going to roll fall back to a non-compact message so let's go inside of this object entries inside of messages. map I have prepared uh I didn't do a return immediately instead I opened curly brackets on purpose and then wrote a return inside so I have some room here to add some specific code so const previous message will be messages index minus one and then const is compact will be decided for the following if we have a previous message and if previous message. user question mark ID is equal to current message. user question question mark ID and if difference in minutes from date FNS so make sure you import difference in minutes from date FNS is the following new date message creation time in the second argument new date previous message creation time is smaller than the time threshold then is compact will be true and you can replace is the hardcoded false to is Compact and there we go so now if I go ahead and for example uh send a message I have an image but then I send it again I don't have an image and again I don't have an image so that's what we want to achieve but it looks like it's not exactly aligned perfectly so let's go ahead and resolve that so let's go ahead back inside of my message component here and not in the E compact but instead of this one right the last return here let's remove the size five from here and there we go so now this looks uh bigger let me just see should I also remove yes let me also remove mr1 here like that so now we have an image here and this is taking exactly the same room as my image above uh great so this now looks much much better and what we can also do is we don't have to type rounded MD every time we can just go into Avatar and change this from rounded full so the Avatar is located inside of your Source folder uh components UI Avatar we added it from Shad CN and let's change it here to be around the MD like this and let's also so we can keep this uh Avatar image aspect Square H full W full let's also add object cover here and in the Avatar full back here let's just modify the rounded full to also be a rounded MD there we go so now we don't have to type in rounded MD every single time right we can now go back inside of the message component individually here and we can remove all of the these rounded MD uh class names here and perhaps we can even use this background sky and text white and text extra small let's copy that and put it inside of the Avatar fold back here so instead of background muted we're just going to add that background Sky text white and text extra small uh and then you don't need any class names at all there we go so I'm just going to go ahead now and try and log out and I'm going to go ahead and log in inide inside of my other account and let me try and send a message here there we go another one there we go works perfectly uh and I kind of want to increase this Alat instead of extra small let's just put it as SM here by default there we go like that uh perfect so now we have that working what we have to do next is we have to implement uh a a toolbar so that when we hover on an image uh when we hover on an individual uh message here I want to toolbar here to display but just before we do that there is one quick thing that we can do and that is show an image If the message has an image right that should not be too hard to implement so let's do that and wrap up this chapter so for that we have to go back inside of our message component here and let's first resolve the last return so we are always going to skip the is Compact and let's ensure that the main return has this feature first so below our uh renderer here we're going to have a thumbnail which will have the URL of image let's go ahead and create that on the same level as message list and message so instead of source components let's add a thumbnail DSX like that and let's create an interface thumbnail props to accept the URL which can be string or null or undefined let's expert const thumbnail let's go ahead and destructure the props so we just have one which is URL and let's go ahead and import everything we need from the dialogue because this will also open in a dialogue if needed so dialogue dialogue content header title and Trigger and let's also prepare an X icon from Lucid re act here so first things first inside of this component if there is no URL we're going to return null and then let's go ahead and let's return a div with a class name uh which will be relative overflow hidden maximum width of 360 pixels border rounded large my of two and cursor zoom in inside of here we're going to have a regular image element we're going to pass in the source to be URL we're going to pass in an ALT of message image and the class name of rounded MD object cover and you can do size full like this if you're getting an sent error here what you can do is you can add the following rule in the beginning so slin disable next next no image element because nextjs doesn't want you to use the image element so you can disable that by adding this uh lther rule go back inside of message now and import thumbnail from do/ thumbnail so the reason I'm using a regular image instead of convex one is because it was just easier to style the way I want it to be styled so I've been logged out so let me go ahead and log in again and now I'm going to go ahead and attempt to send a message so I'm going to write test here I'm going to write hello and let's first send that there we go that works just fine hello with image let's try that I'm going to go ahead uh and select a random uh image that I have uh just a second there we go hello with image and let's try it out now so looks like image is not yet being passed let's see why where did we do a mistake here uh so we probably didn't use the image let's see instead of my message I do have the image oh well the issue is that this is a compact uh component right so okay let's repeat it let's copy the thumbnail URL and let's add it inside of our is compact just below the renderer here and there we go we can now see the image if you want to try it out on the first one go ahead and create a new channel and in the first message go ahead and try and send something and there we go it it works in the non-compact one as well also try whether it works when you just send like this there we go so you can now do all of those combinations uh great and I One More combination to just check is if it's not Compact and if it's only an image there we go everything works just fine so what I want to do now is I want to go inside of the thumbnail. DSX and when we click on it let's just enlarge it so this is actually very simple to do we don't even need any states so dialogue will wrap the entire thing inside of our thumbnail DSX we're going to have a dialogue trigger here uh which will wrap this entire div here like that and then we're going to have a dialogue content and this dialogue content will have a class name of Max with 800 pixels border none background transparent padding zero and Shadow none and now let's go ahead and give it an image inside and we can just copy the entire thing here so just copy this entire image paste it inside we're just going to slightly uh modify it uh actually no it will be exactly the same like this so now when you click here there we go and you have the close button right here amazing amazing job you can now send uh images and you can also large () them now let's go ahead and let's add some Cosmetics to our message list so I primarily want to implement a header which will be visible at the top of every last message in each channel so right here I want a little hero so let's go ahead inside of our message list right here and after we close our uh Dynamic random ing of uh all of the messages let's go ahead and let's add whoops let's add a damic check if variant is Channel and if we have channel name and if we have Channel creation time in that case we're going to go ahead and render Channel hero the channel hero component will have a channel name or we can just call it title in this case uh actually let's call it name which will be our channel name and creation time this will be Channel creation time like this now let's go ahead and let's create that on the same level as all the other components we've done so far so instead of source components let's create channel- hero. TSX let's import format now not from path but from date FNS and let's create an interface first channel hero props to accept name which is a string and creation time which will be a number then let's expert cons Channel hero here to have Channel I apologize name and creation time and assign the channel hero props here now inside of here let's go ahead and return a div with a class name margin top of 88 pixels MX of five and margin bottom of four inside of here a div with a class name text to excel font bold Flex items Center and margin bottom of two inside of that a hashtag and a name like this below that we can add another div and while we're here we can turn these divs into paragraphs right let's go ahead and turn this into a paragraph as well and let's add a class name here font normal and text slate 800 and margin bottom of four and inside of here we're going to add a slight description of this channel so this channel was created on format creation time and let's use mmm d o y y y y like this and let's add a DOT this is the very beginning of the and let's add a strong element again channel name here and let's add uh empty okay let's close this like this uh and not channel name but name so name Channel like this and now let's go ahead and go inside of the message list and let's import the channel hero from do/ Channel hero and now every channel should have a nice hero message at the top excellent so if you create a completely new channel hello there all you see here is the hero until I send a message after that a message will be visible great so what I want to do next is I just want to go ahead and prepare everything I need here for the message component so it has some uh further functionality so let's start by removing some hard code and things here uh specifically the hide thread button so we can go ahead and change that to be true only if variant of the message list is a thread so if we are already in a thread we will not be able to create a reply on a reply right so that's why we want to protect this behavior and now let's go ahead and let's add this editing IDs here so that will be a very simple state so we can go ahead and do that here in the beginning so const editing ID set editing ID will be used use state from react and by default it will be null make sure you've imported use state from react I'm just going to move it here to the top like this and I'm going to go ahead and give it a type of ID which you can import from convex generated data model here ID of this will be messages or it can be no great so we have that and now let's also uh pass this editing ID and set editing ID uh to the message here so the message we'll have is editing if editing ID is equal to message ID and set editing ID will very simple be set editing ID like that and now let's resolve the is author let's go ahead and make this uh not hardcoded so we're going to go ahead and get the workspace ID from user workspace ID you can import this from hooks use workspace ID like this and then let's go ahead and let's get our use current member which you can import from features members API uh use current member it requires a workspace ID to be passed so we know which member we're looking for so let's add data to be current member here like so and then inside of here is althor what we are going to compare is if message. member doore ID uh my apologies we can just use message. member ID so if message. member ID is identical to current member question mark ID then that is the author uh and it's underscore ID there we go so we are now ready to go further inside of the message and give it some new features such as a toolbar from which we will be able to edit a message delete a message and add reactions to a message great great job now that we have all the necessary () props inside of our message component let's go ahead and let's Implement a toolbar so the toolbar will appear when an author of a message hovers over their message the toolbar will appear right here and it will give the user options to edit the message add a reaction or remove a message let's go ahead and do that ensure that you have all the necessary props as I do and go inside of the message. DSX like this and inside of here you should have the is editing uh Boolean right here in the props right because we are now successfully passing that and we have something to compare it here so is editing editing ID is equal to message ID so what we're going to do now is first resolve it inside of our normal return so let's go ahead inside of here and what we're going to do is we're going to go right here before this div ends and if we are not editing in that case we're going to go ahead and render a toolbar component which we now have to create so let's go ahead and pass it all the necessary props is author will be is author is pending will for now be explicit false handle edit we'll go ahead and call set editing ID and passing the current ID handle thread will for now just be an empty Arrow function handle delete will also be an empty Arrow function hide thread button will be hide thread button like this so the only function which we can actually activate already is the set editing ID so very simple inside of our parent message list component we are keeping track of which message we are editing using the editing ID State and we are passing that prop inside of the message alongside with set editing ID so that each message can set their own ID as the message we want to edit so that's why this is the only function we can currently call from this toolbar and we are passing the ID which we have as a prop in the message component now let's go ahead and let's create the toolbar component so we're going to create it inside of source components toolbar. TSX like this and let's start by creating an interface toolbar props let's add is author which will be a Boolean let's add a spending which is a Boolean let's add all three of our methods handle edit handle thread and handle delete and let's also add handle reaction which will be a value and a string and lastly we also have uh a hide thread button Boolean let's export cons toolbar and let's go ahead and assign the to tool bar props inside of here let's go ahead and pass in all of those uh variables from above so e althor is bending handle edit handle thread delete and handle reaction and handle and hide thread button uh and I think I somehow missed the handle reaction method from here so let's also add that handle reaction will just be an empty Arrow function as well because we can't do that either so inside of the toolbar here let's go ahead and for now just return a empty div and write toolbar like so let's go back inside of the message component and let's import toolbar from do/ toolbar like this and now you should just see the text toolbar uh in every message so let's go ahead inside of the toolbar and let's prop uh prop ly modified now so I'm going to go ahead and give this a class name of absolute top zero and right five inside of here I'm going to add another div with a class name group hover opacity 100 opacity Zero by default transition on opacity border background color of white rounded MD and Shadow SM now we're going to go ahead and we're going to add a button component from /ui button make sure you add that import and inside of here we're going to add a smile icon from Lucid react so we're going to start adding the icons as well so now when you hover there we go you can see that a big smile icon appears so how does this group hover actually work because we didn't Mark anything inside of here as a group well remember the toolbar is rendered inside of our uh message right and our message here has the group class name this will currently also only work on the main message so if you send another message which is compact this one will not have the toolbar only the main message will have the toolbar so make sure you're testing this out on a main message you can create a new Channel and then just send the first message here to create a main message let's go back inside of our new toolbar component and let's give our button here a couple of props so the variant here will be a ghost the size will be icon small and disabled here will be is pending we have is spending past here that's great uh all right so this is how it looks like now that's better and let's give our icon a size 4 class name there we go much better now so now I'm going to go ahead and copy and paste this and I'm going to go ahead and give this a message Square text icon from Lucid react as well so make sure you have that so there we go we now have an emoji and we have the thread icon uh and and now let's go ahead and add two more so the next one will be pencil from Lucid react and last one will be trash from Lucid react so make sure you have message Square text icon pencil smile and trash and now you should have these four icons right here great so let's go ahead and add our hint component here from do/ hint and let's go ahead head and actually uh well render some useful information about each and every one of these buttons let's start with the last one which is the trash uh button which will obviously be delete message let's go ahead and go to the one above it whoops so this one will be edit message then the thread one will be the following so for the thread we're going to say reply in thread and for the uh smile we're not going to have uh a hint because we're going to reuse our Emoji popover component so Emoji popover from do/ emoji popover which we've already created for this use case right so let's go ahead and oops emoji pop over here let's add it wrap our button inside of emoji popover let's go ahead and add a hint of add reaction and on emoji select we'll get an emoji and we're going to pass it inside of handle reaction Emoji do Native which will be the string right so make sure you don't misspell this part and now inside of here uh okay looks like something here went wrong so let's see exactly uh where did we mess up inside of emoji pop over here we do have as child here so that should be uh correct uh let's see what else could be going wrong I'm going to refresh one more time let me try and click here okay there we go looks like it was a oneoff bug all right great so we can now open the Emoji here and we're going to now have to implement all of these methods right here but before we do that let's also hide some of them if we are not the auor or if we maybe have the hide thread button on so the reaction button will be available for everyone at all times the reply will only be available if we are not having the hide thread button so make sure you put an ex exclamation point here in the beginning so if not hide thread button then go ahead and wrap and show this button and for the edit and delete message we're only going to show if is althor so if we are not an althor we're not going to have the options uh well to edit or delete a message like this there we go is Alor and inside of here there we go so as you can see I have all of these because I've sent this message but let me try and maybe going into some other there we go you can see that for this other user I can only add a reaction or I can reply in thread but for my messages I have all of these options right here great so what we're going to do next is we're going to implement the edit message functionality great great () job now let's implement the edit and delete message functionality so for that we're going to go back inside of our messages API so let's go inside of the convex folder messages and inside of here above our get method I'm going to export const update which will be a mutation we're going to prepare our arguments and as usual we're going to prepare our Handler so let's go ahead and add all the arguments which we are going to need so we need the ID of the me message which we are trying to update and we need the body which will be the new updated body or the value now inside of the Handler we're of course going to have the context and the arguments let's go ahead and do what we usually do which is check if we have the user ID if we don't have the user ID we are unauthorized and now let's go ahead and let's get the message by using await context data Bas get arguments. ID if we can't get the message let's go ahead and uh well this is a mutation so we can throw new error message not found otherwise let's go ahead and let's get the member so const member will be await get member context and then we have to pass in the workspace ID which we can get from our message so message which we just loaded do workspace ID and then user ID in the second argument in the third argument actually if there is no member we're going to go ahead and throw new error member not found actually unauthorized that's what we are going to throw uh and we can also do this if there is no member or if member ID is not equal to message. member ID in that in both of those cases we're going to throw back unauthorized and then let's finally do a wait context database patch arguments. ID and let's simply update the body to be arguments. body and updated at will get a new date. now so we know this is updated and let's finally just return arguments. ID back there we go that's our update method and now let's go ahead and just create a hook for that so inside of features messages API let's copy use create message and paste it and let's rename it use update message let's go ahead and simply request body and let's request ID which is a type of ID messages there we go and response type is ID messages we're going to call this use update message like this and let's change the mutation to be API messages update there we go no more errors inside of this hook anymore so now let's go ahead inside uh of the message component so let's find that inside of source components and you can find the message component here uh oh and one thing we forgot to do is we have to add the toolbar inside of the is compact version as well so I forgot that so let's go ahead and quickly add it here uh I believe it's right here in the end like this make sure you add it in the is compact the same way we have it here so now when you hover here you should have the exact same thing right there we go perfect so now let's actually uh add that mutation here so I'm going to go ahead and I'm going to add use update message method you can import use update message from features messages API use update message so let me go ahead and add it here and from here we can destructure the mutation and let's call it update message and is spending will be is updating message like that there we go now let's go ahead and let's create one universal is spending here and let's go ahead and assign it to is updating message for now later we're going to you know map with something else here and now let's go ahead and let's add the handle update method so const handle update method will accept a body inside of an object so this will be a body string and inside of here we're going to call the update message we're going to pass in the ID which we have and body here and then on success we're going to go ahead and call toast. success message updated and we're going to set editing ID back to null on error here we're going to call toast. error failed to update now message there we go make sure you've added the toast import from sonor I'm just going to go ahead and move it above there we go so we have that now perfect we have the handle update method but what I want to do now is I want to conditionally render something else if editing ID is set to true so right now I'm going to goad and do this let's go inside of our last return so not the compact one the regular one and let's do the following let's go ahead and Mark our first class name as Dynamic so for that we're going to use the CN from liad utils so wrap this entire class name inside of CN like that and make sure you've imported CN from Libs I'm just going to move it here I'm going to collapse the first class name as the first argument here and then I'm going to say if is editing in that case background color will become f2c 744 33 and I'm going to go ahead and copy it once more and just write on Hover background color will be the same like this so now if I click on edit message uh let's see if this works or not looks like it's not working so inside of my toolbar here handle edit sets the editing ID to ID right oh yes make sure you send it uh on a com make sure you're trying this on a compact message but looks like it's still not working here let me try once more okay looks like something is wrong so let's explore what inside of our toolbar here uh I'm not actually calling handle edit or handle thread or handle delete that's what's the issue is so let's go back inside of the toolbar let's get our handle edit and let's use it inside of the button which holds the pencil so inside of here I'm going to add on click handle edit for the delete let's add handle delete here and we have that we have that and we should also handle thread here on this one so on click handle thread there we go so now I'm going to refresh one more time and let's see it now so make sure you're trying again on a main message not the compact one if I click this there we go it becomes yellow and my toolbar is gone why well because in message. DSX we only show the toolbar if we are not editing so in order to you know remove this you have to refresh now but this is what we are going to prepare now let's go ahead back inside of our message and let's import the same way we've imported the renderer let's now import our editor component so const editor Dynamic import s/ components editor and let's add SSR BS there we go we now have the editor component and now we are dynamically going to rendered it so let's go ahead and do this we are doing this first in the uh main return function right so not the compact one so we have to dynamically choose between rendering uh this renderer here or the editor so what we are going to do is the following find where the button for the Avatar ends right right here and inside of here we're going to do if is editing we are going to add a div editor just a text for now otherwise go ahead and render this entire div like this so this entire logic so now if you go ahead and switch for example you should see you know your normal messages and when you click edit message it should just say editor so now what we're going to do is we're going to go ahead and give this a class name of full width and full height and inside render the editor component we're going to go ahead and pass in the onsubmit here to be handle update we're going to pass in disabled to be is updating message or we can just do the general is updating here why not that uh oh we don't have it my apologies is updating message okay and default value here will be json. pars body on cancel will be an arrow function which calls set editing ID to know and we're going to pass in our variant to update so that's the power of our editor let's go ahead and try this now so this is what it currently says try and send a message here so I'm going to go ahead and click here and there we go you can see how that is now the content of our editor and also notice how we are not adding the image here because we took care of that if the variant is passed as update we do not allow an image to be passed inside of here perfect so let's just see if handle update here uh should work so it should work and let's also use this pending so that's what I wanted to do so inside of the editor let's disable it if is pending is true like this and we can also pass the is pending to the toolbar here in the is editing and also in in this toolbar in the compact version right there we go so now I believe this should work so if I change this to edited message let's see what happens there we go edited message and it even has the edited tag right here perfect now let's enable that for compact message here as well because currently nothing is happening for the compact one so first thing we're going to do is we're going to copy this div or at least the class name right that's what we have to do and let's modify it here because I think the class names are exactly the same yes Flex Flex SC Gap one I think that's true so now if I go ahead and click this it becomes yellow great and now what we have to do is the same uh way we uh decided to render you know this part dynamically uh let's go ahead and do is editing question mark uh let's just write a div here editor otherwise render this entire div right here like this and I'm going to go ahead and give this a class name full width full height and render the editor and you can just go ahead and copy all props from the editor uh my apologies where is it it's right here in your main return because we are now doing the compact return right so you can just paste all of them here and it should all be working so I have this compact message here and I'm going to click edit message and there we go let me edit it and click save there we go working flawlessly amazing uh and and now let's go ahead and let's add the delete functionality so the delete functionality we also have to start uh by going back inside of our messages API so inside of convex messages right here and just as we've done the update let's do the remove so I will copy the entire update method here and paste it and I'm going to rename it to remove it's going to be very similar but it's not going to need the body at all this will be exactly the same looking at the message will be the same we're going to have to confirm whether we have the member we're also going to have to confirm whether the member is the actual author of the uh message by comparing the member ID here and instead of patch we're going to use delete and that's it no other arguments here will be passed uh just arguments ID right that is the only thing we actually have to look and we can return back arguments. ID like this now let's go ahead back inside of our source folder features messages let's copy use update message and let's rename it to use remove message and let's remove the body from the request type let's rename this to use remove message and let's change the mutation to API messages remove there we go now we can go back inside of our message component and we can add this as well well so I'm going to go ahead and go inside of my source folder my components my message. DSX and I'm going to copy and paste the use update message and call it use remove message you can import it from the same location as uh use update message right here there we go let's go ahead and rename this mutate to be remove message and is pending here will be is removing message while we are are here let's also prepare our confirm dialogue and our confirm method from use confirm you can import use confirm from hooks use confirm now let's go ahead and give the use confirm some prompts so we're going to add delete message as the title and as a description are you sure you want to delete this message this cannot be undone like that there we go and now let's also add our handle delete method so con handle delete method will be an asynchronous method in which we are going to get okay by awaiting confirm which we've destructured from our use confirm make sure that you have the confirm here and then if not okay we will break the and exit the method early otherwise let's call the delete message remove message and let's call this handle remove like that so remove message and pass in the ID on success here let's go ahead and do toast. success message deleted and let's go ahead and do to-do close thread if opened so if a thread of the same message is opened we have to close it because that message was just deleted by us for other users they're just going to see an error in the thread section which is okay and let's do toast error here fail to delete message there we go we now have the handle remove method and let's add it to both toolbars so first in the if is compact let's pass in the handle delete here I think this can work just normally like this and and in the one below let's also do it there handle delete like this so let's pick a random message now and let's try and delete it uh looks like it's not working so let's see what exactly we did wrong so handle delete is a void handle delete is a void here uh do we actually add it anywhere so we should add it to delete message on click and it looks like we are so why is it not working Let me refresh and try again I'm going to click delete and still it looks like nothing is happening do we have any errors in the console no okay let's go ahead and the bug one by one so I'm going to go ahead and see we have handle remove here which is an asynchronous method oh I know what's happening we are not rendering the confirmed dialogue anywhere let's go ahead and do that so we have to render it in two places we have to render it individually in the is compact return and in the main return below so let's wrap the is compact return inside of a fragment here and at the top let's simply insert the confirm dialogue there we go so inside of here confirm dialogue now let's do the same thing in our main return so wrapping the entire thing in a div uh my apologies in a fragment and then simply add a confirm dialogue here there we go let's refresh and let's try it out I'm going to go ahead and pick a compact message click cancel nothing happens click confirm there we go message deleted and I want to do one quick thing so I want to add a cool effect while this is deleting so I'm going to go here in my main return method inside of this div which already has the is editing and let's now add is removing uh so is how exactly did I name this why did I name them so differently oh okay so is removing message okay let's call it like that is removing message and this is what we're going to do we're going to do a cool collapsing effect right so I'm going to do it like this BG rows 550 sl50 transform transition all scale y0 origin bottom duration 200 and now look at this cool effect and let me just copy this and add it to the is confirm as well so make sure that you remember to also add all of your features to the to the compact version of the message so let's try it out now and here's the cool thing yeah if I go ahead and remove this now you saw a nice little effect and you can see how this compact message now becomes uh the main message and I can click delete again here there we go what a cool effect so make sure that both your edits are working uh inside compact messages and also inside of your main messages make sure your deletes are working inside of your compact messages and your delete and your main messages as well great great job now that we have the ability to edit a message and to delete the message () let's go ahead and let let's add the ability to add a reaction so in order to do that I want to go ahead and create the reactions API so instead of the convex folder I'm going to create a new file reactions. DS and let's quickly go inside of messages here and let's just copy the get member helper I think it's quite handy so we don't have to repeat the code so let's go inside of the reactions let's add it here let's import query context from generated server and ID uh from data model like that and then let's export const toggle which will be a mutation which you can import from uh generated server here let's define the arguments and let's define the Handler like that there we go the arguments for the toggle will be a message ID for which we are adding a reaction and also a value which will be the Emoji that we are adding and now we have to import convex values here so let's just add this as well there we go now let's go ahead and go inside of the Handler and let's add the context and the arguments inside of the parameters here and let's start with our usual checking if we have the user ID and if we don't we throw an error and we have to import out from do SL out like this so this will serve as a toggle method right meaning that uh if we have already added the same reaction and we trigger this method again that will remove that reaction right so before we get to that logic first let's get the message we are trying to add a reaction to so wait context database get arguments. ID uh my apologies message ID if there is no message we're going to go ahead and throw new error message not found and now we're going to get the member from await get member and pass in the context message workspace ID and our user ID if there is no member we're going to throw new error here unauthorized so we don't have to check whether the member is the author of The Message In this case because anyone can add a reaction to any message so first let's go ahead and let's get the existing message uh from this user so I'm going to go ahead and do const existing message reaction from user to be await context. database query reactions. filter let's go ahead and add this query to include all of these uh filters so query equals query field message ID to be arguments message ID then we're going to go ahead and copy this two more times the second one will be member ID to match our member ID and last thing we're going to have is the value which will be arguments. value so the reason I'm not using an index here is because I found that it doesn't work well with this value set right here but we could maybe try it later and see if perhaps I did something wrong instead and let's get the first like this and now we're going to do the following if we have an existing message reaction from the user for this exact message with the exact same value we're going to go ahead and do await context database and simply delete that reaction so existing message reaction from user undor ID else we're going to go ahead and insert that reaction so context datab B insert into reactions and we're going to pass in the value to be arguments value member ID to be member underscore ID message ID to be arguments message ID workspace ID to be arguments workspace oh it will be uh message. workspace ID and we can technically also use message ID for the message ID like this there we go that is our toggle method here here and what I want to do here is always kind of return something uh so let's say inside of here I'm going to return the existing message reaction from the user ID and inside of here I'm going to get the new reaction ID and I'm going to return the new reaction ID so I want my mutations to always return at least something there we go now it's always going to be an ID of reactions in both cases if we removed it or if we just created it uh great so we can now go back inside of our source inside of our features and let's create a new folder reactions and inside of here an API folder and then let's copy any mutation for example messages use create message we can copy that and paste it inside of reactions and let's go ahead and rename it to use toggle reaction like that I'm going to go ahead and close everything besides that and in my body I'm going to go ahead and accept the value which will be a string and I'm going to accept a message ID which will be a type of ID messages everything else will not be required and this will return back an ID of reactions or nothing like this let's go ahead and call this use toggle reaction and let's modify the mutation here to be API reactions total and once you save this change there should be no errors in your code great now let's go ahead and let's actually use this so let's go back inside of our message. DSX which is located inside of source components message. TSX and we've already added the handle update handle remove methods so now let's go ahead and let's add the use toggle reaction which we can get from features reactions API use toggle reaction so I'm going to add the mutation here to be toggle reaction is pending will be is toggling reaction like this and now let's go ahead and let's actually add the handle reaction method so const handle reaction will accept the value of string here and simply call toggle reaction with our message ID to be ID from this props of the message and the value pass like this there we go and the only thing I want to catch is the on error so in in case we are not able to send a reaction we're going to give an error feedback to the user failed to set reaction failed to toggle reaction right we don't have to add a success message because they're going to see it happen immediately so now we have to go ahead uh and add this to our uh reaction method uh well not our reaction method our toolbar my apologies so let's go ahead and find both of our toolbars remember there's two of them so we have to add it here and we have to add it in the main return here handle reaction like this so what we can maybe already do instead of this message uh we should have uh all the props including reactions but we don't have you know a way to render them properly yet so this is what I'm going to do inside of my compact let's go inside of if is compact here I'm going to go ahead and find this updated at and span and below that I'm going to Json stringify my reactions so I'm kind of going to use a dirty way of showing all reactions on a message and now do the same thing instead of your main return after this conditional updated at which renders the edited text simply uh render a stringified reaction model so there we go you can see that now all of my messages have you know empty arrays here so if I now add a reaction let's see what happens there we go you can see the exact value of the reaction and you can see exact members that added this reaction right here right so if I go ahead and click on it again what should happen is that it should get removed and it does get removed perfect and if I change it you know to any other Emoji there we go it changes to that other Emoji perfect exactly what we wanted so now what we have to do is we have to implement the actual reactions bar so let's start that by doing it inside of our uh main return method here so we're going to replace the Json string if I of reactions and add an actual reactions component here and for this reactions we're going to pass in uh let's go ahead and call this data to be reactions and on change here will be handle reaction let's go ahead and now develop the reactions in the same components folder reactions. DSX like this uh let's create an interface reaction props reactions props which will accept uh the data to be an array of omit and what we're going to emit is document from convex of reactions and we're simply going to emit the member ID from it and then we're going to extend the entire thing by having a count of number and member IDs of ID which comes from the same import as our doc members and an array like that and our uh what would we name this onchange will accept the value of string and return a void there we go so basically we're doing inside of here you know the exact same thing that we handled I believe inside of the message type here uh there we go you can see it's exact same thing here so you can copy it from your message props uh okay we now have that and now let's go ahead and Export con reactions let's assign the props reactions props let's destructure the data and on change Here and Now what we're going to do is actually render out our reactions so let me return a div here reactions so let's go inside of the message. DSX component and let's import reactions from dot SL reactions the same way we did with our toolbar uh thumbnail for example and let's immediately add it in both our Compact and non-compact components so it's already in the correct place in this main return so just after thumbnail and after the edited that's when we're going to add the reactions and I want you to copy that and do the same thing inside of your first if is compact uh edit here so instead of Json stringify reactions after thumbnail after updated ad simply add the proper reactions import here so now all of these messages should have a big reaction text below it now let's go ahead and actually uh render our reactions here so what we're going to need is also to know if we are the ones that added a reaction so for that we need a workspace ID from use workspace ID you can get that from the hooks use workspace ID import above then we are going to need the data from use current member you can import that from features members API use current member uh and let's Alias this from data to current member like this and pass in the workspace ID and you can rename this to member since that's the only member we're going to have I believe know let's be specific let's write current member just in case we modify something later okay and now what we need is the const current member ID so I'm just going to Alias that to dataor ID like this if we don't have reactions my apologies if data. length is zero or if we don't have the current member ID uh and this is not data this is current member like this so if we don't have current member ID or data. link we're just going to return back null like this so now these messages that don't have reactions don't have the big reactions text only those that have reactions have it so if I add an emoji here there we go it has a big reactions text here now let's go ahead and actually render the reactions so for the main container here let's add a flex item Center Gap one margin top of one and margin bottom of one now inside let's go ahead and add reactions. map my apologize data map let's get the individual reaction here and let's add a native button element which will simply have uh the reaction. value inside so there we go now we can see the reactions so if I go ahead and add a new reaction here there we go you can see how they appear next to to each other but we still have no idea which reaction was the one we added and we don't know how many people added the same reaction so let's go ahead and develop that so besides uh the reaction value we're going to add a span which will do reaction. count like this so now you can see the number one next to each reaction here right so if you go ahead now and log out for example and log in with another user which has access to the same workspace and if you add the same reaction right so let's say this uh heart eyes there we go now it says two so it doesn't add it you know as an additional heart I and one no it combines all member IDs that reacted with the same value great so that is working perfect and now let's actually go ahead and style this properly so we are going to need to import CN from lib utils so import CN oops from lib utils and let's go ahead and give this button a class name of CN the first value will be our default value so height of six PX of two rounded of full background slate 200/70 border border transparent text slate 800 Flex item Center and GAP X of one there we go now they're looking much better and now let's do the following if we have added a reaction to it which we're going to know like this if reaction in the current iteration do member IDs includes our our current member ID which we have as a constant here in that case we can go ahead and render our background blue 100 with a 70% opacity border blue 500 and text white uh there we go so this is how this looks now but I don't believe this text uh is correct so text should also be the blue 500 there we go so you can now see which reactions you have added great uh and Yeah we actually we can leave this text at White because we're going to manually change this span here so let's go ahead and do that as well so inside of this span go ahead and give it a class name as well which will be CN so by default text extra small font semi bold and text muted foreground that's going to be the default and then if reaction. member IDs includes current member ID in that case text will be blue 500 like that there we go this is looking much much better now so let's go ahead now and also add the ability to add a reaction from clicking on existing reactions because currently we can only do it you know by adding it through this model here so now let's add the ability to add it by simply clicking on it so for that we already passed the unchange method so what we're going to do is we're going to extend this button to have an on click method and very simply it's going to be an arrow function which calls the unchange and passes in the current reaction value so you can easily add yours as well so if you want to add another kiss here there we go you just click on it want to remove it you just click on it and it toggles back amazing so let's go ahead now and continue developing this even further so what I want to do is I want to add a hint around this entire button here so let me just go ahead and do this there we go and let's import our hint component so let's import hint from SL hint I'm going to change this to SL components hint like this uh and let's wrap the entire button inside of a hint so this entire thing and let's give it a key of reaction ID and let's give it a label open btic reaction. count reaction. count is equal to one person otherwise people reacted with reaction. value like this so now when you hover you can see how many people or person reacted with a value and what I want to do uh next is also add a little uh plus icon here to choose an additional Emoji without going here so that's going to be quite simple at the end here let's simply add uh an emoji popover component you can get this from do/ emoji popover like this and go ahead and addit a hint of add reaction on emoji select get the Emoji and pass in the on reaction to be whoops on change to be Emoji do Native and inside add a button and then MD outline add reaction you can import this icon from react icons MD like this so now you have this plus to add a reaction and now let's just style the button first let's give the icon a class name of size four and let's give the button a class name of height 6 bx3 rounded full background slate 200 with a 70% opacity border border transparent hover border slate 500 text slate 800 Flex items Center and GAP X of one like this there we go and you can now go ahead and add an additional reaction for example and it will only appear in these messages which already have some reactions there we go you just implemented reactions amazing what you have to do now what we have to do now is Implement reply in thread functionality and then we are ready to implement one-on-one conversation and that will be the end of all the big main functionalities that this slack clone has amazing amazing () job so one thing that we have to develop before we go on threads is infinite load because if you for example go inside of source features messages API use get messages and change the batch size to three and I refresh here you can see that only three messages are loaded but we know that there are more messages so only the latest three messages so this is the latest right so this will then be appended to the last three that's not an issue right but if I refresh now you can see that the one above is now missing because we only load the last three messages in this example we're going to turn this back to 20 but I suggest that you put it to a lower number now so that you you can see this issue and now let's actually Implement a button which will load new messages and then we're going to turn that into Infinite load which is not a button but just a viewport Observer reaction so let's go ahead inside of our component here and inside of here we should find the message list right here and what I want to do is I want to go to the end of this object entries right this entire thing so right before we do the variant Channel and inside of here I'm just going to add a div here and then a little button inside load more and I'm going to add an on click here and just call the you know load more and we should have the load more inside of our props here in the message list so inside of your I believe page in the channel ID you should have the use get messages where you distruct load more and you pass it here to the message list so now I have this button load more and there we go you can see that it loads more in batches of three messages until it gets to the end perfect so that works and now let's go ahead and improve this by also adding a little loading indicator if we are loading more so I'm going to go ahead and do this if is loading more which should also be available to you as a prop here and it should be passed here through status loading more we're going to render a component we already have which is this div right here this HR element and then this span format date label date key so basically this right I want to copy that element so let me copy that let me go back here is loading more and I'm going to render that but inside of here I'm just going to add a loader from Lucid react and I'm going to give it a class name of size 4 and animate spin make sure you've imported the loader from Lucid react I'm just going to move it here so now let's refresh everything I only have three messages and when I click clod more there we go you can see a nice little indicator that it's loading more messages it's very fast right but the reason I want it to appear like that is because this will not work on a button but instead this will work on an observer so now let's go ahead and do the following let's go and change this div to instead be a self-closing div and let's give it a class name p of one so it needs to be visible inside of our viewport and then let's R an a ref let's get the element if we have the element we Define The Observer to be new intersection Observer inside of the argument here in the array get the entry open the function if entry is intersecting and if we are able to load more so can load more is also a prop you should be having in the message list component can load more it should be passed as status can load more in your channel ID page so you should have this as well so if we are intersecting with this small little pixel here and we have the ability to load more we are simply going to load more messages and then we're going to pass in some additional options here so threshold will be 1.0 like this and then let's simply do observer. observe and pass in the element ref which we get from here and let's go ahead and add a return here Observer do disconnect so we have a proper clean up here there we go so now if you refresh you can see how my messages are loading when I'm scrolling so I'm going to go ahead and zoom in a lot so it doesn't immediately load all messages so now when I go up you can see how it loads more messages until it reaches the end and all messages there we go so now no need for the button because you are for sure going to have all of your messages loaded right you can see how when I go up the more messages are loaded perfect and you can now safely go back to use get messages and change this batch size to 20 because we are able to load more than 20 messages at once you can even put it to 100 if you want to but the lower you put it uh the more you're going to see that infinite load effect great great job now let's go ahead and let's implement the thread functionality so in () order to do that let's go ahead and let's add a package bun add Nu Qs or npm install nqs or Nu let's go ahead and call it like that it's simpler and faster so now let's go ahead and let's create a hook which we are going to use to control the parent message ID so I'm going to choose the URL state to control the parent message ID the reason I want to do that is first of all it's extremely simple it's reliable and also because it will reset on every subsequent channel change here so I don't have to manually turn off the selected uh parent message ID and then keep track of is that parent message message ID in the right Channel and all of those confusing things right so I'm going to go ahead and use that inside of my URL State and that's why we just installed uh the no package here so let's go ahead and see how this package works so I'm going to go ahead inside uh of my features and I'm going to go inside of messages and I'm going to create a new folder called store and inside of here I'm going to create use parent message ID do TS I'm going to import use Query state from KN and I will export cons use parent message ID here to Be an Arrow function which very simply returns use Query State and then the actual query key which will be inside of the URL so I'm going to call this parent message ID like this so so thanks to this package Nu we will now have our usual you know const parent message ID set parent message ID use state but this time thanks to Nu it will be automatically synchronized to my URL right so something like this parent message ID will be null right so if this is null this will be my URL if I change this to 1 through three my parent message ID will change to 1 to three as well or if I manually change this to 3 to1 my state will change to 3:1 so it's going to be uh B directional here and that will help us a lot in managing our state you can of course implement this yourselves but honestly this is a great package and I am considering using this in every future project that I will be building so that's how this package will be used and I just want to separate it in its own hook here in its message feature and now let's add it into one more reusable hook which we're going to create inside of source hooks so it's going to be General like undefined for what exactly we're going to use it so let's add use panel. TS and inside of here I'm going to import our use parent message ID from features messages store use parent message ID and I will export cons use panel Here and Now inside of here I will get the parent message ID and set parent message ID to come from use parent message ID like that and then I'm going to add const on open message we will get the message ID which will be a type of string and in here we're going to Simply do set parent message ID and passing the message ID like that and on close we'll simply do set parent message ID and revert it to null and let's go ahead and let's return the parent message ID here and on close and also on open message there we go so now that we have that let's go ahead and let's use this inside of our uh layout for our workspace so let's go inside of the app folder workspace workspace ID and inside of here we have the layout with our resizable panels so what I'm going to do now is I'm going to add a constant use panel from hooks use panel so let me just move it here and in here I will destructure the current panel message ID uh parent message ID and on close and I'm going to add con show panel to be a Boolean if we have the parent message ID like this so later on I'm going to add some more elements here right so that's why I'm adding it in this way but for now we just have this option so I'm going to show the panel if this is true and this double exclamation points turn turns a string into true or false depending on if it's falsy or truthy so now let's go ahead and actually render this resizable uh panel here so let's find our last resizable panel here which renders the children and then let's do if show panel is active go ahead and add a fragment and add another resizable handle here with handle and add another resizable panel here this resizable panel will have a minimum size of 20 and a default size of 29 and inside of here we can just say load thread like that so right now nothing should really be changed but if you go uh inside of your url so I'm going to try and do this manually now and if you append a parent message ID let's say 1 2 3 there we go you can see that now we have a third panel here so our uh Nu here detected inside of Ed panel inside of Ed parent message ID which is basically just this detected that we now have a parent message ID and then that turned the show panel constant into true and that rendered another panel here great so now we're going to reuse all of those components which we've created the message the message list the chat input the editor the renderer and we're going to create a mini chat inside of this panel right here so one more thing that we have to do here is actually open this up when we click on reply in thread right so I just wanted to demonstrate to you how I do it manually you know by adding something in the ID but now let's go ahead and let's do it by clicking reply in thread here so let's go inside of our message. DSX component which is located inside of source components here let's find the message and above the use confirm let's go ahead and let's add our use panel method from hooks use panel so let me go ahead and move use panel Here and Now inside of here let's go ahead and let's get onopen message like this and let's also add on close and now let's let's append the onopen message to two toolbars that we have so first one is in the is if is compact return so find the toolbar and modify the handle thread to call the onopen message and pass in the ID of the message and do the same thing for your toolbar below there we go and one more thing that we have to modify is if we delete the message so I'm going to go ahead inside of my handle remove method here and I have a TOD do close thread if open here so what I'm going to do is uh first of all also get the parent message ID from Ed panel so I'm going to do if parent message ID is equal to the ID we just deleted in that case let's call on close so we close that thread so that's in handle remove remove message on success here now let's try it out so I'm going to refresh I don't have anything inside of my URL and I will click reply and thread and there we go we now have a new resizable panel right here and we can go ahead uh and now load the actual content inside so let's go back inside of the layout. TSX and first of all let's create a default loading State inside of here so the loading state will be a div with a loader from Lucid react so just just make sure you've imported the Lucid react loader here I'm going to go ahead and give this loader a class name of size five animate Spin and text muted foreground and I'm going to give the div a class name of flex height full items Center and justify Center so by default if there is an additional panel opened it will be a loader like this but if we have the parent message ID in that case we're going to go ahead and render uh a div and thread inside otherwise we're going to go ahead and render the default loader here like this so let me just improve this by adding the parenthesis up there and there we go now it's more readable and I will just join these two together like that uh so if we have the parent message ID we will load the thread otherwise it's a loader so that will be an edge case it should never technically happen but you know just in case we will have a fallback here and now let's go ahead and instead of rendering this div let's R render the thread self closing component which will have the following the thread will have a message ID which will be a type of parent message ID as ID make sure you import ID from data model in convex now remember inside of our use panel use parent message ID this is by default a string and you no gives you the ability to add custom types but not to the extent uh where you can add U for example the type we need ID from convex right so technically that is a string and we can leave it as a string here that's completely fine so what we're going to do is just add add ID of messages here that's how we're going to resolve that issue and let's go ahead and add on close here to be onclose of course you know types will not mess up your code it will just mess up the linter here so let's go ahead and create the actual thread component so that will be located inside of features messages inside of here and let's go ahead and let's create a new folder components and inside let's create a thread. TSX like this and inside of here I will create an interface thread props with a message ID which will be a type of ID messages and on close which will be a void method and let's export con thread here let's go ahead and let's destructure the message ID and on close method from thread props and inside of here let's go ahead and return the basic uh thread inside so I'm going to go ahead and give this a class name of full height flex and flex call inside of that I'm going to add a div with a class name Flex justify between items Center adding of four and Border bottom and then I'm going to add a paragraph thread and then I'm going to add a button from components UI buttons to make sure you have this as well and the button will simply be an X icon from Lucid react which will have a class name size five stroke 1.5 the button will have an onclick of on close a size of Icon small and a variant of ghost and in side of the thread here we're going to have a class name text large and font bold so now let's go inside of the layout and let's actually import the thread from features messages components thread I'm going to go ahead uh and move this here like that there we go so we should now have the thread component loaded here and there we go so I should now be able to close it as well so now if I click here that opens the thread and if I click like again it closes the thread like this there we go so we can now control that and now let's actually load the message that we have selected when we click here and now that I think of it I think it would be cool if the thread header had the same height as my chat header here I think that would be cool to match so let me just see inside of my thread here uh I just have a padding for set here but inside of my header component inside of uh workspace workspace ID channel channel ID header I think instead of here I have defined the height yes I did so height 49 pixels and PX of four let's do that in the thread so instead of P4 it will be PX4 and it will have a defined height there we go this is now much much cooler uh great uh and now let's go ahead and let's load that initial message so we're going to go ahead back inside of the thread here uh and let's prepare our use get message if we even have that hook let me just quickly check we don't we have used get messages but we are missing uh the individual uh get by ID so let's go ahead and create that so we have to go back inside of our convex folder and inside of messages. d s and we have the you know Global get method here now let's create the get by ID so export con get by ID will be a query which will accept arguments and ID V ID messages and then a Handler which will be an asynchronous context and arguments method here and we're going to do the thing we always do which is check if we have the user ID then we're going to go ahead and load the message M using a wait context database get arguments. ID if there is no message we're going to uh throw new uh actually this is a query so we're returning things right we are not throwing errors so return n return now like this uh then let's go ahead and let's get the member so const member will be await populate member which will be context and message. member ID like this if we don't have the member we will return back null then we need the user so const user will be await populate user context and member user ID if we don't have user again return null we can't populate this message completely in that case and if we have all of those uh what's left is to uh get the reactions so const reactions here here will be await populate reactions context and message undor ID and then what we have to do is we can copy from our get method here how we uh do reactions with counts so we can copy this reactions with counts and let's add it to our uh get by ID method here like this there we go and now we have to add the duped reactions so that's in the same method here but below it so const duped reaction and let's copy the entire thing with this initial value and the type here so let's go ahead and add that and see if perhaps we're going to have to do some changes so back instead of the get by ID here there we go looks like it works perfectly fine it only uses the reactions with counts which uses the reactions everything else here is pretty normal great so we now have reactions added let me just see where this ends so it ends here great uh and now we also have to copy the reactions without ID property without member ID there we go here it is so let's add that as well and now we have a one-on-one match of how this message would look like in the get all messages API endpoint it will look the same now and be populated in the same way when we individually load it great and now let's go ahead and do return spread the entire message image will be message image if we have it we're going to do await context storage get URL message. image otherwise image will be undefined then we're going to have a user a member and reactions which will be reactions without member ID property and this will just be member not member ID there we go uh and what I also want to do here is just prevent uh non-member users from accessing this so I'm going to add const current member here uh will do we have a short hand for that yes we do get member so we can pass in the workspace ID and the current user ID let's do that so let's go inside not inside of remove not inside of update there we go inside of get by ID once we get the message if we confirm that it there the message exists we're going to do current member is await get member we're going to pass in the context message workspace ID and the currently logged in user ID if we don't have the current member that means you cannot load this message right because you don't have permissions you're not part of this workspace so if you somehow hit this endpoint we're not going to give you anything back and then we can continue with populating uh the member of the this so this is the current member which is trying to access the message and this member is the member that actually wrote the message Mage so we are populating that member and that user but we don't have to populate the current member we just have to confirm it exists great so we now have get by ID so let's go ahead inside of features messages API the same way we had use get messages copy and paste it and now create use get message like this go inside of use get message rename the type to use get message props and add it here use get message props like this uh oh and I picked the one that uses the paginated query let's go ahead and just use any other it's going to be simpler uh for example channels API use get channel just copy everything inside go back inside of your messages API use get message make sure you are inside of this new one don't accidentally override your use get messages so be careful and you can remove everything from here and paste the use get Channel and rename this to use get message it will accept the ID of messages add the use get message props here this will be use get message and this will be API messages get by ID there we go we now have used get message individually inside of our features messages API we can now go back inside of our thread component and we can go ahead and get use get message individual message right ID message ID so that's why we had to type the message ID to be an ID of messages because our API will only accept that kind of type right so that's why inside of my layout here I had to use this as ID messages because by default this is just a string which you know is technically correct this is also a string but it also gives convex some specific context which we need so that's why using that kind of trick uh great so inside of here we're going to have data and we're going to have is loading so let's go ahead and Alias that to something else here so I'm going to have the data to be my message and is loading will be is message loading or simply loading message now let's go ahead and let's add some loading States here and some error States here so I'm going to do if loading message you can go ahead and return uh well the exact same thing we had for example here in the workspace ID layout so just this loader that we keep using I probably should have created a reusable component for this at this point so feel free to do that if you want to create a reusable component for you know this kind of loader so if it's loading message we will display a loader here in the thread uh if there is no message uh let's go ahead and do the following so I actually want to copy this entire thing here like this and then outside of this div here I will just add and copy this for example and instead of loader it will be alert triangle from Lucid react so make sure we've added alert triangle here and we are not going to do animate spin here and we're going to add Flex Flex column and GAP y of two and below the alert triangle we're going to add a paragraph message not found so this will happen in case it's been deleted while our thread was opened so let's add a class name here text small and text muted foreground like this uh and I think that should be enough so now uh let me also go ahead inside of the individual message here inside of the div I'm going to do Json stringify the message that we just loaded there we go so this is the message now that we load here so when I go ahead and click this there we go you can see all the attributes and thing and now if you go ahead and delete the message oh what actually happens is that we get that caught inside of our message. vsx there we go we close uh the uh the panel if the parent message ID from the URL is active to the ID which we just deleted so if I comment this out for example and refresh my page and just open a random message here and then I delete that message is this one yes basically so if I click delete message there we go now it will have this kind of state message not found and I think that's a pretty cool state to have here uh great and I also actually want to have one more case so let's bring this back instead of thread here uh let me go ahead and change this to true so I want to see this loading state so this loading state is fine but it doesn't give me the ability to close this so what I want to do is I want to copy the entire thing from if there's no message and just add it here and then let's just bring back the loader here remove the text and add animate spin back so now it will be loading but you also have the ability to close it in case it's been loading you know for too long here like that there we go so I want you to always have the ability to close uh your thread from here so bring this back to loading message uh there we go great so uh what I want to do now is I want to be able to actually uh load the individual message so let's go ahead and do that in our main return here so instead of this div Json stringify message we're actually going to go ahead and render the message component from component message Mage so our reusable component here and we're going to give it all the properties we need so first of all we're going to activate the hide thread button because we are not going to be able to open another panel from here right so hide the thread button the member ID will be message member ID we're going to have author image to be message user image we're going to have althor name to be message username we're going to have is author for now let's just put it to false body will be message body image will be message image created ad will be message creation time uh updated at will be message updated at ID will be message uncore ID uh we also added the image we have this okay reactions will be message. reactions is editing will be false and set is editing set editing ID will be an empty Arrow function for now so now you should have something of a message here there we go so you can see that now we can at least see the message that we are planning on replying here so it's not exactly perfect but but it's visible right here uh great so now let's go ahead and let's give it some more options now let's add the necessary properties so that we can properly add the is althor and is editing Fields inside of this message which is now nicely displayed here every time we click reply in thread so I'm going to go ahead and I'm going to load the current member so const data will be current member use get current or is it use current member like this and let's go ahead and pass in the workspace ID let's get the workspace ID from used workspace ID here so make sure you've imported both of this like this and I will just change this to features messages API use get message so I can separate the features Imports now we have the current member here and what we're going to do is we're going to go inside of the individual message and we're going to check his author to be if message. member uh member ID is equal to current member ID and let's add a question mark here so now we will be aware if this is an author or not so I can you can see from here I can edit and delete my message but if I open someone else's thread then I can just add a reaction here but it looks like we do have some issues regarding this Emoji uh does it happen all the time so here it doesn't happen here it also doesn't happen I don't know if this is like an edge case I will explore that a bit further maybe we got something useful in here I don't know but it looks like it goes away after refresh but we can certainly come back to this I will try it out every now and then to see what's happening with this uh great okay this is fine let's see if adding a reaction here works there we go so I can re add a reaction from here I can add it from here I can remove it from here and I can remove it from here perfect uh what I currently cannot do I believe uh is let's see can I delete the message from here I can delete it awesome uh but can I edit the message from here I cannot okay so let's enable that so we're going to add the editing ID inside of the thread here so const editing ID set editing ID will be used State and now by default and it will accept an ID of messages or null and we have to import use state from react so let me just move that here to the top editing ID and set editing ID and now we can go ahead and pass in the is editing here to check if editing ID is equal to the message ID and set editing ID can be set editing ID here let's trite out like this so now if I click here rename in sorry edit in thread and click save there we go we can now edit in thread as well perfect so we now finalized the thread load the message functionality so what I want to do next is I want to load the editor here and be able to send a reply to this thread great great job now let's add the editor component () to our thread sidebar here so let's start by importing our next Dynamic import so import Dynamic from next Dynamic and then let's go ahead and Define const Editor to be dynamic import add components editor SSR bols there we go we now have our editor component we're going to add it here so after this encapsulating div around the message let's add a new div and let's render the editor inside let's give this a class name of PX4 let's go ahead and pass in uh the onsubmit method for now to be an empty Arrow function let's go ahead and give it a disabled of explicit false let's give it a key well we can't do anything yet so let's just keep it like this for now and a placeholder of reply like that so now already there we go we should have the reply uh input right here excellent so now let's go ahead and let's actually Implement some of the methods here so the first thing I want to add is is I want to add the create message and use generate upload URL hooks here so I think it's very useful if we open up chat input component because we could copy and paste a lot of things from here so chat input inside of source app workspace workspace ID channel channel ID chat input so we can actually start with all of these things as well let's copy these two states editor key and is pending and let's add it to our thread component here like this then let's also add the editor ref here let's import use ref from react and quill from quill so I'm going to move Quil import here like that besides editor ref let's import these two create message and generate upload URL so I'm going to add them below these two and maybe even separate them because these are queries and you know these are mutations so let's at least separate them like this we also have to add the Imports for use create message and use generate upload URL so let me go ahead and copy these two as well I'm just going to add them here there we go so now we have editor key is spending editor ref create message and generate upload URL now let's also go ahead and copy the create message values here and let's add it below our thread props and let's slightly modify it so we're going to need the channel ID the workspace ID but also the parent message ID which will be an ID of messages like this because this will be a reply let's also add the channel ID here from use Channel ID hook so let me just move the hook here there we go and I believe we now have everything ready to reimplement our on submit method so we can copy that as well from the chat input component here let's copy the handle submit entirely here I'm going to copy it and let's see if we have anything missing here looks like we only have the toast missing which is great uh okay let's go ahead and do that let's import toast from sonor whoops is it toast like this there we go toast from sonor and what's missing in this handle submit method in the you know thread component which we've just copied from the chat input is that inside of the values here I'm not passing the parent message ID which I have clearly defined here that it's required right so it's not required in the general chat input here but it is required here because this is the thread response right so let's go ahead and add that to our values here so after workspace ID let's add parent message ID to be the current message which we have just loaded or we can just use the message ID here right so you can either use the data message. ID or you can use the message ID and add a comma here there we go so now we should be able to you know add replies so let's see if this is true or not the the problem is we will not be able to see that yet so if I go ahead and add hello reply and press enter uh oh and I think there's one more thing that I have to uh do here maybe I have to also pass this a variant of thread no okay nothing my my apologies I confused the two so if I go ahead and press this nothing happens because I never passed onsubmit so let's go inside of here and let's actually pass handle submit here a key of editor key uh a disabled of is spending and inner ref of editor ref so you should have all of this the editor key because we copied it the handle submit which which we just modify the editor erf here and is pending which is controlled here let's try this again so I will now go ahead and also prepare my data here my messages and I hope these are sorted by creation so I'm going to go ahead and add a reply here there we go so no errors which means this worked and hopefully it also passed the parent message ID here right hopefully this was also submitted and what I can already see is that it didn't appear here in the main uh get messages right so if you go ahead and check out the let's go ahead and do this uh where is it my channel ID page. DSX so inside of here we use the use get messages and we pass in the channel ID let's see do we have inside of uh API messages get do we actually have the logic to filter out uh those without parent message ID great so we use the filter here uh we basically Bally pass this as null okay great now let's go ahead and try out and see are these my latest messages I'm not sure but looks like they are because in this one and not a single other I have the parent message ID and there here it is here is the message let's see what this message says edit in thread and let's see there we go that was exactly the message I replied to and what I replied was I think reply or something so if I go back to messages here and click on this body reply here perfect so it is definitely working what we have to do next is we have to add our own little version of message list here so it actually loads the reply messages but also does the whole infinite thing loading the infinite loading thing so in order to load the replies here I want to close everything besides the thread component and open the message list component we could technically reuse the message list the problem is it will cause some scroll issues right so it's a very nitpicky reason from my side why I don't want to reuse it and you know it's definitely a better practice to reuse this component which we created to be reused but uh you know it it just happens that it Scrolls in such a weird way and it's hard to modify the message list component to handle both the uh Channel variant the conversation variant and also the thread variant with featured message on top it can be done but I honestly just think it's easier to copy some uh features here from the message list inside of the thread here and we're going to have our messages here and later you can play around and try and reuse the message list component in a certain way so let's go ahead and do that so I'm going to go ahead and go inside of the uh thread and let's do the use get messages here so I'm going to get const data messages and actually I forgot that use get messages is a paginated query right so instead of our use get messages which we can get from here or with at slash features messages API use get messages depending on where you wanted uh we are actually returning some other things so we are getting the results status and load more and instead of the use get messages we have to pass in Channel ID and also parent message ID which is message ID so this parent message ID is very important because I want this to only load the replies to this message ID which we open right I don't want it to load everything else just the replies for this for example so now let's also Define uh the can load more and is loading more constants so can load more is loading more the same way we do in the message list here I believe uh where is it oh I think we actually do that in the channel channel ID page right so we are basically doing this right great so we have that we have load more we have these two uh and now let's go ahead and let's Implement our grouped messages uh trick so we can group them by date so let's go inside of the message list and let's copy the grouped messages here you can copy them and before you do your first return here go ahead and add grouped messages now this will not be data instead it will be results like this and we have to import uh well first we have to change this to be a type of results as well and we have to import the format from date FNS so let's just go ahead and move this to the top like this we have grouped messages now and let's also modify this if loading the individual message which we are replying to but also if the status is first loading first page in any of those cases so if we're loading all replies to this also show the little loading indicator right okay so we now have grouped messages here which is great we can now use them so what I want to do now is go here where I have my div which encapsulates the featured message and let's modify this div now where is it uh okay let's modify this div so it has this Flex right here right so Flex One Flex Flex SC reverse padding bottom four overflow y AO and messages scroll bar so I'm going to add this to this div which is encapsulating the individual message so right now this is set at the bottom because we use flex call reverse so what we're going to do now is we're going to add the messages here in the code above the featured message but in reality it will be below the featured message quick reminder we are using Flex called reverse because we are loading the messages in reversed order right so we are not loading more content as we scroll down we are loading more content as we scroll up right so that's why we do this logic so now what I want to do inside of here is well uh go inside of the message list and copy our object entries thing right we can copy the entire thing right the entire object entries and we have grouped messages we're going to have to add this format date label here uh we have to import the difference in minutes I suppose and we already have this component so let's see what happens I'm going to go ahead and paste that here I'm going to indent it and let's fix error by error bug by bug so format date label is missing and I think we can just copy that from here format date label you can also you know uh add it in a reusable util uh in our usable utils file so let me just add format date label here in my thread component let me import is today let me import is yesterday uh so all of this from date FNS and that should fix one error so let me go here to see there we go so we can now load this and now inside of here we are missing the difference in minutes which is just an import from date FNS as well besides this we're missing the threshold so let's go ahead and copy from the message list here and let's also add it here I'm going to do it above the thread props there we go so that resolved that issue and now we have the hide thread button which we can just you know set it manually to true because we know we are going to remove it everything else I think should be just fine we have the editing ID set editing ID message member ID current member ID you know everything else is exactly the same so so let me go ahead and try and refresh this and see if anything has changed or not oh I still have some errors here oh no I don't okay so if I write reply there we go this is a reply awesome we can now see the replies here uh so now let's go ahead and also finish up by adding the infinite load here so I'm going to go back inside of the message list and instead of the message list I can still see oh we're not using these two things we're going to use that later okay so after we do the whole object entries we have this Observer div so let's go ahead and copy The Observer div and let's also add it after our object entries so in the thread components that's just above the featured message here so let me add that here and I love when it has no bugs at all perfect we have everything we need here we have the load more distructor from here perfect and now let's also add the is loading more and that will be the entire thing we need because we don't need this right we don't need the channel hero so just add this at the bottom and we should have the is loading more here we already have the loader and that should be the entire thread functionality now so if I go ahead and open this there we go it loaded the one from before so I can now send a lot of messages here and they will all use the same you know uh uh infinite load method they still have all the Compact and non-compact rules I can add reactions to them I can go ahead and edit if I'm the author I can delete them everything is working just fine the only thing I can't do is open a thread where we are looking at a reply message right so I can only open threads from Main messages here hello there there we go amazing amazing job what's left to do is to implement direct oneon-one conversations now let's implement the () individual oneon-one conversation so we're going to have to fix this 404 page so let's quickly go ahead and r visit our user item inside of source app folder workspace workspace ID you should be able to find the user item and double check that this is the hre it's redirecting to SL workpace workspace ID member and then the individual ID of the member so let me go ahead and create that route we're going to go inside of source inside of the app folder workspace inside of workspace ID just like we had the channel we now have the member member and inside of here we're going to have a member ID inside of square brackets and inside of that a page. DSX file let's go ahead and return this member ID page div member ID page and now let's go ahead and try and visit a user again and there we go we are now redirected to member ID page right here great so what I want to do now is I want to mark this inside of use client like this and I want to prepare my workspace ID from use workspace ID like this and I also want to create a use member ID so let me go inside of hooks we have used Channel ID and use workspace ID so let's copy one of them and rename them to use member ID inside of here rename the hook to use member ID and return pam. member ID as ID members now let's go inside up the page and let's also add con member ID to be the new used member ID go ahead and simply Json stringify member ID and workspace ID here so we can see it happening there we go this is my member ID and this is my workspace ID so I should be able to switch things now for example and go you can even choose your yourself right so this is my member ID and this is my workspace ID perfect but to test this out properly I would suggest picking up another user but you will be able to have conversations with yourself as well that will be fully supported great so now what we have to do is whenever we visit this website we have to either find an existing conversation with Member One and member two ID or create a new conversation if those two members never spoke before so let's go ahead and create that we're going to go ahead and go inside of the convex folder and let's create a new conversations. TS a endpoint here and let's export const create or get and let's make this a mutation from generated server like this inside of here we're going to have some arguments and we're going to have an asynchronous Handler in the arguments we're going to request a workspace ID from v. ID workspaces and make sure you import the values from convex and besides the workspace ID we're also going to have the member ID with uh whom we are trying to chat so members I mean member ID and workspace ID so then we have the context and the arguments inside of the Handler here and let's start as usual so we get the user ID from our out which you can import from slou we get the user and we protect the route in case the user ID is missing now let's get the current member to be await context. database query the members with index by workspace ID and user ID query equals workspace ID arguments workspace ID do equals user ID our user ID and unique there we go so only members within the workspace will be able to uh create this uh types of conversations right so now let's go ahead and let's do other member will be await context database. getet arguments member ID so we are talking this is the member uh ID uh to whom we are trying to chat with and this is us right so now we're going to do if there is no current member or if there is no other member we cannot initiate this conversation so just throw new error here member not found and now let's attempt to find an existing conversation between these two members in this exact workspace so const existing conversation here will be await context. databasequery conversations and unfortunately we can't use the index here because we don't know at which position member ID 1 will be or member ID 2 will be so technically we could have two indexes you know both in reverse order and then call two different uh you know queries yeah maybe that's a solution if you want you can experiment with that but I will use you know filters here so query equals first of all let's do query field workspace ID needs to match arguments workspace ID that's the first thing so we are looking inside of this workspace ID and then chain another filter and then inside of here you're going to do qu query. or so one of these two combinations query. end in the first combination we are going to check if the field Member One ID matches the current member ID and if the field member 2 ID matches the other member ID so that's the first combination and then we copy this and do the reverse thing so if Member One ID is the other member and member two ID is the current member so the reason there can be two uh combinations possible is because it will depend on who initiated the conversation and then later on when the user when another user tries to visit this conversation perhaps the conversation already exists so we can't always guarantee that the user trying to access this will be number one that's why we have to check for both combinations so make sure you do this uh properly and of course chain this with unique like this and then what we are going to do is if if we have an existing conversation we're going to return the entire existing conversation here otherwise we're going to create a new conversation right here so wait context database insert conversations and we're going to pass in the workspace ID to be arguments workspace ID Member One ID will be our current member underscore ID and member 2 ID will be other member ID and then you can get the entire conversation here by doing a wait uh context database get conversation ID which we've just created in case we are not able to get that conversation which we've just created we have to throw back a new error here because something is wrong so conversation not found and then we can return the new conversation which we've fully queried here so this endpoint will return the entire conversation object inside of a promise here like this great now let's go ahead and let's create the use create or get conversation so let's go ahead inside of source features and let's create a new folder conversations inside of here let's create a new folder API and let's copy a mutation for example inside of members uh we don't have one inside of messages I think we have use create message so copy that and paste it inside of conversations API and rename this one to use create or get conversation so the more descriptive better right and now let's focus on this so the request type inside of here is the workspace ID and the member ID and both are required so this is an ID of members and it will return back a document of conversations so make sure you add the doc file and you add conversations here and then this will be use create or get conversation hook and inside of here we're going to use the api. conversations. create or get and this should not throw any errors anymore and the response type should be the entire conversation with the ID workspace ID Member One ID member 2 ID all of those things perfect so now that we have this mutation let's go back to our newly created page which is located inside of the app folder inside of workspace member member ID page. DSX and now uh what we're going to do is the following const data mutate and is pending from use create or get conversation and pass in uh whoops this is a mutation I forgot so uh we don't pass that here we will pass it later when we execute the method so again make sure you have the use client boundary here in the page and now we can safely use use effect inside of here so when the user mounts on this page we're going to go ahead and actually call the mutate method here and pass in the workspace ID and the member ID like this and then simply have the member ID workspace ID and mutate inside of your dependency array here and now we're going to do if is pending we're going to return a div and let me just find you know any loader really you can just copy any of these which we've wrote a 100 times already so I'm using the example from let's see uh join workspace ID page. DSX basically just any loader copy it and paste it here let's add the loader from Lucid react so I'm going to go ahead and move both of this to the top there we go uh so if it's pending that's what we're going to return we can copy and paste this so in case it's not pending which means we've passed through this but we still don't have the data we're going to return alert triangle from Lucid react we're going to turn this into Flex Po and GAP Y 2 we are going to remove the animate spin here and we're going to add a span which will say conversation not found and we're going to give the span a class name text small and text muted foreground make sure you've imported the alert triangle from Lucid react and then we are finally uh going to Let's stringify the data which we found here so now if I I go ahead and refresh here okay so it says conversation not found so let's see why that is happening uh let's see we should have the data here in the use Creator get conversation uh we are calling mutate here so how about we do on success here and get the data and com a log the data and on error uh let's go ahead and get get the error and conso log the error so let's see what's going wrong here whether we are actually doing this or not so I'm going to refresh this and uh looks like we have the data right here so this is created so why do I still get that error if it's spending and this is if no data has been found and then inside of here we stringify the data that's interesting what if I go ahead and click here again same thing uh seems to happen all right let's go ahead and debug a little bit here I think it's because the data itself from coming from the mutation is not exactly the most reliable thing uh let's see whether we are doing something wrong here set data uh maybe when we call this mutate again the data gets reset to null perhaps that's what's Happening Here set state this do we clear the data Maybe I think this is all right so let's see uh inside of page member ID what happens if I do a console log of the data so I want to watch the process happening here let's see it's null in the beginning yes and then you know we have data here and then it's null again uh all right so let's debug why that's happening uh per perhaps we can use this how about we do Conversation Set conversation use State like this and make it null by default and give it a type of document uh which will be conversations like this so let's kind of put it in a state maybe that will improve it but then we we can't keep it reactive yeah that's an issue uh okay let me go ahead and pause and see how we can resolve this all right so we are not going to rely on the data coming from a mutation uh to render our things inside of here this is what we're going to do instead we're going to add a state conversation ID set conversation [Music] ID and use State and go ahead and make it null in the beginning but give it an option of ID conver ation or now and go ahead and import the ID and we don't need the document from here and what I'm actually going to do is I'm going to revisit my use create or get conversation inside of the mutation itself so the Endo in the convex folder and I'm going to do the thing I always do I will just return the IDS right that's the only thing I actually need so inside of here I'm just returning the I don't even need to do this part I can just return the new conversation ID that's it and then let's go back instead of the use create or get conversation and let's modify the response type to be the ID of conversations as it always was up until this point and what we're going to do now is we're going to go inside of page here and inside of the on success we're simply going to do set conversation ID data like this and on the error I I don't think we even have to do anything or well we could and we could just do a toast error fail to create or get conversation and import toast from sonor so at least the user is alerted if something goes wrong here uh and now I'm going to use that the conversation ID and I'm just going to pass in the conversation ID here let's see if that will improve this there we go so now inside of here I should get the conversation IDs so if I go ahead inside of my data now and check inside of my conversations there we go this is one of the conversation IDs right here and they are connected to members perfect so this way our page is stable because it relies on the state which we set here and that this is what we're going to use you can also remove the data from here we're going to use this to create our main component here which we are going to call conversation so let's go ahead and add conversation here and pass in the ID to be data data uh actually just the conversation ID like this there we go and the ID will never you know update so we don't have to worry about that we just have to redirect to this component and now let's actually go ahead and create the conversation ID component so inside of the member ID here let's create a new file conversation. DSX let's go ahead and create an interface conversation props it will accept an ID which is a type of ID conversations let's export cons conversation here let's return a div and let's assign and destructure the props so ID and conversation props right here we can now go back inside of the page. DSs and we can import the conversation from do/ conversation like this and you should now just see a text which says conversation here or actually no because we don't uh render anything inside which is good because it means this is the component that is currently loading uh great so what we have to do now is we have to implement or we have to reuse the use get member uh use get member hook let's see inside of features inside of members do we get used get members no uh we have used get members but we don't have the individual uh use get member so let's go ahead and Implement inside of convex inside of members we have the current we have you know get let's go ahead and let's do expert con get by ID which will be a query and let's do arguments ID v. ID of me mbers and let's pass in the Handler which will have the context and the arguments in here and now let's go ahead and let's do the usual thing which is checking if the current user trying to access this is logged in uh then let's go ahead and do const member to be await context. database. getet arguments. idid if we can't find that member we are immediately uh just going to return back an early null here uh then let's go ahead and do const user to be await populate user pass in the context and member. user ID and if there is no user we cannot load this member so return back now and then return uh the spread of member with a combination of user inside like this there we go and you should have the populate user helper above uh one thing I also want to do here is once we confirm that we uh have the member let's also confirm that the current uh member exists so I'm going to do await context database query uh members here with index by workspace ID and user ID let's get the query query equals workspace ID will be the member uh workspace ID and we're going to to chain user ID to be user ID if there is no current member it means this user is not part of that workspace so we are not going to load the user they want right so let's just confirm that this is all right we are querying by members using by workspace ID and user ID uh we confirm that the workspace ID is from the where this member we are trying to look for is located in and comparing that with this user ID I think this should be just fine and now let's go ahead inside of our source folder inside of our features inside of members and let's copy the existing use get members and paste it and let's rename it to use get member like that let's go ahead and rename the props to use get member props let's rename this to use get member and the only thing what did we say we need we need the uh my apologies it was just the ID okay so we need the ID of the member this will be the ID then and this will be get by ID there we go uh all right now let's go ahead and let's go back inside of our page so Source folder app folder workspace member member ID conversation. TSX right here and inside of here we are going to go ahead and load the member so const member ID will be use member ID from Hook use member ID make sure you've added that and then we're going to go ahead and add use get member here from features members API use get member and inside of here we're going to pass in the ID uh to be the member ID passed like this inside of here we get the data which is the member and is loading which will be member loading like this perfect uh and and now we are also going to do the following con results status and load more from use get messages from features messages API use get messages and since this time we have conversation ID and not Channel ID nor the parent message ID that's what we're going to use that's this ID prop right here so let's add conversation ID here ID there we go and we now have result status and can load more here so let's go ahead and quickly go back to this page and let's just copy uh this if is pending here and paste it inside of the conversation. PSX the is pending will this time be if member loading is true or if status is loading first page and let's import the loader from Lucid react as well there we go uh we now have this ready and now let's go ahead and run a div here with a class name Flex Flex column and a full height like this and now what I want us to do uh is I want us to add a header component here like this and I want to reuse the existing header which we've had I believe it was the workspace ID channel there we go so we need this header so let's copy this entire header and paste it inside of member ID this time and you can import it from here so let's import header from slhe header right make sure you're doing this inside of your member member ID we just pasted the header here right and now you should have the header and now we will just slightly not in Channel ID make sure you're modifying this one now we're just going to go ahead and you know slightly uh modify this header I think it's going to be even simpler actually so the props will be member name which is is an optional string member image which will be an optional string as well on click which will be a void like this and then expert con header here uh we'll have the member name which will be defaulted to member in case we cannot load it member image will be here and on click will be here like this uh and the only thing we're actually going to need out of pretty much everything here yeah we can remove all of this things right it's going to be a much simpler header component so remove this entire thing and you know just add the avat fullback to be member name character at zero to uppercase that's the only thing we currently care about uh the this div with this class name is fine you can remove the confirm dialogue from here uh and you can actually remove pretty much everything inside this is a huge component you can remove everything inside of this div right and what I want you to add here is a native button element you should already have this important I believe we have way too many Imports now so just leave the button which is the one we need inside of this button uh we're going to go ahead and give this a variant of ghost a class name of text large font semi bold bx2 overflow hidden and width of Auto we're going to give it a size of small and we're going to pass in the on clip click here to be well just on click from our props actually uh like this and we now need to import everything from the Avatar itself so Avatar Avatar fullback and Avatar image from components UI Avatar and let's go ahead and add the Avatar here let's add a class name of size six and Mr of two inside let's add an Outer Image here let's give it a source of member image and now for the Avatar fallback I just want to render the Avatar fallback inside and I don't think we need to add any class names because I think we've uh added this which uh essentially makes it default uh gives it a default look every time we use it and outside of this Avatar create a span element with member name next to it and give the spanic last name of truncate and then add an fa Chevron down from react icons fa so I'm just going to move this here there we go and let's go ahead and give this a class name of size 2.5 and mL of two like this there we go so let's go back inside of the conversation here and now let's give it some uh proper uh inputs so I'm going to give it a member name here of member question Mark user uh oh looks like we uh let's see so I have this member here from use get member get by ID so we have the member and I have the user oh I accidentally wrote user ID here when I meant to write user so confirm that inside of your convex members uh instead of get by ID you return a spread of member and then the user I was accidentally passing user ID so that's why my user object did not exist here where I'm trying to pass it so this will be member do user dot name then we're going to have a member image which will be member do user. image like this and on click for now will just be an empty Arrow function so now we should have a nice header here there we go you can see how it looks great both on those that have an image and those that don't have an image perfect and it has the exact same style as our channel right and later this will open uh a sidebar similar to the ones we have uh For Thread replying here but we don't have that implemented yet all right so what I want to do now is I want to add a chat input here so let's go ahead and close everything else and let's focus on the chat input so we can also copy the chat input from our workspace workspace ID channel channel ID here so let's copy that and let's paste it inside of member member ID on the same place we had the header there we go we now have the chat input here and I think all inputs should be working you know just fine uh and the only thing we're going to change here is the chat input props so it's going to accept the placeholder but also a conversation ID which will be uh a type of uh ID conversations so why am I passing this as a prop well remember my URL does not have the conversation ID I only have member IDs right uh so that's why we are going to have to explicitly pass this conversation ID here uh and I think that what we have to modify further is remove the channel ID from this chat input so make sure you're modifying the one inside of member member ID here instead we're going to be working with conversation ID which will be an ID of conversations like this uh and then inside of here we can D structure the conversation ID like this uh you can remove the channel ID and you can remove the use Channel ID import entirely here and now when you get to the values instead of passing the channel Channel ID you will pass the conversation ID here like that and everything else I'm pretty sure can stay exactly the same uh I don't think there should be any change at all so let's go back inside of the conversation now and let's add the message uh my as the chat input from do/ chat input here let's give it a placeholder of message and then use member do user do name and give it a conversation ID of the ID prop and there we go now it says message my name here if I pick another user it uses their name in my case they are both the same perfect and now we can reuse our message list component from components message list so let's go ahead and add that uh somewhere here like this let me just go ahead and align this there we go and now let's go ahead and just add these results we which we have here to the message list right so data results like this variant here will be conversation so you should have that inside of your message list uh the message list props should have a channel thread or the conversation variant but there's one thing missing here uh which is this so we only have the channel hero we should also create the member hero so we're going to add that later and then we're going to use these the member ID uh the member name and the member image here so let's go ahead and give it a variant of conversation a member image which will be member. user. image a member name which will be member. user.name the load more which will be load more is loading more which will be status loading more and can load more which will be status can load more but I think this is already enough for us to start you know sending some private messages so I'm going to say hello world and there we go and let me just go ahead and fix one more thing here so uh you can see that I'm currently talking to this user but they are not selected so let's go inside of the workspace sidebar which is located inside of source app and I think you know just the workspace component itself not uh okay so this one workspace ID and inside of here we should have the workspace sidebar correct and instead of the user item here let's do the following let's add is active or variant here and we also need the member ID so let's quickly add that here because we now have that useful hook so const member ID will be use member ID so you can already see why we need to use the member ID in the URL instead of the conversation ID otherwise it would be 10 times more complicated to keep track of which conversation ID relates to what member ID inside of our sidebar like it would just be too difficult to handle so let's go ahead and do this if the current Item ID is equal to the member ID inside of our URL in that case it's active otherwise it's default and there we go perfect let's go ahead and double check this by logging out here and let me log in into my other account and let me go ahead and make sure that I I am in the GitHub workspace and click on this other user and there we go these are the messages here and I should even be able to reply in thread here so reply in thread in oneon-one convo there we go we can handle that as well and amazing and I just noticed that we are missing uh one important thing which is that when I reply in thread I should have an indicator that there are existing replies for this message uh great but before we do that which we can handle in the next chapter I want to wrap up the one-on-one conversations by also adding a nice little uh like we have you know for channels this hero I now want to implement the member hero so let's go ahead and do that I'm going to go ahead inside of my message list component and we're now going to leverage this member name and member image so let's go ahead and copy the channel hero rules here if variant uh is conversation here and if we have the member name and if we have the member uh image we're going to go ahead and render the conversation hero here and we are going to pass in the name which can be member name and we can pass in the image which will simply be member image and now let's go ahead and let's develop the conversation hero here so I'm going to go ahead inside of the components and create conversation DH hero. DSX like this let's see if we can copy anything from Channel hero so let's copy the entire thing and let's paste it inside of the conversation hero let's rename this all instances to conversation hero so con ation hero props and this will be an image and also a string and let's make both of them optional because they are not required to exist I believe oh we actually no we don't have to it's fine so this will be an image in this case uh margin top can stay the same this can stay the same and now inside of here let's remove uh let's actually keep this so this is fine font B items and that's okay uh but let's just remove this let's just keep it font uh text to Excel and font bold and inside of here we can just render you know the name of the member and this channel instead of writing this we can write inside this conversation is just between you and and then use a strong element and render the name of the other member like this and then we also have to add our Avatar example here so let's just add Avatar here and let's do our usual so I'm going to add a div here with a class name Flex items Center Gap X of one and margin bottom of two inside of here I'm going to add our Avatar component with a class name size 14 rounded MD which we actually don't need so just MR2 Avatar image which is going to have a source of member image which will which is actually just image here sorry uh let's go ahead and create our Avatar fback here to use the name prop character at zero to uppercase and then inside of here we should be able to just pass to Avatar fullback the Avatar fullback uh like this okay and let's also put this paragraph here here inside of this div like this and let's go inside of the message list and let's import the conversation hero from do/ conversation hero here and now if I refresh this let's see uh I still don't have that so why is that let's see I'm passing in the variant to be a type of conversation here and let me revisit my let's see inside of the uh not work space ID uh member member ID conversation I have the message list I'm passing the member image I'm passing the member name here and I'm passing the variant conversation so what exactly is making this not uh render anything if I write something here this is working but uh I'm not seeing this let's see why for a second all right I think I know what it is uh yeah so I can see it on regular users but I can't see it on users who don't have an image because of my rule set here so let me remove this rule set and let me go inside of conversation hero and make this optional and make this optional and pull back the name to member there we go so now there we go this user has their own hero header as well amazing so now we can also quickly explain uh finally our underscore conversation ID which appears a couple of times here so I told you that when we use the get method here uh we have this Edge case where we don't have conversation ID and we don't have Channel ID but we have the parent message ID so when does that happen well for example inside of a one-on-one conversation inside of a thread this is that exact case loading this messages is that case we don't know what conversation does this belong to why well let's take a look if we go inside of our thread here let's see what happens so we have uh the channel ID and the workspace ID right but inside of conversation we don't have the uh Channel ID right we have member ID which is not something we can send at all so when I go ahead and call the handle submit method here and I pass in the channel ID this is undefined but this is not and also the conversation ID which is an option is also undefined right I can almost never pass that through URL so both of these don't exist in that case let me just not mess this up but parent message exists so I detect that here and I know that's the edge case and that's how I uh get the actual conversation ID from the parent message and same thing happens in this submit form in the thread as well so let's go back inside of the thread here so you can see the same thing happening here right uh I can't send the channel ID I I only have the parent message ID so that's the only thing that can happen and here inside of the uh where where is my use get messages same thing no Channel ID so that's the edge case I was talking about I hope it's a at least a little bit clearer now uh great so what we have to do next is we have to fix uh our thread indicator right so if there are replies we should have a little indicator here below that there are replies and we also have to implement the user profile so we can change the role great great job now let's go ahead and let's () implement the thread bar component so I want to go back inside of my message. DSX inside of my source components here and first of all let's go inside of the if is compact return and after we pass the reactions let's add the thread bar which we are going to create so the thread bar will have a count prop which will be thread count it's going to have an image which will be thread image it's going to have a Tim stamp which will be thread timestamp like this and let's go ahead and copy this and let's add it right here uh in the lower return like this and now let's go ahead and create the thread bar inside of the components folder so thread dasb bar. DSX let's create an interface thread bar props and let's go ahead and give it a count of number and optional image of string timestamp of number on click an empty Arrow function and let's export con thread bar and let's use the thread bar props here and let's destructure all the necessary Elements which are count image Tim stamp whoops and on click like that now let's go ahead and do the following if we don't have the count or if we don't have the timestamp or if we don't have an image let's return null so for now we were only going to be able to test this on users that have an image meaning use a Google or GitHub login to test this out and now let's go ahead and let's return a native button element here we're going to give it an on click off on click that's going to be uh the first and the simplest prop here and now let's go ahead and give this button a class name padding of one rounded MD hover background white border border transpar parent cover border border Flex items Center justify start we're going to go ahead and give it the name of group slash thread dasar this is important don't just give it group because we already have group inside of the message component after that transition and a Max width of 600 pixels that is the entire class name for our button and now inside of the button let's go ahead and let's add a div with a class name Flex items Center Gap two and overflow hidden inside of here we're going to add the Avatar so let's go ahead and prepare the import Avatar Avatar image and let's add an avatar foldback here like this and I think we can copy it from somewhere we probably can let's see instead of the message component itself we already have it the Avatar let's just copy it and let's just paste it inside there we go let's go ahead and give the Avatar a class name which we are going to uh be which is going to be size six and Shrink zero The Source will be image and the Avatar 4 back here will for now just be the letter M as in member and let's return this actually let's remove this actually so image will not be required just the count and the time stamp will be required to so we don't render null right so we now render the Avatar callback here Avatar fullback and outside of the Avatar itself add a span element and go ahead and give it a class name text extra small text Sky 700 hover underline font Boldt and truncate and inside of here add count and then if count is larger than one replies otherwise reply then another span with a class name text extra small text muted foreground truncate group- hover SL thread Dash barar so group hover should be exactly like this and then slash exactly what you wrote here whoops in the first div thread Dash bar so make sure that you don't misspell this so if we hover on the thread bar it will become block but otherwise it's hidden by default and inside of this span we're going to write last reply and then format distance to now from date FNS so let's add that import and go ahead and pass in the Tim stamp and add the options add suix to be true and continue writing actually that's it we didn't have to write anything else and below this add a span view thread and give this span a class name of text extra small text muted foreground truncate group hover SL thread bar will be block otherwise hidden as well and already uh actually let's go inside of the message. DSX and let's find one of the threadb bar with errors and let's now import it from do/ threadbar and that should get rid of our errors here and you should now start seeing uh the replies here as you can see there we go we have the replies great let's go ahead and develop them further uh so now what I want to do is I want to go outside of this div and add a Chevron right which you can import from Lucid react so I'm just going to add it here like this and give it a class name of size four text muted foreground ml AO opacity zero group Das hover slash thread Das barar like this opacity 100 transition shrink zero and that will be it like this so there we go you can see how this looks like now uh and let's just see can I improve this text uh view thread so let's go ahead and do this uh I made a mistake here so one should be visible by default and one should be visible on Hover so let's do it like this uh for the last reply blah blah blah we're going to change the group hover thread bar to be uh hidden on Hover right but block by default so now there we go you can see how it says last reply about 4 hours ago but when I hover it says view thread and now we just have to give the ability to this uh uh give the ability to this thread bar to actually do the on click so let's go in setad of the message here and our on click here will simply be onop message so let's find the first thread bar and let's give it an on click on open message and pass in the ID and then copy this and find the second thread bar here and just add that here so now when you go ahead and click here there we go that opens the thread perfect so we now have a much better thread functionality but we have one mistake so for example if the last reply is from the user that does not have an image we can exactly render that so let's fix that and in order to fix that what I believe we have to do is we have to revisit our messages. TSX in the convex so our API here and specifically this big get query so somewhere in here we are populating the thread there we go populate the thread so what we have to do is go inside of the populate thread method let's open it and let's give it some more use useful information so I'm going to go ahead and also add a name here uh to just be an empty string like this and let's go ahead and add a name here to be an empty string and then finally let's add the name here and let's see can I do so I am populating the member uh can oh we have the last message user perfect so name do name there we go so we now also have the name of the uh last message that sent the image but we're not done yet so now that we have the populate thread uh let's go ahead and actually go back inside of the get query we now have the thread here which has the name which is a new field now and we have to go down here and add alongside thread image let's also add thread name here thread. name like this there we go let's go back inside of the message. TSX here and I think we also have to modify the props now so we have a thread uh image here let's also add thread name here to be a string and let's also add the thread name here as well and now we have to go to the message list component I believe uh am I in the wrong let's see where are my messages here actually oh I have collapsed them my apologies so they should be inside of here there we go so inste of your message list find where you return the message inside of this whole big uh you know map and just as you've added the thread image you can now add the thread name here it be message. uh thread name and let me just go ahead and do a quick search of everywhere where we are doing this so two places message list and also the thread. DSX component even though technically this should not be happening here but go inside of your uh Source features messages components thread. TSX and find the message here and add the thread name here to be the message thread name like this so now all cases of the message components should have the thread name uh well at least those uh that matter and now let's go ahead and see if we can modify our thread bar to also accept name which will be an optional string let's get the name here and let's give it a default value of member right here like that and let me copy one out our fallback from literally anywhere so I will just copy this one from the user item component and I will paste it here so Avatar fback here will be the name and then we can use the outter fullback instead of the M letter so just outter fullback like this let's go back instead of the message. DSX because we're not done yet uh we also have to add this to the other thread bar which I'm missing here so thread name okay so make sure that both of your thread bars now have the new thread name prop which we have just passed throughout our message list uh all the way and there we go we now have that edge case solved as well amazing so you now have uh the fully working thread bar what we're going to develop next is the ability to open user profile and to change their role great great job now let's go ahead and let's implement the member profile so just as () we've implemented the thread panel when we click here we get a new URL appended here the parent message ID and then the thread opens inside of here now I want the the same thing to happen if I click on the user image or their name so let's go ahead and let's start by copying our use parent message ID hook which I believe is inside of features messages store so use parent message ID so I'm going to copy the entire store folder and I'm going to add it inside of the members folder here and inside of here I'm going to rename this to use profile member ID I don't want to call it use member ID because we have that inside of hooks right so this is simply to extract it from params but what we are developing now is to get the profile of that member so let's call it like that let's rename this to use profile member ID and let's simply rename the key of the query state to be profile member ID there we go now let's go ahead and let's go inside of our hooks use panel. DS and let's import use profile member ID now what I want to do is I want to add the unopen profile so we can copy and paste this onopen message here and let's rename it to onopen profile and the Pam here will be the member ID and it will set profile member ID and set profile member ID from use profile member ID so let's go ahead and pass in the member ID here and let's use set profile member ID here on the unopen profile like this but now that we have both of this available uh I know that they will not be able to be opened at the same time so every time I open a profile I will set the profile member ID but I will also set the parent message ID to null and I will also do the reverse in the unopen message so I will do set profile member ID to null like this and the on close I will always close both of them so set profile member ID to null here as well and then go ahead and return the profile member ID here and onopen profile here as well there we go that's our Ed panel and now we have to go back inside of our workspace layout so that's inside of the app folder workspace workspace ID layout DSX and inside of here we can now also destructure the profile member ID so we can add if we have parent message ID or if we have profile member ID make sure you're using double exclamation points here and here so if any of those exists in the URL we're going to show an additional panel and now inside of here we're going to decide whether we are showing the thread which is already solved here and let's add an additional if Clause here so if we have profile member idid in that case go ahead and open another option and then add an else here again and inside of here we're going to add a profile component which we are going to create and let's go ahead and pass in the member ID here to be the profile member ID as ID members so we're using the same trick as above and let's passing the on close to be on close there we go so now we have to go go ahead and develop the profile component so let's create that inside of the features folder inside of members and let's go ahead and create a new folder components and inside of here a new file which we are going to call profile. DSX like that let's create an interface profile props to accept a member ID which is a type of ID members and an unclose method here which is a void then let's export const profile and let's assign the profile props here member ID and on close let's go ahead and return a div profile so this should be enough for us to at least be able to open a specific profile let's go ins set of a layout and let's import the profile from features members components profile so as we did right here I'm going to move it here alongside with the thread uh great but we don't really have any way of opening this at the moment except by manually adding profile uh is it profile member ID yes it is it's profile member ID there we go and then you can see the profile here opens but if we click on thread for example you can see that the profile uh is no longer the part of the URL only the parent message ID is the part of the URL so only one can be opened at the same time so let's go ahead and properly open this by clicking on a specific member so for that we have to revisit our message. PSX inside of source components here and we are not using anywhere the member ID here which we always pass so now we're going to use it so from the use panel uh let's also do on open profile like this and now let's find all the places where we need to add this and I already noticed something here so we have this is toggling reaction from use toggle reaction let's just add it to this is pending so is toggling reaction like this great and now let's go ahead and use the onopen profile so in the compact message there is nothing to click on that can open the profile right so nothing here should really open the profile but in the main message clicking on the image and on the name should open the profile so let's go ahead and let's find uh let's see where is the Avatar component oh so let's go to the main return here right and this button which encapsulates the Avatar will now have an onclick here which will be an arrow function on open profile and pass in the member ID like this and we're going to have it in one more place which is inside of this else so if not editing we're going to have this button of the author name so let's go ahead and just assign that on click here as well on open profile member ID so now if you click on this name there we go the profile opens if you click on the thread the thread opens we can close the thread and if we click here there we go the profile opens as well perfect and both can be overridden and if you look at your url the profile member ID changes depending on which user you click on now let's go ahead and let's actually uh develop the profile so I think we should also keep our thread open just in case we want to quickly uh copy something from here so the first thing we're going to have to do is we're going to have to get the member so I believe we've developed that recently inside of my members API there we go we have used get member perfect so let's go ahead and let's do const use get member and let's pass in the ID to be member ID and let's import use get member from do/ API use get member like this from here we can structure the data which we can remap to member and is loading which can be is member loading or is loading member like this and now let's go ahead and let's copy uh some of our existing uh loading States here right we can copy the if no message and if uh loading message and it will just slightly modify so I'm copying this from the messages components thread here because it's quite similar so first of all we're going to modify this if is loading member we're going to go ahead and add a button component we're going to go ahead and add an X icon here from Lucid react so all of these let me just go ahead and move this here let me move this to the top like this let me add the loader from Lucid react like that and this is the data so if no member in that case we're going to go ahead and say a profile here in the top and let's have an alert triangle here from Lucid react and let's change this to member or profile not found right uh so now while you are loading here uh let's go ahead and see can I uh can I mark this as true for example and okay so it still says thread here in my loading so let's go ahead and change this to profile like this there we go so you now have the profile option when you click on thread it loads the thread here is the profile option which can be closed if it's loading for too long so let's change this to is loading member here and this is if no member is available so let me try and hard coding this to true as well see what happens there we go profile not found so in case the user gets deleted while we are opening it there we go we have that solved as well uh and now what I want to do is I want to render the proper uh preview of the user here so let's go ahead and let's copy this uh let's copy the entire div here and let's add it here like this and now we're going to go ahead and slightly modified here so so this can stay profile like this and then inside of this div here what we're going to do is the following this will be the body right so I'm going to change this to let's see item Center Height full I just think I don't want the Gap here and I don't need the height full justify Center is also fine and let's give it a padding of four instead so I just want a larger space here let me right here so you can see I just want like a larger space here in the beginning of the user profile file and inside of here what I'm going to do is I'm going to render the user Avatar so for that let's go ahead and let's import everything we need from the Avatar component and inside of here we're going to add the Avatar The Avatar image and the Avatar P back and now we have to do uh what we usually do here so let's create a fallback quickly here when we load the member so let's ensure that after we have the member let's add a constant fullback so that will be member. user.name or we can just use an M for the fallback in case we and let's call it Avatar fallback right the member comes from this uh use get member so now we have out our fullback which we can add here so now there we go you should see like a big uh like a small uh user profile here uh and let's also add a source here to be member user image there we go so if they have an image they will have an image otherwise you can see it's just their profile uh and now let's go ahead and let's style this so I'm going to go ahead and give this Avatar a class name of Max with 256 pixels Max height of 256 pixels and size four uh so now inside of here this looks fine but looks like my avatar fallback here does not work well so what if I give this a height full uh looks like it doesn't work what if I give it an aspect Square there we go so now it's a little bit better like this and let's also go ahead and give this a text of extra large or 2 XEL four Excel do we have six Excel there we go so now I think it's the same size as the uh uh the regular image one there we go so that's kind of the preview of the profile which we're looking and it should be kind of scalable as you can see uh uh let's see if this is as well there we go so they both seem to behave the same all right and now let's go ahead and let's uh further develop this so below this div encapsulating the Avatar we're going to prepare the room for some buttons right and some contact information so we're going to have class name Flex Flex call and padding of four here then inside of here a paragraph member. user.name So now inside of here there we go we have the name of the user let's give this paragraph a class name of text extra large in font bold like this and then uh let's go ahead and uh well I want to skip what we have to do next which is uh we have to develop like the buttons to leave and change rle I want to do that later so instead I'm going to go ahead and first finish the contact information so let's add the separator from components UI separator make sure you've added this like that and then go ahead and add a div and you can copy this class name so I just want to keep the same spacing here and I'm going to add a paragraph contact information so there we go after my name we should have the contact information here and let's go ahead and give this a class name text small font bold and margin bottom of and then inside of here I'm going to add a div with a class name Flex item Center and GAP 2 I'm going to add another div which will encapsulate a mail icon from Lucid react so just make sure you've imported mail icon from Lucid react let's give theem mail icon a class name of size 4 like this let's give the div encapsulating the mail icon a class name of size 9 rounded medium background muted Flex item Center and justify Center so like a little container for our icon here like this there we go and then outside of that we're going to create a div which will hold the user email information so this will be a class name Flex Flex column let's add a paragraph email address there we go let's go ahead and style the email address text here to be text 13 pixels font semi bold text muted foreground like this and let's add a link component from next link so make sure you've imported the link from next link I'm just going to move it here with the uh Global Imports and the H ref here will be open btics mail to member user email like this and class name will be text small power underline and text will have a special hex color of 1 2 6 4 A3 like this and inside we're going to render member user email and let's see if this works and there we go you can now see various user information in their profile right here perfect the only thing I kind of worried about is scaling this uh this special alatar fullback type because we use this huge test next uh so let's go ahead and see if I you know zoom in a lot yeah I mean this is a very no weird Edge case but okay looks like it never overflows which is fine uh great so we have that and now what I want to develop is I want to develop the options to change the user role and to kick the user or if the user is you know looking at their own profile they should have the ability to leave the workspace uh great great () job so now let's go ahead and let's implement the change roll and remove or leave workspace functionality so let's go in set of convex inside of our members API here so far we've developed the get by ID the get and the current queries so now let's go ahead and let's export const update which will be a mutation which we have to import from from generated server here it will accept the arguments and our asynchronous Handler for the arguments we want the ID which will be an ID of members and we also want one thing we will be able to change about the member which will be the role so that is v. Union and then two options admin and member like this and we have to add this inside of the arguments object my apologies so ID for the member which we are trying to update and then the role which we are trying to update in here we get the context and the arguments like this uh let's go ahead and get the user ID from await out get user ID and pass in the context if there is no user ID we're just going to throw new error unauthorized here then let's get the current member which is a wait context. database query members and uh well we have the query by workspace ID but we don't yet have it so let's first do con member which we are trying to update is await context database get arguments ID if there is no such member we're going to throw new error back member not found and then we can continue with the current member query so we're going to using the with index by workspace ID and by user ID let's get the query and let's go ahead and do query equals workpace ID to be member workspace ID and user ID to be our user ID and let's add unique and now if we were unable uh to found to find uh the current member or if current member role is not an admin in that in any of those cases we will not be able to proceed further with making this change so let's throw new error unauthorized here and then finally let's go ahead and do await context database patch arguments ID roll arguments roll and let's go ahead and let's return back arguments ID here for the member we are updating there we go so now that we have that we also have to develop the remove method so we can just copy the update method and let's call this one remove and this will just take the ID of the member here like this we can do the exact same logic here the current member if there is no current member or the role is not admin in any of those cases uh we are going to uh prevent the user right so what I want to do now is also add some additional checks here before we do this I will add a to-do remove member so there are some specific things we have to check before allowing anyone even an admin to do this so first of all we're going to do this if the member we are trying to remove is an admin we're going to throw new error here admin cannot be removed we will not be able to remove admin so we first have to downgrade them to members uh then we're going to check if is self by using the current member ID and check it with arguments ID then we're going to check if is self admin as well we're going to check if current member role is an admin like this so oh we already checked for this if we are an admin so we don't have to do that up there right so inside of here we're also going to do if well we can just do this in the if Clause my apologies so if we're trying to remove ourselves uh we're also going to throw new error here unauthorized like this but I just realized that uh this will not allow us to remove ourselves from the workspace right so this is how we are going to do this uh we're going to remove this check here in the remove method right so the first thing we're going to check is like this if the member we are trying to remove is an admin we won't be able to remove them then if the current member is trying to remove themselves and also if that member is an admin then we're going to throw back the error so if current member. roll is in admin we're going to go ahead and throw cannot remove uh self if an admin self is an admin right so we we cannot remove ourselves if we are an admin but uh we are going to allow ourselves to remove ourselves in other combinations so now let's write await context database delete arguments ID but before we can try this out we also have to delete all relations here so let's go ahead and let's prepare all the messages reactions and conversations that this member has created so await promise all like this so in the first uh item in the array we're going to query the database or messages that this member has sent so messages with index by uh member ID query query equals member ID member ID and let's also add collect here so we get all of them so that's the messages here then we're going to have to query all reactions that this member added and we have the same Index right so inside of your schema you can see that for my messages here I have by member ID and for my reactions I also have by member ID so I can easily remove all of them when a member leaves and let's go ahead and add one more here uh so this one will be conversations and the reason the way we're going to check this is by using a filter here so do filter query query or the first thing we're going to going to check if the field Member One ID matches member ID like this perhaps we can put this like this there we go so either this combination or member 2 ID equals the member ID right so we're going to check if there are any conversations with us as the member inside so in the second is reactions and in the third is conversations like this and then before we do the remove removal of the actual uh member we're going to do four const message of messages AWA context database delete message ID and then we can go ahead and duplicate this two more times and do the same thing for the other entities here so this will be for const reaction of reactions delete the reaction ID and for con conversation of whoops conversations remove the conversation ID there we go so we now have the ability uh to remove and to update our user so let's go ahead and create the hooks for that so inside of the source folder inside of features here inside of members inside of API uh let's find one maybe messages API use create message uh so copy this one and paste Bas it inside of members API use create message and let's rename it to use update user uh update member like this make sure you're inside of this new file let's go ahead and uh change some things here so we need the member ID or is it just ID I think uh which we have to do some members here and we will also need uh to pass in the role which will be either admin or member so these two and it will return back the ID of members back and let's change this to use update member and let's change this to be API members update and let's see what exactly is wrong inside of this so members. update here ID of members and role of ADD admin or member role of admin oh the ID is required yes like this there we go no errors for the use update member we can now copy and paste this and create a use remove member method and inside of here there will be no role let's call this use remove member and let's change this to API members remove and there we go we now have the new use remove member and use update member M Hooks and we can go back now inside of our source features members components profile. TSX let's go ahead and let's add them to our mutations here so const use update member and const use remove member so both of them are available here like this because they are in the members folder so you can access them from here in the API just by going back and let's go ahead and let's D structure the mutate here and let's call it update member and is pending will be is updating member then we're going to have a mutate here remove member is pending is removing member there we go uh what I want to also do here is initialize the use current member as well so we need that that will be quite helpful so we can see if we are an admin or not can we actually do this so use the current member here we'll have the data of current member and is loading uh is loading current member and inside of here we have to pass in the workspace ID which we can get from use workspace ID from hooks use workspace ID there we go so we we now have uh pretty much everything we need here and let me just use the is loading current member here as well in this is if is loading member like this so if we are loading the current member or or if we are loading the member we display the spinner here uh great so now let's go ahead and see whether we can actually uh display those options to the user or not so after our out our fullback here uh we're going to go ahead and develop uh just below this member username we're going to check if current member. roll is an admin in that case go ahead and let's do the following let's check if current member ID is equal to member ID so in this case it basically means let's go ahead and write it like this for now it basically means that we are an admin and we are trying trying to uh look at our own options here so let's go ahead and let's give ourselves a button here and the button will very simply have a member. roll option and a Chevron down icon from Lucid react and let's give this a class name of size four and mL of two and let's give the button a variant of outline and a class name fullwidth and capitalized so I think that now if you click on yourself here uh oh but we also have to confirm that we are an admin right so we are not an admin of this workspace but if I go ahead and pick maybe the one where I am an admin and click here there we go you can see that I have this big admin button now like this uh great all right so we have that option uh and now what we have to do is we also have to add another button next to it which will be remove like this and we should encapsulate this into a div with a class name Flex items Center Gap two and margin top of four there we go let's give this remove button whoops a variant of outline a class name of with full and capitalize well this one doesn't need capitalize right this one needs it because member. roll is lowercase right there we go so we now have the options to change the role and to remove ourselves from here uh okay and I think that this tary way of doing if Clauses has confused me a bit so what we're seeing right now should be the view for a an admin looking at another person's profile right so we ourselves when we click here should not see remove we should see the leave option and since we know that inside of our backend logic we ourselves we not be able to change our uh role right so we should just see the leave option here if we are not an admin for example so let's go ahead and quickly fix this so the first Clause is correct if the current member role is an admin and if the current member ID is not the member ID then we're going to Showcase this so there we go now if I am an admin and I click on myself I see nothing yet right but if I go to another workspace here uh let's or so what I have to do is log out now and just go back inside of my other account here which is an admin here so let's just try it out uh so now if I click on another user and click on their profile there we go you can see that now I have the proper options here so I'm an admin you can see this is my different account here and I'm clicking on this other user I can now see their option that they are a member and I have the option to remove them but if I click on myself I don't have any options yet so that's what we're going to develop now so now let's add an else here if Clause if current member question mark underscore ID is equal to member ID so if we are looking at ourselves this time and we also have to do another check so if we're looking at ourselves and if the current member role is not admin in that case we're going to have just a single button here and let's immediately add an else null here we're going to add just a button here leave like this so let's me just go ahead and give this a variant to this button and let's give this a class name margin top of four like this uh so let's see yeah if I'm an admin I should actually not have any options for myself so I shouldn't be able to change my role and I shouldn't be able uh to leave the server if I am an admin right because the server needs to have an admin but if I go ahead and log out now and if I revisit my other account like this and go inside of the GitHub workpace where I'm not an admin I should have the big leave button but I don't have the button to change anyone's role and if I click on an admin for example there we go I don't have I can't do anything for them I can't kick them and I can't change their rules so that's what we wanted to achieve great so now let's go ahead and let's implement the leave and the remove role which which will be used by individual users who want to leave themselves or admins who want to kick a user and let's also implement the uh on Roll change right so I I should not have used turnery here I'm sorry for that feel free to you know separate this into some more readable constants but let's go through it together so if the current member is an admin and it's looking at a profile that's not theirs they're going to have the option to change their role and to remove that user otherwise if this current user is looking at themselves and they are not an admin they will be have an option to leave right so there is a leftover case okay what if an admin is looking at themselves well we don't want them to to give them the ability to do anything right because we need to have an admin in the server uh all right so I know it's a little bit confusing so feel free to pause and uh carefully you know uh copy this part okay uh so now that we have that let's actually add uh some methods here which will have some nice toasters and stuff like that so let's start with the uh on remove and on leave methods so const on remove here we'll call the remove member method and it will pass in the ID member ID which we have from the props here on success here we are very simply going to do toast. success member remove and let's go ahead and call the toast from soner and let's also do the on close method here so inside of our thread when we deleted a message for example uh or actually it's inside of our message. DSX uh where is it our handle remove inside of here we had to check if the parent message ID matches the currently opened ID that's because the message component can be deleted from anywhere so for example I can open a thread here and delete the message from here so that's why we had to close the thread like that but in a profile we will only be able to delete a profile from the panel so we can safely uh you know close it on success here and on error here we have a toast error failed to remove member great so we have this now let's copy and remove and let's go ahead and let's create an on leave which will be exactly the same but it will have different toast messages and also we're going to have different confirmation models later so now let's go ahead a you left the workspace and let's go ahead and add failed to leave the workspace like this and one more thing we have to develop is the unroll method so we can copy and paste the on leave one for example and let's go ahead and create an unroll change or let's call it simply on update and let's accept the uh role value of either admin or member let's go ahead and let's use the update member and let's pass in the role here and on toast success it will be R changed on toast uh error it will be failed to change roll like this uh and now let's also Implement our confirmation dialogues here so we're going to need a leave uh let's go ahead and the leave dialogue and confirm leave use confirm from hooks use confirm let me just move it here like this so inside of here we're going to tell to the user uh leave workspace and then are you sure you want to leave this workspace we're going to copy this and then we're going to add a remove dialogue and confirm remove which will say remove member are you sure you want to remove this member and we're going to have a update dialogue and confirm update this will be change rooll are you sure you want to change this member members role like this so now let's add the update dialogue leave dialogue and the remove dialogue uh to our code here so I'm going to wrap the entire thing here inside of a fragment so my main return method right like this and I'm going to add the remove dialogue the leave dialogue and the update dialogue and I'm going to go back to all of my three methods here the on remove will become asynchronous now and it will have a const okay of a made await confirm remove if not okay we do an early return same thing for the on leave turn it into an asynchronous method and go ahead and check this but instead of confirm remove this will be confirm leave so the user is prompted with different questions and then we have an asynchronous on update here and this will use the confirm update great so now let's go ahead and let's use the on remove uh and on leave methods because for the on update we still have to implement the drop down so let's use the on remove somewhere let's go ahead inside of here and let's see at the logic we have so we have the button remove so that's the one that should be called for removing someone right here and for the leave it's this one on leave so let's see what option do we have here so since I am not an admin inside of this workspace I am a guest and I would click on myself there we go I have the option to leave the workspace and let's see if it works there we go I left the workspace you can see this fallback of ours member member M right and we can also improve this on leave so when we leave somewhere we should probably redirect the user away from this workspace so they don't see this broken screen so con router use router here from next navigation like this let's go ahead and on uh on leave we're going to go ahead and do router replace let's just push the user to the RO page like this and let's see what happens if we do this there we go so some errors but that's fine right I just don't want things to break there we go you can see how this looks like now a complete failure from their part uh excellent so now uh I want to see do I have uh do I have any server where I have two users where I am an admin let's see uh inside of this hello world what am I here am I an admin yes I'm an admin here uh I can see that by this as well so let me go ahead and log out and let me continue with GitHub here for my other user uh so it's sign up here in invite so I'm going to go ahead and send a hi there message so we just tested out that leave is working and now let's test out the role change and the uh remove user so I will go ahead and log out here and I will go back inside of my other account where I am an admin uh there we go so there we go I have the option to remove this user now but I don't want to test out just yet because I first want to develop the uh member functionality here the role change because we just confirmed that the API endpoints to remove or to leave works and it's exactly the same endpoint so you know it's it's not a problem so let's go ahead now and let's add everything we need from the drop down menu so I'm going to add that here the drop down menu the content the trigger the radio group and the radio item so now we're going to have to turn this button where the member roll is into a drop- down where it will have basically uh more options to change so let's go ahead and Mark Mark the entire button inside of a drop- down menu then go ahead and give this a drop down menu trigger and then as child prop then outside of the drop down menu trigger add a drop- down menu content and let's go ahead and give this content a class name of with full and let's create a drop- down menu radio group and a drop- down menu radio item which will say admin here and let's go ahead and give this a value of admin in lowercase to make sure you have the radio menu radio uh drop down menu radio item and radio group and let's give the group value here a default value of member. roll on value change will call the RO and pass in the on roll on update roll as admin or member and now let's also add another drop- down menu item here to be member and the value of member like this so now when you click here there we go you can choose between admin and member and when you click you should get a confirmation here so if I click confirm here role has been changed and there we go you can see that this is now an admin here and I believe that we won't be able to remove him there we go so failed to remove member so uh can I change the role let's see so I can change the role because I'm also an admin right but I cannot remove them while they are an admin I can remove them now so let's double check this so let's see if this is actually an admin I mean it is right it's an admin we can log out a confirm let's go ahead and go inside of my GitHub here uh my invite workspace so now there we go I can change the preferences I can delete the workspace which means I am an admin right and for example for this other admin I can now downgrade them there we go they're now downgraded and I can also remove them now so let's remove them there we go that member has been removed and you can see how their messages have been removed as well amazing amazing job now let's go ahead () and let's add some to-dos which we wrote so I'm going to search my entire project for to-do and I see one in channels. TS right here inside of convex channels. TS inside of my remove mutation when I remove a channel I also want to remove all Associated messages from that channel so let's do that I'm going to go ahead and add a constant messages from await promise all and inside of here I'm going to add context. databasequery messages with index by Channel ID and let's add a query Checker here query equals Channel ID to be arguments ID and let's collect all of those messages and then inside of here we can do four cons message of messages await context database delete message ID there we go but besides that I think I'm also missing something in inside of my workspaces so let's go inside of the convex workspaces here and let's focus on the remove mutation here as well in the workspaces So currently the only thing I remove after I delete the workspace are the members so let's go ahead and copy and paste this and let's now remove all channels so everything has the exact same query bu workspace ID for reactions bu workspace ID for the messages by workspace ID for conversations for the channels ensure that you have this index in pretty much all uh except workspaces in our tables right so we remove the channels now after channels we have conversations after conversations we have the messages and after messages we have reactions and then we have members in the first one channels next conversations messages and reactions like this and then we can copy and paste this for con channel of channels delete channel ID like this then let's go ahead and copy this again for con conversation of conversations delete the conversation here then for const message M of messages remove message ID and last one will be all reactions we have in the workspace so reaction of reactions whoops reaction ID so now removing the workspace will pretty much Clear every single thing we've created uh inside of it uh great so we have that resolved what I want to do now is just check do we have any empty on clicks for example uh let's see we do have inside of conversation. TSX great it's a good thing we checked for that so let's go inside of source app workspace workspace ID member member ID conversation and inside of here we have a header so that is referring to this when we click on when we go inside of oneone conversation we have this header which currently does nothing right so let's go ahead and get our use panel import from hooks use panel so we are doing this inside of the uh conversation. DSX here inside of the member ID make sure you're doing it inside of the member ID here and let's do the uh onopen profile here like this and then I'm going to pass in the on click here on open profile member ID which we should have here from the use member ID so now when I click here there we go I can now talk to users uh in that way as well let me check do I have uh any Channels with multiple users looks like not now but yeah you can just click here now and it will appear right here uh great let's check if we have uh any disabled set to false we don't perfect so we don't have any leftovers so what I want to do now is I want to add a little command tool when we click on the search here which will load all users and all channels so let's go inside of our toolbar which is located inside of source components here and inside of here uh is it the toolbar uh let me just see no it's not the toolbar my apologies it's the nov bar uh how did they call it header uh let's see uh I'm not sure where this is located so it should be inside of let's see workspace the toolbar right here so this is the toolbar I intended to use great so this one search and then data name for your workspace which we loaded here uh so what I want to do here is I want to add the command uh component from shaten so let's go ahead and pick our uh installation here so I will use bun shat latest add command here and now that we have command let's go ahead and let's import everything we are going to need here from the command inside of this toolbar I'm going to add it here like this and let's see how we use it okay so command we have the command input here uh let me just see I think they should have an example of command they do right here and how does the code for that look like okay let's see so it starts with the command dialogue being wrapped around and where exactly is oh okay so that's how we're going to to do it let's go ahead and copy this command dialogue here this entire thing like this and I'm just going to add it uh let's see where can we add the command dialog here well I think we can just add it below the button here like this and what we're going to do now is I have to intend this entire thing right but uh also let's Okay so we have command empty we have command group and let's just have one command item here which will be test item and let's remove every other command item until we reach the end of the group and then we have the command separator and then let's have another one here which will be uh another test item so I will simplify this for you so you can pause and copy it there we go so this is our entire uh code right so command dialogue command input here and then command list with two groups one for suggestions and one for settings like this now let's go ahead and implement the open and set open here so open set open use State and false and import US state from react I'm just going to move that here like this there we go so now by default I think that should not be visible so what we're going to do is that when we click here it should open up that dialogue so let's go ahead and add a button here on click set open to true so now when I click on search invite there we go it opens up this command dialogue and inside of here I want to have uh my channels and my members so let's go ahead and try and Implement that here so I'm going to change the heading here to be channels and here it will be members like this let's go ahead and add our loading here so I'm going to move this here and let's get use get channels and I think I can just pass in the workspace ID I believe it works as simple as that use G channels from features API use get channels and inside of here we should have the data channels and then we should have the members so this will be use get members and also by workspace ID so we should have all of these hooks by now because we are basically doing the same thing we did in this sidebar here we are loading the channels and the members so now what we're going to do is inside of the channels group we can go ahead and go over channels question mark map get the individual Channel and render the channel item here uh the command item with channel. name inside so let's see if I click here there we go my channels so if I go ahead and create a a new channel and click again here there we go we have the option of a new channel here perfect and now let's go ahead and do the same thing but for my members here so we're going to look through members get the individual member and we're going to do member and now can I do user name I can perfect member user.name there we go we also have the members now perfect and what I want to do now is give them some can I use an hre here I can't can I mark them as link like this and can I give this as child prop I can perfect so let's import link from link is it like this there we go link from next link and let's give this an hre of Slash so for members it's workspace workspace ID member and then member ID let me copy this link and add it here for the channels and close it and then we're going to use channel so Channel and channel ID so I think that now when I click in this there we go it should open the channel right but the only thing that seems to not be happening is that it does not close uh so can I add an unclick here set close uh set open po will that redirect and close at the same time time now it looks like it does not okay uh so what we're going to do instead is the following we're going to Define const on channel click which we'll call set open to false and then we're simply going to do con router use router from next navigation so make sure you add this here as well there we go and if the channel has been clicked we will do a router. push and we can just copy the one from here so we request the channel ID inside of here which will be a string like this and then copy and paste this oops on channel click this will be on member click member ID member member ID and then we can just add the UN clicks here so I'm going to call this on channel click Channel ID like this and remove this link we don't need it and same thing here no need for as child and on click here we'll simply do on member click member ID and remove the link from here and I I think that now it should both redirect and close so if I click here oh looks like the on click is not working uh okay so let's just quickly see uh why that's happening I think it's because of on click we should use on select here so let's try that now if I click this there we go so now we can use this to look for members or to well uh switch channels amazing amazing job now I want to fix this flashing () effect which happens every time we refresh which is also this warning we have that one of our panels does not have a default size so let's go ahead and fix this layout shift by going inside of the source app folder workspace workspace ID layout. DSX and let's find the resizable panel which encapsulates our children and let's give it a default size of 80 so I'm not exactly sure what are the limits of how this sizing works I assume 100 is maximum so if the default size of this panel is 20 I suppose this one is left with 80 right so now when you refresh you can see that there is a much much lower layout shift happening here and even if you have a panel opened it looks great excellent so we no longer have that large large layout shift there is still a shift if because of our local storage right so we added the autosave ID here so during server side rendering it doesn't know uh where it will resize there is a fix for that if you want to you can explore the resizable panel uh let me just find it the resizable uh react resizable panels has a guide on keeping the layout shift from uh with cookies alongside local storage so that way it will be already known on server side but I think this is already an improvement over what we had the second thing I kind of want to resolve is this Emoji picker so if you want to you can leave it as it is but you know a few times in my project it crashed so let's see whether we can add another Emoji picker let's go inside of the Emoji Pop over here and basically we're using emoji Mart uh I Googled and it does have some weird issues but I couldn't find a way to fix them so now let's do buned Emoji picker react which is a package uh from npm here and let's import that instead inside of the Emoji popover component so let's import Emoji picker from emoji picker react and let's render that in here so it will just be Emoji picker and we don't pass in any data and instead of on emoji select uh this will be on emoji click and let's remove the imports from emoji Mart here and the on select here will pass an emoji but I have no idea what this Emoji actually is so I will first do a console log of this Emoji here and I will comment out everything else so let's uh try this out again so I will refresh this and I will open a console uh my inspect element here so let me try and click Emoji it definitely opens the Emoji bar that's great and if I click this I get the Emoji back and so instead of native it is Emoji right so that's the different that's the difference so I will go ahead and send this in on emoji select but now we have some problems right so let's find the Emoji Pop power component and I think we're using it in two places uh three places it seems the editor the reactions and the toolbar so let's see how any of them work uh so inside of the if you if you even want to do this change so if your emoji is working fine you don't have to do this change but in case it's not working let's go ahead and fix this and let me just see something uh do we ever use anything besides the Emoji native no we always use it okay let's improve this let's go and set up the Emoji popover and instead of setting the entire Emoji uh let's call this value and let's simply do value. emoji and I'm not sure if maybe this is even strictly typed does it have it does have type picker props uh Emoji click data perhaps that will be the type here so value will be Emoji click data which you can import from emoji pick or react and that's a type like this so then you can see you have it hardcoded Emoji here there we go and go ahead and change this to be a value of string because we will just be passing this value. Emoji that's all we need now let's find all the places we use Emoji popover starting with the editor component here so that's inside of the source components editor we have the Emoji popover and on emoji select let's see that function here so instead of here we can do this much simpler by this is just a value and string or let's call this Emoji value so we don't overwrite the existing value constant and simply pass in the Emoji value here like this let's go ahead and search further we have it in the reactions component which is already throwing an error here so inside of source components reactions on change instead of emoji do Native we're just passing the Emoji right because this is now a string we Chang it so that on emoji select from the Emoji popover directly gives us the Emoji and the last one is inside of the toolbar so inside of source components toolbar and we also have an error here and we also just have to remove the native because we just improved this by a lot so let's try it out now let's see if it works in all places so I'm going to go ahead and add a smiley and it removed the smiley as we expected uh let's go ahead add this there we go let's go ahead and add uh here all of this seem to work just fine I can add it from here as well perfect so that's how you change your uh Emoji picker if the older one was causing you any problems amazing amazing job now let's go ahead and let's deploy the () project so go ahead and create a new GitHub repository I'm going to go ahead and call this next4 slack CL I'm then going to go ahead and select the private repository option and create repository inside of here I'm going to select the second choice which is an existing repository so I will copy those three lines and in my non-running app I'm going to paste all of them here once I refresh this page there we go my entire project is down here now let's go to ver.com and deploy the app once you you found the add new project button on ver.com you should be able to see the next1 14 slack clone right here and select import and now let's go ahead and let's follow along with verell here but also with convex instructions on deploying to versel so let me zoom in here so we have a versel account we linked the project and now we're doing uh the now we have to do the following overwrite the build command so we have to overwrite the build command to be this npx convex deploy and then uh-- CMD npm run build so I'm going to be using npx and npm here but I think we can also replace this with bunx and Bun Run build right uh so let's go ahead and go inside of new project verell and let's open this and let's click over right here instead of next build it's going to be ntx convex deploy D- CMD npm run build like this all right so we've set that up now we have to set up the convex deploy key environment variable so let's go ahead and go inside of our convex dashboard then settings page and then generate production deploy key so let's prepare the convex deploy key here inside of verell so environment variables convex deploy key let's go inside of our database settings uh and I already forgot what it was there we go so deployment URL and deploy key so let's create a production deployment here like this let's go inside of settings again so now you can see that inside of here I have the option uh of going to production or development for my slack tutorial right so right now I'm in production so let's go inside of settings again and inside of here I now have the option to generate deploy keys so let's click generate production deploy key I'm going to call this production click save uh and there we go we now have this key right here so let's copy that key if that's what we are supposed to do let me just double check yes generate production deploy key and then we have to paste that inside let's go ahead and go to verell here and add the key it should have the prod prefix here and let's click add there we go and I also want to go inside of my environment. local uh next public okay so I don't think we have to add anything else here I think that should be it the only thing we can double check well actually let's hit deploy and then we'll see if we have any errors we'll just go going to go ahead and fix them so I'm going to pause the screen now and I'm going to unpause when this is finished or failed so we can resolve it all right so my deployment failed because it seemed like I'm missing some key props right here so let's go ahead inside of my workspace workspace ID toolbar. TSX let's resolve that so Source app folder workspace workspace ID toolbar. TSX and unfortunately I'm not getting uh the it's a shame that I'm not getting the errors here I think that my linter uh is maybe taking a break so if I reload window will I maybe get the errors now there we go now I'm getting the errors okay so let's go ahead and give our Command item a key here of Channel ID and in here a key of member ID there we go so now in order to resolve this we have to go back inside of our terminal do git add get commit fix uh build errors and get push and get push will automatically uh call another uh another deployment process here so you can click back here and you can just find your project here you can see I have a bunch of projects so going into your latest one here and inside of your deployments you should now see a new deployment has started right so you can go ahead and click here whoops this opened the source code so find a way to open it like this I will pause the screen again and we'll see if we have something more to fix and there we go looks like this time it passed so let's go ahead and let's click on this main domain always look at this this is your main domain everything else are just previous views so let's go ahead and click here and let's see if we can break something so now you should have no channels nothing no users inside so I'm going to go ahead and try and continue with GitHub and it looks like we can't do that here because I think we need to set additional environment variables here so uh let me remind you that inside of our convex here uh where is my you can see that in production I don't have any environment variables here right but inside of my development here I have a bunch of these environment variables so we're going to have to configure those so if we visit convex out again and if we visit the production instructions here you can see that they have the Das Das production flag so let's see if that will help us here so let's go ahead inside of our project and either run npx this or bux this and let's see if that will now uh fix there we go so enter the URL where your site is hosted so for that uh we have to copy this URL so make sure that you copied this one and not the any of the preview ones so this is your url now so let's add this but I will have to slightly modify it by just removing slash out here there we go so this is my full URL where I'm hosting my website so now it's configuring the private and the public key and for the GitHub and for the Google we're going to have to set it up ourselves so now if we visit our database again uh there we go so this is UND development let's go and click production again here there we go now we have these three perfect so we can now I believe already start creating our accounts but let's go ahead and let's configure the Google and GitHub but this time for production deployment so let's go ahead inside of our GitHub settings like the first time with and let's go inside of developer settings here oou apps and let's create a new oou app here and I'm going to call this slack production now for the homepage URL this is our homepage right our basically our new versel URL here and for the authorization callback we don't have to go inside of our uh database make sure you're looking at the production view you need to have prod written here and now we have to find uh I think it's htb actions URL I think this is the one and then you go here and add this SL API slout SL callback SL GitHub like this and click register application like this and now you have the client ID and uh the client secret so there are different ways you can add this to your production on convex now uh you can either go here and just manually add it or if you want to use this I think you can do bonex uh and I'm just not entirely sure so I think is convex environment set out it will be GitHub ID and then paste it here and I think they should have the dash dash prod flag here so if I do that there we go if you add prod it will add on prod here there we go Al GitHub ID so that's how you can add it in production and now let's go ahead and generate the secret from here I just have to verify now let's copy the secret and let's do banex convex environment set out GitHub secret and paste that and D- prod there we go now this is on production as well so if I go ahead and revisit it again I have out GitHub ID and out GitHub secret available here so that should be exactly as I have in my development right there we go out GitHub ID and out GitHub secret and we need to do the same thing for Google here but let's just quickly try out our deployment here is this even working at the moment can I connect my GitHub now there we go I can connect my GitHub and I should be redirected here and say hello world and there we go General is right here hello we are sending messages and our Emoji uh bar seems to be working let's see if the threads are working hello from production let's try it like this hello from production there we go uh let's try sending an image here hello image let's see if that will be working there we go that is working in production as well perfect and I think I've never tried sending an image in thread but I think image in thread should work just fine there we go it works here as well uh perfect amazing uh and now uh what I want to do is also show you how to do the Google uh Cloud solution here so go inside of your Google Cloud platform and let's go ahead and create a new one so I'm going to call this slack production now we'll create a new organization here let's wait a second for slack production here to be finished basically we're doing the exact same thing we did in our first authentication uh chapter right so make sure you're in slack production let's go to apis and services here let's go instead of O out consent screen here and now let me just close this it will be external let's click create we're going to call this slack creation slack Brad let's add an email here skip the logo and add another email here as well click save and continue you can go ahead and click save and continue here and save and continue here and for authorized domains I think that maybe now we can actually add this URL here so let's try doing that uh can I click edit here and let's try and adding authorized domains like this can I do that or just this can it even be subdomain okay I think we can do that perfect now let's go inside of credentials let's click create credentials or our client ID and let's go ahead and select web application it doesn't matter authorize JavaScript Origins here will also be uh our URL like this and authorized redirect URL Uris uh here will be our production make sure you're in production here URL and deploy key HTTP actions URL so make sure it's the production one the same one you've added uh previously to GitHub and so let's go ahead and add this here slash API slout callback SLG gooogle this time and let's click create and now we should receive the client ID so let's go ahead and do banex convex environment set uh out Google ID d-pro make sure you add D- broad at the end and then copy the client secret so that will be bonex convex environment set out Google secret d-r as well and now if I go ahead and visit my environment variables here there we go I have out Google ID out Google secret all of these things so if I try my uh deployment here there we go I'm gonna go ahead and log out and let me try and log in using Google this time and I will select an account of mine here let's see if this will work or not there we go looks like it's working just fine this is my uh Google account here perfect amazing amazing job so one thing I've noticed is that if we go to the root of our application let me do this you can see my URL there we go so if I go to root of my application like without any workspace specified I have this weird you know loader in the corner and my user button so if you want you can resolve that as well by going instead of source app folder page. TSX and simply do one of our you know uh loader things so just copy it from any page with the H full Flex item Center and loader here and just render this instead no need to render anything else at all we don't need the user button like this uh and I think that that should be it so instead of layout here this should be fine uh yeah so now what you would have to do to update this is simply get add get commit fix loading and do get push and you can follow along inside of your verell here by clicking here on deployments there we go it's building another deployment and then that will be fixed great you now have both the production and the development environment you've set up the out and we've shown that the upload works the Emoji Works everything works just fine amazing amazing job thank you so much for watching and see you in the next tutorial









